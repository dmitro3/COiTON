(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[665],{2238:function(e,t,n){"use strict";n.d(t,{Z:function(){return u}});let r=["angular-cli","create-react-app","html","javascript","node","polymer","typescript","vue"],i=["project","search","ports","settings"],o=["light","dark"],a=["editor","preview"],l={clickToLoad:e=>trueParam("ctl",e),devToolsHeight:e=>percentParam("devtoolsheight",e),forceEmbedLayout:e=>trueParam("embed",e),hideDevTools:e=>trueParam("hidedevtools",e),hideExplorer:e=>trueParam("hideExplorer",e),hideNavigation:e=>trueParam("hideNavigation",e),openFile:e=>stringParams("file",e),showSidebar:e=>booleanParam("showSidebar",e),sidebarView:e=>enumParam("sidebarView",e,i),startScript:e=>stringParams("startScript",e),terminalHeight:e=>percentParam("terminalHeight",e),theme:e=>enumParam("theme",e,o),view:e=>enumParam("view",e,a),zenMode:e=>trueParam("zenMode",e)};function buildParams(e={}){let t=Object.entries(e).map(([e,t])=>null!=t&&l.hasOwnProperty(e)?l[e](t):"").filter(Boolean);return t.length?`?${t.join("&")}`:""}function trueParam(e,t){return!0===t?`${e}=1`:""}function booleanParam(e,t){return"boolean"==typeof t?`${e}=${t?"1":"0"}`:""}function percentParam(e,t){return"number"!=typeof t||Number.isNaN(t)?"":`${e}=${encodeURIComponent(Math.round(Math.min(100,Math.max(0,t))))}`}function enumParam(e,t="",n=[]){return n.includes(t)?`${e}=${encodeURIComponent(t)}`:""}function stringParams(e,t){let n=Array.isArray(t)?t:[t];return n.filter(e=>"string"==typeof e&&""!==e.trim()).map(t=>`${e}=${encodeURIComponent(t)}`).join("&")}function genID(){return Math.random().toString(36).slice(2,6)+Math.random().toString(36).slice(2,6)}function openUrl(e,t){return`${getOrigin(t)}${e}${buildParams(t)}`}function embedUrl(e,t){let n={forceEmbedLayout:!0};return t&&"object"==typeof t&&Object.assign(n,t),`${getOrigin(n)}${e}${buildParams(n)}`}function getOrigin(e={}){let t="string"==typeof e.origin?e.origin:"https://stackblitz.com";return t.replace(/\/$/,"")}function replaceAndEmbed(e,t,n){if(!t||!e||!e.parentNode)throw Error("Invalid Element");e.id&&(t.id=e.id),e.className&&(t.className=e.className),setFrameDimensions(t,n),e.replaceWith(t)}function findElement(e){if("string"==typeof e){let t=document.getElementById(e);if(!t)throw Error(`Could not find element with id '${e}'`);return t}if(e instanceof HTMLElement)return e;throw Error(`Invalid element: ${e}`)}function openTarget(e){return e&&!1===e.newWindow?"_self":"_blank"}function setFrameDimensions(e,t={}){let n=Object.hasOwnProperty.call(t,"height")?`${t.height}`:"300",r=Object.hasOwnProperty.call(t,"width")?`${t.width}`:void 0;e.setAttribute("height",n),r?e.setAttribute("width",r):e.setAttribute("style","width:100%;")}let RDC=class RDC{constructor(e){this.pending={},this.port=e,this.port.onmessage=this.messageListener.bind(this)}request({type:e,payload:t}){return new Promise((n,r)=>{let i=genID();this.pending[i]={resolve:n,reject:r},this.port.postMessage({type:e,payload:{...t,__reqid:i}})})}messageListener(e){if("string"!=typeof e.data.payload?.__reqid)return;let{type:t,payload:n}=e.data,{__reqid:r,__success:i,__error:o}=n;this.pending[r]&&(i?this.pending[r].resolve(this.cleanResult(n)):this.pending[r].reject(o?`${t}: ${o}`:t),delete this.pending[r])}cleanResult(e){let t={...e};return delete t.__reqid,delete t.__success,delete t.__error,Object.keys(t).length?t:null}};let VM=class VM{constructor(e,t){this.editor={openFile:e=>this._rdc.request({type:"SDK_OPEN_FILE",payload:{path:e}}),setCurrentFile:e=>this._rdc.request({type:"SDK_SET_CURRENT_FILE",payload:{path:e}}),setTheme:e=>this._rdc.request({type:"SDK_SET_UI_THEME",payload:{theme:e}}),setView:e=>this._rdc.request({type:"SDK_SET_UI_VIEW",payload:{view:e}}),showSidebar:(e=!0)=>this._rdc.request({type:"SDK_TOGGLE_SIDEBAR",payload:{visible:e}})},this.preview={origin:"",getUrl:()=>this._rdc.request({type:"SDK_GET_PREVIEW_URL",payload:{}}).then(e=>e?.url??null),setUrl:(e="/")=>{if("string"!=typeof e||!e.startsWith("/"))throw Error(`Invalid argument: expected a path starting with '/', got '${e}'`);return this._rdc.request({type:"SDK_SET_PREVIEW_URL",payload:{path:e}})}},this._rdc=new RDC(e),Object.defineProperty(this.preview,"origin",{value:"string"==typeof t.previewOrigin?t.previewOrigin:null,writable:!1})}applyFsDiff(e){var t;if(null!==e&&"object"==typeof e&&null!==(t=e.create)&&"object"==typeof t){if(!Array.isArray(e.destroy))throw Error("Invalid diff object: expected diff.destroy to be an array.")}else throw Error("Invalid diff object: expected diff.create to be an object.");return this._rdc.request({type:"SDK_APPLY_FS_DIFF",payload:e})}getDependencies(){return this._rdc.request({type:"SDK_GET_DEPS_SNAPSHOT",payload:{}})}getFsSnapshot(){return this._rdc.request({type:"SDK_GET_FS_SNAPSHOT",payload:{}})}};let c=[];let Connection=class Connection{constructor(e){this.id=genID(),this.element=e,this.pending=new Promise((e,t)=>{let listenForSuccess=({data:t,ports:n})=>{t?.action==="SDK_INIT_SUCCESS"&&t.id===this.id&&(this.vm=new VM(n[0],t.payload),e(this.vm),cleanup())},pingFrame=()=>{this.element.contentWindow?.postMessage({action:"SDK_INIT",id:this.id},"*")};function cleanup(){window.clearInterval(r),window.removeEventListener("message",listenForSuccess)}window.addEventListener("message",listenForSuccess),pingFrame();let n=0,r=window.setInterval(()=>{if(this.vm){cleanup();return}if(n>=20){cleanup(),t("Timeout: Unable to establish a connection with the StackBlitz VM"),c.forEach((e,t)=>{e.id===this.id&&c.splice(t,1)});return}n++,pingFrame()},500)}),c.push(this)}};let getConnection=e=>{let t=e instanceof Element?"element":"id";return c.find(n=>n[t]===e)??null};function createHiddenInput(e,t){let n=document.createElement("input");return n.type="hidden",n.name=e,n.value=t,n}function encodeFilePath(e){return e.replace(/\[/g,"%5B").replace(/\]/g,"%5D")}function createProjectForm({template:e,title:t,description:n,dependencies:i,files:o,settings:a}){if(!r.includes(e)){let e=r.map(e=>`'${e}'`).join(", ");console.warn(`Unsupported project.template: must be one of ${e}`)}let l=[],addInput=(e,t,n="")=>{l.push(createHiddenInput(e,"string"==typeof t?t:n))};addInput("project[title]",t),"string"==typeof n&&n.length>0&&addInput("project[description]",n),addInput("project[template]",e,"javascript"),i&&("node"===e?console.warn("Invalid project.dependencies: dependencies must be provided as a 'package.json' file when using the 'node' template."):addInput("project[dependencies]",JSON.stringify(i))),a&&addInput("project[settings]",JSON.stringify(a)),Object.entries(o).forEach(([e,t])=>{addInput(`project[files][${encodeFilePath(e)}]`,t)});let c=document.createElement("form");return c.method="POST",c.setAttribute("style","display:none!important;"),c.append(...l),c}function createProjectFrameHTML(e,t){let n=createProjectForm(e);n.action=embedUrl("/run",t),n.id="sb_run";let r=`<!doctype html>
<html>
<head><title></title></head>
<body>
  ${n.outerHTML}
  <script>document.getElementById('${n.id}').submit();</script>
</body>
</html>`;return r}function openNewProject(e,t){let n=createProjectForm(e);n.action=openUrl("/run",t),n.target=openTarget(t),document.body.appendChild(n),n.submit(),document.body.removeChild(n)}function connect(e){if(!e?.contentWindow)return Promise.reject("Provided element is not an iframe.");let t=getConnection(e)??new Connection(e);return t.pending}function openProject(e,t){openNewProject(e,t)}function openProjectId(e,t){let n=openUrl(`/edit/${e}`,t),r=openTarget(t);window.open(n,r)}function openGithubProject(e,t){let n=openUrl(`/github/${e}`,t),r=openTarget(t);window.open(n,r)}function embedProject(e,t,n){let r=findElement(e),i=createProjectFrameHTML(t,n),o=document.createElement("iframe");return replaceAndEmbed(r,o,n),o.contentDocument?.write(i),connect(o)}function embedProjectId(e,t,n){let r=findElement(e),i=document.createElement("iframe");return i.src=embedUrl(`/edit/${t}`,n),replaceAndEmbed(r,i,n),connect(i)}function embedGithubProject(e,t,n){let r=findElement(e),i=document.createElement("iframe");return i.src=embedUrl(`/github/${t}`,n),replaceAndEmbed(r,i,n),connect(i)}let u={connect,embedGithubProject,embedProject,embedProjectId,openGithubProject,openProject,openProjectId}},2729:function(){},1779:function(e,t,n){"use strict";n.r(t),n.d(t,{hideOthers:function(){return hideOthers},inertOthers:function(){return inertOthers},supportsInert:function(){return supportsInert},suppressOthers:function(){return suppressOthers}});var getDefaultParent=function(e){return"undefined"==typeof document?null:(Array.isArray(e)?e[0]:e).ownerDocument.body},r=new WeakMap,i=new WeakMap,o={},a=0,unwrapHost=function(e){return e&&(e.host||unwrapHost(e.parentNode))},applyAttributeToOthers=function(e,t,n,l){var c=(Array.isArray(e)?e:[e]).map(function(e){if(t.contains(e))return e;var n=unwrapHost(e);return n&&t.contains(n)?n:(console.error("aria-hidden",e,"in not contained inside",t,". Doing nothing"),null)}).filter(function(e){return!!e});o[n]||(o[n]=new WeakMap);var u=o[n],d=[],p=new Set,h=new Set(c),keep=function(e){!e||p.has(e)||(p.add(e),keep(e.parentNode))};c.forEach(keep);var deep=function(e){!e||h.has(e)||Array.prototype.forEach.call(e.children,function(e){if(p.has(e))deep(e);else{var t=e.getAttribute(l),o=null!==t&&"false"!==t,a=(r.get(e)||0)+1,c=(u.get(e)||0)+1;r.set(e,a),u.set(e,c),d.push(e),1===a&&o&&i.set(e,!0),1===c&&e.setAttribute(n,"true"),o||e.setAttribute(l,"true")}})};return deep(t),p.clear(),a++,function(){d.forEach(function(e){var t=r.get(e)-1,o=u.get(e)-1;r.set(e,t),u.set(e,o),t||(i.has(e)||e.removeAttribute(l),i.delete(e)),o||e.removeAttribute(n)}),--a||(r=new WeakMap,r=new WeakMap,i=new WeakMap,o={})}},hideOthers=function(e,t,n){void 0===n&&(n="data-aria-hidden");var r=Array.from(Array.isArray(e)?e:[e]),i=t||getDefaultParent(e);return i?(r.push.apply(r,Array.from(i.querySelectorAll("[aria-live]"))),applyAttributeToOthers(r,i,n,"aria-hidden")):function(){return null}},inertOthers=function(e,t,n){void 0===n&&(n="data-inert-ed");var r=t||getDefaultParent(e);return r?applyAttributeToOthers(e,r,n,"inert"):function(){return null}},supportsInert=function(){return"undefined"!=typeof HTMLElement&&HTMLElement.prototype.hasOwnProperty("inert")},suppressOthers=function(e,t,n){return void 0===n&&(n="data-suppressed"),(supportsInert()?inertOthers:hideOthers)(e,t,n)}},8729:function(e){"use strict";var t=Object.prototype.hasOwnProperty,n="~";function Events(){}function EE(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function addListener(e,t,r,i,o){if("function"!=typeof r)throw TypeError("The listener must be a function");var a=new EE(r,i||e,o),l=n?n+t:t;return e._events[l]?e._events[l].fn?e._events[l]=[e._events[l],a]:e._events[l].push(a):(e._events[l]=a,e._eventsCount++),e}function clearEvent(e,t){0==--e._eventsCount?e._events=new Events:delete e._events[t]}function EventEmitter(){this._events=new Events,this._eventsCount=0}Object.create&&(Events.prototype=Object.create(null),new Events().__proto__||(n=!1)),EventEmitter.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},EventEmitter.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,a=Array(o);i<o;i++)a[i]=r[i].fn;return a},EventEmitter.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},EventEmitter.prototype.emit=function(e,t,r,i,o,a){var l=n?n+e:e;if(!this._events[l])return!1;var c,u,d=this._events[l],p=arguments.length;if(d.fn){switch(d.once&&this.removeListener(e,d.fn,void 0,!0),p){case 1:return d.fn.call(d.context),!0;case 2:return d.fn.call(d.context,t),!0;case 3:return d.fn.call(d.context,t,r),!0;case 4:return d.fn.call(d.context,t,r,i),!0;case 5:return d.fn.call(d.context,t,r,i,o),!0;case 6:return d.fn.call(d.context,t,r,i,o,a),!0}for(u=1,c=Array(p-1);u<p;u++)c[u-1]=arguments[u];d.fn.apply(d.context,c)}else{var h,g=d.length;for(u=0;u<g;u++)switch(d[u].once&&this.removeListener(e,d[u].fn,void 0,!0),p){case 1:d[u].fn.call(d[u].context);break;case 2:d[u].fn.call(d[u].context,t);break;case 3:d[u].fn.call(d[u].context,t,r);break;case 4:d[u].fn.call(d[u].context,t,r,i);break;default:if(!c)for(h=1,c=Array(p-1);h<p;h++)c[h-1]=arguments[h];d[u].fn.apply(d[u].context,c)}}return!0},EventEmitter.prototype.on=function(e,t,n){return addListener(this,e,t,n,!1)},EventEmitter.prototype.once=function(e,t,n){return addListener(this,e,t,n,!0)},EventEmitter.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return clearEvent(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||clearEvent(this,o);else{for(var l=0,c=[],u=a.length;l<u;l++)(a[l].fn!==t||i&&!a[l].once||r&&a[l].context!==r)&&c.push(a[l]);c.length?this._events[o]=1===c.length?c[0]:c:clearEvent(this,o)}return this},EventEmitter.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&clearEvent(this,t)):(this._events=new Events,this._eventsCount=0),this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prefixed=n,EventEmitter.EventEmitter=EventEmitter,e.exports=EventEmitter},9780:function(e,t,n){e=n.nmd(e);var r,i="__lodash_hash_undefined__",o="[object Arguments]",a="[object Array]",l="[object Boolean]",c="[object Date]",u="[object Error]",d="[object Function]",p="[object Map]",h="[object Number]",g="[object Object]",f="[object Promise]",m="[object RegExp]",y="[object Set]",b="[object String]",w="[object WeakMap]",S="[object ArrayBuffer]",v="[object DataView]",x=/^\[object .+?Constructor\]$/,T=/^(?:0|[1-9]\d*)$/,P={};P["[object Float32Array]"]=P["[object Float64Array]"]=P["[object Int8Array]"]=P["[object Int16Array]"]=P["[object Int32Array]"]=P["[object Uint8Array]"]=P["[object Uint8ClampedArray]"]=P["[object Uint16Array]"]=P["[object Uint32Array]"]=!0,P[o]=P[a]=P[S]=P[l]=P[v]=P[c]=P[u]=P[d]=P[p]=P[h]=P[g]=P[m]=P[y]=P[b]=P[w]=!1;var C="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,k="object"==typeof self&&self&&self.Object===Object&&self,I=C||k||Function("return this")(),E=t&&!t.nodeType&&t,_=E&&e&&!e.nodeType&&e,M=_&&_.exports===E,j=M&&C.process,A=function(){try{return j&&j.binding&&j.binding("util")}catch(e){}}(),$=A&&A.isTypedArray;function arrayFilter(e,t){for(var n=-1,r=null==e?0:e.length,i=0,o=[];++n<r;){var a=e[n];t(a,n,e)&&(o[i++]=a)}return o}function arrayPush(e,t){for(var n=-1,r=t.length,i=e.length;++n<r;)e[i+n]=t[n];return e}function arraySome(e,t){for(var n=-1,r=null==e?0:e.length;++n<r;)if(t(e[n],n,e))return!0;return!1}function baseTimes(e,t){for(var n=-1,r=Array(e);++n<e;)r[n]=t(n);return r}function baseUnary(e){return function(t){return e(t)}}function cacheHas(e,t){return e.has(t)}function getValue(e,t){return null==e?void 0:e[t]}function mapToArray(e){var t=-1,n=Array(e.size);return e.forEach(function(e,r){n[++t]=[r,e]}),n}function overArg(e,t){return function(n){return e(t(n))}}function setToArray(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var D=Array.prototype,O=Function.prototype,B=Object.prototype,F=I["__core-js_shared__"],U=O.toString,L=B.hasOwnProperty,R=(r=/[^.]+$/.exec(F&&F.keys&&F.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",z=B.toString,N=RegExp("^"+U.call(L).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),V=M?I.Buffer:void 0,H=I.Symbol,G=I.Uint8Array,W=B.propertyIsEnumerable,Z=D.splice,K=H?H.toStringTag:void 0,Y=Object.getOwnPropertySymbols,X=V?V.isBuffer:void 0,J=overArg(Object.keys,Object),Q=getNative(I,"DataView"),ee=getNative(I,"Map"),et=getNative(I,"Promise"),en=getNative(I,"Set"),er=getNative(I,"WeakMap"),ei=getNative(Object,"create"),eo=toSource(Q),ea=toSource(ee),es=toSource(et),el=toSource(en),ec=toSource(er),eu=H?H.prototype:void 0,ed=eu?eu.valueOf:void 0;function Hash(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function hashClear(){this.__data__=ei?ei(null):{},this.size=0}function hashDelete(e){var t=this.has(e)&&delete this.__data__[e];return this.size-=t?1:0,t}function hashGet(e){var t=this.__data__;if(ei){var n=t[e];return n===i?void 0:n}return L.call(t,e)?t[e]:void 0}function hashHas(e){var t=this.__data__;return ei?void 0!==t[e]:L.call(t,e)}function hashSet(e,t){var n=this.__data__;return this.size+=this.has(e)?0:1,n[e]=ei&&void 0===t?i:t,this}function ListCache(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function listCacheClear(){this.__data__=[],this.size=0}function listCacheDelete(e){var t=this.__data__,n=assocIndexOf(t,e);return!(n<0)&&(n==t.length-1?t.pop():Z.call(t,n,1),--this.size,!0)}function listCacheGet(e){var t=this.__data__,n=assocIndexOf(t,e);return n<0?void 0:t[n][1]}function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1}function listCacheSet(e,t){var n=this.__data__,r=assocIndexOf(n,e);return r<0?(++this.size,n.push([e,t])):n[r][1]=t,this}function MapCache(e){var t=-1,n=null==e?0:e.length;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function mapCacheClear(){this.size=0,this.__data__={hash:new Hash,map:new(ee||ListCache),string:new Hash}}function mapCacheDelete(e){var t=getMapData(this,e).delete(e);return this.size-=t?1:0,t}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){var n=getMapData(this,e),r=n.size;return n.set(e,t),this.size+=n.size==r?0:1,this}function SetCache(e){var t=-1,n=null==e?0:e.length;for(this.__data__=new MapCache;++t<n;)this.add(e[t])}function setCacheAdd(e){return this.__data__.set(e,i),this}function setCacheHas(e){return this.__data__.has(e)}function Stack(e){var t=this.__data__=new ListCache(e);this.size=t.size}function stackClear(){this.__data__=new ListCache,this.size=0}function stackDelete(e){var t=this.__data__,n=t.delete(e);return this.size=t.size,n}function stackGet(e){return this.__data__.get(e)}function stackHas(e){return this.__data__.has(e)}function stackSet(e,t){var n=this.__data__;if(n instanceof ListCache){var r=n.__data__;if(!ee||r.length<199)return r.push([e,t]),this.size=++n.size,this;n=this.__data__=new MapCache(r)}return n.set(e,t),this.size=n.size,this}function arrayLikeKeys(e,t){var n=ef(e),r=!n&&eg(e),i=!n&&!r&&em(e),o=!n&&!r&&!i&&ey(e),a=n||r||i||o,l=a?baseTimes(e.length,String):[],c=l.length;for(var u in e)(t||L.call(e,u))&&!(a&&("length"==u||i&&("offset"==u||"parent"==u)||o&&("buffer"==u||"byteLength"==u||"byteOffset"==u)||isIndex(u,c)))&&l.push(u);return l}function assocIndexOf(e,t){for(var n=e.length;n--;)if(eq(e[n][0],t))return n;return -1}function baseGetAllKeys(e,t,n){var r=t(e);return ef(e)?r:arrayPush(r,n(e))}function baseGetTag(e){return null==e?void 0===e?"[object Undefined]":"[object Null]":K&&K in Object(e)?getRawTag(e):objectToString(e)}function baseIsArguments(e){return isObjectLike(e)&&baseGetTag(e)==o}function baseIsEqual(e,t,n,r,i){return e===t||(null!=e&&null!=t&&(isObjectLike(e)||isObjectLike(t))?baseIsEqualDeep(e,t,n,r,baseIsEqual,i):e!=e&&t!=t)}function baseIsEqualDeep(e,t,n,r,i,l){var c=ef(e),u=ef(t),d=c?a:eh(e),p=u?a:eh(t);d=d==o?g:d,p=p==o?g:p;var h=d==g,f=p==g,m=d==p;if(m&&em(e)){if(!em(t))return!1;c=!0,h=!1}if(m&&!h)return l||(l=new Stack),c||ey(e)?equalArrays(e,t,n,r,i,l):equalByTag(e,t,d,n,r,i,l);if(!(1&n)){var y=h&&L.call(e,"__wrapped__"),b=f&&L.call(t,"__wrapped__");if(y||b){var w=y?e.value():e,S=b?t.value():t;return l||(l=new Stack),i(w,S,n,r,l)}}return!!m&&(l||(l=new Stack),equalObjects(e,t,n,r,i,l))}function baseIsNative(e){return!(!isObject(e)||isMasked(e))&&(isFunction(e)?N:x).test(toSource(e))}function baseIsTypedArray(e){return isObjectLike(e)&&isLength(e.length)&&!!P[baseGetTag(e)]}function baseKeys(e){if(!isPrototype(e))return J(e);var t=[];for(var n in Object(e))L.call(e,n)&&"constructor"!=n&&t.push(n);return t}function equalArrays(e,t,n,r,i,o){var a=1&n,l=e.length,c=t.length;if(l!=c&&!(a&&c>l))return!1;var u=o.get(e);if(u&&o.get(t))return u==t;var d=-1,p=!0,h=2&n?new SetCache:void 0;for(o.set(e,t),o.set(t,e);++d<l;){var g=e[d],f=t[d];if(r)var m=a?r(f,g,d,t,e,o):r(g,f,d,e,t,o);if(void 0!==m){if(m)continue;p=!1;break}if(h){if(!arraySome(t,function(e,t){if(!cacheHas(h,t)&&(g===e||i(g,e,n,r,o)))return h.push(t)})){p=!1;break}}else if(!(g===f||i(g,f,n,r,o))){p=!1;break}}return o.delete(e),o.delete(t),p}function equalByTag(e,t,n,r,i,o,a){switch(n){case v:if(e.byteLength!=t.byteLength||e.byteOffset!=t.byteOffset)break;e=e.buffer,t=t.buffer;case S:if(e.byteLength!=t.byteLength||!o(new G(e),new G(t)))break;return!0;case l:case c:case h:return eq(+e,+t);case u:return e.name==t.name&&e.message==t.message;case m:case b:return e==t+"";case p:var d=mapToArray;case y:var g=1&r;if(d||(d=setToArray),e.size!=t.size&&!g)break;var f=a.get(e);if(f)return f==t;r|=2,a.set(e,t);var w=equalArrays(d(e),d(t),r,i,o,a);return a.delete(e),w;case"[object Symbol]":if(ed)return ed.call(e)==ed.call(t)}return!1}function equalObjects(e,t,n,r,i,o){var a=1&n,l=baseGetAllKeys(e,keys,ep),c=l.length;if(c!=baseGetAllKeys(t,keys,ep).length&&!a)return!1;for(var u=c;u--;){var d=l[u];if(!(a?d in t:L.call(t,d)))return!1}var p=o.get(e);if(p&&o.get(t))return p==t;var h=!0;o.set(e,t),o.set(t,e);for(var g=a;++u<c;){var f=e[d=l[u]],m=t[d];if(r)var y=a?r(m,f,d,t,e,o):r(f,m,d,e,t,o);if(!(void 0===y?f===m||i(f,m,n,r,o):y)){h=!1;break}g||(g="constructor"==d)}if(h&&!g){var b=e.constructor,w=t.constructor;b!=w&&"constructor"in e&&"constructor"in t&&!("function"==typeof b&&b instanceof b&&"function"==typeof w&&w instanceof w)&&(h=!1)}return o.delete(e),o.delete(t),h}function getMapData(e,t){var n=e.__data__;return isKeyable(t)?n["string"==typeof t?"string":"hash"]:n.map}function getNative(e,t){var n=getValue(e,t);return baseIsNative(n)?n:void 0}function getRawTag(e){var t=L.call(e,K),n=e[K];try{e[K]=void 0;var r=!0}catch(e){}var i=z.call(e);return r&&(t?e[K]=n:delete e[K]),i}Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet,MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet,SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas,Stack.prototype.clear=stackClear,Stack.prototype.delete=stackDelete,Stack.prototype.get=stackGet,Stack.prototype.has=stackHas,Stack.prototype.set=stackSet;var ep=Y?function(e){return null==e?[]:arrayFilter(Y(e=Object(e)),function(t){return W.call(e,t)})}:stubArray,eh=baseGetTag;function isIndex(e,t){return!!(t=null==t?9007199254740991:t)&&("number"==typeof e||T.test(e))&&e>-1&&e%1==0&&e<t}function isKeyable(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function isMasked(e){return!!R&&R in e}function isPrototype(e){var t=e&&e.constructor;return e===("function"==typeof t&&t.prototype||B)}function objectToString(e){return z.call(e)}function toSource(e){if(null!=e){try{return U.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function eq(e,t){return e===t||e!=e&&t!=t}(Q&&eh(new Q(new ArrayBuffer(1)))!=v||ee&&eh(new ee)!=p||et&&eh(et.resolve())!=f||en&&eh(new en)!=y||er&&eh(new er)!=w)&&(eh=function(e){var t=baseGetTag(e),n=t==g?e.constructor:void 0,r=n?toSource(n):"";if(r)switch(r){case eo:return v;case ea:return p;case es:return f;case el:return y;case ec:return w}return t});var eg=baseIsArguments(function(){return arguments}())?baseIsArguments:function(e){return isObjectLike(e)&&L.call(e,"callee")&&!W.call(e,"callee")},ef=Array.isArray;function isArrayLike(e){return null!=e&&isLength(e.length)&&!isFunction(e)}var em=X||stubFalse;function isEqual(e,t){return baseIsEqual(e,t)}function isFunction(e){if(!isObject(e))return!1;var t=baseGetTag(e);return t==d||"[object GeneratorFunction]"==t||"[object AsyncFunction]"==t||"[object Proxy]"==t}function isLength(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}function isObject(e){var t=typeof e;return null!=e&&("object"==t||"function"==t)}function isObjectLike(e){return null!=e&&"object"==typeof e}var ey=$?baseUnary($):baseIsTypedArray;function keys(e){return isArrayLike(e)?arrayLikeKeys(e):baseKeys(e)}function stubArray(){return[]}function stubFalse(){return!1}e.exports=isEqual},6978:function(e,t,n){var r="Expected a function",i=0/0,o=/^\s+|\s+$/g,a=/^[-+]0x[0-9a-f]+$/i,l=/^0b[01]+$/i,c=/^0o[0-7]+$/i,u=parseInt,d="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,p="object"==typeof self&&self&&self.Object===Object&&self,h=d||p||Function("return this")(),g=Object.prototype.toString,f=Math.max,m=Math.min,now=function(){return h.Date.now()};function debounce(e,t,n){var i,o,a,l,c,u,d=0,p=!1,h=!1,g=!0;if("function"!=typeof e)throw TypeError(r);function invokeFunc(t){var n=i,r=o;return i=o=void 0,d=t,l=e.apply(r,n)}function leadingEdge(e){return d=e,c=setTimeout(timerExpired,t),p?invokeFunc(e):l}function remainingWait(e){var n=e-u,r=e-d,i=t-n;return h?m(i,a-r):i}function shouldInvoke(e){var n=e-u,r=e-d;return void 0===u||n>=t||n<0||h&&r>=a}function timerExpired(){var e=now();if(shouldInvoke(e))return trailingEdge(e);c=setTimeout(timerExpired,remainingWait(e))}function trailingEdge(e){return(c=void 0,g&&i)?invokeFunc(e):(i=o=void 0,l)}function cancel(){void 0!==c&&clearTimeout(c),d=0,i=u=o=c=void 0}function flush(){return void 0===c?l:trailingEdge(now())}function debounced(){var e=now(),n=shouldInvoke(e);if(i=arguments,o=this,u=e,n){if(void 0===c)return leadingEdge(u);if(h)return c=setTimeout(timerExpired,t),invokeFunc(u)}return void 0===c&&(c=setTimeout(timerExpired,t)),l}return t=toNumber(t)||0,isObject(n)&&(p=!!n.leading,a=(h="maxWait"in n)?f(toNumber(n.maxWait)||0,t):a,g="trailing"in n?!!n.trailing:g),debounced.cancel=cancel,debounced.flush=flush,debounced}function throttle(e,t,n){var i=!0,o=!0;if("function"!=typeof e)throw TypeError(r);return isObject(n)&&(i="leading"in n?!!n.leading:i,o="trailing"in n?!!n.trailing:o),debounce(e,t,{leading:i,maxWait:t,trailing:o})}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function isObjectLike(e){return!!e&&"object"==typeof e}function isSymbol(e){return"symbol"==typeof e||isObjectLike(e)&&"[object Symbol]"==g.call(e)}function toNumber(e){if("number"==typeof e)return e;if(isSymbol(e))return i;if(isObject(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=isObject(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(o,"");var n=l.test(e);return n||c.test(e)?u(e.slice(2),n?2:8):a.test(e)?i:+e}e.exports=throttle},528:function(e,t,n){var r,i="__lodash_hash_undefined__",o=/^\[object .+?Constructor\]$/,a="object"==typeof n.g&&n.g&&n.g.Object===Object&&n.g,l="object"==typeof self&&self&&self.Object===Object&&self,c=a||l||Function("return this")();function arrayIncludes(e,t){return!!(e?e.length:0)&&baseIndexOf(e,t,0)>-1}function arrayIncludesWith(e,t,n){for(var r=-1,i=e?e.length:0;++r<i;)if(n(t,e[r]))return!0;return!1}function baseFindIndex(e,t,n,r){for(var i=e.length,o=n+(r?1:-1);r?o--:++o<i;)if(t(e[o],o,e))return o;return -1}function baseIndexOf(e,t,n){if(t!=t)return baseFindIndex(e,baseIsNaN,n);for(var r=n-1,i=e.length;++r<i;)if(e[r]===t)return r;return -1}function baseIsNaN(e){return e!=e}function cacheHas(e,t){return e.has(t)}function getValue(e,t){return null==e?void 0:e[t]}function isHostObject(e){var t=!1;if(null!=e&&"function"!=typeof e.toString)try{t=!!(e+"")}catch(e){}return t}function setToArray(e){var t=-1,n=Array(e.size);return e.forEach(function(e){n[++t]=e}),n}var u=Array.prototype,d=Function.prototype,p=Object.prototype,h=c["__core-js_shared__"],g=(r=/[^.]+$/.exec(h&&h.keys&&h.keys.IE_PROTO||""))?"Symbol(src)_1."+r:"",f=d.toString,m=p.hasOwnProperty,y=p.toString,b=RegExp("^"+f.call(m).replace(/[\\^$.*+?()[\]{}|]/g,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),w=u.splice,S=getNative(c,"Map"),v=getNative(c,"Set"),x=getNative(Object,"create");function Hash(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function hashClear(){this.__data__=x?x(null):{}}function hashDelete(e){return this.has(e)&&delete this.__data__[e]}function hashGet(e){var t=this.__data__;if(x){var n=t[e];return n===i?void 0:n}return m.call(t,e)?t[e]:void 0}function hashHas(e){var t=this.__data__;return x?void 0!==t[e]:m.call(t,e)}function hashSet(e,t){return this.__data__[e]=x&&void 0===t?i:t,this}function ListCache(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function listCacheClear(){this.__data__=[]}function listCacheDelete(e){var t=this.__data__,n=assocIndexOf(t,e);return!(n<0)&&(n==t.length-1?t.pop():w.call(t,n,1),!0)}function listCacheGet(e){var t=this.__data__,n=assocIndexOf(t,e);return n<0?void 0:t[n][1]}function listCacheHas(e){return assocIndexOf(this.__data__,e)>-1}function listCacheSet(e,t){var n=this.__data__,r=assocIndexOf(n,e);return r<0?n.push([e,t]):n[r][1]=t,this}function MapCache(e){var t=-1,n=e?e.length:0;for(this.clear();++t<n;){var r=e[t];this.set(r[0],r[1])}}function mapCacheClear(){this.__data__={hash:new Hash,map:new(S||ListCache),string:new Hash}}function mapCacheDelete(e){return getMapData(this,e).delete(e)}function mapCacheGet(e){return getMapData(this,e).get(e)}function mapCacheHas(e){return getMapData(this,e).has(e)}function mapCacheSet(e,t){return getMapData(this,e).set(e,t),this}function SetCache(e){var t=-1,n=e?e.length:0;for(this.__data__=new MapCache;++t<n;)this.add(e[t])}function setCacheAdd(e){return this.__data__.set(e,i),this}function setCacheHas(e){return this.__data__.has(e)}function assocIndexOf(e,t){for(var n=e.length;n--;)if(eq(e[n][0],t))return n;return -1}function baseIsNative(e){return!(!isObject(e)||isMasked(e))&&(isFunction(e)||isHostObject(e)?b:o).test(toSource(e))}function baseUniq(e,t,n){var r=-1,i=arrayIncludes,o=e.length,a=!0,l=[],c=l;if(n)a=!1,i=arrayIncludesWith;else if(o>=200){var u=t?null:T(e);if(u)return setToArray(u);a=!1,i=cacheHas,c=new SetCache}else c=t?[]:l;e:for(;++r<o;){var d=e[r],p=t?t(d):d;if(d=n||0!==d?d:0,a&&p==p){for(var h=c.length;h--;)if(c[h]===p)continue e;t&&c.push(p),l.push(d)}else i(c,p,n)||(c!==l&&c.push(p),l.push(d))}return l}Hash.prototype.clear=hashClear,Hash.prototype.delete=hashDelete,Hash.prototype.get=hashGet,Hash.prototype.has=hashHas,Hash.prototype.set=hashSet,ListCache.prototype.clear=listCacheClear,ListCache.prototype.delete=listCacheDelete,ListCache.prototype.get=listCacheGet,ListCache.prototype.has=listCacheHas,ListCache.prototype.set=listCacheSet,MapCache.prototype.clear=mapCacheClear,MapCache.prototype.delete=mapCacheDelete,MapCache.prototype.get=mapCacheGet,MapCache.prototype.has=mapCacheHas,MapCache.prototype.set=mapCacheSet,SetCache.prototype.add=SetCache.prototype.push=setCacheAdd,SetCache.prototype.has=setCacheHas;var T=v&&1/setToArray(new v([,-0]))[1]==1/0?function(e){return new v(e)}:noop;function getMapData(e,t){var n=e.__data__;return isKeyable(t)?n["string"==typeof t?"string":"hash"]:n.map}function getNative(e,t){var n=getValue(e,t);return baseIsNative(n)?n:void 0}function isKeyable(e){var t=typeof e;return"string"==t||"number"==t||"symbol"==t||"boolean"==t?"__proto__"!==e:null===e}function isMasked(e){return!!g&&g in e}function toSource(e){if(null!=e){try{return f.call(e)}catch(e){}try{return e+""}catch(e){}}return""}function uniq(e){return e&&e.length?baseUniq(e):[]}function eq(e,t){return e===t||e!=e&&t!=t}function isFunction(e){var t=isObject(e)?y.call(e):"";return"[object Function]"==t||"[object GeneratorFunction]"==t}function isObject(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}function noop(){}e.exports=uniq},352:function(e,t,n){var r,i=function(){var e=String.fromCharCode,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+-$",r={};function getBaseValue(e,t){if(!r[e]){r[e]={};for(var n=0;n<e.length;n++)r[e][e.charAt(n)]=n}return r[e][t]}var i={compressToBase64:function(e){if(null==e)return"";var n=i._compress(e,6,function(e){return t.charAt(e)});switch(n.length%4){default:case 0:return n;case 1:return n+"===";case 2:return n+"==";case 3:return n+"="}},decompressFromBase64:function(e){return null==e?"":""==e?null:i._decompress(e.length,32,function(n){return getBaseValue(t,e.charAt(n))})},compressToUTF16:function(t){return null==t?"":i._compress(t,15,function(t){return e(t+32)})+" "},decompressFromUTF16:function(e){return null==e?"":""==e?null:i._decompress(e.length,16384,function(t){return e.charCodeAt(t)-32})},compressToUint8Array:function(e){for(var t=i.compress(e),n=new Uint8Array(2*t.length),r=0,o=t.length;r<o;r++){var a=t.charCodeAt(r);n[2*r]=a>>>8,n[2*r+1]=a%256}return n},decompressFromUint8Array:function(t){if(null==t)return i.decompress(t);for(var n=Array(t.length/2),r=0,o=n.length;r<o;r++)n[r]=256*t[2*r]+t[2*r+1];var a=[];return n.forEach(function(t){a.push(e(t))}),i.decompress(a.join(""))},compressToEncodedURIComponent:function(e){return null==e?"":i._compress(e,6,function(e){return n.charAt(e)})},decompressFromEncodedURIComponent:function(e){return null==e?"":""==e?null:(e=e.replace(/ /g,"+"),i._decompress(e.length,32,function(t){return getBaseValue(n,e.charAt(t))}))},compress:function(t){return i._compress(t,16,function(t){return e(t)})},_compress:function(e,t,n){if(null==e)return"";var r,i,o,a={},l={},c="",u="",d="",p=2,h=3,g=2,f=[],m=0,y=0;for(o=0;o<e.length;o+=1)if(c=e.charAt(o),Object.prototype.hasOwnProperty.call(a,c)||(a[c]=h++,l[c]=!0),u=d+c,Object.prototype.hasOwnProperty.call(a,u))d=u;else{if(Object.prototype.hasOwnProperty.call(l,d)){if(256>d.charCodeAt(0)){for(r=0;r<g;r++)m<<=1,y==t-1?(y=0,f.push(n(m)),m=0):y++;for(r=0,i=d.charCodeAt(0);r<8;r++)m=m<<1|1&i,y==t-1?(y=0,f.push(n(m)),m=0):y++,i>>=1}else{for(r=0,i=1;r<g;r++)m=m<<1|i,y==t-1?(y=0,f.push(n(m)),m=0):y++,i=0;for(r=0,i=d.charCodeAt(0);r<16;r++)m=m<<1|1&i,y==t-1?(y=0,f.push(n(m)),m=0):y++,i>>=1}0==--p&&(p=Math.pow(2,g),g++),delete l[d]}else for(r=0,i=a[d];r<g;r++)m=m<<1|1&i,y==t-1?(y=0,f.push(n(m)),m=0):y++,i>>=1;0==--p&&(p=Math.pow(2,g),g++),a[u]=h++,d=String(c)}if(""!==d){if(Object.prototype.hasOwnProperty.call(l,d)){if(256>d.charCodeAt(0)){for(r=0;r<g;r++)m<<=1,y==t-1?(y=0,f.push(n(m)),m=0):y++;for(r=0,i=d.charCodeAt(0);r<8;r++)m=m<<1|1&i,y==t-1?(y=0,f.push(n(m)),m=0):y++,i>>=1}else{for(r=0,i=1;r<g;r++)m=m<<1|i,y==t-1?(y=0,f.push(n(m)),m=0):y++,i=0;for(r=0,i=d.charCodeAt(0);r<16;r++)m=m<<1|1&i,y==t-1?(y=0,f.push(n(m)),m=0):y++,i>>=1}0==--p&&(p=Math.pow(2,g),g++),delete l[d]}else for(r=0,i=a[d];r<g;r++)m=m<<1|1&i,y==t-1?(y=0,f.push(n(m)),m=0):y++,i>>=1;0==--p&&(p=Math.pow(2,g),g++)}for(r=0,i=2;r<g;r++)m=m<<1|1&i,y==t-1?(y=0,f.push(n(m)),m=0):y++,i>>=1;for(;;){if(m<<=1,y==t-1){f.push(n(m));break}y++}return f.join("")},decompress:function(e){return null==e?"":""==e?null:i._decompress(e.length,32768,function(t){return e.charCodeAt(t)})},_decompress:function(t,n,r){var i,o,a,l,c,u,d,p=[],h=4,g=4,f=3,m="",y=[],b={val:r(0),position:n,index:1};for(i=0;i<3;i+=1)p[i]=i;for(a=0,c=4,u=1;u!=c;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(l>0?1:0)*u,u<<=1;switch(a){case 0:for(a=0,c=256,u=1;u!=c;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(l>0?1:0)*u,u<<=1;d=e(a);break;case 1:for(a=0,c=65536,u=1;u!=c;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(l>0?1:0)*u,u<<=1;d=e(a);break;case 2:return""}for(p[3]=d,o=d,y.push(d);;){if(b.index>t)return"";for(a=0,c=Math.pow(2,f),u=1;u!=c;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(l>0?1:0)*u,u<<=1;switch(d=a){case 0:for(a=0,c=256,u=1;u!=c;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(l>0?1:0)*u,u<<=1;p[g++]=e(a),d=g-1,h--;break;case 1:for(a=0,c=65536,u=1;u!=c;)l=b.val&b.position,b.position>>=1,0==b.position&&(b.position=n,b.val=r(b.index++)),a|=(l>0?1:0)*u,u<<=1;p[g++]=e(a),d=g-1,h--;break;case 2:return y.join("")}if(0==h&&(h=Math.pow(2,f),f++),p[d])m=p[d];else{if(d!==g)return null;m=o+o.charAt(0)}y.push(m),p[g++]=o+m.charAt(0),h--,o=m,0==h&&(h=Math.pow(2,f),f++)}}};return i}();void 0!==(r=(function(){return i}).call(t,n,t,e))&&(e.exports=r)},2601:function(e,t,n){"use strict";var r,i;e.exports=(null==(r=n.g.process)?void 0:r.env)&&"object"==typeof(null==(i=n.g.process)?void 0:i.env)?n.g.process:n(8960)},8811:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return dynamic}});let r=n(1024);n(2265);let i=r._(n(7075));function convertModule(e){return{default:(null==e?void 0:e.default)||e}}function dynamic(e,t){let n=i.default,r={loading:e=>{let{error:t,isLoading:n,pastDelay:r}=e;return null}};"function"==typeof e&&(r.loader=e),Object.assign(r,t);let o=r.loader;return n({...r,loader:()=>null!=o?o().then(convertModule):Promise.resolve(convertModule(()=>null))})}("function"==typeof t.default||"object"==typeof t.default&&null!==t.default)&&void 0===t.default.__esModule&&(Object.defineProperty(t.default,"__esModule",{value:!0}),Object.assign(t.default,t),e.exports=t.default)},9167:function(e,t,n){"use strict";function NoSSR(e){let{children:t}=e;return t}Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"NoSSR",{enumerable:!0,get:function(){return NoSSR}}),n(1283)},7075:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),Object.defineProperty(t,"default",{enumerable:!0,get:function(){return a}});let r=n(1024),i=r._(n(2265)),o=n(9167);function Loadable(e){let t=Object.assign({loader:null,loading:null,ssr:!0},e);function LoadableComponent(e){let n=t.loading,r=i.default.createElement(n,{isLoading:!0,pastDelay:!0,error:null}),a=t.ssr?i.default.Fragment:o.NoSSR,l=t.lazy;return i.default.createElement(i.default.Suspense,{fallback:r},i.default.createElement(a,null,i.default.createElement(l,e)))}return t.lazy=i.default.lazy(t.loader),LoadableComponent.displayName="LoadableComponent",LoadableComponent}let a=Loadable},2026:function(){},3545:function(e,t,n){"use strict";Object.defineProperty(t,"$",{enumerable:!0,get:function(){return createServerReference}});let r=n(5231);function createServerReference(e){let{createServerReference:t}=n(6671);return t(e,r.callServer)}},470:function(e,t){"use strict";Symbol.for("react.server.reference")},8960:function(e){!function(){var t={229:function(e){var t,n,r,i=e.exports={};function defaultSetTimout(){throw Error("setTimeout has not been defined")}function defaultClearTimeout(){throw Error("clearTimeout has not been defined")}function runTimeout(e){if(t===setTimeout)return setTimeout(e,0);if((t===defaultSetTimout||!t)&&setTimeout)return t=setTimeout,setTimeout(e,0);try{return t(e,0)}catch(n){try{return t.call(null,e,0)}catch(n){return t.call(this,e,0)}}}function runClearTimeout(e){if(n===clearTimeout)return clearTimeout(e);if((n===defaultClearTimeout||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{return n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}!function(){try{t="function"==typeof setTimeout?setTimeout:defaultSetTimout}catch(e){t=defaultSetTimout}try{n="function"==typeof clearTimeout?clearTimeout:defaultClearTimeout}catch(e){n=defaultClearTimeout}}();var o=[],a=!1,l=-1;function cleanUpNextTick(){a&&r&&(a=!1,r.length?o=r.concat(o):l=-1,o.length&&drainQueue())}function drainQueue(){if(!a){var e=runTimeout(cleanUpNextTick);a=!0;for(var t=o.length;t;){for(r=o,o=[];++l<t;)r&&r[l].run();l=-1,t=o.length}r=null,a=!1,runClearTimeout(e)}}function Item(e,t){this.fun=e,this.array=t}function noop(){}i.nextTick=function(e){var t=Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];o.push(new Item(e,t)),1!==o.length||a||runTimeout(drainQueue)},Item.prototype.run=function(){this.fun.apply(null,this.array)},i.title="browser",i.browser=!0,i.env={},i.argv=[],i.version="",i.versions={},i.on=noop,i.addListener=noop,i.once=noop,i.off=noop,i.removeListener=noop,i.removeAllListeners=noop,i.emit=noop,i.prependListener=noop,i.prependOnceListener=noop,i.listeners=function(e){return[]},i.binding=function(e){throw Error("process.binding is not supported")},i.cwd=function(){return"/"},i.chdir=function(e){throw Error("process.chdir is not supported")},i.umask=function(){return 0}}},n={};function __nccwpck_require__(e){var r=n[e];if(void 0!==r)return r.exports;var i=n[e]={exports:{}},o=!0;try{t[e](i,i.exports,__nccwpck_require__),o=!1}finally{o&&delete n[e]}return i.exports}__nccwpck_require__.ab="//";var r=__nccwpck_require__(229);e.exports=r}()},622:function(e,t,n){"use strict";/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var r=n(2265),i=Symbol.for("react.element"),o=Symbol.for("react.fragment"),a=Object.prototype.hasOwnProperty,l=r.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,c={key:!0,ref:!0,__self:!0,__source:!0};function q(e,t,n){var r,o={},u=null,d=null;for(r in void 0!==n&&(u=""+n),void 0!==t.key&&(u=""+t.key),void 0!==t.ref&&(d=t.ref),t)a.call(t,r)&&!c.hasOwnProperty(r)&&(o[r]=t[r]);if(e&&e.defaultProps)for(r in t=e.defaultProps)void 0===o[r]&&(o[r]=t[r]);return{$$typeof:i,type:e,key:u,ref:d,props:o,_owner:l.current}}t.Fragment=o,t.jsx=q,t.jsxs=q},7437:function(e,t,n){"use strict";e.exports=n(622)},4002:function(e,t,n){var r=n(2601);"undefined"!=typeof __nccwpck_require__&&(__nccwpck_require__.ab="//"),({189:function(){!function(e,t){"use strict";if(!e.setImmediate){var n,i=1,o={},a=!1,l=e.document,c=Object.getPrototypeOf&&Object.getPrototypeOf(e);c=c&&c.setTimeout?c:e,"[object process]"===({}).toString.call(e.process)?installNextTickImplementation():canUsePostMessage()?installPostMessageImplementation():e.MessageChannel?installMessageChannelImplementation():l&&"onreadystatechange"in l.createElement("script")?installReadyStateChangeImplementation():installSetTimeoutImplementation(),c.setImmediate=setImmediate,c.clearImmediate=clearImmediate}function setImmediate(e){"function"!=typeof e&&(e=Function(""+e));for(var t=Array(arguments.length-1),r=0;r<t.length;r++)t[r]=arguments[r+1];var a={callback:e,args:t};return o[i]=a,n(i),i++}function clearImmediate(e){delete o[e]}function run(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(void 0,n)}}function runIfPresent(e){if(a)setTimeout(runIfPresent,0,e);else{var t=o[e];if(t){a=!0;try{run(t)}finally{clearImmediate(e),a=!1}}}}function installNextTickImplementation(){n=function(e){r.nextTick(function(){runIfPresent(e)})}}function canUsePostMessage(){if(e.postMessage&&!e.importScripts){var t=!0,n=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=n,t}}function installPostMessageImplementation(){var t="setImmediate$"+Math.random()+"$",onGlobalMessage=function(n){n.source===e&&"string"==typeof n.data&&0===n.data.indexOf(t)&&runIfPresent(+n.data.slice(t.length))};e.addEventListener?e.addEventListener("message",onGlobalMessage,!1):e.attachEvent("onmessage",onGlobalMessage),n=function(n){e.postMessage(t+n,"*")}}function installMessageChannelImplementation(){var e=new MessageChannel;e.port1.onmessage=function(e){runIfPresent(e.data)},n=function(t){e.port2.postMessage(t)}}function installReadyStateChangeImplementation(){var e=l.documentElement;n=function(t){var n=l.createElement("script");n.onreadystatechange=function(){runIfPresent(t),n.onreadystatechange=null,e.removeChild(n),n=null},e.appendChild(n)}}function installSetTimeoutImplementation(){n=function(e){setTimeout(runIfPresent,0,e)}}}("undefined"==typeof self?void 0===n.g?this:n.g:self)}})[189](),e.exports={}},5219:function(e,t,n){!function(){var t={845:function(e,t,r){var i=void 0!==n.g&&n.g||"undefined"!=typeof self&&self||window,o=Function.prototype.apply;function Timeout(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new Timeout(o.call(setTimeout,i,arguments),clearTimeout)},t.setInterval=function(){return new Timeout(o.call(setInterval,i,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(i,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;t>=0&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},r(505),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==n.g&&n.g.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==n.g&&n.g.clearImmediate||this&&this.clearImmediate},505:function(e){"use strict";e.exports=n(4002)}},r={};function __nccwpck_require__(e){var n=r[e];if(void 0!==n)return n.exports;var i=r[e]={exports:{}},o=!0;try{t[e].call(i.exports,i,i.exports,__nccwpck_require__),o=!1}finally{o&&delete r[e]}return i.exports}__nccwpck_require__.ab="//";var i=__nccwpck_require__(845);e.exports=i}()},3386:function(e,t,n){"use strict";n.d(t,{Z:function(){return v}});var r,i,o,__assign=function(){return(__assign=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var i in t=arguments[n])Object.prototype.hasOwnProperty.call(t,i)&&(e[i]=t[i]);return e}).apply(this,arguments)};function __rest(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&0>t.indexOf(r)&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var i=0,r=Object.getOwnPropertySymbols(e);i<r.length;i++)0>t.indexOf(r[i])&&Object.prototype.propertyIsEnumerable.call(e,r[i])&&(n[r[i]]=e[r[i]]);return n}function __spreadArray(e,t,n){if(n||2==arguments.length)for(var r,i=0,o=t.length;i<o;i++)!r&&i in t||(r||(r=Array.prototype.slice.call(t,0,i)),r[i]=t[i]);return e.concat(r||Array.prototype.slice.call(t))}"function"==typeof SuppressedError&&SuppressedError;var a=n(2265),l="right-scroll-bar-position",c="width-before-scroll-bar";function assignRef(e,t){return"function"==typeof e?e(t):e&&(e.current=t),e}function useCallbackRef(e,t){var n=(0,a.useState)(function(){return{value:e,callback:t,facade:{get current(){return n.value},set current(value){var r=n.value;r!==value&&(n.value=value,n.callback(value,r))}}}})[0];return n.callback=t,n.facade}function useMergeRefs(e,t){return useCallbackRef(t||null,function(t){return e.forEach(function(e){return assignRef(e,t)})})}function ItoI(e){return e}var u=(void 0===r&&(r={}),(i=function innerCreateMedium(e,t){void 0===t&&(t=ItoI);var n=[],r=!1;return{read:function(){if(r)throw Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return n.length?n[n.length-1]:e},useMedium:function(e){var i=t(e,r);return n.push(i),function(){n=n.filter(function(e){return e!==i})}},assignSyncMedium:function(e){for(r=!0;n.length;){var t=n;n=[],t.forEach(e)}n={push:function(t){return e(t)},filter:function(){return n}}},assignMedium:function(e){r=!0;var t=[];if(n.length){var i=n;n=[],i.forEach(e),t=n}var executeQueue=function(){var n=t;t=[],n.forEach(e)},cycle=function(){return Promise.resolve().then(executeQueue)};cycle(),n={push:function(e){t.push(e),cycle()},filter:function(e){return t=t.filter(e),n}}}}}(null)).options=__assign({async:!0,ssr:!1},r),i),nothing=function(){},d=a.forwardRef(function(e,t){var n=a.useRef(null),r=a.useState({onScrollCapture:nothing,onWheelCapture:nothing,onTouchMoveCapture:nothing}),i=r[0],o=r[1],l=e.forwardProps,c=e.children,d=e.className,p=e.removeScrollBar,h=e.enabled,g=e.shards,f=e.sideCar,m=e.noIsolation,y=e.inert,b=e.allowPinchZoom,w=e.as,S=void 0===w?"div":w,v=__rest(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noIsolation","inert","allowPinchZoom","as"]),x=useMergeRefs([n,t]),T=__assign(__assign({},v),i);return a.createElement(a.Fragment,null,h&&a.createElement(f,{sideCar:u,removeScrollBar:p,shards:g,noIsolation:m,inert:y,setCallbacks:o,allowPinchZoom:!!b,lockRef:n}),l?a.cloneElement(a.Children.only(c),__assign(__assign({},T),{ref:x})):a.createElement(S,__assign({},T,{className:d,ref:x}),c))});d.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1},d.classNames={fullWidth:c,zeroRight:l};var SideCar=function(e){var t=e.sideCar,n=__rest(e,["sideCar"]);if(!t)throw Error("Sidecar: please provide `sideCar` property to import the right car");var r=t.read();if(!r)throw Error("Sidecar medium not found");return a.createElement(r,__assign({},n))};function exportSidecar(e,t){return e.useMedium(t),SideCar}function makeStyleTag(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var t=o||n.nc;return t&&e.setAttribute("nonce",t),e}function injectStyles(e,t){e.styleSheet?e.styleSheet.cssText=t:e.appendChild(document.createTextNode(t))}function insertStyleTag(e){(document.head||document.getElementsByTagName("head")[0]).appendChild(e)}SideCar.isSideCarExport=!0;var stylesheetSingleton=function(){var e=0,t=null;return{add:function(n){0==e&&(t=makeStyleTag())&&(injectStyles(t,n),insertStyleTag(t)),e++},remove:function(){--e||!t||(t.parentNode&&t.parentNode.removeChild(t),t=null)}}},styleHookSingleton=function(){var e=stylesheetSingleton();return function(t,n){a.useEffect(function(){return e.add(t),function(){e.remove()}},[t&&n])}},styleSingleton=function(){var e=styleHookSingleton();return function(t){return e(t.styles,t.dynamic),null}},p={left:0,top:0,right:0,gap:0},parse=function(e){return parseInt(e||"",10)||0},getOffset=function(e){var t=window.getComputedStyle(document.body),n=t["padding"===e?"paddingLeft":"marginLeft"],r=t["padding"===e?"paddingTop":"marginTop"],i=t["padding"===e?"paddingRight":"marginRight"];return[parse(n),parse(r),parse(i)]},getGapWidth=function(e){if(void 0===e&&(e="margin"),"undefined"==typeof window)return p;var t=getOffset(e),n=document.documentElement.clientWidth,r=window.innerWidth;return{left:t[0],top:t[1],right:t[2],gap:Math.max(0,r-n+t[2]-t[0])}},h=styleSingleton(),getStyles=function(e,t,n,r){var i=e.left,o=e.top,a=e.right,u=e.gap;return void 0===n&&(n="margin"),"\n  .".concat("with-scroll-bars-hidden"," {\n   overflow: hidden ").concat(r,";\n   padding-right: ").concat(u,"px ").concat(r,";\n  }\n  body {\n    overflow: hidden ").concat(r,";\n    overscroll-behavior: contain;\n    ").concat([t&&"position: relative ".concat(r,";"),"margin"===n&&"\n    padding-left: ".concat(i,"px;\n    padding-top: ").concat(o,"px;\n    padding-right: ").concat(a,"px;\n    margin-left:0;\n    margin-top:0;\n    margin-right: ").concat(u,"px ").concat(r,";\n    "),"padding"===n&&"padding-right: ".concat(u,"px ").concat(r,";")].filter(Boolean).join(""),"\n  }\n  \n  .").concat(l," {\n    right: ").concat(u,"px ").concat(r,";\n  }\n  \n  .").concat(c," {\n    margin-right: ").concat(u,"px ").concat(r,";\n  }\n  \n  .").concat(l," .").concat(l," {\n    right: 0 ").concat(r,";\n  }\n  \n  .").concat(c," .").concat(c," {\n    margin-right: 0 ").concat(r,";\n  }\n  \n  body {\n    ").concat("--removed-body-scroll-bar-size",": ").concat(u,"px;\n  }\n")},RemoveScrollBar=function(e){var t=e.noRelative,n=e.noImportant,r=e.gapMode,i=void 0===r?"margin":r,o=a.useMemo(function(){return getGapWidth(i)},[i]);return a.createElement(h,{styles:getStyles(o,!t,i,n?"":"!important")})},g=!1;if("undefined"!=typeof window)try{var f=Object.defineProperty({},"passive",{get:function(){return g=!0,!0}});window.addEventListener("test",f,f),window.removeEventListener("test",f,f)}catch(e){g=!1}var m=!!g&&{passive:!1},elementCanBeScrolled=function(e,t){var n=window.getComputedStyle(e);return"hidden"!==n[t]&&!(n.overflowY===n.overflowX&&"TEXTAREA"!==e.tagName&&"visible"===n[t])},locationCouldBeScrolled=function(e,t){var n=t;do{if("undefined"!=typeof ShadowRoot&&n instanceof ShadowRoot&&(n=n.host),elementCouldBeScrolled(e,n)){var r=getScrollVariables(e,n);if(r[1]>r[2])return!0}n=n.parentNode}while(n&&n!==document.body);return!1},elementCouldBeScrolled=function(e,t){return"v"===e?elementCanBeScrolled(t,"overflowY"):elementCanBeScrolled(t,"overflowX")},getScrollVariables=function(e,t){return"v"===e?[t.scrollTop,t.scrollHeight,t.clientHeight]:[t.scrollLeft,t.scrollWidth,t.clientWidth]},handleScroll=function(e,t,n,r,i){var o,a=(o=window.getComputedStyle(t).direction,"h"===e&&"rtl"===o?-1:1),l=a*r,c=n.target,u=t.contains(c),d=!1,p=l>0,h=0,g=0;do{var f=getScrollVariables(e,c),m=f[0],y=f[1]-f[2]-a*m;(m||y)&&elementCouldBeScrolled(e,c)&&(h+=y,g+=m),c=c.parentNode}while(!u&&c!==document.body||u&&(t.contains(c)||t===c));return p&&(i&&0===h||!i&&l>h)?d=!0:!p&&(i&&0===g||!i&&-l>g)&&(d=!0),d},getTouchXY=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},getDeltaXY=function(e){return[e.deltaX,e.deltaY]},extractRef=function(e){return e&&"current"in e?e.current:e},y=0,b=[],w=exportSidecar(u,function(e){var t=a.useRef([]),n=a.useRef([0,0]),r=a.useRef(),i=a.useState(y++)[0],o=a.useState(function(){return styleSingleton()})[0],l=a.useRef(e);a.useEffect(function(){l.current=e},[e]),a.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(i));var t=__spreadArray([e.lockRef.current],(e.shards||[]).map(extractRef),!0).filter(Boolean);return t.forEach(function(e){return e.classList.add("allow-interactivity-".concat(i))}),function(){document.body.classList.remove("block-interactivity-".concat(i)),t.forEach(function(e){return e.classList.remove("allow-interactivity-".concat(i))})}}},[e.inert,e.lockRef.current,e.shards]);var c=a.useCallback(function(e,t){if("touches"in e&&2===e.touches.length)return!l.current.allowPinchZoom;var i,o=getTouchXY(e),a=n.current,c="deltaX"in e?e.deltaX:a[0]-o[0],u="deltaY"in e?e.deltaY:a[1]-o[1],d=e.target,p=Math.abs(c)>Math.abs(u)?"h":"v";if("touches"in e&&"h"===p&&"range"===d.type)return!1;var h=locationCouldBeScrolled(p,d);if(!h)return!0;if(h?i=p:(i="v"===p?"h":"v",h=locationCouldBeScrolled(p,d)),!h)return!1;if(!r.current&&"changedTouches"in e&&(c||u)&&(r.current=i),!i)return!0;var g=r.current||i;return handleScroll(g,t,e,"h"===g?c:u,!0)},[]),u=a.useCallback(function(e){if(b.length&&b[b.length-1]===o){var n="deltaY"in e?getDeltaXY(e):getTouchXY(e),r=t.current.filter(function(t){var r;return t.name===e.type&&t.target===e.target&&(r=t.delta)[0]===n[0]&&r[1]===n[1]})[0];if(r&&r.should){e.cancelable&&e.preventDefault();return}if(!r){var i=(l.current.shards||[]).map(extractRef).filter(Boolean).filter(function(t){return t.contains(e.target)});(i.length>0?c(e,i[0]):!l.current.noIsolation)&&e.cancelable&&e.preventDefault()}}},[]),d=a.useCallback(function(e,n,r,i){var o={name:e,delta:n,target:r,should:i};t.current.push(o),setTimeout(function(){t.current=t.current.filter(function(e){return e!==o})},1)},[]),p=a.useCallback(function(e){n.current=getTouchXY(e),r.current=void 0},[]),h=a.useCallback(function(t){d(t.type,getDeltaXY(t),t.target,c(t,e.lockRef.current))},[]),g=a.useCallback(function(t){d(t.type,getTouchXY(t),t.target,c(t,e.lockRef.current))},[]);a.useEffect(function(){return b.push(o),e.setCallbacks({onScrollCapture:h,onWheelCapture:h,onTouchMoveCapture:g}),document.addEventListener("wheel",u,m),document.addEventListener("touchmove",u,m),document.addEventListener("touchstart",p,m),function(){b=b.filter(function(e){return e!==o}),document.removeEventListener("wheel",u,m),document.removeEventListener("touchmove",u,m),document.removeEventListener("touchstart",p,m)}},[]);var f=e.removeScrollBar,w=e.inert;return a.createElement(a.Fragment,null,w?a.createElement(o,{styles:"\n  .block-interactivity-".concat(i," {pointer-events: none;}\n  .allow-interactivity-").concat(i," {pointer-events: all;}\n")}):null,f?a.createElement(RemoveScrollBar,{gapMode:"margin"}):null)}),S=a.forwardRef(function(e,t){return a.createElement(d,__assign({},e,{ref:t,sideCar:w}))});S.classNames=d.classNames;var v=S},2744:function(e,t){var n;/*!
	Copyright (c) 2018 Jed Watson.
	Licensed under the MIT License (MIT), see
	http://jedwatson.github.io/classnames
*/!function(){"use strict";var r={}.hasOwnProperty;function classNames(){for(var e="",t=0;t<arguments.length;t++){var n=arguments[t];n&&(e=appendClass(e,parseValue(n)))}return e}function parseValue(e){if("string"==typeof e||"number"==typeof e)return e;if("object"!=typeof e)return"";if(Array.isArray(e))return classNames.apply(null,e);if(e.toString!==Object.prototype.toString&&!e.toString.toString().includes("[native code]"))return e.toString();var t="";for(var n in e)r.call(e,n)&&e[n]&&(t=appendClass(t,n));return t}function appendClass(e,t){return t?e?e+" "+t:e+t:e}e.exports?(classNames.default=classNames,e.exports=classNames):void 0!==(n=(function(){return classNames}).apply(t,[]))&&(e.exports=n)}()},9228:function(e,t,n){"use strict";n(7933);var r=n(9632);e.exports=r("Array","at")},5134:function(e,t,n){"use strict";n(7781),n(9328);var r=n(9632);e.exports=r("Array","flatMap")},1521:function(e,t,n){"use strict";n(3896),n(1767);var r=n(9632);e.exports=r("Array","flat")},7942:function(e,t,n){"use strict";n(4554);var r=n(9632);e.exports=r("String","at")},632:function(e,t,n){"use strict";n(789),n(1490),n(3510);var r=n(9632);e.exports=r("String","replaceAll")},6284:function(e,t,n){"use strict";var r=n(43),i=n(1747),o=TypeError;e.exports=function(e){if(r(e))return e;throw new o(i(e)+" is not a function")}},8609:function(e,t,n){"use strict";var r=n(1350),i=n(2957),o=n(4982).f,a=r("unscopables"),l=Array.prototype;void 0===l[a]&&o(l,a,{configurable:!0,value:i(null)}),e.exports=function(e){l[a][e]=!0}},2166:function(e,t,n){"use strict";var r=n(2068).charAt;e.exports=function(e,t,n){return t+(n?r(e,t).length:1)}},1485:function(e,t,n){"use strict";var r=n(6695),i=String,o=TypeError;e.exports=function(e){if(r(e))return e;throw new o(i(e)+" is not an object")}},8786:function(e,t,n){"use strict";var r=n(949),i=n(76),o=n(4464),createMethod=function(e){return function(t,n,a){var l,c=r(t),u=o(c);if(0===u)return!e&&-1;var d=i(a,u);if(e&&n!=n){for(;u>d;)if((l=c[d++])!=l)return!0}else for(;u>d;d++)if((e||d in c)&&c[d]===n)return e||d||0;return!e&&-1}};e.exports={includes:createMethod(!0),indexOf:createMethod(!1)}},665:function(e,t,n){"use strict";var r=n(7631),i=n(1357),o=n(6695),a=n(1350)("species"),l=Array;e.exports=function(e){var t;return r(e)&&(i(t=e.constructor)&&(t===l||r(t.prototype))?t=void 0:o(t)&&null===(t=t[a])&&(t=void 0)),void 0===t?l:t}},747:function(e,t,n){"use strict";var r=n(665);e.exports=function(e,t){return new(r(e))(0===t?0:t)}},6938:function(e,t,n){"use strict";var r=n(8842),i=r({}.toString),o=r("".slice);e.exports=function(e){return o(i(e),8,-1)}},9743:function(e,t,n){"use strict";var r=n(8830),i=n(43),o=n(6938),a=n(1350)("toStringTag"),l=Object,c="Arguments"===o(function(){return arguments}()),tryGet=function(e,t){try{return e[t]}catch(e){}};e.exports=r?o:function(e){var t,n,r;return void 0===e?"Undefined":null===e?"Null":"string"==typeof(n=tryGet(t=l(e),a))?n:c?o(t):"Object"===(r=o(t))&&i(t.callee)?"Arguments":r}},783:function(e,t,n){"use strict";var r=n(9472),i=n(5191),o=n(1218),a=n(4982);e.exports=function(e,t,n){for(var l=i(t),c=a.f,u=o.f,d=0;d<l.length;d++){var p=l[d];r(e,p)||n&&r(n,p)||c(e,p,u(t,p))}}},549:function(e,t,n){"use strict";var r=n(2534),i=n(4982),o=n(9085);e.exports=r?function(e,t,n){return i.f(e,t,o(1,n))}:function(e,t,n){return e[t]=n,e}},9085:function(e){"use strict";e.exports=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}}},4897:function(e,t,n){"use strict";var r=n(43),i=n(4982),o=n(5412),a=n(2501);e.exports=function(e,t,n,l){l||(l={});var c=l.enumerable,u=void 0!==l.name?l.name:t;if(r(n)&&o(n,u,l),l.global)c?e[t]=n:a(t,n);else{try{l.unsafe?e[t]&&(c=!0):delete e[t]}catch(e){}c?e[t]=n:i.f(e,t,{value:n,enumerable:!1,configurable:!l.nonConfigurable,writable:!l.nonWritable})}return e}},2501:function(e,t,n){"use strict";var r=n(7738),i=Object.defineProperty;e.exports=function(e,t){try{i(r,e,{value:t,configurable:!0,writable:!0})}catch(n){r[e]=t}return t}},2534:function(e,t,n){"use strict";var r=n(4256);e.exports=!r(function(){return 7!==Object.defineProperty({},1,{get:function(){return 7}})[1]})},7039:function(e,t,n){"use strict";var r=n(7738),i=n(6695),o=r.document,a=i(o)&&i(o.createElement);e.exports=function(e){return a?o.createElement(e):{}}},1960:function(e){"use strict";var t=TypeError;e.exports=function(e){if(e>9007199254740991)throw t("Maximum allowed index exceeded");return e}},7960:function(e){"use strict";e.exports="undefined"!=typeof navigator&&String(navigator.userAgent)||""},4130:function(e,t,n){"use strict";var r,i,o=n(7738),a=n(7960),l=o.process,c=o.Deno,u=l&&l.versions||c&&c.version,d=u&&u.v8;d&&(i=(r=d.split("."))[0]>0&&r[0]<4?1:+(r[0]+r[1])),!i&&a&&(!(r=a.match(/Edge\/(\d+)/))||r[1]>=74)&&(r=a.match(/Chrome\/(\d+)/))&&(i=+r[1]),e.exports=i},9632:function(e,t,n){"use strict";var r=n(7738),i=n(8842);e.exports=function(e,t){return i(r[e].prototype[t])}},1971:function(e){"use strict";e.exports=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"]},9272:function(e,t,n){"use strict";var r=n(7738),i=n(1218).f,o=n(549),a=n(4897),l=n(2501),c=n(783),u=n(1559);e.exports=function(e,t){var n,d,p,h,g,f=e.target,m=e.global,y=e.stat;if(n=m?r:y?r[f]||l(f,{}):r[f]&&r[f].prototype)for(d in t){if(h=t[d],p=e.dontCallGetSet?(g=i(n,d))&&g.value:n[d],!u(m?d:f+(y?".":"#")+d,e.forced)&&void 0!==p){if(typeof h==typeof p)continue;c(h,p)}(e.sham||p&&p.sham)&&o(h,"sham",!0),a(n,d,h,e)}}},4256:function(e){"use strict";e.exports=function(e){try{return!!e()}catch(e){return!0}}},2571:function(e,t,n){"use strict";n(789);var r=n(5817),i=n(4897),o=n(3955),a=n(4256),l=n(1350),c=n(549),u=l("species"),d=RegExp.prototype;e.exports=function(e,t,n,p){var h=l(e),g=!a(function(){var t={};return t[h]=function(){return 7},7!==""[e](t)}),f=g&&!a(function(){var t=!1,n=/a/;return"split"===e&&((n={}).constructor={},n.constructor[u]=function(){return n},n.flags="",n[h]=/./[h]),n.exec=function(){return t=!0,null},n[h](""),!t});if(!g||!f||n){var m=/./[h],y=t(h,""[e],function(e,t,n,i,a){var l=t.exec;return l===o||l===d.exec?g&&!a?{done:!0,value:r(m,t,n,i)}:{done:!0,value:r(e,n,t,i)}:{done:!1}});i(String.prototype,e,y[0]),i(d,h,y[1])}p&&c(d[h],"sham",!0)}},9162:function(e,t,n){"use strict";var r=n(7631),i=n(4464),o=n(1960),a=n(9668),flattenIntoArray=function(e,t,n,l,c,u,d,p){for(var h,g,f=c,m=0,y=!!d&&a(d,p);m<l;)m in n&&(h=y?y(n[m],m,t):n[m],u>0&&r(h)?(g=i(h),f=flattenIntoArray(e,t,h,g,f,u-1)-1):(o(f+1),e[f]=h),f++),m++;return f};e.exports=flattenIntoArray},5815:function(e,t,n){"use strict";var r=n(1115),i=Function.prototype,o=i.apply,a=i.call;e.exports="object"==typeof Reflect&&Reflect.apply||(r?a.bind(o):function(){return a.apply(o,arguments)})},9668:function(e,t,n){"use strict";var r=n(6919),i=n(6284),o=n(1115),a=r(r.bind);e.exports=function(e,t){return i(e),void 0===t?e:o?a(e,t):function(){return e.apply(t,arguments)}}},1115:function(e,t,n){"use strict";var r=n(4256);e.exports=!r(function(){var e=(function(){}).bind();return"function"!=typeof e||e.hasOwnProperty("prototype")})},5817:function(e,t,n){"use strict";var r=n(1115),i=Function.prototype.call;e.exports=r?i.bind(i):function(){return i.apply(i,arguments)}},6309:function(e,t,n){"use strict";var r=n(2534),i=n(9472),o=Function.prototype,a=r&&Object.getOwnPropertyDescriptor,l=i(o,"name"),c=l&&(!r||r&&a(o,"name").configurable);e.exports={EXISTS:l,PROPER:l&&"something"===(function(){}).name,CONFIGURABLE:c}},6919:function(e,t,n){"use strict";var r=n(6938),i=n(8842);e.exports=function(e){if("Function"===r(e))return i(e)}},8842:function(e,t,n){"use strict";var r=n(1115),i=Function.prototype,o=i.call,a=r&&i.bind.bind(o,o);e.exports=r?a:function(e){return function(){return o.apply(e,arguments)}}},5651:function(e,t,n){"use strict";var r=n(7738),i=n(43);e.exports=function(e,t){var n;return arguments.length<2?i(n=r[e])?n:void 0:r[e]&&r[e][t]}},2112:function(e,t,n){"use strict";var r=n(6284),i=n(6617);e.exports=function(e,t){var n=e[t];return i(n)?void 0:r(n)}},7175:function(e,t,n){"use strict";var r=n(8842),i=n(4405),o=Math.floor,a=r("".charAt),l=r("".replace),c=r("".slice),u=/\$([$&'`]|\d{1,2}|<[^>]*>)/g,d=/\$([$&'`]|\d{1,2})/g;e.exports=function(e,t,n,r,p,h){var g=n+e.length,f=r.length,m=d;return void 0!==p&&(p=i(p),m=u),l(h,m,function(i,l){var u;switch(a(l,0)){case"$":return"$";case"&":return e;case"`":return c(t,0,n);case"'":return c(t,g);case"<":u=p[c(l,1,-1)];break;default:var d=+l;if(0===d)return i;if(d>f){var h=o(d/10);if(0===h)return i;if(h<=f)return void 0===r[h-1]?a(l,1):r[h-1]+a(l,1);return i}u=r[d-1]}return void 0===u?"":u})}},7738:function(e,t,n){"use strict";var check=function(e){return e&&e.Math===Math&&e};e.exports=check("object"==typeof globalThis&&globalThis)||check("object"==typeof window&&window)||check("object"==typeof self&&self)||check("object"==typeof n.g&&n.g)||check("object"==typeof this&&this)||function(){return this}()||Function("return this")()},9472:function(e,t,n){"use strict";var r=n(8842),i=n(4405),o=r({}.hasOwnProperty);e.exports=Object.hasOwn||function(e,t){return o(i(e),t)}},8347:function(e){"use strict";e.exports={}},1162:function(e,t,n){"use strict";var r=n(5651);e.exports=r("document","documentElement")},1149:function(e,t,n){"use strict";var r=n(2534),i=n(4256),o=n(7039);e.exports=!r&&!i(function(){return 7!==Object.defineProperty(o("div"),"a",{get:function(){return 7}}).a})},3910:function(e,t,n){"use strict";var r=n(8842),i=n(4256),o=n(6938),a=Object,l=r("".split);e.exports=i(function(){return!a("z").propertyIsEnumerable(0)})?function(e){return"String"===o(e)?l(e,""):a(e)}:a},2402:function(e,t,n){"use strict";var r=n(8842),i=n(43),o=n(9145),a=r(Function.toString);i(o.inspectSource)||(o.inspectSource=function(e){return a(e)}),e.exports=o.inspectSource},5230:function(e,t,n){"use strict";var r,i,o,a=n(9819),l=n(7738),c=n(6695),u=n(549),d=n(9472),p=n(9145),h=n(50),g=n(8347),f="Object already initialized",m=l.TypeError,y=l.WeakMap;if(a||p.state){var b=p.state||(p.state=new y);b.get=b.get,b.has=b.has,b.set=b.set,r=function(e,t){if(b.has(e))throw new m(f);return t.facade=e,b.set(e,t),t},i=function(e){return b.get(e)||{}},o=function(e){return b.has(e)}}else{var w=h("state");g[w]=!0,r=function(e,t){if(d(e,w))throw new m(f);return t.facade=e,u(e,w,t),t},i=function(e){return d(e,w)?e[w]:{}},o=function(e){return d(e,w)}}e.exports={set:r,get:i,has:o,enforce:function(e){return o(e)?i(e):r(e,{})},getterFor:function(e){return function(t){var n;if(!c(t)||(n=i(t)).type!==e)throw new m("Incompatible receiver, "+e+" required");return n}}}},7631:function(e,t,n){"use strict";var r=n(6938);e.exports=Array.isArray||function(e){return"Array"===r(e)}},43:function(e){"use strict";var t="object"==typeof document&&document.all;e.exports=void 0===t&&void 0!==t?function(e){return"function"==typeof e||e===t}:function(e){return"function"==typeof e}},1357:function(e,t,n){"use strict";var r=n(8842),i=n(4256),o=n(43),a=n(9743),l=n(5651),c=n(2402),noop=function(){},u=l("Reflect","construct"),d=/^\s*(?:class|function)\b/,p=r(d.exec),h=!d.test(noop),isConstructorModern=function(e){if(!o(e))return!1;try{return u(noop,[],e),!0}catch(e){return!1}},isConstructorLegacy=function(e){if(!o(e))return!1;switch(a(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return h||!!p(d,c(e))}catch(e){return!0}};isConstructorLegacy.sham=!0,e.exports=!u||i(function(){var e;return isConstructorModern(isConstructorModern.call)||!isConstructorModern(Object)||!isConstructorModern(function(){e=!0})||e})?isConstructorLegacy:isConstructorModern},1559:function(e,t,n){"use strict";var r=n(4256),i=n(43),o=/#|\.prototype\./,isForced=function(e,t){var n=l[a(e)];return n===u||n!==c&&(i(t)?r(t):!!t)},a=isForced.normalize=function(e){return String(e).replace(o,".").toLowerCase()},l=isForced.data={},c=isForced.NATIVE="N",u=isForced.POLYFILL="P";e.exports=isForced},6617:function(e){"use strict";e.exports=function(e){return null==e}},6695:function(e,t,n){"use strict";var r=n(43);e.exports=function(e){return"object"==typeof e?null!==e:r(e)}},9168:function(e){"use strict";e.exports=!1},1059:function(e,t,n){"use strict";var r=n(6695),i=n(6938),o=n(1350)("match");e.exports=function(e){var t;return r(e)&&(void 0!==(t=e[o])?!!t:"RegExp"===i(e))}},5375:function(e,t,n){"use strict";var r=n(5651),i=n(43),o=n(112),a=n(327),l=Object;e.exports=a?function(e){return"symbol"==typeof e}:function(e){var t=r("Symbol");return i(t)&&o(t.prototype,l(e))}},4464:function(e,t,n){"use strict";var r=n(2510);e.exports=function(e){return r(e.length)}},5412:function(e,t,n){"use strict";var r=n(8842),i=n(4256),o=n(43),a=n(9472),l=n(2534),c=n(6309).CONFIGURABLE,u=n(2402),d=n(5230),p=d.enforce,h=d.get,g=String,f=Object.defineProperty,m=r("".slice),y=r("".replace),b=r([].join),w=l&&!i(function(){return 8!==f(function(){},"length",{value:8}).length}),S=String(String).split("String"),v=e.exports=function(e,t,n){"Symbol("===m(g(t),0,7)&&(t="["+y(g(t),/^Symbol\(([^)]*)\).*$/,"$1")+"]"),n&&n.getter&&(t="get "+t),n&&n.setter&&(t="set "+t),(!a(e,"name")||c&&e.name!==t)&&(l?f(e,"name",{value:t,configurable:!0}):e.name=t),w&&n&&a(n,"arity")&&e.length!==n.arity&&f(e,"length",{value:n.arity});try{n&&a(n,"constructor")&&n.constructor?l&&f(e,"prototype",{writable:!1}):e.prototype&&(e.prototype=void 0)}catch(e){}var r=p(e);return a(r,"source")||(r.source=b(S,"string"==typeof t?t:"")),e};Function.prototype.toString=v(function(){return o(this)&&h(this).source||u(this)},"toString")},1325:function(e){"use strict";var t=Math.ceil,n=Math.floor;e.exports=Math.trunc||function(e){var r=+e;return(r>0?n:t)(r)}},2957:function(e,t,n){"use strict";var r,i=n(1485),o=n(9400),a=n(1971),l=n(8347),c=n(1162),u=n(7039),d=n(50),p="prototype",h="script",g=d("IE_PROTO"),EmptyConstructor=function(){},scriptTag=function(e){return"<"+h+">"+e+"</"+h+">"},NullProtoObjectViaActiveX=function(e){e.write(scriptTag("")),e.close();var t=e.parentWindow.Object;return e=null,t},NullProtoObjectViaIFrame=function(){var e,t=u("iframe");return t.style.display="none",c.appendChild(t),t.src=String("java"+h+":"),(e=t.contentWindow.document).open(),e.write(scriptTag("document.F=Object")),e.close(),e.F},NullProtoObject=function(){try{r=new ActiveXObject("htmlfile")}catch(e){}NullProtoObject="undefined"!=typeof document?document.domain&&r?NullProtoObjectViaActiveX(r):NullProtoObjectViaIFrame():NullProtoObjectViaActiveX(r);for(var e=a.length;e--;)delete NullProtoObject[p][a[e]];return NullProtoObject()};l[g]=!0,e.exports=Object.create||function(e,t){var n;return null!==e?(EmptyConstructor[p]=i(e),n=new EmptyConstructor,EmptyConstructor[p]=null,n[g]=e):n=NullProtoObject(),void 0===t?n:o.f(n,t)}},9400:function(e,t,n){"use strict";var r=n(2534),i=n(1887),o=n(4982),a=n(1485),l=n(949),c=n(5540);t.f=r&&!i?Object.defineProperties:function(e,t){a(e);for(var n,r=l(t),i=c(t),u=i.length,d=0;u>d;)o.f(e,n=i[d++],r[n]);return e}},4982:function(e,t,n){"use strict";var r=n(2534),i=n(1149),o=n(1887),a=n(1485),l=n(7843),c=TypeError,u=Object.defineProperty,d=Object.getOwnPropertyDescriptor,p="enumerable",h="configurable",g="writable";t.f=r?o?function(e,t,n){if(a(e),t=l(t),a(n),"function"==typeof e&&"prototype"===t&&"value"in n&&g in n&&!n[g]){var r=d(e,t);r&&r[g]&&(e[t]=n.value,n={configurable:h in n?n[h]:r[h],enumerable:p in n?n[p]:r[p],writable:!1})}return u(e,t,n)}:u:function(e,t,n){if(a(e),t=l(t),a(n),i)try{return u(e,t,n)}catch(e){}if("get"in n||"set"in n)throw new c("Accessors not supported");return"value"in n&&(e[t]=n.value),e}},1218:function(e,t,n){"use strict";var r=n(2534),i=n(5817),o=n(6787),a=n(9085),l=n(949),c=n(7843),u=n(9472),d=n(1149),p=Object.getOwnPropertyDescriptor;t.f=r?p:function(e,t){if(e=l(e),t=c(t),d)try{return p(e,t)}catch(e){}if(u(e,t))return a(!i(o.f,e,t),e[t])}},7613:function(e,t,n){"use strict";var r=n(9852),i=n(1971).concat("length","prototype");t.f=Object.getOwnPropertyNames||function(e){return r(e,i)}},4531:function(e,t){"use strict";t.f=Object.getOwnPropertySymbols},112:function(e,t,n){"use strict";var r=n(8842);e.exports=r({}.isPrototypeOf)},9852:function(e,t,n){"use strict";var r=n(8842),i=n(9472),o=n(949),a=n(8786).indexOf,l=n(8347),c=r([].push);e.exports=function(e,t){var n,r=o(e),u=0,d=[];for(n in r)!i(l,n)&&i(r,n)&&c(d,n);for(;t.length>u;)i(r,n=t[u++])&&(~a(d,n)||c(d,n));return d}},5540:function(e,t,n){"use strict";var r=n(9852),i=n(1971);e.exports=Object.keys||function(e){return r(e,i)}},6787:function(e,t){"use strict";var n={}.propertyIsEnumerable,r=Object.getOwnPropertyDescriptor,i=r&&!n.call({1:2},1);t.f=i?function(e){var t=r(this,e);return!!t&&t.enumerable}:n},1823:function(e,t,n){"use strict";var r=n(5817),i=n(43),o=n(6695),a=TypeError;e.exports=function(e,t){var n,l;if("string"===t&&i(n=e.toString)&&!o(l=r(n,e))||i(n=e.valueOf)&&!o(l=r(n,e))||"string"!==t&&i(n=e.toString)&&!o(l=r(n,e)))return l;throw new a("Can't convert object to primitive value")}},5191:function(e,t,n){"use strict";var r=n(5651),i=n(8842),o=n(7613),a=n(4531),l=n(1485),c=i([].concat);e.exports=r("Reflect","ownKeys")||function(e){var t=o.f(l(e)),n=a.f;return n?c(t,n(e)):t}},8911:function(e,t,n){"use strict";var r=n(5817),i=n(1485),o=n(43),a=n(6938),l=n(3955),c=TypeError;e.exports=function(e,t){var n=e.exec;if(o(n)){var u=r(n,e,t);return null!==u&&i(u),u}if("RegExp"===a(e))return r(l,e,t);throw new c("RegExp#exec called on incompatible receiver")}},3955:function(e,t,n){"use strict";var r,i,o=n(5817),a=n(8842),l=n(2455),c=n(4045),u=n(9602),d=n(3801),p=n(2957),h=n(5230).get,g=n(7541),f=n(3349),m=d("native-string-replace",String.prototype.replace),y=RegExp.prototype.exec,b=y,w=a("".charAt),S=a("".indexOf),v=a("".replace),x=a("".slice),T=(i=/b*/g,o(y,r=/a/,"a"),o(y,i,"a"),0!==r.lastIndex||0!==i.lastIndex),P=u.BROKEN_CARET,C=void 0!==/()??/.exec("")[1];(T||C||P||g||f)&&(b=function(e){var t,n,r,i,a,u,d,g=h(this),f=l(e),k=g.raw;if(k)return k.lastIndex=this.lastIndex,t=o(b,k,f),this.lastIndex=k.lastIndex,t;var I=g.groups,E=P&&this.sticky,_=o(c,this),M=this.source,j=0,A=f;if(E&&(-1===S(_=v(_,"y",""),"g")&&(_+="g"),A=x(f,this.lastIndex),this.lastIndex>0&&(!this.multiline||this.multiline&&"\n"!==w(f,this.lastIndex-1))&&(M="(?: "+M+")",A=" "+A,j++),n=RegExp("^(?:"+M+")",_)),C&&(n=RegExp("^"+M+"$(?!\\s)",_)),T&&(r=this.lastIndex),i=o(y,E?n:this,A),E?i?(i.input=x(i.input,j),i[0]=x(i[0],j),i.index=this.lastIndex,this.lastIndex+=i[0].length):this.lastIndex=0:T&&i&&(this.lastIndex=this.global?i.index+i[0].length:r),C&&i&&i.length>1&&o(m,i[0],n,function(){for(a=1;a<arguments.length-2;a++)void 0===arguments[a]&&(i[a]=void 0)}),i&&I)for(a=0,i.groups=u=p(null);a<I.length;a++)u[(d=I[a])[0]]=i[d[1]];return i}),e.exports=b},4045:function(e,t,n){"use strict";var r=n(1485);e.exports=function(){var e=r(this),t="";return e.hasIndices&&(t+="d"),e.global&&(t+="g"),e.ignoreCase&&(t+="i"),e.multiline&&(t+="m"),e.dotAll&&(t+="s"),e.unicode&&(t+="u"),e.unicodeSets&&(t+="v"),e.sticky&&(t+="y"),t}},290:function(e,t,n){"use strict";var r=n(5817),i=n(9472),o=n(112),a=n(4045),l=RegExp.prototype;e.exports=function(e){var t=e.flags;return!(void 0===t&&!("flags"in l)&&!i(e,"flags")&&o(l,e))?t:r(a,e)}},9602:function(e,t,n){"use strict";var r=n(4256),i=n(7738).RegExp,o=r(function(){var e=i("a","y");return e.lastIndex=2,null!==e.exec("abcd")}),a=o||r(function(){return!i("a","y").sticky}),l=o||r(function(){var e=i("^r","gy");return e.lastIndex=2,null!==e.exec("str")});e.exports={BROKEN_CARET:l,MISSED_STICKY:a,UNSUPPORTED_Y:o}},7541:function(e,t,n){"use strict";var r=n(4256),i=n(7738).RegExp;e.exports=r(function(){var e=i(".","s");return!(e.dotAll&&e.test("\n")&&"s"===e.flags)})},3349:function(e,t,n){"use strict";var r=n(4256),i=n(7738).RegExp;e.exports=r(function(){var e=i("(?<a>b)","g");return"b"!==e.exec("b").groups.a||"bc"!=="b".replace(e,"$<a>c")})},2924:function(e,t,n){"use strict";var r=n(6617),i=TypeError;e.exports=function(e){if(r(e))throw new i("Can't call method on "+e);return e}},50:function(e,t,n){"use strict";var r=n(3801),i=n(7246),o=r("keys");e.exports=function(e){return o[e]||(o[e]=i(e))}},9145:function(e,t,n){"use strict";var r=n(9168),i=n(7738),o=n(2501),a="__core-js_shared__",l=e.exports=i[a]||o(a,{});(l.versions||(l.versions=[])).push({version:"3.37.0",mode:r?"pure":"global",copyright:"\xa9 2014-2024 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.37.0/LICENSE",source:"https://github.com/zloirock/core-js"})},3801:function(e,t,n){"use strict";var r=n(9145);e.exports=function(e,t){return r[e]||(r[e]=t||{})}},2068:function(e,t,n){"use strict";var r=n(8842),i=n(5963),o=n(2455),a=n(2924),l=r("".charAt),c=r("".charCodeAt),u=r("".slice),createMethod=function(e){return function(t,n){var r,d,p=o(a(t)),h=i(n),g=p.length;return h<0||h>=g?e?"":void 0:(r=c(p,h))<55296||r>56319||h+1===g||(d=c(p,h+1))<56320||d>57343?e?l(p,h):r:e?u(p,h,h+2):(r-55296<<10)+(d-56320)+65536}};e.exports={codeAt:createMethod(!1),charAt:createMethod(!0)}},4072:function(e,t,n){"use strict";var r=n(4130),i=n(4256),o=n(7738).String;e.exports=!!Object.getOwnPropertySymbols&&!i(function(){var e=Symbol("symbol detection");return!o(e)||!(Object(e) instanceof Symbol)||!Symbol.sham&&r&&r<41})},76:function(e,t,n){"use strict";var r=n(5963),i=Math.max,o=Math.min;e.exports=function(e,t){var n=r(e);return n<0?i(n+t,0):o(n,t)}},949:function(e,t,n){"use strict";var r=n(3910),i=n(2924);e.exports=function(e){return r(i(e))}},5963:function(e,t,n){"use strict";var r=n(1325);e.exports=function(e){var t=+e;return t!=t||0===t?0:r(t)}},2510:function(e,t,n){"use strict";var r=n(5963),i=Math.min;e.exports=function(e){var t=r(e);return t>0?i(t,9007199254740991):0}},4405:function(e,t,n){"use strict";var r=n(2924),i=Object;e.exports=function(e){return i(r(e))}},1777:function(e,t,n){"use strict";var r=n(5817),i=n(6695),o=n(5375),a=n(2112),l=n(1823),c=n(1350),u=TypeError,d=c("toPrimitive");e.exports=function(e,t){if(!i(e)||o(e))return e;var n,c=a(e,d);if(c){if(void 0===t&&(t="default"),!i(n=r(c,e,t))||o(n))return n;throw new u("Can't convert object to primitive value")}return void 0===t&&(t="number"),l(e,t)}},7843:function(e,t,n){"use strict";var r=n(1777),i=n(5375);e.exports=function(e){var t=r(e,"string");return i(t)?t:t+""}},8830:function(e,t,n){"use strict";var r=n(1350)("toStringTag"),i={};i[r]="z",e.exports="[object z]"===String(i)},2455:function(e,t,n){"use strict";var r=n(9743),i=String;e.exports=function(e){if("Symbol"===r(e))throw TypeError("Cannot convert a Symbol value to a string");return i(e)}},1747:function(e){"use strict";var t=String;e.exports=function(e){try{return t(e)}catch(e){return"Object"}}},7246:function(e,t,n){"use strict";var r=n(8842),i=0,o=Math.random(),a=r(1..toString);e.exports=function(e){return"Symbol("+(void 0===e?"":e)+")_"+a(++i+o,36)}},327:function(e,t,n){"use strict";var r=n(4072);e.exports=r&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},1887:function(e,t,n){"use strict";var r=n(2534),i=n(4256);e.exports=r&&i(function(){return 42!==Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype})},9819:function(e,t,n){"use strict";var r=n(7738),i=n(43),o=r.WeakMap;e.exports=i(o)&&/native code/.test(String(o))},1350:function(e,t,n){"use strict";var r=n(7738),i=n(3801),o=n(9472),a=n(7246),l=n(4072),c=n(327),u=r.Symbol,d=i("wks"),p=c?u.for||u:u&&u.withoutSetter||a;e.exports=function(e){return o(d,e)||(d[e]=l&&o(u,e)?u[e]:p("Symbol."+e)),d[e]}},7933:function(e,t,n){"use strict";var r=n(9272),i=n(4405),o=n(4464),a=n(5963),l=n(8609);r({target:"Array",proto:!0},{at:function(e){var t=i(this),n=o(t),r=a(e),l=r>=0?r:n+r;return l<0||l>=n?void 0:t[l]}}),l("at")},7781:function(e,t,n){"use strict";var r=n(9272),i=n(9162),o=n(6284),a=n(4405),l=n(4464),c=n(747);r({target:"Array",proto:!0},{flatMap:function(e){var t,n=a(this),r=l(n);return o(e),(t=c(n,0)).length=i(t,n,n,r,0,1,e,arguments.length>1?arguments[1]:void 0),t}})},3896:function(e,t,n){"use strict";var r=n(9272),i=n(9162),o=n(4405),a=n(4464),l=n(5963),c=n(747);r({target:"Array",proto:!0},{flat:function(){var e=arguments.length?arguments[0]:void 0,t=o(this),n=a(t),r=c(t,0);return r.length=i(r,t,t,n,0,void 0===e?1:l(e)),r}})},9328:function(e,t,n){"use strict";n(8609)("flatMap")},1767:function(e,t,n){"use strict";n(8609)("flat")},789:function(e,t,n){"use strict";var r=n(9272),i=n(3955);r({target:"RegExp",proto:!0,forced:/./.exec!==i},{exec:i})},4554:function(e,t,n){"use strict";var r=n(9272),i=n(8842),o=n(2924),a=n(5963),l=n(2455),c=n(4256),u=i("".charAt);r({target:"String",proto:!0,forced:c(function(){return"\uD842"!=="\uD842\uDFB7".at(-2)})},{at:function(e){var t=l(o(this)),n=t.length,r=a(e),i=r>=0?r:n+r;return i<0||i>=n?void 0:u(t,i)}})},3510:function(e,t,n){"use strict";var r=n(9272),i=n(5817),o=n(8842),a=n(2924),l=n(43),c=n(6617),u=n(1059),d=n(2455),p=n(2112),h=n(290),g=n(7175),f=n(1350),m=n(9168),y=f("replace"),b=TypeError,w=o("".indexOf),S=o("".replace),v=o("".slice),x=Math.max;r({target:"String",proto:!0},{replaceAll:function(e,t){var n,r,o,f,T,P,C,k,I=a(this),E=0,_=0,M="";if(!c(e)){if((n=u(e))&&!~w(d(a(h(e))),"g"))throw new b("`.replaceAll` does not allow non-global regexes");if(r=p(e,y))return i(r,e,I,t);if(m&&n)return S(d(I),e,t)}for(o=d(I),f=d(e),(T=l(t))||(t=d(t)),C=x(1,P=f.length),E=w(o,f);-1!==E;)k=T?d(t(f,E,o)):g(f,o,E,[],void 0,t),M+=v(o,_,E)+k,_=E+P,E=E+C>o.length?-1:w(o,f,E+C);return _<o.length&&(M+=v(o,_)),M}})},1490:function(e,t,n){"use strict";var r=n(5815),i=n(5817),o=n(8842),a=n(2571),l=n(4256),c=n(1485),u=n(43),d=n(6617),p=n(5963),h=n(2510),g=n(2455),f=n(2924),m=n(2166),y=n(2112),b=n(7175),w=n(8911),S=n(1350)("replace"),v=Math.max,x=Math.min,T=o([].concat),P=o([].push),C=o("".indexOf),k=o("".slice),I="$0"==="a".replace(/./,"$0"),E=!!/./[S]&&""===/./[S]("a","$0");a("replace",function(e,t,n){var o=E?"$":"$0";return[function(e,n){var r=f(this),o=d(e)?void 0:y(e,S);return o?i(o,e,r,n):i(t,g(r),e,n)},function(e,i){var a=c(this),l=g(e);if("string"==typeof i&&-1===C(i,o)&&-1===C(i,"$<")){var d=n(t,a,l,i);if(d.done)return d.value}var f=u(i);f||(i=g(i));var y=a.global;y&&(j=a.unicode,a.lastIndex=0);for(var S=[];null!==(A=w(a,l))&&(P(S,A),y);)""===g(A[0])&&(a.lastIndex=m(l,h(a.lastIndex),j));for(var I="",E=0,_=0;_<S.length;_++){for(var M,j,A,$,D=g((A=S[_])[0]),O=v(x(p(A.index),l.length),0),B=[],F=1;F<A.length;F++)P(B,void 0===(M=A[F])?M:String(M));var U=A.groups;if(f){var L=T([D],B,O,l);void 0!==U&&P(L,U),$=g(r(i,void 0,L))}else $=b(D,l,O,B,U,i);O>=E&&(I+=k(l,E,O)+$,E=O+D.length)}return I+k(l,E)}]},!!l(function(){var e=/./;return e.exec=function(){var e=[];return e.groups={a:"7"},e},"7"!=="".replace(e,"$<a>")})||!I||E)},9645:function(e,t,n){"use strict";var r=n(9228);e.exports=r},6930:function(e,t,n){"use strict";var r=n(5134);e.exports=r},4770:function(e,t,n){"use strict";var r=n(1521);e.exports=r},2880:function(e,t,n){"use strict";var r=n(7942);e.exports=r},9304:function(e,t,n){"use strict";var r=n(632);e.exports=r},3428:function(e,t,n){"use strict";function _extends(){return(_extends=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e}).apply(this,arguments)}n.d(t,{Z:function(){return _extends}})},5744:function(e,t,n){"use strict";function $e42e1063c40fb3ef$export$b9ecd428b558ff10(e,t,{checkForDefaultPrevented:n=!0}={}){return function(r){if(null==e||e(r),!1===n||!r.defaultPrevented)return null==t?void 0:t(r)}}n.d(t,{M:function(){return $e42e1063c40fb3ef$export$b9ecd428b558ff10}})},7733:function(e,t,n){"use strict";n.d(t,{B:function(){return $e02a7d9cb1dc128c$export$c74125a8e3af6bb2}});var r=n(2265),i=n(6989),o=n(2210),a=n(7256);function $e02a7d9cb1dc128c$export$c74125a8e3af6bb2(e){let t=e+"CollectionProvider",[n,l]=(0,i.b)(t),[c,u]=n(t,{collectionRef:{current:null},itemMap:new Map}),d=e+"CollectionSlot",p=r.forwardRef((e,t)=>{let{scope:n,children:i}=e,l=u(d,n),c=(0,o.e)(t,l.collectionRef);return r.createElement(a.g7,{ref:c},i)}),h=e+"CollectionItemSlot",g="data-radix-collection-item",f=r.forwardRef((e,t)=>{let{scope:n,children:i,...l}=e,c=r.useRef(null),d=(0,o.e)(t,c),p=u(h,n);return r.useEffect(()=>(p.itemMap.set(c,{ref:c,...l}),()=>void p.itemMap.delete(c))),r.createElement(a.g7,{[g]:"",ref:d},i)});return[{Provider:e=>{let{scope:t,children:n}=e,i=r.useRef(null),o=r.useRef(new Map).current;return r.createElement(c,{scope:t,itemMap:o,collectionRef:i},n)},Slot:p,ItemSlot:f},function(t){let n=u(e+"CollectionConsumer",t),i=r.useCallback(()=>{let e=n.collectionRef.current;if(!e)return[];let t=Array.from(e.querySelectorAll(`[${g}]`)),r=Array.from(n.itemMap.values()),i=r.sort((e,n)=>t.indexOf(e.ref.current)-t.indexOf(n.ref.current));return i},[n.collectionRef,n.itemMap]);return i},l]}},2210:function(e,t,n){"use strict";n.d(t,{F:function(){return $6ed0406888f73fc4$export$43e446d32b3d21af},e:function(){return $6ed0406888f73fc4$export$c7b2cbe3552a0d05}});var r=n(2265);function $6ed0406888f73fc4$var$setRef(e,t){"function"==typeof e?e(t):null!=e&&(e.current=t)}function $6ed0406888f73fc4$export$43e446d32b3d21af(...e){return t=>e.forEach(e=>$6ed0406888f73fc4$var$setRef(e,t))}function $6ed0406888f73fc4$export$c7b2cbe3552a0d05(...e){return(0,r.useCallback)($6ed0406888f73fc4$export$43e446d32b3d21af(...e),e)}},6989:function(e,t,n){"use strict";n.d(t,{b:function(){return $c512c27ab02ef895$export$50c7b4e9d9f19c1},k:function(){return $c512c27ab02ef895$export$fd42f52fd3ae1109}});var r=n(2265);function $c512c27ab02ef895$export$fd42f52fd3ae1109(e,t){let n=(0,r.createContext)(t);function Provider(e){let{children:t,...i}=e,o=(0,r.useMemo)(()=>i,Object.values(i));return(0,r.createElement)(n.Provider,{value:o},t)}function useContext(i){let o=(0,r.useContext)(n);if(o)return o;if(void 0!==t)return t;throw Error(`\`${i}\` must be used within \`${e}\``)}return Provider.displayName=e+"Provider",[Provider,useContext]}function $c512c27ab02ef895$export$50c7b4e9d9f19c1(e,t=[]){let n=[];function $c512c27ab02ef895$export$fd42f52fd3ae1109(t,i){let o=(0,r.createContext)(i),a=n.length;function Provider(t){let{scope:n,children:i,...l}=t,c=(null==n?void 0:n[e][a])||o,u=(0,r.useMemo)(()=>l,Object.values(l));return(0,r.createElement)(c.Provider,{value:u},i)}function useContext(n,l){let c=(null==l?void 0:l[e][a])||o,u=(0,r.useContext)(c);if(u)return u;if(void 0!==i)return i;throw Error(`\`${n}\` must be used within \`${t}\``)}return n=[...n,i],Provider.displayName=t+"Provider",[Provider,useContext]}let createScope=()=>{let t=n.map(e=>(0,r.createContext)(e));return function(n){let i=(null==n?void 0:n[e])||t;return(0,r.useMemo)(()=>({[`__scope${e}`]:{...n,[e]:i}}),[n,i])}};return createScope.scopeName=e,[$c512c27ab02ef895$export$fd42f52fd3ae1109,$c512c27ab02ef895$var$composeContextScopes(createScope,...t)]}function $c512c27ab02ef895$var$composeContextScopes(...e){let t=e[0];if(1===e.length)return t;let createScope1=()=>{let n=e.map(e=>({useScope:e(),scopeName:e.scopeName}));return function(e){let i=n.reduce((t,{useScope:n,scopeName:r})=>{let i=n(e),o=i[`__scope${r}`];return{...t,...o}},{});return(0,r.useMemo)(()=>({[`__scope${t.scopeName}`]:i}),[i])}};return createScope1.scopeName=t.scopeName,createScope1}},5400:function(e,t,n){"use strict";n.d(t,{gm:function(){return $f631663db3294ace$export$b39126d51d94e6f3}});var r=n(2265);let i=(0,r.createContext)(void 0);function $f631663db3294ace$export$b39126d51d94e6f3(e){let t=(0,r.useContext)(i);return e||t||"ltr"}},9249:function(e,t,n){"use strict";let r;n.d(t,{I0:function(){return m},XB:function(){return h},fC:function(){return f}});var i=n(3428),o=n(2265),a=n(5744),l=n(9790),c=n(2210),u=n(6459);function $addc16e1bbe58fd0$export$3a72a57244d6e765(e,t=null==globalThis?void 0:globalThis.document){let n=(0,u.W)(e);(0,o.useEffect)(()=>{let handleKeyDown=e=>{"Escape"===e.key&&n(e)};return t.addEventListener("keydown",handleKeyDown),()=>t.removeEventListener("keydown",handleKeyDown)},[n,t])}let d="dismissableLayer.update",p=(0,o.createContext)({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),h=(0,o.forwardRef)((e,t)=>{var n;let{disableOutsidePointerEvents:u=!1,onEscapeKeyDown:h,onPointerDownOutside:g,onFocusOutside:f,onInteractOutside:m,onDismiss:y,...b}=e,w=(0,o.useContext)(p),[S,v]=(0,o.useState)(null),x=null!==(n=null==S?void 0:S.ownerDocument)&&void 0!==n?n:null==globalThis?void 0:globalThis.document,[,T]=(0,o.useState)({}),P=(0,c.e)(t,e=>v(e)),C=Array.from(w.layers),[k]=[...w.layersWithOutsidePointerEventsDisabled].slice(-1),I=C.indexOf(k),E=S?C.indexOf(S):-1,_=w.layersWithOutsidePointerEventsDisabled.size>0,M=E>=I,j=$5cb92bef7577960e$var$usePointerDownOutside(e=>{let t=e.target,n=[...w.branches].some(e=>e.contains(t));!M||n||(null==g||g(e),null==m||m(e),e.defaultPrevented||null==y||y())},x),A=$5cb92bef7577960e$var$useFocusOutside(e=>{let t=e.target,n=[...w.branches].some(e=>e.contains(t));n||(null==f||f(e),null==m||m(e),e.defaultPrevented||null==y||y())},x);return $addc16e1bbe58fd0$export$3a72a57244d6e765(e=>{let t=E===w.layers.size-1;t&&(null==h||h(e),!e.defaultPrevented&&y&&(e.preventDefault(),y()))},x),(0,o.useEffect)(()=>{if(S)return u&&(0===w.layersWithOutsidePointerEventsDisabled.size&&(r=x.body.style.pointerEvents,x.body.style.pointerEvents="none"),w.layersWithOutsidePointerEventsDisabled.add(S)),w.layers.add(S),$5cb92bef7577960e$var$dispatchUpdate(),()=>{u&&1===w.layersWithOutsidePointerEventsDisabled.size&&(x.body.style.pointerEvents=r)}},[S,x,u,w]),(0,o.useEffect)(()=>()=>{S&&(w.layers.delete(S),w.layersWithOutsidePointerEventsDisabled.delete(S),$5cb92bef7577960e$var$dispatchUpdate())},[S,w]),(0,o.useEffect)(()=>{let handleUpdate=()=>T({});return document.addEventListener(d,handleUpdate),()=>document.removeEventListener(d,handleUpdate)},[]),(0,o.createElement)(l.WV.div,(0,i.Z)({},b,{ref:P,style:{pointerEvents:_?M?"auto":"none":void 0,...e.style},onFocusCapture:(0,a.M)(e.onFocusCapture,A.onFocusCapture),onBlurCapture:(0,a.M)(e.onBlurCapture,A.onBlurCapture),onPointerDownCapture:(0,a.M)(e.onPointerDownCapture,j.onPointerDownCapture)}))}),g=(0,o.forwardRef)((e,t)=>{let n=(0,o.useContext)(p),r=(0,o.useRef)(null),a=(0,c.e)(t,r);return(0,o.useEffect)(()=>{let e=r.current;if(e)return n.branches.add(e),()=>{n.branches.delete(e)}},[n.branches]),(0,o.createElement)(l.WV.div,(0,i.Z)({},e,{ref:a}))});function $5cb92bef7577960e$var$usePointerDownOutside(e,t=null==globalThis?void 0:globalThis.document){let n=(0,u.W)(e),r=(0,o.useRef)(!1),i=(0,o.useRef)(()=>{});return(0,o.useEffect)(()=>{let handlePointerDown=e=>{if(e.target&&!r.current){let r={originalEvent:e};function handleAndDispatchPointerDownOutsideEvent(){$5cb92bef7577960e$var$handleAndDispatchCustomEvent("dismissableLayer.pointerDownOutside",n,r,{discrete:!0})}"touch"===e.pointerType?(t.removeEventListener("click",i.current),i.current=handleAndDispatchPointerDownOutsideEvent,t.addEventListener("click",i.current,{once:!0})):handleAndDispatchPointerDownOutsideEvent()}else t.removeEventListener("click",i.current);r.current=!1},e=window.setTimeout(()=>{t.addEventListener("pointerdown",handlePointerDown)},0);return()=>{window.clearTimeout(e),t.removeEventListener("pointerdown",handlePointerDown),t.removeEventListener("click",i.current)}},[t,n]),{onPointerDownCapture:()=>r.current=!0}}function $5cb92bef7577960e$var$useFocusOutside(e,t=null==globalThis?void 0:globalThis.document){let n=(0,u.W)(e),r=(0,o.useRef)(!1);return(0,o.useEffect)(()=>{let handleFocus=e=>{e.target&&!r.current&&$5cb92bef7577960e$var$handleAndDispatchCustomEvent("dismissableLayer.focusOutside",n,{originalEvent:e},{discrete:!1})};return t.addEventListener("focusin",handleFocus),()=>t.removeEventListener("focusin",handleFocus)},[t,n]),{onFocusCapture:()=>r.current=!0,onBlurCapture:()=>r.current=!1}}function $5cb92bef7577960e$var$dispatchUpdate(){let e=new CustomEvent(d);document.dispatchEvent(e)}function $5cb92bef7577960e$var$handleAndDispatchCustomEvent(e,t,n,{discrete:r}){let i=n.originalEvent.target,o=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?(0,l.jH)(i,o):i.dispatchEvent(o)}let f=h,m=g},7544:function(e,t,n){"use strict";n.d(t,{Tr:function(){return $d08ef79370b62062$export$d7a01e11500dfb6f},Uv:function(){return $d08ef79370b62062$export$602eac185826482c},VY:function(){return E},ZA:function(){return _},ck:function(){return M},fC:function(){return $d08ef79370b62062$export$be92b6f5f03c0fe9},fF:function(){return $},oC:function(){return j},tu:function(){return D},wU:function(){return A},xz:function(){return I}});var r=n(3428),i=n(2265),o=n(5744),a=n(2210),l=n(6989),c=n(3763),u=n(9790),d=n(7079),p=n(966);let h="DropdownMenu",[g,f]=(0,l.b)(h,[d.Wf]),m=(0,d.Wf)(),[y,b]=g(h),w=(0,i.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,disabled:l=!1,...c}=e,p=b("DropdownMenuTrigger",n),h=m(n);return(0,i.createElement)(d.ee,(0,r.Z)({asChild:!0},h),(0,i.createElement)(u.WV.button,(0,r.Z)({type:"button",id:p.triggerId,"aria-haspopup":"menu","aria-expanded":p.open,"aria-controls":p.open?p.contentId:void 0,"data-state":p.open?"open":"closed","data-disabled":l?"":void 0,disabled:l},c,{ref:(0,a.F)(t,p.triggerRef),onPointerDown:(0,o.M)(e.onPointerDown,e=>{l||0!==e.button||!1!==e.ctrlKey||(p.onOpenToggle(),p.open||e.preventDefault())}),onKeyDown:(0,o.M)(e.onKeyDown,e=>{!l&&(["Enter"," "].includes(e.key)&&p.onOpenToggle(),"ArrowDown"===e.key&&p.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(e.key)&&e.preventDefault())})})))}),S=(0,i.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...a}=e,l=b("DropdownMenuContent",n),c=m(n),u=(0,i.useRef)(!1);return(0,i.createElement)(d.VY,(0,r.Z)({id:l.contentId,"aria-labelledby":l.triggerId},c,a,{ref:t,onCloseAutoFocus:(0,o.M)(e.onCloseAutoFocus,e=>{var t;u.current||null===(t=l.triggerRef.current)||void 0===t||t.focus(),u.current=!1,e.preventDefault()}),onInteractOutside:(0,o.M)(e.onInteractOutside,e=>{let t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;(!l.modal||r)&&(u.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),v=(0,i.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...o}=e,a=m(n);return(0,i.createElement)(d.ZA,(0,r.Z)({},a,o,{ref:t}))}),x=(0,i.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...o}=e,a=m(n);return(0,i.createElement)(d.ck,(0,r.Z)({},a,o,{ref:t}))}),T=(0,i.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...o}=e,a=m(n);return(0,i.createElement)(d.oC,(0,r.Z)({},a,o,{ref:t}))}),P=(0,i.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...o}=e,a=m(n);return(0,i.createElement)(d.wU,(0,r.Z)({},a,o,{ref:t}))}),C=(0,i.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...o}=e,a=m(n);return(0,i.createElement)(d.fF,(0,r.Z)({},a,o,{ref:t}))}),k=(0,i.forwardRef)((e,t)=>{let{__scopeDropdownMenu:n,...o}=e,a=m(n);return(0,i.createElement)(d.tu,(0,r.Z)({},a,o,{ref:t,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),$d08ef79370b62062$export$be92b6f5f03c0fe9=e=>{let{__scopeDropdownMenu:t,children:n,dir:o,open:a,defaultOpen:l,onOpenChange:u,modal:h=!0}=e,g=m(t),f=(0,i.useRef)(null),[b=!1,w]=(0,c.T)({prop:a,defaultProp:l,onChange:u});return(0,i.createElement)(y,{scope:t,triggerId:(0,p.M)(),triggerRef:f,contentId:(0,p.M)(),open:b,onOpenChange:w,onOpenToggle:(0,i.useCallback)(()=>w(e=>!e),[w]),modal:h},(0,i.createElement)(d.fC,(0,r.Z)({},g,{open:b,onOpenChange:w,dir:o,modal:h}),n))},I=w,$d08ef79370b62062$export$602eac185826482c=e=>{let{__scopeDropdownMenu:t,...n}=e,o=m(t);return(0,i.createElement)(d.h_,(0,r.Z)({},o,n))},E=S,_=v,M=x,j=T,A=P,$d08ef79370b62062$export$d7a01e11500dfb6f=e=>{let{__scopeDropdownMenu:t,children:n,open:o,onOpenChange:a,defaultOpen:l}=e,u=m(t),[p=!1,h]=(0,c.T)({prop:o,defaultProp:l,onChange:a});return(0,i.createElement)(d.Tr,(0,r.Z)({},u,{open:p,onOpenChange:h}),n)},$=C,D=k},1244:function(e,t,n){"use strict";n.d(t,{EW:function(){return $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c}});var r=n(2265);let i=0;function $3db38b7d1fb3fe6a$export$b7ece24a22aeda8c(){(0,r.useEffect)(()=>{var e,t;let n=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",null!==(e=n[0])&&void 0!==e?e:$3db38b7d1fb3fe6a$var$createFocusGuard()),document.body.insertAdjacentElement("beforeend",null!==(t=n[1])&&void 0!==t?t:$3db38b7d1fb3fe6a$var$createFocusGuard()),i++,()=>{1===i&&document.querySelectorAll("[data-radix-focus-guard]").forEach(e=>e.remove()),i--}},[])}function $3db38b7d1fb3fe6a$var$createFocusGuard(){let e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.cssText="outline: none; opacity: 0; position: fixed; pointer-events: none",e}},2759:function(e,t,n){"use strict";n.d(t,{M:function(){return p}});var r=n(3428),i=n(2265),o=n(2210),a=n(9790),l=n(6459);let c="focusScope.autoFocusOnMount",u="focusScope.autoFocusOnUnmount",d={bubbles:!1,cancelable:!0},p=(0,i.forwardRef)((e,t)=>{let{loop:n=!1,trapped:p=!1,onMountAutoFocus:g,onUnmountAutoFocus:f,...m}=e,[y,b]=(0,i.useState)(null),w=(0,l.W)(g),S=(0,l.W)(f),v=(0,i.useRef)(null),x=(0,o.e)(t,e=>b(e)),T=(0,i.useRef)({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;(0,i.useEffect)(()=>{if(p){function handleFocusIn(e){if(T.paused||!y)return;let t=e.target;y.contains(t)?v.current=t:$d3863c46a17e8a28$var$focus(v.current,{select:!0})}function handleFocusOut(e){if(T.paused||!y)return;let t=e.relatedTarget;null===t||y.contains(t)||$d3863c46a17e8a28$var$focus(v.current,{select:!0})}function handleMutations(e){let t=document.activeElement;if(t===document.body)for(let t of e)t.removedNodes.length>0&&$d3863c46a17e8a28$var$focus(y)}document.addEventListener("focusin",handleFocusIn),document.addEventListener("focusout",handleFocusOut);let e=new MutationObserver(handleMutations);return y&&e.observe(y,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",handleFocusIn),document.removeEventListener("focusout",handleFocusOut),e.disconnect()}}},[p,y,T.paused]),(0,i.useEffect)(()=>{if(y){h.add(T);let e=document.activeElement,t=y.contains(e);if(!t){let t=new CustomEvent(c,d);y.addEventListener(c,w),y.dispatchEvent(t),t.defaultPrevented||($d3863c46a17e8a28$var$focusFirst($d3863c46a17e8a28$var$removeLinks($d3863c46a17e8a28$var$getTabbableCandidates(y)),{select:!0}),document.activeElement===e&&$d3863c46a17e8a28$var$focus(y))}return()=>{y.removeEventListener(c,w),setTimeout(()=>{let t=new CustomEvent(u,d);y.addEventListener(u,S),y.dispatchEvent(t),t.defaultPrevented||$d3863c46a17e8a28$var$focus(null!=e?e:document.body,{select:!0}),y.removeEventListener(u,S),h.remove(T)},0)}}},[y,w,S,T]);let P=(0,i.useCallback)(e=>{if(!n&&!p||T.paused)return;let t="Tab"===e.key&&!e.altKey&&!e.ctrlKey&&!e.metaKey,r=document.activeElement;if(t&&r){let t=e.currentTarget,[i,o]=$d3863c46a17e8a28$var$getTabbableEdges(t),a=i&&o;a?e.shiftKey||r!==o?e.shiftKey&&r===i&&(e.preventDefault(),n&&$d3863c46a17e8a28$var$focus(o,{select:!0})):(e.preventDefault(),n&&$d3863c46a17e8a28$var$focus(i,{select:!0})):r===t&&e.preventDefault()}},[n,p,T.paused]);return(0,i.createElement)(a.WV.div,(0,r.Z)({tabIndex:-1},m,{ref:x,onKeyDown:P}))});function $d3863c46a17e8a28$var$focusFirst(e,{select:t=!1}={}){let n=document.activeElement;for(let r of e)if($d3863c46a17e8a28$var$focus(r,{select:t}),document.activeElement!==n)return}function $d3863c46a17e8a28$var$getTabbableEdges(e){let t=$d3863c46a17e8a28$var$getTabbableCandidates(e),n=$d3863c46a17e8a28$var$findVisible(t,e),r=$d3863c46a17e8a28$var$findVisible(t.reverse(),e);return[n,r]}function $d3863c46a17e8a28$var$getTabbableCandidates(e){let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function $d3863c46a17e8a28$var$findVisible(e,t){for(let n of e)if(!$d3863c46a17e8a28$var$isHidden(n,{upTo:t}))return n}function $d3863c46a17e8a28$var$isHidden(e,{upTo:t}){if("hidden"===getComputedStyle(e).visibility)return!0;for(;e&&(void 0===t||e!==t);){if("none"===getComputedStyle(e).display)return!0;e=e.parentElement}return!1}function $d3863c46a17e8a28$var$isSelectableInput(e){return e instanceof HTMLInputElement&&"select"in e}function $d3863c46a17e8a28$var$focus(e,{select:t=!1}={}){if(e&&e.focus){let n=document.activeElement;e.focus({preventScroll:!0}),e!==n&&$d3863c46a17e8a28$var$isSelectableInput(e)&&t&&e.select()}}let h=$d3863c46a17e8a28$var$createFocusScopesStack();function $d3863c46a17e8a28$var$createFocusScopesStack(){let e=[];return{add(t){let n=e[0];t!==n&&(null==n||n.pause()),(e=$d3863c46a17e8a28$var$arrayRemove(e,t)).unshift(t)},remove(t){var n;null===(n=(e=$d3863c46a17e8a28$var$arrayRemove(e,t))[0])||void 0===n||n.resume()}}}function $d3863c46a17e8a28$var$arrayRemove(e,t){let n=[...e],r=n.indexOf(t);return -1!==r&&n.splice(r,1),n}function $d3863c46a17e8a28$var$removeLinks(e){return e.filter(e=>"A"!==e.tagName)}},966:function(e,t,n){"use strict";n.d(t,{M:function(){return $1746a345f3d73bb7$export$f680877a34711e37}});var r,i=n(2265),o=n(1030);let a=(r||(r=n.t(i,2)))["useId".toString()]||(()=>void 0),l=0;function $1746a345f3d73bb7$export$f680877a34711e37(e){let[t,n]=i.useState(a());return(0,o.b)(()=>{e||n(e=>null!=e?e:String(l++))},[e]),e||(t?`radix-${t}`:"")}},7079:function(e,t,n){"use strict";n.d(t,{ee:function(){return eB},Eh:function(){return eW},oC:function(){return ez},VY:function(){return eF},ZA:function(){return eU},ck:function(){return eR},wU:function(){return eH},__:function(){return eL},h_:function(){return $6cc32821e9371a1c$export$602eac185826482c},Ee:function(){return eN},Rk:function(){return eV},fC:function(){return $6cc32821e9371a1c$export$be92b6f5f03c0fe9},Z0:function(){return eG},Tr:function(){return $6cc32821e9371a1c$export$d7a01e11500dfb6f},tu:function(){return eK},fF:function(){return eZ},Wf:function(){return K}});var r=n(3428),i=n(2265),o=n(5744),a=n(7733),l=n(2210),c=n(6989),u=n(5400),d=n(9249),p=n(1244),h=n(2759),g=n(966),f=n(2300),m=n(2730),y=n(5606),b=n(9790),w=n(6459),S=n(3763);let v="rovingFocusGroup.onEntryFocus",x={bubbles:!1,cancelable:!0},T="RovingFocusGroup",[P,C,k]=(0,a.B)(T),[I,E]=(0,c.b)(T,[k]),[_,M]=I(T),j=(0,i.forwardRef)((e,t)=>(0,i.createElement)(P.Provider,{scope:e.__scopeRovingFocusGroup},(0,i.createElement)(P.Slot,{scope:e.__scopeRovingFocusGroup},(0,i.createElement)(A,(0,r.Z)({},e,{ref:t}))))),A=(0,i.forwardRef)((e,t)=>{let{__scopeRovingFocusGroup:n,orientation:a,loop:c=!1,dir:d,currentTabStopId:p,defaultCurrentTabStopId:h,onCurrentTabStopIdChange:g,onEntryFocus:f,...m}=e,y=(0,i.useRef)(null),T=(0,l.e)(t,y),P=(0,u.gm)(d),[k=null,I]=(0,S.T)({prop:p,defaultProp:h,onChange:g}),[E,M]=(0,i.useState)(!1),j=(0,w.W)(f),A=C(n),$=(0,i.useRef)(!1),[D,O]=(0,i.useState)(0);return(0,i.useEffect)(()=>{let e=y.current;if(e)return e.addEventListener(v,j),()=>e.removeEventListener(v,j)},[j]),(0,i.createElement)(_,{scope:n,orientation:a,dir:P,loop:c,currentTabStopId:k,onItemFocus:(0,i.useCallback)(e=>I(e),[I]),onItemShiftTab:(0,i.useCallback)(()=>M(!0),[]),onFocusableItemAdd:(0,i.useCallback)(()=>O(e=>e+1),[]),onFocusableItemRemove:(0,i.useCallback)(()=>O(e=>e-1),[])},(0,i.createElement)(b.WV.div,(0,r.Z)({tabIndex:E||0===D?-1:0,"data-orientation":a},m,{ref:T,style:{outline:"none",...e.style},onMouseDown:(0,o.M)(e.onMouseDown,()=>{$.current=!0}),onFocus:(0,o.M)(e.onFocus,e=>{let t=!$.current;if(e.target===e.currentTarget&&t&&!E){let t=new CustomEvent(v,x);if(e.currentTarget.dispatchEvent(t),!t.defaultPrevented){let e=A().filter(e=>e.focusable),t=e.find(e=>e.active),n=e.find(e=>e.id===k),r=[t,n,...e].filter(Boolean),i=r.map(e=>e.ref.current);$d7bdfb9eb0fdf311$var$focusFirst(i)}}$.current=!1}),onBlur:(0,o.M)(e.onBlur,()=>M(!1))})))}),$=(0,i.forwardRef)((e,t)=>{let{__scopeRovingFocusGroup:n,focusable:a=!0,active:l=!1,tabStopId:c,...u}=e,d=(0,g.M)(),p=c||d,h=M("RovingFocusGroupItem",n),f=h.currentTabStopId===p,m=C(n),{onFocusableItemAdd:y,onFocusableItemRemove:w}=h;return(0,i.useEffect)(()=>{if(a)return y(),()=>w()},[a,y,w]),(0,i.createElement)(P.ItemSlot,{scope:n,id:p,focusable:a,active:l},(0,i.createElement)(b.WV.span,(0,r.Z)({tabIndex:f?0:-1,"data-orientation":h.orientation},u,{ref:t,onMouseDown:(0,o.M)(e.onMouseDown,e=>{a?h.onItemFocus(p):e.preventDefault()}),onFocus:(0,o.M)(e.onFocus,()=>h.onItemFocus(p)),onKeyDown:(0,o.M)(e.onKeyDown,e=>{if("Tab"===e.key&&e.shiftKey){h.onItemShiftTab();return}if(e.target!==e.currentTarget)return;let t=$d7bdfb9eb0fdf311$var$getFocusIntent(e,h.orientation,h.dir);if(void 0!==t){e.preventDefault();let n=m().filter(e=>e.focusable),r=n.map(e=>e.ref.current);if("last"===t)r.reverse();else if("prev"===t||"next"===t){"prev"===t&&r.reverse();let n=r.indexOf(e.currentTarget);r=h.loop?$d7bdfb9eb0fdf311$var$wrapArray(r,n+1):r.slice(n+1)}setTimeout(()=>$d7bdfb9eb0fdf311$var$focusFirst(r))}})})))}),D={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function $d7bdfb9eb0fdf311$var$getDirectionAwareKey(e,t){return"rtl"!==t?e:"ArrowLeft"===e?"ArrowRight":"ArrowRight"===e?"ArrowLeft":e}function $d7bdfb9eb0fdf311$var$getFocusIntent(e,t,n){let r=$d7bdfb9eb0fdf311$var$getDirectionAwareKey(e.key,n);if(!("vertical"===t&&["ArrowLeft","ArrowRight"].includes(r))&&!("horizontal"===t&&["ArrowUp","ArrowDown"].includes(r)))return D[r]}function $d7bdfb9eb0fdf311$var$focusFirst(e){let t=document.activeElement;for(let n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function $d7bdfb9eb0fdf311$var$wrapArray(e,t){return e.map((n,r)=>e[(t+r)%e.length])}var O=n(7256),B=n(1779),F=n(3386);let U=["Enter"," "],L=["ArrowUp","PageDown","End"],R=["ArrowDown","PageUp","Home",...L],z={ltr:[...U,"ArrowRight"],rtl:[...U,"ArrowLeft"]},N={ltr:["ArrowLeft"],rtl:["ArrowRight"]},V="Menu",[H,G,W]=(0,a.B)(V),[Z,K]=(0,c.b)(V,[W,f.D7,E]),Y=(0,f.D7)(),X=E(),[J,Q]=Z(V),[ee,et]=Z(V),en=(0,i.forwardRef)((e,t)=>{let{__scopeMenu:n,...o}=e,a=Y(n);return(0,i.createElement)(f.ee,(0,r.Z)({},a,o,{ref:t}))}),er="MenuPortal",[ei,eo]=Z(er,{forceMount:void 0}),ea="MenuContent",[es,el]=Z(ea),ec=(0,i.forwardRef)((e,t)=>{let n=eo(ea,e.__scopeMenu),{forceMount:o=n.forceMount,...a}=e,l=Q(ea,e.__scopeMenu),c=et(ea,e.__scopeMenu);return(0,i.createElement)(H.Provider,{scope:e.__scopeMenu},(0,i.createElement)(y.z,{present:o||l.open},(0,i.createElement)(H.Slot,{scope:e.__scopeMenu},c.modal?(0,i.createElement)(eu,(0,r.Z)({},a,{ref:t})):(0,i.createElement)(ed,(0,r.Z)({},a,{ref:t})))))}),eu=(0,i.forwardRef)((e,t)=>{let n=Q(ea,e.__scopeMenu),a=(0,i.useRef)(null),c=(0,l.e)(t,a);return(0,i.useEffect)(()=>{let e=a.current;if(e)return(0,B.hideOthers)(e)},[]),(0,i.createElement)(ep,(0,r.Z)({},e,{ref:c,trapFocus:n.open,disableOutsidePointerEvents:n.open,disableOutsideScroll:!0,onFocusOutside:(0,o.M)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>n.onOpenChange(!1)}))}),ed=(0,i.forwardRef)((e,t)=>{let n=Q(ea,e.__scopeMenu);return(0,i.createElement)(ep,(0,r.Z)({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>n.onOpenChange(!1)}))}),ep=(0,i.forwardRef)((e,t)=>{let{__scopeMenu:n,loop:a=!1,trapFocus:c,onOpenAutoFocus:u,onCloseAutoFocus:g,disableOutsidePointerEvents:m,onEntryFocus:y,onEscapeKeyDown:b,onPointerDownOutside:w,onFocusOutside:S,onInteractOutside:v,onDismiss:x,disableOutsideScroll:T,...P}=e,C=Q(ea,n),k=et(ea,n),I=Y(n),E=X(n),_=G(n),[M,A]=(0,i.useState)(null),$=(0,i.useRef)(null),D=(0,l.e)(t,$,C.onContentChange),B=(0,i.useRef)(0),U=(0,i.useRef)(""),z=(0,i.useRef)(0),N=(0,i.useRef)(null),V=(0,i.useRef)("right"),H=(0,i.useRef)(0),W=T?F.Z:i.Fragment,Z=T?{as:O.g7,allowPinchZoom:!0}:void 0,handleTypeaheadSearch=e=>{var t,n;let r=U.current+e,i=_().filter(e=>!e.disabled),o=document.activeElement,a=null===(t=i.find(e=>e.ref.current===o))||void 0===t?void 0:t.textValue,l=i.map(e=>e.textValue),c=$6cc32821e9371a1c$var$getNextMatch(l,r,a),u=null===(n=i.find(e=>e.textValue===c))||void 0===n?void 0:n.ref.current;!function updateSearch(e){U.current=e,window.clearTimeout(B.current),""!==e&&(B.current=window.setTimeout(()=>updateSearch(""),1e3))}(r),u&&setTimeout(()=>u.focus())};(0,i.useEffect)(()=>()=>window.clearTimeout(B.current),[]),(0,p.EW)();let K=(0,i.useCallback)(e=>{var t,n;let r=V.current===(null===(t=N.current)||void 0===t?void 0:t.side);return r&&$6cc32821e9371a1c$var$isPointerInGraceArea(e,null===(n=N.current)||void 0===n?void 0:n.area)},[]);return(0,i.createElement)(es,{scope:n,searchRef:U,onItemEnter:(0,i.useCallback)(e=>{K(e)&&e.preventDefault()},[K]),onItemLeave:(0,i.useCallback)(e=>{var t;K(e)||(null===(t=$.current)||void 0===t||t.focus(),A(null))},[K]),onTriggerLeave:(0,i.useCallback)(e=>{K(e)&&e.preventDefault()},[K]),pointerGraceTimerRef:z,onPointerGraceIntentChange:(0,i.useCallback)(e=>{N.current=e},[])},(0,i.createElement)(W,Z,(0,i.createElement)(h.M,{asChild:!0,trapped:c,onMountAutoFocus:(0,o.M)(u,e=>{var t;e.preventDefault(),null===(t=$.current)||void 0===t||t.focus()}),onUnmountAutoFocus:g},(0,i.createElement)(d.XB,{asChild:!0,disableOutsidePointerEvents:m,onEscapeKeyDown:b,onPointerDownOutside:w,onFocusOutside:S,onInteractOutside:v,onDismiss:x},(0,i.createElement)(j,(0,r.Z)({asChild:!0},E,{dir:k.dir,orientation:"vertical",loop:a,currentTabStopId:M,onCurrentTabStopIdChange:A,onEntryFocus:(0,o.M)(y,e=>{k.isUsingKeyboardRef.current||e.preventDefault()})}),(0,i.createElement)(f.VY,(0,r.Z)({role:"menu","aria-orientation":"vertical","data-state":$6cc32821e9371a1c$var$getOpenState(C.open),"data-radix-menu-content":"",dir:k.dir},I,P,{ref:D,style:{outline:"none",...P.style},onKeyDown:(0,o.M)(P.onKeyDown,e=>{let t=e.target,n=t.closest("[data-radix-menu-content]")===e.currentTarget,r=e.ctrlKey||e.altKey||e.metaKey,i=1===e.key.length;n&&("Tab"===e.key&&e.preventDefault(),!r&&i&&handleTypeaheadSearch(e.key));let o=$.current;if(e.target!==o||!R.includes(e.key))return;e.preventDefault();let a=_().filter(e=>!e.disabled),l=a.map(e=>e.ref.current);L.includes(e.key)&&l.reverse(),$6cc32821e9371a1c$var$focusFirst(l)}),onBlur:(0,o.M)(e.onBlur,e=>{e.currentTarget.contains(e.target)||(window.clearTimeout(B.current),U.current="")}),onPointerMove:(0,o.M)(e.onPointerMove,$6cc32821e9371a1c$var$whenMouse(e=>{let t=e.target,n=H.current!==e.clientX;if(e.currentTarget.contains(t)&&n){let t=e.clientX>H.current?"right":"left";V.current=t,H.current=e.clientX}}))})))))))}),eh=(0,i.forwardRef)((e,t)=>{let{__scopeMenu:n,...o}=e;return(0,i.createElement)(b.WV.div,(0,r.Z)({role:"group"},o,{ref:t}))}),eg=(0,i.forwardRef)((e,t)=>{let{__scopeMenu:n,...o}=e;return(0,i.createElement)(b.WV.div,(0,r.Z)({},o,{ref:t}))}),ef="MenuItem",em="menu.itemSelect",ey=(0,i.forwardRef)((e,t)=>{let{disabled:n=!1,onSelect:a,...c}=e,u=(0,i.useRef)(null),d=et(ef,e.__scopeMenu),p=el(ef,e.__scopeMenu),h=(0,l.e)(t,u),g=(0,i.useRef)(!1);return(0,i.createElement)(eb,(0,r.Z)({},c,{ref:h,disabled:n,onClick:(0,o.M)(e.onClick,()=>{let e=u.current;if(!n&&e){let t=new CustomEvent(em,{bubbles:!0,cancelable:!0});e.addEventListener(em,e=>null==a?void 0:a(e),{once:!0}),(0,b.jH)(e,t),t.defaultPrevented?g.current=!1:d.onClose()}}),onPointerDown:t=>{var n;null===(n=e.onPointerDown)||void 0===n||n.call(e,t),g.current=!0},onPointerUp:(0,o.M)(e.onPointerUp,e=>{var t;g.current||null===(t=e.currentTarget)||void 0===t||t.click()}),onKeyDown:(0,o.M)(e.onKeyDown,e=>{let t=""!==p.searchRef.current;!n&&(!t||" "!==e.key)&&U.includes(e.key)&&(e.currentTarget.click(),e.preventDefault())})}))}),eb=(0,i.forwardRef)((e,t)=>{let{__scopeMenu:n,disabled:a=!1,textValue:c,...u}=e,d=el(ef,n),p=X(n),h=(0,i.useRef)(null),g=(0,l.e)(t,h),[f,m]=(0,i.useState)(!1),[y,w]=(0,i.useState)("");return(0,i.useEffect)(()=>{let e=h.current;if(e){var t;w((null!==(t=e.textContent)&&void 0!==t?t:"").trim())}},[u.children]),(0,i.createElement)(H.ItemSlot,{scope:n,disabled:a,textValue:null!=c?c:y},(0,i.createElement)($,(0,r.Z)({asChild:!0},p,{focusable:!a}),(0,i.createElement)(b.WV.div,(0,r.Z)({role:"menuitem","data-highlighted":f?"":void 0,"aria-disabled":a||void 0,"data-disabled":a?"":void 0},u,{ref:g,onPointerMove:(0,o.M)(e.onPointerMove,$6cc32821e9371a1c$var$whenMouse(e=>{if(a)d.onItemLeave(e);else if(d.onItemEnter(e),!e.defaultPrevented){let t=e.currentTarget;t.focus()}})),onPointerLeave:(0,o.M)(e.onPointerLeave,$6cc32821e9371a1c$var$whenMouse(e=>d.onItemLeave(e))),onFocus:(0,o.M)(e.onFocus,()=>m(!0)),onBlur:(0,o.M)(e.onBlur,()=>m(!1))}))))}),ew=(0,i.forwardRef)((e,t)=>{let{checked:n=!1,onCheckedChange:a,...l}=e;return(0,i.createElement)(eC,{scope:e.__scopeMenu,checked:n},(0,i.createElement)(ey,(0,r.Z)({role:"menuitemcheckbox","aria-checked":$6cc32821e9371a1c$var$isIndeterminate(n)?"mixed":n},l,{ref:t,"data-state":$6cc32821e9371a1c$var$getCheckedState(n),onSelect:(0,o.M)(l.onSelect,()=>null==a?void 0:a(!!$6cc32821e9371a1c$var$isIndeterminate(n)||!n),{checkForDefaultPrevented:!1})})))}),[eS,ev]=Z("MenuRadioGroup",{value:void 0,onValueChange:()=>{}}),ex=(0,i.forwardRef)((e,t)=>{let{value:n,onValueChange:o,...a}=e,l=(0,w.W)(o);return(0,i.createElement)(eS,{scope:e.__scopeMenu,value:n,onValueChange:l},(0,i.createElement)(eh,(0,r.Z)({},a,{ref:t})))}),eT=(0,i.forwardRef)((e,t)=>{let{value:n,...a}=e,l=ev("MenuRadioItem",e.__scopeMenu),c=n===l.value;return(0,i.createElement)(eC,{scope:e.__scopeMenu,checked:c},(0,i.createElement)(ey,(0,r.Z)({role:"menuitemradio","aria-checked":c},a,{ref:t,"data-state":$6cc32821e9371a1c$var$getCheckedState(c),onSelect:(0,o.M)(a.onSelect,()=>{var e;return null===(e=l.onValueChange)||void 0===e?void 0:e.call(l,n)},{checkForDefaultPrevented:!1})})))}),eP="MenuItemIndicator",[eC,ek]=Z(eP,{checked:!1}),eI=(0,i.forwardRef)((e,t)=>{let{__scopeMenu:n,forceMount:o,...a}=e,l=ek(eP,n);return(0,i.createElement)(y.z,{present:o||$6cc32821e9371a1c$var$isIndeterminate(l.checked)||!0===l.checked},(0,i.createElement)(b.WV.span,(0,r.Z)({},a,{ref:t,"data-state":$6cc32821e9371a1c$var$getCheckedState(l.checked)})))}),eE=(0,i.forwardRef)((e,t)=>{let{__scopeMenu:n,...o}=e;return(0,i.createElement)(b.WV.div,(0,r.Z)({role:"separator","aria-orientation":"horizontal"},o,{ref:t}))}),e_=(0,i.forwardRef)((e,t)=>{let{__scopeMenu:n,...o}=e,a=Y(n);return(0,i.createElement)(f.Eh,(0,r.Z)({},a,o,{ref:t}))}),eM="MenuSub",[ej,eA]=Z(eM),e$="MenuSubTrigger",eD=(0,i.forwardRef)((e,t)=>{let n=Q(e$,e.__scopeMenu),a=et(e$,e.__scopeMenu),c=eA(e$,e.__scopeMenu),u=el(e$,e.__scopeMenu),d=(0,i.useRef)(null),{pointerGraceTimerRef:p,onPointerGraceIntentChange:h}=u,g={__scopeMenu:e.__scopeMenu},f=(0,i.useCallback)(()=>{d.current&&window.clearTimeout(d.current),d.current=null},[]);return(0,i.useEffect)(()=>f,[f]),(0,i.useEffect)(()=>{let e=p.current;return()=>{window.clearTimeout(e),h(null)}},[p,h]),(0,i.createElement)(en,(0,r.Z)({asChild:!0},g),(0,i.createElement)(eb,(0,r.Z)({id:c.triggerId,"aria-haspopup":"menu","aria-expanded":n.open,"aria-controls":c.contentId,"data-state":$6cc32821e9371a1c$var$getOpenState(n.open)},e,{ref:(0,l.F)(t,c.onTriggerChange),onClick:t=>{var r;null===(r=e.onClick)||void 0===r||r.call(e,t),e.disabled||t.defaultPrevented||(t.currentTarget.focus(),n.open||n.onOpenChange(!0))},onPointerMove:(0,o.M)(e.onPointerMove,$6cc32821e9371a1c$var$whenMouse(t=>{u.onItemEnter(t),t.defaultPrevented||e.disabled||n.open||d.current||(u.onPointerGraceIntentChange(null),d.current=window.setTimeout(()=>{n.onOpenChange(!0),f()},100))})),onPointerLeave:(0,o.M)(e.onPointerLeave,$6cc32821e9371a1c$var$whenMouse(e=>{var t,r;f();let i=null===(t=n.content)||void 0===t?void 0:t.getBoundingClientRect();if(i){let t=null===(r=n.content)||void 0===r?void 0:r.dataset.side,o="right"===t,a=i[o?"left":"right"],l=i[o?"right":"left"];u.onPointerGraceIntentChange({area:[{x:e.clientX+(o?-5:5),y:e.clientY},{x:a,y:i.top},{x:l,y:i.top},{x:l,y:i.bottom},{x:a,y:i.bottom}],side:t}),window.clearTimeout(p.current),p.current=window.setTimeout(()=>u.onPointerGraceIntentChange(null),300)}else{if(u.onTriggerLeave(e),e.defaultPrevented)return;u.onPointerGraceIntentChange(null)}})),onKeyDown:(0,o.M)(e.onKeyDown,t=>{let r=""!==u.searchRef.current;if(!e.disabled&&(!r||" "!==t.key)&&z[a.dir].includes(t.key)){var i;n.onOpenChange(!0),null===(i=n.content)||void 0===i||i.focus(),t.preventDefault()}})})))}),eO=(0,i.forwardRef)((e,t)=>{let n=eo(ea,e.__scopeMenu),{forceMount:a=n.forceMount,...c}=e,u=Q(ea,e.__scopeMenu),d=et(ea,e.__scopeMenu),p=eA("MenuSubContent",e.__scopeMenu),h=(0,i.useRef)(null),g=(0,l.e)(t,h);return(0,i.createElement)(H.Provider,{scope:e.__scopeMenu},(0,i.createElement)(y.z,{present:a||u.open},(0,i.createElement)(H.Slot,{scope:e.__scopeMenu},(0,i.createElement)(ep,(0,r.Z)({id:p.contentId,"aria-labelledby":p.triggerId},c,{ref:g,align:"start",side:"rtl"===d.dir?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:e=>{var t;d.isUsingKeyboardRef.current&&(null===(t=h.current)||void 0===t||t.focus()),e.preventDefault()},onCloseAutoFocus:e=>e.preventDefault(),onFocusOutside:(0,o.M)(e.onFocusOutside,e=>{e.target!==p.trigger&&u.onOpenChange(!1)}),onEscapeKeyDown:(0,o.M)(e.onEscapeKeyDown,e=>{d.onClose(),e.preventDefault()}),onKeyDown:(0,o.M)(e.onKeyDown,e=>{let t=e.currentTarget.contains(e.target),n=N[d.dir].includes(e.key);if(t&&n){var r;u.onOpenChange(!1),null===(r=p.trigger)||void 0===r||r.focus(),e.preventDefault()}})})))))});function $6cc32821e9371a1c$var$getOpenState(e){return e?"open":"closed"}function $6cc32821e9371a1c$var$isIndeterminate(e){return"indeterminate"===e}function $6cc32821e9371a1c$var$getCheckedState(e){return $6cc32821e9371a1c$var$isIndeterminate(e)?"indeterminate":e?"checked":"unchecked"}function $6cc32821e9371a1c$var$focusFirst(e){let t=document.activeElement;for(let n of e)if(n===t||(n.focus(),document.activeElement!==t))return}function $6cc32821e9371a1c$var$wrapArray(e,t){return e.map((n,r)=>e[(t+r)%e.length])}function $6cc32821e9371a1c$var$getNextMatch(e,t,n){let r=t.length>1&&Array.from(t).every(e=>e===t[0]),i=r?t[0]:t,o=n?e.indexOf(n):-1,a=$6cc32821e9371a1c$var$wrapArray(e,Math.max(o,0)),l=1===i.length;l&&(a=a.filter(e=>e!==n));let c=a.find(e=>e.toLowerCase().startsWith(i.toLowerCase()));return c!==n?c:void 0}function $6cc32821e9371a1c$var$isPointInPolygon(e,t){let{x:n,y:r}=e,i=!1;for(let e=0,o=t.length-1;e<t.length;o=e++){let a=t[e].x,l=t[e].y,c=t[o].x,u=t[o].y,d=l>r!=u>r&&n<(c-a)*(r-l)/(u-l)+a;d&&(i=!i)}return i}function $6cc32821e9371a1c$var$isPointerInGraceArea(e,t){if(!t)return!1;let n={x:e.clientX,y:e.clientY};return $6cc32821e9371a1c$var$isPointInPolygon(n,t)}function $6cc32821e9371a1c$var$whenMouse(e){return t=>"mouse"===t.pointerType?e(t):void 0}let $6cc32821e9371a1c$export$be92b6f5f03c0fe9=e=>{let{__scopeMenu:t,open:n=!1,children:r,dir:o,onOpenChange:a,modal:l=!0}=e,c=Y(t),[d,p]=(0,i.useState)(null),h=(0,i.useRef)(!1),g=(0,w.W)(a),m=(0,u.gm)(o);return(0,i.useEffect)(()=>{let handleKeyDown=()=>{h.current=!0,document.addEventListener("pointerdown",handlePointer,{capture:!0,once:!0}),document.addEventListener("pointermove",handlePointer,{capture:!0,once:!0})},handlePointer=()=>h.current=!1;return document.addEventListener("keydown",handleKeyDown,{capture:!0}),()=>{document.removeEventListener("keydown",handleKeyDown,{capture:!0}),document.removeEventListener("pointerdown",handlePointer,{capture:!0}),document.removeEventListener("pointermove",handlePointer,{capture:!0})}},[]),(0,i.createElement)(f.fC,c,(0,i.createElement)(J,{scope:t,open:n,onOpenChange:g,content:d,onContentChange:p},(0,i.createElement)(ee,{scope:t,onClose:(0,i.useCallback)(()=>g(!1),[g]),isUsingKeyboardRef:h,dir:m,modal:l},r)))},eB=en,$6cc32821e9371a1c$export$602eac185826482c=e=>{let{__scopeMenu:t,forceMount:n,children:r,container:o}=e,a=Q(er,t);return(0,i.createElement)(ei,{scope:t,forceMount:n},(0,i.createElement)(y.z,{present:n||a.open},(0,i.createElement)(m.h,{asChild:!0,container:o},r)))},eF=ec,eU=eh,eL=eg,eR=ey,ez=ew,eN=ex,eV=eT,eH=eI,eG=eE,eW=e_,$6cc32821e9371a1c$export$d7a01e11500dfb6f=e=>{let{__scopeMenu:t,children:n,open:r=!1,onOpenChange:o}=e,a=Q(eM,t),l=Y(t),[c,u]=(0,i.useState)(null),[d,p]=(0,i.useState)(null),h=(0,w.W)(o);return(0,i.useEffect)(()=>(!1===a.open&&h(!1),()=>h(!1)),[a.open,h]),(0,i.createElement)(f.fC,l,(0,i.createElement)(J,{scope:t,open:r,onOpenChange:h,content:d,onContentChange:p},(0,i.createElement)(ej,{scope:t,contentId:(0,g.M)(),triggerId:(0,g.M)(),trigger:c,onTriggerChange:u},n)))},eZ=eD,eK=eO},2300:function(e,t,n){"use strict";n.d(t,{ee:function(){return B},Eh:function(){return U},VY:function(){return F},fC:function(){return $cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9},D7:function(){return k}});var r=n(3428),i=n(2265);let o=["top","right","bottom","left"],a=Math.min,l=Math.max,c=Math.round,u=Math.floor,createCoords=e=>({x:e,y:e}),d={left:"right",right:"left",bottom:"top",top:"bottom"},p={start:"end",end:"start"};function evaluate(e,t){return"function"==typeof e?e(t):e}function getSide(e){return e.split("-")[0]}function getAlignment(e){return e.split("-")[1]}function getOppositeAxis(e){return"x"===e?"y":"x"}function getAxisLength(e){return"y"===e?"height":"width"}function getSideAxis(e){return["top","bottom"].includes(getSide(e))?"y":"x"}function getAlignmentSides(e,t,n){void 0===n&&(n=!1);let r=getAlignment(e),i=getOppositeAxis(getSideAxis(e)),o=getAxisLength(i),a="x"===i?r===(n?"end":"start")?"right":"left":"start"===r?"bottom":"top";return t.reference[o]>t.floating[o]&&(a=getOppositePlacement(a)),[a,getOppositePlacement(a)]}function getExpandedPlacements(e){let t=getOppositePlacement(e);return[getOppositeAlignmentPlacement(e),t,getOppositeAlignmentPlacement(t)]}function getOppositeAlignmentPlacement(e){return e.replace(/start|end/g,e=>p[e])}function getSideList(e,t,n){let r=["left","right"],i=["right","left"];switch(e){case"top":case"bottom":if(n)return t?i:r;return t?r:i;case"left":case"right":return t?["top","bottom"]:["bottom","top"];default:return[]}}function getOppositeAxisPlacements(e,t,n,r){let i=getAlignment(e),o=getSideList(getSide(e),"start"===n,r);return i&&(o=o.map(e=>e+"-"+i),t&&(o=o.concat(o.map(getOppositeAlignmentPlacement)))),o}function getOppositePlacement(e){return e.replace(/left|right|bottom|top/g,e=>d[e])}function expandPaddingObject(e){return{top:0,right:0,bottom:0,left:0,...e}}function getPaddingObject(e){return"number"!=typeof e?expandPaddingObject(e):{top:e,right:e,bottom:e,left:e}}function rectToClientRect(e){return{...e,top:e.y,left:e.x,right:e.x+e.width,bottom:e.y+e.height}}function computeCoordsFromPlacement(e,t,n){let r,{reference:i,floating:o}=e,a=getSideAxis(t),l=getOppositeAxis(getSideAxis(t)),c=getAxisLength(l),u=getSide(t),d="y"===a,p=i.x+i.width/2-o.width/2,h=i.y+i.height/2-o.height/2,g=i[c]/2-o[c]/2;switch(u){case"top":r={x:p,y:i.y-o.height};break;case"bottom":r={x:p,y:i.y+i.height};break;case"right":r={x:i.x+i.width,y:h};break;case"left":r={x:i.x-o.width,y:h};break;default:r={x:i.x,y:i.y}}switch(getAlignment(t)){case"start":r[l]-=g*(n&&d?-1:1);break;case"end":r[l]+=g*(n&&d?-1:1)}return r}let computePosition=async(e,t,n)=>{let{placement:r="bottom",strategy:i="absolute",middleware:o=[],platform:a}=n,l=o.filter(Boolean),c=await (null==a.isRTL?void 0:a.isRTL(t)),u=await a.getElementRects({reference:e,floating:t,strategy:i}),{x:d,y:p}=computeCoordsFromPlacement(u,r,c),h=r,g={},f=0;for(let n=0;n<l.length;n++){let{name:o,fn:m}=l[n],{x:y,y:b,data:w,reset:S}=await m({x:d,y:p,initialPlacement:r,placement:h,strategy:i,middlewareData:g,rects:u,platform:a,elements:{reference:e,floating:t}});if(d=null!=y?y:d,p=null!=b?b:p,g={...g,[o]:{...g[o],...w}},S&&f<=50){f++,"object"==typeof S&&(S.placement&&(h=S.placement),S.rects&&(u=!0===S.rects?await a.getElementRects({reference:e,floating:t,strategy:i}):S.rects),{x:d,y:p}=computeCoordsFromPlacement(u,h,c)),n=-1;continue}}return{x:d,y:p,placement:h,strategy:i,middlewareData:g}};async function detectOverflow(e,t){var n;void 0===t&&(t={});let{x:r,y:i,platform:o,rects:a,elements:l,strategy:c}=e,{boundary:u="clippingAncestors",rootBoundary:d="viewport",elementContext:p="floating",altBoundary:h=!1,padding:g=0}=evaluate(t,e),f=getPaddingObject(g),m=l[h?"floating"===p?"reference":"floating":p],y=rectToClientRect(await o.getClippingRect({element:null==(n=await (null==o.isElement?void 0:o.isElement(m)))||n?m:m.contextElement||await (null==o.getDocumentElement?void 0:o.getDocumentElement(l.floating)),boundary:u,rootBoundary:d,strategy:c})),b="floating"===p?{...a.floating,x:r,y:i}:a.reference,w=await (null==o.getOffsetParent?void 0:o.getOffsetParent(l.floating)),S=await (null==o.isElement?void 0:o.isElement(w))&&await (null==o.getScale?void 0:o.getScale(w))||{x:1,y:1},v=rectToClientRect(o.convertOffsetParentRelativeRectToViewportRelativeRect?await o.convertOffsetParentRelativeRectToViewportRelativeRect({rect:b,offsetParent:w,strategy:c}):b);return{top:(y.top-v.top+f.top)/S.y,bottom:(v.bottom-y.bottom+f.bottom)/S.y,left:(y.left-v.left+f.left)/S.x,right:(v.right-y.right+f.right)/S.x}}let arrow=e=>({name:"arrow",options:e,async fn(t){let{x:n,y:r,placement:i,rects:o,platform:c,elements:u,middlewareData:d}=t,{element:p,padding:h=0}=evaluate(e,t)||{};if(null==p)return{};let g=getPaddingObject(h),f={x:n,y:r},m=getOppositeAxis(getSideAxis(i)),y=getAxisLength(m),b=await c.getDimensions(p),w="y"===m,S=w?"clientHeight":"clientWidth",v=o.reference[y]+o.reference[m]-f[m]-o.floating[y],x=f[m]-o.reference[m],T=await (null==c.getOffsetParent?void 0:c.getOffsetParent(p)),P=T?T[S]:0;P&&await (null==c.isElement?void 0:c.isElement(T))||(P=u.floating[S]||o.floating[y]);let C=P/2-b[y]/2-1,k=a(g[w?"top":"left"],C),I=a(g[w?"bottom":"right"],C),E=P-b[y]-I,_=P/2-b[y]/2+(v/2-x/2),M=l(k,a(_,E)),j=!d.arrow&&null!=getAlignment(i)&&_!=M&&o.reference[y]/2-(_<k?k:I)-b[y]/2<0,A=j?_<k?_-k:_-E:0;return{[m]:f[m]+A,data:{[m]:M,centerOffset:_-M-A,...j&&{alignmentOffset:A}},reset:j}}});function getSideOffsets(e,t){return{top:e.top-t.height,right:e.right-t.width,bottom:e.bottom-t.height,left:e.left-t.width}}function isAnySideFullyClipped(e){return o.some(t=>e[t]>=0)}async function convertValueToCoords(e,t){let{placement:n,platform:r,elements:i}=e,o=await (null==r.isRTL?void 0:r.isRTL(i.floating)),a=getSide(n),l=getAlignment(n),c="y"===getSideAxis(n),u=["left","top"].includes(a)?-1:1,d=o&&c?-1:1,p=evaluate(t,e),{mainAxis:h,crossAxis:g,alignmentAxis:f}="number"==typeof p?{mainAxis:p,crossAxis:0,alignmentAxis:null}:{mainAxis:0,crossAxis:0,alignmentAxis:null,...p};return l&&"number"==typeof f&&(g="end"===l?-1*f:f),c?{x:g*d,y:h*u}:{x:h*u,y:g*d}}function getNodeName(e){return isNode(e)?(e.nodeName||"").toLowerCase():"#document"}function getWindow(e){var t;return(null==e?void 0:null==(t=e.ownerDocument)?void 0:t.defaultView)||window}function getDocumentElement(e){var t;return null==(t=(isNode(e)?e.ownerDocument:e.document)||window.document)?void 0:t.documentElement}function isNode(e){return e instanceof Node||e instanceof getWindow(e).Node}function isElement(e){return e instanceof Element||e instanceof getWindow(e).Element}function isHTMLElement(e){return e instanceof HTMLElement||e instanceof getWindow(e).HTMLElement}function isShadowRoot(e){return"undefined"!=typeof ShadowRoot&&(e instanceof ShadowRoot||e instanceof getWindow(e).ShadowRoot)}function isOverflowElement(e){let{overflow:t,overflowX:n,overflowY:r,display:i}=getComputedStyle(e);return/auto|scroll|overlay|hidden|clip/.test(t+r+n)&&!["inline","contents"].includes(i)}function isTableElement(e){return["table","td","th"].includes(getNodeName(e))}function isContainingBlock(e){let t=isWebKit(),n=getComputedStyle(e);return"none"!==n.transform||"none"!==n.perspective||!!n.containerType&&"normal"!==n.containerType||!t&&!!n.backdropFilter&&"none"!==n.backdropFilter||!t&&!!n.filter&&"none"!==n.filter||["transform","perspective","filter"].some(e=>(n.willChange||"").includes(e))||["paint","layout","strict","content"].some(e=>(n.contain||"").includes(e))}function getContainingBlock(e){let t=getParentNode(e);for(;isHTMLElement(t)&&!isLastTraversableNode(t);){if(isContainingBlock(t))return t;t=getParentNode(t)}return null}function isWebKit(){return"undefined"!=typeof CSS&&!!CSS.supports&&CSS.supports("-webkit-backdrop-filter","none")}function isLastTraversableNode(e){return["html","body","#document"].includes(getNodeName(e))}function getComputedStyle(e){return getWindow(e).getComputedStyle(e)}function getNodeScroll(e){return isElement(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.pageXOffset,scrollTop:e.pageYOffset}}function getParentNode(e){if("html"===getNodeName(e))return e;let t=e.assignedSlot||e.parentNode||isShadowRoot(e)&&e.host||getDocumentElement(e);return isShadowRoot(t)?t.host:t}function getNearestOverflowAncestor(e){let t=getParentNode(e);return isLastTraversableNode(t)?e.ownerDocument?e.ownerDocument.body:e.body:isHTMLElement(t)&&isOverflowElement(t)?t:getNearestOverflowAncestor(t)}function getOverflowAncestors(e,t,n){var r;void 0===t&&(t=[]),void 0===n&&(n=!0);let i=getNearestOverflowAncestor(e),o=i===(null==(r=e.ownerDocument)?void 0:r.body),a=getWindow(i);return o?t.concat(a,a.visualViewport||[],isOverflowElement(i)?i:[],a.frameElement&&n?getOverflowAncestors(a.frameElement):[]):t.concat(i,getOverflowAncestors(i,[],n))}function getCssDimensions(e){let t=getComputedStyle(e),n=parseFloat(t.width)||0,r=parseFloat(t.height)||0,i=isHTMLElement(e),o=i?e.offsetWidth:n,a=i?e.offsetHeight:r,l=c(n)!==o||c(r)!==a;return l&&(n=o,r=a),{width:n,height:r,$:l}}function unwrapElement(e){return isElement(e)?e:e.contextElement}function getScale(e){let t=unwrapElement(e);if(!isHTMLElement(t))return createCoords(1);let n=t.getBoundingClientRect(),{width:r,height:i,$:o}=getCssDimensions(t),a=(o?c(n.width):n.width)/r,l=(o?c(n.height):n.height)/i;return a&&Number.isFinite(a)||(a=1),l&&Number.isFinite(l)||(l=1),{x:a,y:l}}let h=createCoords(0);function getVisualOffsets(e){let t=getWindow(e);return isWebKit()&&t.visualViewport?{x:t.visualViewport.offsetLeft,y:t.visualViewport.offsetTop}:h}function shouldAddVisualOffsets(e,t,n){return void 0===t&&(t=!1),!!n&&(!t||n===getWindow(e))&&t}function getBoundingClientRect(e,t,n,r){void 0===t&&(t=!1),void 0===n&&(n=!1);let i=e.getBoundingClientRect(),o=unwrapElement(e),a=createCoords(1);t&&(r?isElement(r)&&(a=getScale(r)):a=getScale(e));let l=shouldAddVisualOffsets(o,n,r)?getVisualOffsets(o):createCoords(0),c=(i.left+l.x)/a.x,u=(i.top+l.y)/a.y,d=i.width/a.x,p=i.height/a.y;if(o){let e=getWindow(o),t=r&&isElement(r)?getWindow(r):r,n=e.frameElement;for(;n&&r&&t!==e;){let e=getScale(n),t=n.getBoundingClientRect(),r=getComputedStyle(n),i=t.left+(n.clientLeft+parseFloat(r.paddingLeft))*e.x,o=t.top+(n.clientTop+parseFloat(r.paddingTop))*e.y;c*=e.x,u*=e.y,d*=e.x,p*=e.y,c+=i,u+=o,n=getWindow(n).frameElement}}return rectToClientRect({width:d,height:p,x:c,y:u})}function convertOffsetParentRelativeRectToViewportRelativeRect(e){let{rect:t,offsetParent:n,strategy:r}=e,i=isHTMLElement(n),o=getDocumentElement(n);if(n===o)return t;let a={scrollLeft:0,scrollTop:0},l=createCoords(1),c=createCoords(0);if((i||!i&&"fixed"!==r)&&(("body"!==getNodeName(n)||isOverflowElement(o))&&(a=getNodeScroll(n)),isHTMLElement(n))){let e=getBoundingClientRect(n);l=getScale(n),c.x=e.x+n.clientLeft,c.y=e.y+n.clientTop}return{width:t.width*l.x,height:t.height*l.y,x:t.x*l.x-a.scrollLeft*l.x+c.x,y:t.y*l.y-a.scrollTop*l.y+c.y}}function getClientRects(e){return Array.from(e.getClientRects())}function getWindowScrollBarX(e){return getBoundingClientRect(getDocumentElement(e)).left+getNodeScroll(e).scrollLeft}function getDocumentRect(e){let t=getDocumentElement(e),n=getNodeScroll(e),r=e.ownerDocument.body,i=l(t.scrollWidth,t.clientWidth,r.scrollWidth,r.clientWidth),o=l(t.scrollHeight,t.clientHeight,r.scrollHeight,r.clientHeight),a=-n.scrollLeft+getWindowScrollBarX(e),c=-n.scrollTop;return"rtl"===getComputedStyle(r).direction&&(a+=l(t.clientWidth,r.clientWidth)-i),{width:i,height:o,x:a,y:c}}function getViewportRect(e,t){let n=getWindow(e),r=getDocumentElement(e),i=n.visualViewport,o=r.clientWidth,a=r.clientHeight,l=0,c=0;if(i){o=i.width,a=i.height;let e=isWebKit();(!e||e&&"fixed"===t)&&(l=i.offsetLeft,c=i.offsetTop)}return{width:o,height:a,x:l,y:c}}function getInnerBoundingClientRect(e,t){let n=getBoundingClientRect(e,!0,"fixed"===t),r=n.top+e.clientTop,i=n.left+e.clientLeft,o=isHTMLElement(e)?getScale(e):createCoords(1),a=e.clientWidth*o.x,l=e.clientHeight*o.y,c=i*o.x,u=r*o.y;return{width:a,height:l,x:c,y:u}}function getClientRectFromClippingAncestor(e,t,n){let r;if("viewport"===t)r=getViewportRect(e,n);else if("document"===t)r=getDocumentRect(getDocumentElement(e));else if(isElement(t))r=getInnerBoundingClientRect(t,n);else{let n=getVisualOffsets(e);r={...t,x:t.x-n.x,y:t.y-n.y}}return rectToClientRect(r)}function hasFixedPositionAncestor(e,t){let n=getParentNode(e);return!(n===t||!isElement(n)||isLastTraversableNode(n))&&("fixed"===getComputedStyle(n).position||hasFixedPositionAncestor(n,t))}function getClippingElementAncestors(e,t){let n=t.get(e);if(n)return n;let r=getOverflowAncestors(e,[],!1).filter(e=>isElement(e)&&"body"!==getNodeName(e)),i=null,o="fixed"===getComputedStyle(e).position,a=o?getParentNode(e):e;for(;isElement(a)&&!isLastTraversableNode(a);){let t=getComputedStyle(a),n=isContainingBlock(a);n||"fixed"!==t.position||(i=null);let l=o?!n&&!i:!n&&"static"===t.position&&!!i&&["absolute","fixed"].includes(i.position)||isOverflowElement(a)&&!n&&hasFixedPositionAncestor(e,a);l?r=r.filter(e=>e!==a):i=t,a=getParentNode(a)}return t.set(e,r),r}function getClippingRect(e){let{element:t,boundary:n,rootBoundary:r,strategy:i}=e,o="clippingAncestors"===n?getClippingElementAncestors(t,this._c):[].concat(n),c=[...o,r],u=c[0],d=c.reduce((e,n)=>{let r=getClientRectFromClippingAncestor(t,n,i);return e.top=l(r.top,e.top),e.right=a(r.right,e.right),e.bottom=a(r.bottom,e.bottom),e.left=l(r.left,e.left),e},getClientRectFromClippingAncestor(t,u,i));return{width:d.right-d.left,height:d.bottom-d.top,x:d.left,y:d.top}}function getDimensions(e){return getCssDimensions(e)}function getRectRelativeToOffsetParent(e,t,n){let r=isHTMLElement(t),i=getDocumentElement(t),o="fixed"===n,a=getBoundingClientRect(e,!0,o,t),l={scrollLeft:0,scrollTop:0},c=createCoords(0);if(r||!r&&!o){if(("body"!==getNodeName(t)||isOverflowElement(i))&&(l=getNodeScroll(t)),r){let e=getBoundingClientRect(t,!0,o,t);c.x=e.x+t.clientLeft,c.y=e.y+t.clientTop}else i&&(c.x=getWindowScrollBarX(i))}return{x:a.left+l.scrollLeft-c.x,y:a.top+l.scrollTop-c.y,width:a.width,height:a.height}}function getTrueOffsetParent(e,t){return isHTMLElement(e)&&"fixed"!==getComputedStyle(e).position?t?t(e):e.offsetParent:null}function getOffsetParent(e,t){let n=getWindow(e);if(!isHTMLElement(e))return n;let r=getTrueOffsetParent(e,t);for(;r&&isTableElement(r)&&"static"===getComputedStyle(r).position;)r=getTrueOffsetParent(r,t);return r&&("html"===getNodeName(r)||"body"===getNodeName(r)&&"static"===getComputedStyle(r).position&&!isContainingBlock(r))?n:r||getContainingBlock(e)||n}let getElementRects=async function(e){let{reference:t,floating:n,strategy:r}=e,i=this.getOffsetParent||getOffsetParent,o=this.getDimensions;return{reference:getRectRelativeToOffsetParent(t,await i(n),r),floating:{x:0,y:0,...await o(n)}}};function isRTL(e){return"rtl"===getComputedStyle(e).direction}let g={convertOffsetParentRelativeRectToViewportRelativeRect,getDocumentElement:getDocumentElement,getClippingRect,getOffsetParent,getElementRects,getClientRects,getDimensions,getScale,isElement:isElement,isRTL};function observeMove(e,t){let n,r=null,i=getDocumentElement(e);function cleanup(){clearTimeout(n),r&&r.disconnect(),r=null}function refresh(o,c){void 0===o&&(o=!1),void 0===c&&(c=1),cleanup();let{left:d,top:p,width:h,height:g}=e.getBoundingClientRect();if(o||t(),!h||!g)return;let f=u(p),m=u(i.clientWidth-(d+h)),y=u(i.clientHeight-(p+g)),b=u(d),w={rootMargin:-f+"px "+-m+"px "+-y+"px "+-b+"px",threshold:l(0,a(1,c))||1},S=!0;function handleObserve(e){let t=e[0].intersectionRatio;if(t!==c){if(!S)return refresh();t?refresh(!1,t):n=setTimeout(()=>{refresh(!1,1e-7)},100)}S=!1}try{r=new IntersectionObserver(handleObserve,{...w,root:i.ownerDocument})}catch(e){r=new IntersectionObserver(handleObserve,w)}r.observe(e)}return refresh(!0),cleanup}function autoUpdate(e,t,n,r){let i;void 0===r&&(r={});let{ancestorScroll:o=!0,ancestorResize:a=!0,elementResize:l="function"==typeof ResizeObserver,layoutShift:c="function"==typeof IntersectionObserver,animationFrame:u=!1}=r,d=unwrapElement(e),p=o||a?[...d?getOverflowAncestors(d):[],...getOverflowAncestors(t)]:[];p.forEach(e=>{o&&e.addEventListener("scroll",n,{passive:!0}),a&&e.addEventListener("resize",n)});let h=d&&c?observeMove(d,n):null,g=-1,f=null;l&&(f=new ResizeObserver(e=>{let[r]=e;r&&r.target===d&&f&&(f.unobserve(t),cancelAnimationFrame(g),g=requestAnimationFrame(()=>{f&&f.observe(t)})),n()}),d&&!u&&f.observe(d),f.observe(t));let m=u?getBoundingClientRect(e):null;function frameLoop(){let t=getBoundingClientRect(e);m&&(t.x!==m.x||t.y!==m.y||t.width!==m.width||t.height!==m.height)&&n(),m=t,i=requestAnimationFrame(frameLoop)}return u&&frameLoop(),n(),()=>{p.forEach(e=>{o&&e.removeEventListener("scroll",n),a&&e.removeEventListener("resize",n)}),h&&h(),f&&f.disconnect(),f=null,u&&cancelAnimationFrame(i)}}let floating_ui_dom_computePosition=(e,t,n)=>{let r=new Map,i={platform:g,...n},o={...i.platform,_c:r};return computePosition(e,t,{...i,platform:o})};var f=n(4887);let floating_ui_react_dom_arrow=e=>{function isRef(e){return({}).hasOwnProperty.call(e,"current")}return{name:"arrow",options:e,fn(t){let{element:n,padding:r}="function"==typeof e?e(t):e;if(n&&isRef(n)){if(null!=n.current)return arrow({element:n.current,padding:r}).fn(t)}else if(n)return arrow({element:n,padding:r}).fn(t);return{}}}};var m="undefined"!=typeof document?i.useLayoutEffect:i.useEffect;function deepEqual(e,t){let n,r,i;if(e===t)return!0;if(typeof e!=typeof t)return!1;if("function"==typeof e&&e.toString()===t.toString())return!0;if(e&&t&&"object"==typeof e){if(Array.isArray(e)){if((n=e.length)!=t.length)return!1;for(r=n;0!=r--;)if(!deepEqual(e[r],t[r]))return!1;return!0}if((n=(i=Object.keys(e)).length)!==Object.keys(t).length)return!1;for(r=n;0!=r--;)if(!({}).hasOwnProperty.call(t,i[r]))return!1;for(r=n;0!=r--;){let n=i[r];if(("_owner"!==n||!e.$$typeof)&&!deepEqual(e[n],t[n]))return!1}return!0}return e!=e&&t!=t}function getDPR(e){if("undefined"==typeof window)return 1;let t=e.ownerDocument.defaultView||window;return t.devicePixelRatio||1}function roundByDPR(e,t){let n=getDPR(e);return Math.round(t*n)/n}function useLatestRef(e){let t=i.useRef(e);return m(()=>{t.current=e}),t}function useFloating(e){void 0===e&&(e={});let{placement:t="bottom",strategy:n="absolute",middleware:r=[],platform:o,elements:{reference:a,floating:l}={},transform:c=!0,whileElementsMounted:u,open:d}=e,[p,h]=i.useState({x:0,y:0,strategy:n,placement:t,middlewareData:{},isPositioned:!1}),[g,y]=i.useState(r);deepEqual(g,r)||y(r);let[b,w]=i.useState(null),[S,v]=i.useState(null),x=i.useCallback(e=>{e!=k.current&&(k.current=e,w(e))},[w]),T=i.useCallback(e=>{e!==I.current&&(I.current=e,v(e))},[v]),P=a||b,C=l||S,k=i.useRef(null),I=i.useRef(null),E=i.useRef(p),_=useLatestRef(u),M=useLatestRef(o),j=i.useCallback(()=>{if(!k.current||!I.current)return;let e={placement:t,strategy:n,middleware:g};M.current&&(e.platform=M.current),floating_ui_dom_computePosition(k.current,I.current,e).then(e=>{let t={...e,isPositioned:!0};A.current&&!deepEqual(E.current,t)&&(E.current=t,f.flushSync(()=>{h(t)}))})},[g,t,n,M]);m(()=>{!1===d&&E.current.isPositioned&&(E.current.isPositioned=!1,h(e=>({...e,isPositioned:!1})))},[d]);let A=i.useRef(!1);m(()=>(A.current=!0,()=>{A.current=!1}),[]),m(()=>{if(P&&(k.current=P),C&&(I.current=C),P&&C){if(_.current)return _.current(P,C,j);j()}},[P,C,j,_]);let $=i.useMemo(()=>({reference:k,floating:I,setReference:x,setFloating:T}),[x,T]),D=i.useMemo(()=>({reference:P,floating:C}),[P,C]),O=i.useMemo(()=>{let e={position:n,left:0,top:0};if(!D.floating)return e;let t=roundByDPR(D.floating,p.x),r=roundByDPR(D.floating,p.y);return c?{...e,transform:"translate("+t+"px, "+r+"px)",...getDPR(D.floating)>=1.5&&{willChange:"transform"}}:{position:n,left:t,top:r}},[n,c,D.floating,p.x,p.y]);return i.useMemo(()=>({...p,update:j,refs:$,elements:D,floatingStyles:O}),[p,j,$,D,O])}var y=n(9790);let b=(0,i.forwardRef)((e,t)=>{let{children:n,width:o=10,height:a=5,...l}=e;return(0,i.createElement)(y.WV.svg,(0,r.Z)({},l,{ref:t,width:o,height:a,viewBox:"0 0 30 10",preserveAspectRatio:"none"}),e.asChild?n:(0,i.createElement)("polygon",{points:"0,0 30,0 15,10"}))});var w=n(2210),S=n(6989),v=n(6459),x=n(1030),T=n(4977);let P="Popper",[C,k]=(0,S.b)(P),[I,E]=C(P),_=(0,i.forwardRef)((e,t)=>{let{__scopePopper:n,virtualRef:o,...a}=e,l=E("PopperAnchor",n),c=(0,i.useRef)(null),u=(0,w.e)(t,c);return(0,i.useEffect)(()=>{l.onAnchorChange((null==o?void 0:o.current)||c.current)}),o?null:(0,i.createElement)(y.WV.div,(0,r.Z)({},a,{ref:u}))}),M="PopperContent",[j,A]=C(M),$=(0,i.forwardRef)((e,t)=>{var n,o,c,u,d,p,h,g,f,m,b,S,P,C;let{__scopePopper:k,side:I="bottom",sideOffset:_=0,align:A="center",alignOffset:$=0,arrowPadding:D=0,avoidCollisions:O=!0,collisionBoundary:B=[],collisionPadding:F=0,sticky:U="partial",hideWhenDetached:L=!1,updatePositionStrategy:R="optimized",onPlaced:z,...N}=e,V=E(M,k),[H,G]=(0,i.useState)(null),W=(0,w.e)(t,e=>G(e)),[Z,K]=(0,i.useState)(null),Y=(0,T.t)(Z),X=null!==(n=null==Y?void 0:Y.width)&&void 0!==n?n:0,J=null!==(o=null==Y?void 0:Y.height)&&void 0!==o?o:0,Q="number"==typeof F?F:{top:0,right:0,bottom:0,left:0,...F},ee=Array.isArray(B)?B:[B],et=ee.length>0,en={padding:Q,boundary:ee.filter($cf1ac5d9fe0e8206$var$isNotNull),altBoundary:et},{refs:er,floatingStyles:ei,placement:eo,isPositioned:ea,middlewareData:es}=useFloating({strategy:"fixed",placement:I+("center"!==A?"-"+A:""),whileElementsMounted:(...e)=>{let t=autoUpdate(...e,{animationFrame:"always"===R});return t},elements:{reference:V.anchor},middleware:[{name:"offset",options:f={mainAxis:_+J,alignmentAxis:$},async fn(e){let{x:t,y:n}=e,r=await convertValueToCoords(e,f);return{x:t+r.x,y:n+r.y,data:r}}},O&&{name:"shift",options:b={mainAxis:!0,crossAxis:!1,limiter:"partial"===U?(void 0===m&&(m={}),{options:m,fn(e){let{x:t,y:n,placement:r,rects:i,middlewareData:o}=e,{offset:a=0,mainAxis:l=!0,crossAxis:c=!0}=evaluate(m,e),u={x:t,y:n},d=getSideAxis(r),p=getOppositeAxis(d),h=u[p],g=u[d],f=evaluate(a,e),y="number"==typeof f?{mainAxis:f,crossAxis:0}:{mainAxis:0,crossAxis:0,...f};if(l){let e="y"===p?"height":"width",t=i.reference[p]-i.floating[e]+y.mainAxis,n=i.reference[p]+i.reference[e]-y.mainAxis;h<t?h=t:h>n&&(h=n)}if(c){var b,w;let e="y"===p?"width":"height",t=["top","left"].includes(getSide(r)),n=i.reference[d]-i.floating[e]+(t&&(null==(b=o.offset)?void 0:b[d])||0)+(t?0:y.crossAxis),a=i.reference[d]+i.reference[e]+(t?0:(null==(w=o.offset)?void 0:w[d])||0)-(t?y.crossAxis:0);g<n?g=n:g>a&&(g=a)}return{[p]:h,[d]:g}}}):void 0,...en},async fn(e){let{x:t,y:n,placement:r}=e,{mainAxis:i=!0,crossAxis:o=!1,limiter:c={fn:e=>{let{x:t,y:n}=e;return{x:t,y:n}}},...u}=evaluate(b,e),d={x:t,y:n},p=await detectOverflow(e,u),h=getSideAxis(getSide(r)),g=getOppositeAxis(h),f=d[g],m=d[h];if(i){let e=f+p["y"===g?"top":"left"],t=f-p["y"===g?"bottom":"right"];f=l(e,a(f,t))}if(o){let e="y"===h?"top":"left",t="y"===h?"bottom":"right",n=m+p[e],r=m-p[t];m=l(n,a(m,r))}let y=c.fn({...e,[g]:f,[h]:m});return{...y,data:{x:y.x-t,y:y.y-n}}}},O&&{name:"flip",options:S={...en},async fn(e){var t,n,r,i,o;let{placement:a,middlewareData:l,rects:c,initialPlacement:u,platform:d,elements:p}=e,{mainAxis:h=!0,crossAxis:g=!0,fallbackPlacements:f,fallbackStrategy:m="bestFit",fallbackAxisSideDirection:y="none",flipAlignment:b=!0,...w}=evaluate(S,e);if(null!=(t=l.arrow)&&t.alignmentOffset)return{};let v=getSide(a),x=getSide(u)===u,T=await (null==d.isRTL?void 0:d.isRTL(p.floating)),P=f||(x||!b?[getOppositePlacement(u)]:getExpandedPlacements(u));f||"none"===y||P.push(...getOppositeAxisPlacements(u,b,y,T));let C=[u,...P],k=await detectOverflow(e,w),I=[],E=(null==(n=l.flip)?void 0:n.overflows)||[];if(h&&I.push(k[v]),g){let e=getAlignmentSides(a,c,T);I.push(k[e[0]],k[e[1]])}if(E=[...E,{placement:a,overflows:I}],!I.every(e=>e<=0)){let e=((null==(r=l.flip)?void 0:r.index)||0)+1,t=C[e];if(t)return{data:{index:e,overflows:E},reset:{placement:t}};let n=null==(i=E.filter(e=>e.overflows[0]<=0).sort((e,t)=>e.overflows[1]-t.overflows[1])[0])?void 0:i.placement;if(!n)switch(m){case"bestFit":{let e=null==(o=E.map(e=>[e.placement,e.overflows.filter(e=>e>0).reduce((e,t)=>e+t,0)]).sort((e,t)=>e[1]-t[1])[0])?void 0:o[0];e&&(n=e);break}case"initialPlacement":n=u}if(a!==n)return{reset:{placement:n}}}return{}}},{name:"size",options:P={...en,apply:({elements:e,rects:t,availableWidth:n,availableHeight:r})=>{let{width:i,height:o}=t.reference,a=e.floating.style;a.setProperty("--radix-popper-available-width",`${n}px`),a.setProperty("--radix-popper-available-height",`${r}px`),a.setProperty("--radix-popper-anchor-width",`${i}px`),a.setProperty("--radix-popper-anchor-height",`${o}px`)}},async fn(e){let t,n;let{placement:r,rects:i,platform:o,elements:c}=e,{apply:u=()=>{},...d}=evaluate(P,e),p=await detectOverflow(e,d),h=getSide(r),g=getAlignment(r),f="y"===getSideAxis(r),{width:m,height:y}=i.floating;"top"===h||"bottom"===h?(t=h,n=g===(await (null==o.isRTL?void 0:o.isRTL(c.floating))?"start":"end")?"left":"right"):(n=h,t="end"===g?"top":"bottom");let b=y-p[t],w=m-p[n],S=!e.middlewareData.shift,v=b,x=w;if(f){let e=m-p.left-p.right;x=g||S?a(w,e):e}else{let e=y-p.top-p.bottom;v=g||S?a(b,e):e}if(S&&!g){let e=l(p.left,0),t=l(p.right,0),n=l(p.top,0),r=l(p.bottom,0);f?x=m-2*(0!==e||0!==t?e+t:l(p.left,p.right)):v=y-2*(0!==n||0!==r?n+r:l(p.top,p.bottom))}await u({...e,availableWidth:x,availableHeight:v});let T=await o.getDimensions(c.floating);return m!==T.width||y!==T.height?{reset:{rects:!0}}:{}}},Z&&floating_ui_react_dom_arrow({element:Z,padding:D}),$cf1ac5d9fe0e8206$var$transformOrigin({arrowWidth:X,arrowHeight:J}),L&&{name:"hide",options:C={strategy:"referenceHidden",...en},async fn(e){let{rects:t}=e,{strategy:n="referenceHidden",...r}=evaluate(C,e);switch(n){case"referenceHidden":{let n=await detectOverflow(e,{...r,elementContext:"reference"}),i=getSideOffsets(n,t.reference);return{data:{referenceHiddenOffsets:i,referenceHidden:isAnySideFullyClipped(i)}}}case"escaped":{let n=await detectOverflow(e,{...r,altBoundary:!0}),i=getSideOffsets(n,t.floating);return{data:{escapedOffsets:i,escaped:isAnySideFullyClipped(i)}}}default:return{}}}}]}),[el,ec]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(eo),eu=(0,v.W)(z);(0,x.b)(()=>{ea&&(null==eu||eu())},[ea,eu]);let ed=null===(c=es.arrow)||void 0===c?void 0:c.x,ep=null===(u=es.arrow)||void 0===u?void 0:u.y,eh=(null===(d=es.arrow)||void 0===d?void 0:d.centerOffset)!==0,[eg,ef]=(0,i.useState)();return(0,x.b)(()=>{H&&ef(window.getComputedStyle(H).zIndex)},[H]),(0,i.createElement)("div",{ref:er.setFloating,"data-radix-popper-content-wrapper":"",style:{...ei,transform:ea?ei.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:eg,"--radix-popper-transform-origin":[null===(p=es.transformOrigin)||void 0===p?void 0:p.x,null===(h=es.transformOrigin)||void 0===h?void 0:h.y].join(" ")},dir:e.dir},(0,i.createElement)(j,{scope:k,placedSide:el,onArrowChange:K,arrowX:ed,arrowY:ep,shouldHideArrow:eh},(0,i.createElement)(y.WV.div,(0,r.Z)({"data-side":el,"data-align":ec},N,{ref:W,style:{...N.style,animation:ea?void 0:"none",opacity:null!==(g=es.hide)&&void 0!==g&&g.referenceHidden?0:void 0}}))))}),D={top:"bottom",right:"left",bottom:"top",left:"right"},O=(0,i.forwardRef)(function(e,t){let{__scopePopper:n,...o}=e,a=A("PopperArrow",n),l=D[a.placedSide];return(0,i.createElement)("span",{ref:a.onArrowChange,style:{position:"absolute",left:a.arrowX,top:a.arrowY,[l]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[a.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[a.placedSide],visibility:a.shouldHideArrow?"hidden":void 0}},(0,i.createElement)(b,(0,r.Z)({},o,{ref:t,style:{...o.style,display:"block"}})))});function $cf1ac5d9fe0e8206$var$isNotNull(e){return null!==e}let $cf1ac5d9fe0e8206$var$transformOrigin=e=>({name:"transformOrigin",options:e,fn(t){var n,r,i,o,a;let{placement:l,rects:c,middlewareData:u}=t,d=(null===(n=u.arrow)||void 0===n?void 0:n.centerOffset)!==0,p=d?0:e.arrowWidth,h=d?0:e.arrowHeight,[g,f]=$cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(l),m={start:"0%",center:"50%",end:"100%"}[f],y=(null!==(r=null===(i=u.arrow)||void 0===i?void 0:i.x)&&void 0!==r?r:0)+p/2,b=(null!==(o=null===(a=u.arrow)||void 0===a?void 0:a.y)&&void 0!==o?o:0)+h/2,w="",S="";return"bottom"===g?(w=d?m:`${y}px`,S=`${-h}px`):"top"===g?(w=d?m:`${y}px`,S=`${c.floating.height+h}px`):"right"===g?(w=`${-h}px`,S=d?m:`${b}px`):"left"===g&&(w=`${c.floating.width+h}px`,S=d?m:`${b}px`),{data:{x:w,y:S}}}});function $cf1ac5d9fe0e8206$var$getSideAndAlignFromPlacement(e){let[t,n="center"]=e.split("-");return[t,n]}let $cf1ac5d9fe0e8206$export$be92b6f5f03c0fe9=e=>{let{__scopePopper:t,children:n}=e,[r,o]=(0,i.useState)(null);return(0,i.createElement)(I,{scope:t,anchor:r,onAnchorChange:o},n)},B=_,F=$,U=O},2730:function(e,t,n){"use strict";n.d(t,{h:function(){return l}});var r=n(3428),i=n(2265),o=n(4887),a=n(9790);let l=(0,i.forwardRef)((e,t)=>{var n;let{container:l=null==globalThis?void 0:null===(n=globalThis.document)||void 0===n?void 0:n.body,...c}=e;return l?o.createPortal((0,i.createElement)(a.WV.div,(0,r.Z)({},c,{ref:t})),l):null})},5606:function(e,t,n){"use strict";n.d(t,{z:function(){return $921a889cee6df7e8$export$99c2b779aa4e8b8b}});var r=n(2265),i=n(4887),o=n(2210),a=n(1030);function $fe963b355347cc68$export$3e6543de14f8614f(e,t){return(0,r.useReducer)((e,n)=>{let r=t[e][n];return null!=r?r:e},e)}let $921a889cee6df7e8$export$99c2b779aa4e8b8b=e=>{let{present:t,children:n}=e,i=$921a889cee6df7e8$var$usePresence(t),a="function"==typeof n?n({present:i.isPresent}):r.Children.only(n),l=(0,o.e)(i.ref,a.ref),c="function"==typeof n;return c||i.isPresent?(0,r.cloneElement)(a,{ref:l}):null};function $921a889cee6df7e8$var$usePresence(e){let[t,n]=(0,r.useState)(),o=(0,r.useRef)({}),l=(0,r.useRef)(e),c=(0,r.useRef)("none"),u=e?"mounted":"unmounted",[d,p]=$fe963b355347cc68$export$3e6543de14f8614f(u,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return(0,r.useEffect)(()=>{let e=$921a889cee6df7e8$var$getAnimationName(o.current);c.current="mounted"===d?e:"none"},[d]),(0,a.b)(()=>{let t=o.current,n=l.current,r=n!==e;if(r){let r=c.current,i=$921a889cee6df7e8$var$getAnimationName(t);e?p("MOUNT"):"none"===i||(null==t?void 0:t.display)==="none"?p("UNMOUNT"):n&&r!==i?p("ANIMATION_OUT"):p("UNMOUNT"),l.current=e}},[e,p]),(0,a.b)(()=>{if(t){let handleAnimationEnd=e=>{let n=$921a889cee6df7e8$var$getAnimationName(o.current),r=n.includes(e.animationName);e.target===t&&r&&(0,i.flushSync)(()=>p("ANIMATION_END"))},handleAnimationStart=e=>{e.target===t&&(c.current=$921a889cee6df7e8$var$getAnimationName(o.current))};return t.addEventListener("animationstart",handleAnimationStart),t.addEventListener("animationcancel",handleAnimationEnd),t.addEventListener("animationend",handleAnimationEnd),()=>{t.removeEventListener("animationstart",handleAnimationStart),t.removeEventListener("animationcancel",handleAnimationEnd),t.removeEventListener("animationend",handleAnimationEnd)}}p("ANIMATION_END")},[t,p]),{isPresent:["mounted","unmountSuspended"].includes(d),ref:(0,r.useCallback)(e=>{e&&(o.current=getComputedStyle(e)),n(e)},[])}}function $921a889cee6df7e8$var$getAnimationName(e){return(null==e?void 0:e.animationName)||"none"}$921a889cee6df7e8$export$99c2b779aa4e8b8b.displayName="Presence"},9790:function(e,t,n){"use strict";n.d(t,{WV:function(){return l},jH:function(){return $8927f6f2acc4f386$export$6d1a0317bde7de7f}});var r=n(3428),i=n(2265),o=n(4887),a=n(7256);let l=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","span","svg","ul"].reduce((e,t)=>{let n=(0,i.forwardRef)((e,n)=>{let{asChild:o,...l}=e,c=o?a.g7:t;return(0,i.useEffect)(()=>{window[Symbol.for("radix-ui")]=!0},[]),(0,i.createElement)(c,(0,r.Z)({},l,{ref:n}))});return n.displayName=`Primitive.${t}`,{...e,[t]:n}},{});function $8927f6f2acc4f386$export$6d1a0317bde7de7f(e,t){e&&(0,o.flushSync)(()=>e.dispatchEvent(t))}},7256:function(e,t,n){"use strict";n.d(t,{g7:function(){return a}});var r=n(3428),i=n(2265),o=n(2210);let a=(0,i.forwardRef)((e,t)=>{let{children:n,...o}=e,a=i.Children.toArray(n),c=a.find($5e63c961fc1ce211$var$isSlottable);if(c){let e=c.props.children,n=a.map(t=>t!==c?t:i.Children.count(e)>1?i.Children.only(null):(0,i.isValidElement)(e)?e.props.children:null);return(0,i.createElement)(l,(0,r.Z)({},o,{ref:t}),(0,i.isValidElement)(e)?(0,i.cloneElement)(e,void 0,n):null)}return(0,i.createElement)(l,(0,r.Z)({},o,{ref:t}),n)});a.displayName="Slot";let l=(0,i.forwardRef)((e,t)=>{let{children:n,...r}=e;return(0,i.isValidElement)(n)?(0,i.cloneElement)(n,{...$5e63c961fc1ce211$var$mergeProps(r,n.props),ref:t?(0,o.F)(t,n.ref):n.ref}):i.Children.count(n)>1?i.Children.only(null):null});l.displayName="SlotClone";let $5e63c961fc1ce211$export$d9f1ccf0bdb05d45=({children:e})=>(0,i.createElement)(i.Fragment,null,e);function $5e63c961fc1ce211$var$isSlottable(e){return(0,i.isValidElement)(e)&&e.type===$5e63c961fc1ce211$export$d9f1ccf0bdb05d45}function $5e63c961fc1ce211$var$mergeProps(e,t){let n={...t};for(let r in t){let i=e[r],o=t[r],a=/^on[A-Z]/.test(r);a?i&&o?n[r]=(...e)=>{o(...e),i(...e)}:i&&(n[r]=i):"style"===r?n[r]={...i,...o}:"className"===r&&(n[r]=[i,o].filter(Boolean).join(" "))}return{...e,...n}}},6459:function(e,t,n){"use strict";n.d(t,{W:function(){return $b1b2314f5f9a1d84$export$25bec8c6f54ee79a}});var r=n(2265);function $b1b2314f5f9a1d84$export$25bec8c6f54ee79a(e){let t=(0,r.useRef)(e);return(0,r.useEffect)(()=>{t.current=e}),(0,r.useMemo)(()=>(...e)=>{var n;return null===(n=t.current)||void 0===n?void 0:n.call(t,...e)},[])}},3763:function(e,t,n){"use strict";n.d(t,{T:function(){return $71cd76cc60e0454e$export$6f32135080cb4c3}});var r=n(2265),i=n(6459);function $71cd76cc60e0454e$export$6f32135080cb4c3({prop:e,defaultProp:t,onChange:n=()=>{}}){let[o,a]=$71cd76cc60e0454e$var$useUncontrolledState({defaultProp:t,onChange:n}),l=void 0!==e,c=l?e:o,u=(0,i.W)(n),d=(0,r.useCallback)(t=>{if(l){let n="function"==typeof t?t(e):t;n!==e&&u(n)}else a(t)},[l,e,a,u]);return[c,d]}function $71cd76cc60e0454e$var$useUncontrolledState({defaultProp:e,onChange:t}){let n=(0,r.useState)(e),[o]=n,a=(0,r.useRef)(o),l=(0,i.W)(t);return(0,r.useEffect)(()=>{a.current!==o&&(l(o),a.current=o)},[o,a,l]),n}},1030:function(e,t,n){"use strict";n.d(t,{b:function(){return i}});var r=n(2265);let i=(null==globalThis?void 0:globalThis.document)?r.useLayoutEffect:()=>{}},4977:function(e,t,n){"use strict";n.d(t,{t:function(){return $db6c3485150b8e66$export$1ab7ae714698c4b8}});var r=n(2265),i=n(1030);function $db6c3485150b8e66$export$1ab7ae714698c4b8(e){let[t,n]=(0,r.useState)(void 0);return(0,i.b)(()=>{if(e){n({width:e.offsetWidth,height:e.offsetHeight});let t=new ResizeObserver(t=>{let r,i;if(!Array.isArray(t)||!t.length)return;let o=t[0];if("borderBoxSize"in o){let e=o.borderBoxSize,t=Array.isArray(e)?e[0]:e;r=t.inlineSize,i=t.blockSize}else r=e.offsetWidth,i=e.offsetHeight;n({width:r,height:i})});return t.observe(e,{box:"border-box"}),()=>t.unobserve(e)}n(void 0)},[e]),t}},7295:function(e,t,n){"use strict";n.d(t,{g:function(){return SVGContainer}});var r=n(7437);function SVGContainer({children:e,className:t="",...n}){return(0,r.jsx)("svg",{...n,className:`tl-svg-container ${t}`,children:e})}},5894:function(e,t,n){"use strict";n.d(t,{A6:function(){return h},JM:function(){return getUserPreferences},MO:function(){return getFreshUserPreferences},ks:function(){return g},ng:function(){return userPrefersDarkUI},yu:function(){return setUserPreferences}});var r=n(9502),i=n(932),o=n(6934),a=n(5958),l=n(1034);n(2601);let c="TLDRAW_USER_DATA_v3",u=a.T.object({id:a.T.string,name:a.T.string.nullable().optional(),locale:a.T.string.nullable().optional(),color:a.T.string.nullable().optional(),isDarkMode:a.T.boolean.nullable().optional(),animationSpeed:a.T.number.nullable().optional(),edgeScrollSpeed:a.T.number.nullable().optional(),isSnapMode:a.T.boolean.nullable().optional(),isWrapMode:a.T.boolean.nullable().optional()}),d={AddAnimationSpeed:1,AddIsSnapMode:2,MakeFieldsNullable:3,AddEdgeScrollSpeed:4,AddExcalidrawSelectMode:5},p=(0,i.zn)({currentVersion:d.AddExcalidrawSelectMode,migrators:{[d.AddAnimationSpeed]:{up:e=>({...e,animationSpeed:1}),down:({animationSpeed:e,...t})=>t},[d.AddIsSnapMode]:{up:e=>({...e,isSnapMode:!1}),down:({isSnapMode:e,...t})=>t},[d.MakeFieldsNullable]:{up:e=>e,down:e=>({id:e.id,name:e.name??g.name,locale:e.locale??g.locale,color:e.color??g.color,animationSpeed:e.animationSpeed??g.animationSpeed,isDarkMode:e.isDarkMode??g.isDarkMode,isSnapMode:e.isSnapMode??g.isSnapMode,isWrapMode:e.isWrapMode??g.isWrapMode})},[d.AddEdgeScrollSpeed]:{up:e=>({...e,edgeScrollSpeed:1}),down:({edgeScrollSpeed:e,...t})=>t},[d.AddExcalidrawSelectMode]:{up:e=>({...e,isWrapMode:!1}),down:({isWrapMode:e,...t})=>t}}}),h=["#FF802B","#EC5E41","#F2555A","#F04F88","#E34BA9","#BD54C6","#9D5BD2","#7B66DC","#02B1CC","#11B3A3","#39B178","#55B467"];function getRandomColor(){return h[Math.floor(Math.random()*h.length)]}function userPrefersDarkUI(){return"undefined"!=typeof window&&(window.matchMedia?.("(prefers-color-scheme: dark)")?.matches??!1)}function userPrefersReducedMotion(){return"undefined"!=typeof window&&(window.matchMedia?.("(prefers-reduced-motion: reduce)")?.matches??!1)}let g=Object.freeze({name:"New User",locale:(0,o.Bz)(),color:getRandomColor(),isDarkMode:!1,edgeScrollSpeed:1,animationSpeed:userPrefersReducedMotion()?0:1,isSnapMode:!1,isWrapMode:!1});function getFreshUserPreferences(){return{id:(0,l.E)()}}function migrateUserPreferences(e){if(null===e||"object"!=typeof e||!("version"in e)||!("user"in e)||"number"!=typeof e.version)return getFreshUserPreferences();let t=(0,i.Te)({value:e.user,fromVersion:e.version,toVersion:p.currentVersion??0,migrations:p});if("error"===t.type)return getFreshUserPreferences();try{u.validate(t.value)}catch(e){return getFreshUserPreferences()}return t.value}function loadUserPreferences(){let e="undefined"==typeof window?null:JSON.parse(window?.localStorage?.getItem(c)||"null")??null;return migrateUserPreferences(e)}let f=(0,r.cn)("globalUserData",null);function storeUserPreferences(){"undefined"!=typeof window&&window.localStorage&&window.localStorage.setItem(c,JSON.stringify({version:p.currentVersion,user:f.get()}))}function setUserPreferences(e){u.validate(e),f.set(e),storeUserPreferences(),broadcastUserPreferencesChange()}let m="undefined"==typeof BroadcastChannel?null:new BroadcastChannel("tldraw-user-sync");m?.addEventListener("message",e=>{let t=e.data;t?.type===b&&t?.origin!==getBroadcastOrigin()&&f.set(migrateUserPreferences(t.data))});let y=null;function getBroadcastOrigin(){return null===y&&(y=(0,l.E)()),y}let b="tldraw-user-preferences-change";function broadcastUserPreferencesChange(){m?.postMessage({type:b,origin:getBroadcastOrigin(),data:{user:getUserPreferences(),version:p.currentVersion}})}function getUserPreferences(){let e=f.get();return e||(e=loadUserPreferences(),f.set(e)),e}},7217:function(e,t,n){"use strict";n.d(t,{L:function(){return createTLUser}});var r=n(9502),i=n(5894);function createTLUser(e={}){return{derivePresenceState:e.derivePresenceState??(()=>(0,r.Fl)("presence",()=>null)),userPreferences:e.userPreferences??(0,r.Fl)("userPreferences",()=>(0,i.JM)()),setUserPreferences:e.setUserPreferences??i.yu}}},9968:function(e,t,n){"use strict";n.d(t,{m:function(){return checkShapesAndAddCore},u:function(){return i}});var r=n(2772);let i=[r.Q],o=new Set(i.map(e=>e.type));function checkShapesAndAddCore(e){let t=[...i],n=new Set;for(let r of e){if(o.has(r.type))throw Error(`Shape type "${r.type}" is a core shapes type and cannot be overridden`);if(n.has(r.type))throw Error(`Shape type "${r.type}" is defined more than once`);t.push(r),n.add(r.type)}return t}},7655:function(e,t,n){"use strict";n.d(t,{$G:function(){return P},CK:function(){return _},CN:function(){return p},E:function(){return c},EB:function(){return O},Et:function(){return o},KD:function(){return l},MN:function(){return E},Ns:function(){return f},O8:function(){return I},Pr:function(){return B},Pz:function(){return b},Qd:function(){return g},RH:function(){return m},RZ:function(){return k},Sk:function(){return S},UD:function(){return w},Xy:function(){return T},Zj:function(){return u},a:function(){return $},aR:function(){return j},dW:function(){return C},iF:function(){return x},kx:function(){return i},qV:function(){return y},rF:function(){return D},rQ:function(){return F},sZ:function(){return d},s_:function(){return v},uJ:function(){return a},wM:function(){return A},wi:function(){return h},yV:function(){return M}});var r=n(1986);let i=2e3,o=40,a=80,l=320,c=[.1,.25,.5,1,2,4,8],u=.1,d=8,p=.5,h=.1,g=.2,f=.005,m=.05,y=450,b=200,w=6,S=4,v=32,x={};for(let e=1;e<=Math.ceil(d);e++)x[e+"_dark"]=`hash_pattern_zoom_${e}_dark`,x[e+"_light"]=`hash_pattern_zoom_${e}_light`;let T={duration:0,easing:r.L.easeInOutCubic},P=.09,C=[{min:-1,mid:.15,step:64},{min:.05,mid:.375,step:16},{min:.15,mid:1,step:4},{min:.7,mid:2.5,step:1}],k=6e4,I=3e3,E=1200,_={CAMERA_MOVE:-10},M=64,j=620,A=8,$=20,D=8,O=12,B=20,F=12},6912:function(e,t,n){"use strict";n.d(t,{w:function(){return arrowBindingsIndex}});var r=n(9502);let arrowBindingsIndex=e=>{let{store:t}=e,n=t.query.filterHistory("shape"),i=t.query.records("shape",()=>({type:{eq:"arrow"}}));function fromScratch(){let e=i.get(),t={};for(let n of e){let{start:e,end:r}=n.props;if("binding"===e.type){let r=t[e.boundShapeId];r?r.push({arrowId:n.id,handleId:"start"}):t[e.boundShapeId]=[{arrowId:n.id,handleId:"start"}]}if("binding"===r.type){let e=t[r.boundShapeId];e?e.push({arrowId:n.id,handleId:"end"}):t[r.boundShapeId]=[{arrowId:n.id,handleId:"end"}]}}return t}return(0,r.Fl)("arrowBindingsIndex",(t,i)=>{let o;if((0,r.e1)(t))return fromScratch();let a=n.getDiffSince(i);if(a===r.SB)return fromScratch();function ensureNewArray(e){o||(o={...t}),o[e]?o[e]===t[e]&&(o[e]=[...o[e]]):o[e]=[]}function removingBinding(e,t,n){ensureNewArray(e),o[e]=o[e].filter(e=>e.arrowId!==t||e.handleId!==n),0===o[e].length&&delete o[e]}function addBinding(e,t,n){ensureNewArray(e),o[e].push({arrowId:t,handleId:n})}for(let t of a){for(let n of Object.values(t.added))if(e.isShapeOfType(n,"arrow")){let{start:e,end:t}=n.props;"binding"===e.type&&addBinding(e.boundShapeId,n.id,"start"),"binding"===t.type&&addBinding(t.boundShapeId,n.id,"end")}for(let[n,r]of Object.values(t.updated))if(e.isShapeOfType(n,"arrow")&&e.isShapeOfType(r,"arrow"))for(let e of["start","end"]){let t=n.props[e],i=r.props[e];"binding"===t.type&&"point"===i.type?removingBinding(t.boundShapeId,n.id,e):"point"===t.type&&"binding"===i.type?addBinding(i.boundShapeId,r.id,e):"binding"===t.type&&"binding"===i.type&&t.boundShapeId!==i.boundShapeId&&(removingBinding(t.boundShapeId,n.id,e),addBinding(i.boundShapeId,r.id,e))}for(let n of Object.values(t.removed))if(e.isShapeOfType(n,"arrow")){let{start:e,end:t}=n.props;"binding"===e.type&&removingBinding(e.boundShapeId,n.id,"start"),"binding"===t.type&&removingBinding(t.boundShapeId,n.id,"end")}}return o??t})}},9078:function(e,t,n){"use strict";n.d(t,{s:function(){return parentsToChildren}});var r=n(9502),i=n(6934),o=n(3112);let parentsToChildren=e=>{let t=e.query.ids("shape");function fromScratch(){let n={},r=t.get(),i=Array(r.size);return r.forEach(t=>i.push(e.get(t))),i.sort(o.hl),i.forEach(e=>{n[e.parentId]||(n[e.parentId]=[]),n[e.parentId].push(e.id)}),n}return(0,r.Fl)("parentsToChildrenWithIndexes",(t,n)=>{let a;if((0,r.e1)(t))return fromScratch();let l=e.history.getDiffSince(n);if(l===r.SB)return fromScratch();if(0===l.length)return t;let c=null,ensureNewArray=e=>{c||(c={...t}),c[e]?c[e]===t[e]&&(c[e]=[...c[e]]):c[e]=[]},u=new Set;for(let e=0,t=l.length;e<t;e++){for(let t of Object.values((a=l[e]).added))(0,i.VV)(t)&&(ensureNewArray(t.parentId),c[t.parentId].push(t.id),u.add(c[t.parentId]));for(let[e,t]of Object.values(a.updated))if((0,i.VV)(t)&&(0,i.VV)(e)){if(e.parentId!==t.parentId)ensureNewArray(e.parentId),ensureNewArray(t.parentId),c[e.parentId].splice(c[e.parentId].indexOf(t.id),1),c[t.parentId].push(t.id),u.add(c[t.parentId]);else if(e.index!==t.index){ensureNewArray(t.parentId);let e=c[t.parentId].indexOf(t.id);c[t.parentId][e]=t.id,u.add(c[t.parentId])}}for(let e of Object.values(a.removed))(0,i.VV)(e)&&(ensureNewArray(e.parentId),c[e.parentId].splice(c[e.parentId].indexOf(e.id),1))}for(let t of u){let n=(0,o.oA)(t.map(t=>e.get(t)));n.sort(o.hl),t.splice(0,t.length,...n.map(e=>e.id))}return c??t})}},4211:function(e,t,n){"use strict";n.d(t,{Q:function(){return deriveShapeIdsInCurrentPage}});var r=n(9502),i=n(932),o=n(6934);let isShapeInPage=(e,t,n)=>{for(;!(0,o.r5)(n.parentId);){let t=e.get(n.parentId);if(!t)return!1;n=t}return n.parentId===t},deriveShapeIdsInCurrentPage=(e,t)=>{let n=e.query.ids("shape"),a=null;function fromScratch(){let r=t();return a=r,new Set([...n.get()].filter(t=>isShapeInPage(e,r,e.get(t))))}return(0,r.Fl)("_shapeIdsInCurrentPage",(n,l)=>{if((0,r.e1)(n))return fromScratch();let c=t();if(c!==a)return fromScratch();let u=e.history.getDiffSince(l);if(u===r.SB)return fromScratch();let d=new i.mW(n);for(let t of u){for(let n of Object.values(t.added))(0,o.VV)(n)&&isShapeInPage(e,c,n)&&d.add(n.id);for(let[n,r]of Object.values(t.updated))(0,o.VV)(r)&&(isShapeInPage(e,c,r)?d.add(r.id):d.remove(r.id));for(let e of Object.keys(t.removed))(0,o.YT)(e)&&d.remove(e)}let p=d.get();return p?(0,r.qo)(p.value,p.diff):n})}},829:function(e,t,n){"use strict";n.d(t,{o:function(){return ClickManager}});var r=n(7655),i=n(4204),o=n(1034);let ClickManager=class ClickManager{constructor(e){this.editor=e}_clickId="";_clickTimeout;_clickScreenPoint;_previousScreenPoint;_getClickTimeout=(e,t=(0,o.E)())=>{this._clickId=t,clearTimeout(this._clickTimeout),this._clickTimeout=setTimeout(()=>{if(this._clickState===e&&this._clickId===t){switch(this._clickState){case"pendingTriple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"double_click",phase:"settle"});break;case"pendingQuadruple":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"triple_click",phase:"settle"});break;case"pendingOverflow":this.editor.dispatch({...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"settle"})}this._clickState="idle"}},"idle"===e||"pendingDouble"===e?r.qV:r.Pz)};_clickState="idle";get clickState(){return this._clickState}lastPointerInfo={};transformPointerDownEvent=e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=i.B.From(e.point),this._previousScreenPoint&&this._previousScreenPoint.dist(this._clickScreenPoint)>40&&(this._clickState="idle"),this._previousScreenPoint=this._clickScreenPoint,this.lastPointerInfo=e,this._clickState){case"idle":return this._clickState="pendingDouble",this._clickTimeout=this._getClickTimeout(this._clickState),e;case"pendingDouble":return this._clickState="pendingTriple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"double_click",phase:"down"};case"pendingTriple":return this._clickState="pendingQuadruple",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"triple_click",phase:"down"};case"pendingQuadruple":return this._clickState="pendingOverflow",this._clickTimeout=this._getClickTimeout(this._clickState),{...e,type:"click",name:"quadruple_click",phase:"down"};case"pendingOverflow":return this._clickState="overflow",this._clickTimeout=this._getClickTimeout(this._clickState),e;default:return this._clickTimeout=this._getClickTimeout(this._clickState),e}};transformPointerUpEvent=e=>{if(!this._clickState)return e;switch(this._clickScreenPoint=i.B.From(e.point),this._clickState){case"pendingTriple":return{...this.lastPointerInfo,type:"click",name:"double_click",phase:"up"};case"pendingQuadruple":return{...this.lastPointerInfo,type:"click",name:"triple_click",phase:"up"};case"pendingOverflow":return{...this.lastPointerInfo,type:"click",name:"quadruple_click",phase:"up"};default:return e}};cancelDoubleClickTimeout=()=>{this._clickTimeout=clearTimeout(this._clickTimeout),this._clickState="idle"};handleMove=()=>{"idle"!==this._clickState&&this._clickScreenPoint&&this._clickScreenPoint.dist(this.editor.inputs.currentScreenPoint)>(this.editor.getInstanceState().isCoarsePointer?r.UD:r.Sk)&&this.cancelDoubleClickTimeout()}}},106:function(e,t,n){"use strict";n.d(t,{l:function(){return EnvironmentManager}});let EnvironmentManager=class EnvironmentManager{constructor(e){this.editor=e,"undefined"!=typeof window&&"navigator"in window?(this.isSafari=/^((?!chrome|android).)*safari/i.test(navigator.userAgent),this.isIos=!!navigator.userAgent.match(/iPad/i)||!!navigator.userAgent.match(/iPhone/i),this.isChromeForIos=/crios.*safari/i.test(navigator.userAgent),this.isFirefox=/firefox/i.test(navigator.userAgent),this.isAndroid=/android/i.test(navigator.userAgent)):(this.isSafari=!1,this.isIos=!1,this.isChromeForIos=!1,this.isFirefox=!1,this.isAndroid=!1)}isSafari;isIos;isChromeForIos;isFirefox;isAndroid}},7055:function(e,t,n){"use strict";n.d(t,{E:function(){return HistoryManager}});var r=n(9502),i=n(932),o=n(1034);function stack(e){if(e){let t=a;for(;e.length;)t=t.push(e.pop());return t}return a}let EmptyStackItem=class EmptyStackItem{length=0;head=null;tail=this;push(e){return new StackItem(e,this)}toArray(){return r.LZ}[Symbol.iterator](){return{next:()=>({value:void 0,done:!0})}}};let a=new EmptyStackItem;let StackItem=class StackItem{constructor(e,t){this.head=e,this.tail=t,this.length=t.length+1}length;push(e){return new StackItem(e,this)}toArray(){return Array.from(this)}[Symbol.iterator](){let e=this;return{next(){if(!e.length)return{value:void 0,done:!0};{let t=e.head;return e=e.tail,{value:t,done:!1}}}}}};let HistoryManager=class HistoryManager{constructor(e,t){this.ctx=e,this.annotateError=t}_undos=(0,r.cn)("HistoryManager.undos",stack());_redos=(0,r.cn)("HistoryManager.redos",stack());_batchDepth=0;onBatchComplete=()=>void 0;_commands={};getNumUndos(){return this._undos.get().length}getNumRedos(){return this._redos.get().length}createCommand=(e,t,n)=>{if(this._commands[e])throw Error(`Duplicate command: ${e}`);this._commands[e]=n;let exec=(...r)=>{if(!this._batchDepth)return this.batch(()=>exec(...r)),this.ctx;let a=t(...r);if(!a)return this.ctx;let{data:l,ephemeral:c,squashing:u,preservesRedoStack:d}=a;if(this.ignoringUpdates((e,t)=>(n.do(l),{undos:e,redos:t})),!c){let t=this._undos.get().head;u&&t&&"command"===t.type&&t.name===e&&t.preservesRedoStack===d?this._undos.update(e=>e.tail.push({...t,id:(0,o.E)(),data:(0,i.ZV)(n.squash(t.data,l))})):this._undos.update(t=>t.push({type:"command",name:e,data:(0,i.ZV)(l),id:(0,o.E)(),preservesRedoStack:d})),a.preservesRedoStack||this._redos.set(stack()),this.ctx.emit("change-history",{reason:"push"})}return this.ctx};return exec};batch=e=>{try{this._batchDepth++,1===this._batchDepth?(0,r.ay)(()=>{let t=this._undos.get().head?.id;e(),t!==this._undos.get().head?.id&&this.onBatchComplete()}):e()}catch(e){throw this.annotateError(e),e}finally{this._batchDepth--}return this};ignoringUpdates=e=>{let t=this._undos.get(),n=this._redos.get();this._undos.set(stack()),this._redos.set(stack());try{({undos:t,redos:n}=(0,r.ay)(()=>e(t,n)))}finally{this._undos.set(t),this._redos.set(n)}};_undo=({pushToRedoStack:e,toMark:t})=>(this.ignoringUpdates((n,r)=>{if(0===n.length)return{undos:n,redos:r};for(;n.head?.type==="STOP";){let i=n.head;if(n=n.tail,e&&(r=r.push(i)),i.id===t)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:n,redos:r}}if(0===n.length)return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:n,redos:r};for(;n.head;){let i=n.head;if(n=n.tail,e&&(r=r.push(i)),"STOP"===i.type){if(i.onUndo&&(!t||i.id===t))break}else{let e=this._commands[i.name];e.undo(i.data)}}return this.ctx.emit("change-history",e?{reason:"undo"}:{reason:"bail",markId:t}),{undos:n,redos:r}}),this);undo=()=>(this._undo({pushToRedoStack:!0}),this);redo=()=>(this.ignoringUpdates((e,t)=>{if(0===t.length)return{undos:e,redos:t};for(;t.head?.type==="STOP";)e=e.push(t.head),t=t.tail;if(0===t.length)return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t};for(;t.head;){let n=t.head;if(e=e.push(t.head),t=t.tail,"STOP"===n.type){if(n.onRedo)break}else{let e=this._commands[n.name];e.redo?e.redo(n.data):e.do(n.data)}}return this.ctx.emit("change-history",{reason:"redo"}),{undos:e,redos:t}}),this);bail=()=>(this._undo({pushToRedoStack:!1}),this);bailToMark=e=>(this._undo({pushToRedoStack:!1,toMark:e}),this);mark=(e=(0,o.E)(),t=!0,n=!0)=>{let r=this._undos.get().head;return r&&"STOP"===r.type&&r.id===e&&r.onUndo===t&&r.onRedo===n?r.id:(this._undos.update(r=>r.push({type:"STOP",id:e,onUndo:t,onRedo:n})),this.ctx.emit("mark-history",{id:e}),e)};clear(){this._undos.set(stack()),this._redos.set(stack())}}},7252:function(e,t,n){"use strict";n.d(t,{o:function(){return ScribbleManager}});var r=n(4204),i=n(1034);let ScribbleManager=class ScribbleManager{constructor(e){this.editor=e}scribbleItems=new Map;state="paused";addScribble=(e,t=(0,i.E)())=>{let n={id:t,scribble:{id:t,size:20,color:"accent",opacity:.8,delay:0,points:[],shrink:.1,taper:!0,...e,state:"starting"},timeoutMs:0,delayRemaining:e.delay??0,prev:null,next:null};return this.scribbleItems.set(t,n),"paused"===this.state&&this.resume(),n};resume(){this.state="running",this.editor.addListener("tick",this.tick)}pause(){this.editor.removeListener("tick",this.tick),this.state="paused"}reset(){this.editor.updateInstanceState({scribbles:[]}),this.scribbleItems.clear(),this.pause()}stop=e=>{let t=this.scribbleItems.get(e);if(!t)throw Error(`Scribble with id ${e} not found`);return t.delayRemaining=Math.min(t.delayRemaining,200),t.scribble.state="stopping",t};addPoint=(e,t,n)=>{let i=this.scribbleItems.get(e);if(!i)throw Error(`Scribble with id ${e} not found`);let{prev:o}=i,a={x:t,y:n,z:.5};return(!o||r.B.Dist(o,a)>=1)&&(i.next=a),i};tick=e=>{this.editor.batch(()=>{this.scribbleItems.forEach(t=>{if("starting"===t.scribble.state){let{next:e,prev:n}=t;e&&e!==n&&(t.prev=e,t.scribble.points.push(e)),t.scribble.points.length>8&&(t.scribble.state="active");return}t.delayRemaining>0&&(t.delayRemaining=Math.max(0,t.delayRemaining-e)),t.timeoutMs+=e,t.timeoutMs>=16&&(t.timeoutMs=0);let{delayRemaining:n,timeoutMs:r,prev:i,next:o,scribble:a}=t;switch(a.state){case"active":o&&o!==i?(t.prev=o,a.points.push(o),0===n&&a.points.length>8&&a.points.shift()):0===r&&(a.points.length>1?a.points.shift():t.delayRemaining=a.delay);break;case"stopping":if(0===t.delayRemaining&&0===r){if(1===a.points.length){this.scribbleItems.delete(t.id);return}a.shrink&&(a.size=Math.max(1,a.size*(1-a.shrink))),a.points.shift()}}}),this.editor.updateInstanceState({scribbles:Array.from(this.scribbleItems.values()).map(({scribble:e})=>({...e,points:[...e.points]})).slice(-5)}),0===this.scribbleItems.size&&this.pause()})}}},5084:function(e,t,n){"use strict";n.d(t,{Y:function(){return SideEffectManager}});let SideEffectManager=class SideEffectManager{constructor(e){this.editor=e,e.store.onBeforeCreate=(e,t)=>{let n=this._beforeCreateHandlers[e.typeName];if(n){let r=e;for(let e of n)r=e(r,t);return r}return e},e.store.onAfterCreate=(e,t)=>{let n=this._afterCreateHandlers[e.typeName];if(n)for(let r of n)r(e,t)},e.store.onBeforeChange=(e,t,n)=>{let r=this._beforeChangeHandlers[t.typeName];if(r){let i=t;for(let t of r)i=t(e,i,n);return i}return t};let t=0;e.store.onAfterChange=(e,n,r)=>{if(++t>1e3)console.error("[CleanupManager.onAfterChange] Maximum update depth exceeded, bailing out.");else{let t=this._afterChangeHandlers[n.typeName];if(t)for(let i of t)i(e,n,r)}t--},e.store.onBeforeDelete=(e,t)=>{let n=this._beforeDeleteHandlers[e.typeName];if(n){for(let r of n)if(!1===r(e,t))return!1}},e.store.onAfterDelete=(e,t)=>{let n=this._afterDeleteHandlers[e.typeName];if(n)for(let r of n)r(e,t)},e.history.onBatchComplete=()=>{this._batchCompleteHandlers.forEach(e=>e())}}_beforeCreateHandlers={};_afterCreateHandlers={};_beforeChangeHandlers={};_afterChangeHandlers={};_beforeDeleteHandlers={};_afterDeleteHandlers={};_batchCompleteHandlers=[];registerBeforeCreateHandler(e,t){let n=this._beforeCreateHandlers[e];return n||(this._beforeCreateHandlers[e]=[]),this._beforeCreateHandlers[e].push(t),()=>remove(this._beforeCreateHandlers[e],t)}registerAfterCreateHandler(e,t){let n=this._afterCreateHandlers[e];return n||(this._afterCreateHandlers[e]=[]),this._afterCreateHandlers[e].push(t),()=>remove(this._afterCreateHandlers[e],t)}registerBeforeChangeHandler(e,t){let n=this._beforeChangeHandlers[e];return n||(this._beforeChangeHandlers[e]=[]),this._beforeChangeHandlers[e].push(t),()=>remove(this._beforeChangeHandlers[e],t)}registerAfterChangeHandler(e,t){let n=this._afterChangeHandlers[e];return n||(this._afterChangeHandlers[e]=[]),this._afterChangeHandlers[e].push(t),()=>remove(this._afterChangeHandlers[e],t)}registerBeforeDeleteHandler(e,t){let n=this._beforeDeleteHandlers[e];return n||(this._beforeDeleteHandlers[e]=[]),this._beforeDeleteHandlers[e].push(t),()=>remove(this._beforeDeleteHandlers[e],t)}registerAfterDeleteHandler(e,t){let n=this._afterDeleteHandlers[e];return n||(this._afterDeleteHandlers[e]=[]),this._afterDeleteHandlers[e].push(t),()=>remove(this._afterDeleteHandlers[e],t)}registerBatchCompleteHandler(e){return this._batchCompleteHandlers.push(e),()=>remove(this._batchCompleteHandlers,e)}};function remove(e,t){let n=e.indexOf(t);n>=0&&e.splice(n,1)}},6076:function(e,t,n){"use strict";n.d(t,{f:function(){return SnapManager}});var r=n(9502),i=n(6934),o=n(3112),a=n(696),l=n(5404),c=n(4204),u=n(6166),d=n(1034),p=Object.defineProperty,h=Object.getOwnPropertyDescriptor,__decorateClass=(e,t,n,r)=>{for(var i,o=r>1?void 0:r?h(t,n):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&p(t,n,o),o};let round=e=>Math.round(1e8*e)/1e8;function findAdjacentGaps(e,t,n,r,i){let o=e.filter(e=>("forward"===r?e.startNode.id===t:e.endNode.id===t)&&round(e.length)===round(n)&&(0,u.mW)(e.breadthIntersection[0],e.breadthIntersection[1],i[0],i[1]));if(0===o.length)return[];let a=new Set;return o.forEach(t=>{let l="forward"===r?t.endNode.id:t.startNode.id;if(!a.has(l)){a.add(l);let c=findAdjacentGaps(e,l,n,r,(0,u.mW)(t.breadthIntersection[0],t.breadthIntersection[1],i[0],i[1]));o.push(...c)}}),o}function dedupeGapSnaps(e){e.sort((e,t)=>t.gaps.length-e.gaps.length);for(let t=e.length-1;t>0;t--){let n=e[t];for(let r=t-1;r>=0;r--){let i=e[r];if(i.direction===n.direction&&n.gaps.every(e=>i.gaps.some(t=>round(e.startEdge[0].x)===round(t.startEdge[0].x)&&round(e.startEdge[0].y)===round(t.startEdge[0].y)&&round(e.startEdge[1].x)===round(t.startEdge[1].x)&&round(e.startEdge[1].y)===round(t.startEdge[1].y))&&i.gaps.some(t=>round(e.endEdge[0].x)===round(t.endEdge[0].x)&&round(e.endEdge[0].y)===round(t.endEdge[0].y)&&round(e.endEdge[1].x)===round(t.endEdge[1].x)&&round(e.endEdge[1].y)===round(t.endEdge[1].y)))){e.splice(t,1);break}}}}let BoundsSnaps=class BoundsSnaps{constructor(e){this.manager=e,this.editor=e.editor}editor;getSnapPointsCache(){let{editor:e}=this;return e.store.createComputedCache("snapPoints",t=>{let n=e.getShapePageTransform(t.id);if(!n)return;let r=e.getShapeUtil(t).getBoundsSnapGeometry(t),i=r.points??e.getShapeGeometry(t).bounds.cornersAndCenter;if(n&&i)return i.map((e,r)=>{let{x:i,y:o}=l._.applyToPoint(n,e);return{x:i,y:o,id:`${t.id}:${r}`}})})}getSnapPoints(e){return this.getSnapPointsCache().get(e)??[]}getSnappablePoints(){let e=this.getSnapPointsCache(),t=this.manager.getSnappableShapes(),n=[];for(let r of t){let t=e.get(r);t&&n.push(...t)}return n}getSnappableGapNodes(){return Array.from(this.manager.getSnappableShapes(),e=>({id:e,pageBounds:(0,o.kP)(this.editor.getShapePageBounds(e))}))}getVisibleGaps(){let e,t;let n=[],r=[],i=this.getSnappableGapNodes().sort((e,t)=>e.pageBounds.minX-t.pageBounds.minX);for(let r=0;r<i.length;r++){e=i[r];for(let o=r+1;o<i.length;o++)t=i[o],e.pageBounds.maxX<t.pageBounds.minX&&(0,u.ep)(e.pageBounds.minY,e.pageBounds.maxY,t.pageBounds.minY,t.pageBounds.maxY)&&n.push({startNode:e,endNode:t,startEdge:[new c.B(e.pageBounds.maxX,e.pageBounds.minY),new c.B(e.pageBounds.maxX,e.pageBounds.maxY)],endEdge:[new c.B(t.pageBounds.minX,t.pageBounds.minY),new c.B(t.pageBounds.minX,t.pageBounds.maxY)],length:t.pageBounds.minX-e.pageBounds.maxX,breadthIntersection:(0,u.mW)(e.pageBounds.minY,e.pageBounds.maxY,t.pageBounds.minY,t.pageBounds.maxY)})}let o=i.sort((e,t)=>e.pageBounds.minY-t.pageBounds.minY);for(let n=0;n<o.length;n++){e=o[n];for(let i=n+1;i<o.length;i++)t=o[i],e.pageBounds.maxY<t.pageBounds.minY&&(0,u.ep)(e.pageBounds.minX,e.pageBounds.maxX,t.pageBounds.minX,t.pageBounds.maxX)&&r.push({startNode:e,endNode:t,startEdge:[new c.B(e.pageBounds.minX,e.pageBounds.maxY),new c.B(e.pageBounds.maxX,e.pageBounds.maxY)],endEdge:[new c.B(t.pageBounds.minX,t.pageBounds.minY),new c.B(t.pageBounds.maxX,t.pageBounds.minY)],length:t.pageBounds.minY-e.pageBounds.maxY,breadthIntersection:(0,u.mW)(e.pageBounds.minX,e.pageBounds.maxX,t.pageBounds.minX,t.pageBounds.maxX)})}return{horizontal:n,vertical:r}}snapTranslateShapes({lockedAxis:e,initialSelectionPageBounds:t,initialSelectionSnapPoints:n,dragDelta:r}){let i=this.manager.getSnapThreshold(),o=this.getSnappablePoints(),a=t.clone().translate(r),l=n.map(({x:e,y:t},n)=>({id:"selection:"+n,x:e+r.x,y:t+r.y})),u=[],d=[],p=new c.B(i,i);this.collectPointSnaps({minOffset:p,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:o,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:p});let h=new c.B("x"===e?0:u[0]?.nudge??0,"y"===e?0:d[0]?.nudge??0);p.x=0,p.y=0,u.length=0,d.length=0,l.forEach(e=>{e.x+=h.x,e.y+=h.y}),a.translate(h),this.collectPointSnaps({minOffset:p,nearestSnapsX:u,nearestSnapsY:d,otherNodeSnapPoints:o,selectionSnapPoints:l}),this.collectGapSnaps({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d,minOffset:p});let g=this.getPointSnapLines({nearestSnapsX:u,nearestSnapsY:d}),f=this.getGapSnapLines({selectionPageBounds:a,nearestSnapsX:u,nearestSnapsY:d});return this.manager.setIndicators([...f,...g]),{nudge:h}}snapResizeShapes({initialSelectionPageBounds:e,dragDelta:t,handle:n,isAspectRatioLocked:r,isResizingFromCenter:i}){let o=this.manager.getSnapThreshold(),{box:l,scaleX:u,scaleY:d}=a.xu.Resize(e,n,i?2*t.x:t.x,i?2*t.y:t.y,r),p=n;u<0&&(p=(0,a.Ee)(p)),d<0&&(p=(0,a.Op)(p)),i&&(l.center=e.center);let h="top"===p||"bottom"===p,g="left"===p||"right"===p,f=getResizeSnapPointsForHandle(p,l),m=this.getSnappablePoints(),y=[],b=[],w=new c.B(o,o);this.collectPointSnaps({minOffset:w,nearestSnapsX:y,nearestSnapsY:b,otherNodeSnapPoints:m,selectionSnapPoints:f});let S=new c.B(h?0:y[0]?.nudge??0,g?0:b[0]?.nudge??0);if(r&&(0,a.m3)(p)&&0!==S.len()){let t=y.length&&b.length?Math.abs(S.x)<Math.abs(S.y)?"x":"y":y.length?"x":"y",n=e.aspectRatio;"x"===t?(b.length=0,S.y=S.x/n,("bottom_left"===p||"top_right"===p)&&(S.y=-S.y)):(y.length=0,S.x=S.y*n,("bottom_left"===p||"top_right"===p)&&(S.x=-S.x))}let v=c.B.Add(t,S),{box:x}=a.xu.Resize(e,n,i?2*v.x:v.x,i?2*v.y:v.y,r);i&&(x.center=e.center);let T=getResizeSnapPointsForHandle("any",x);y.length=0,b.length=0,w.x=0,w.y=0,this.collectPointSnaps({minOffset:w,nearestSnapsX:y,nearestSnapsY:b,otherNodeSnapPoints:m,selectionSnapPoints:T});let P=this.getPointSnapLines({nearestSnapsX:y,nearestSnapsY:b});return this.manager.setIndicators([...P]),{nudge:S}}collectPointSnaps({selectionSnapPoints:e,otherNodeSnapPoints:t,minOffset:n,nearestSnapsX:r,nearestSnapsY:i}){for(let o of e)for(let e of t){let t=c.B.Sub(o,e),a=Math.abs(t.x),l=Math.abs(t.y);round(a)<=round(n.x)&&(round(a)<round(n.x)&&(r.length=0),r.push({type:"points",points:{thisPoint:o,otherPoint:e},nudge:e.x-o.x}),n.x=a),round(l)<=round(n.y)&&(round(l)<round(n.y)&&(i.length=0),i.push({type:"points",points:{thisPoint:o,otherPoint:e},nudge:e.y-o.y}),n.y=l)}}collectGapSnaps({selectionPageBounds:e,minOffset:t,nearestSnapsX:n,nearestSnapsY:r}){let{horizontal:i,vertical:o}=this.getVisibleGaps();for(let r of i){if(!(0,u.ep)(r.breadthIntersection[0],r.breadthIntersection[1],e.minY,e.maxY))continue;let i=r.startEdge[0].x+r.length/2,o=i-e.center.x,a=r.length>e.width;if(a&&round(Math.abs(o))<=round(t.x)){round(Math.abs(o))<round(t.x)&&(n.length=0),t.x=Math.abs(o);let e={type:"gap_center",gap:r,nudge:o},i=n.find(({type:e})=>"gap_center"===e),a=i&&(0,u.mW)(r.breadthIntersection[0],r.breadthIntersection[1],i.gap.breadthIntersection[0],i.gap.breadthIntersection[1]);i&&i.gap.length>r.length&&a?n[n.indexOf(i)]=e:i&&a||n.push(e)}let l=r.startNode.pageBounds.minX-r.length,c=e.maxX,d=l-c;round(Math.abs(d))<=round(t.x)&&(round(Math.abs(d))<round(t.x)&&(n.length=0),t.x=Math.abs(d),n.push({type:"gap_duplicate",gap:r,protrusionDirection:"left",nudge:d}));let p=r.endNode.pageBounds.maxX+r.length,h=e.minX,g=p-h;round(Math.abs(g))<=round(t.x)&&(round(Math.abs(g))<round(t.x)&&(n.length=0),t.x=Math.abs(g),n.push({type:"gap_duplicate",gap:r,protrusionDirection:"right",nudge:g}))}for(let n of o){if(!(0,u.ep)(n.breadthIntersection[0],n.breadthIntersection[1],e.minX,e.maxX))continue;let i=n.startEdge[0].y+n.length/2,o=i-e.center.y,a=n.length>e.height;if(a&&round(Math.abs(o))<=round(t.y)){round(Math.abs(o))<round(t.y)&&(r.length=0),t.y=Math.abs(o);let e={type:"gap_center",gap:n,nudge:o},i=r.find(({type:e})=>"gap_center"===e),a=i&&(0,u.ep)(i.gap.breadthIntersection[0],i.gap.breadthIntersection[1],n.breadthIntersection[0],n.breadthIntersection[1]);i&&i.gap.length>n.length&&a?r[r.indexOf(i)]=e:i&&a||r.push(e);continue}let l=n.startNode.pageBounds.minY-n.length,c=e.maxY,d=l-c;round(Math.abs(d))<=round(t.y)&&(round(Math.abs(d))<round(t.y)&&(r.length=0),t.y=Math.abs(d),r.push({type:"gap_duplicate",gap:n,protrusionDirection:"top",nudge:d}));let p=n.endNode.pageBounds.maxY+n.length,h=e.minY,g=p-h;round(Math.abs(g))<=round(t.y)&&(round(Math.abs(g))<round(t.y)&&(r.length=0),t.y=Math.abs(g),r.push({type:"gap_duplicate",gap:n,protrusionDirection:"bottom",nudge:g}))}}getPointSnapLines({nearestSnapsX:e,nearestSnapsY:t}){let n={},r={};if(e.length>0){for(let t of e)if("points"===t.type){let e=round(t.points.otherPoint.x);n[e]||(n[e]=[]),n[e].push(t.points)}}if(t.length>0){for(let e of t)if("points"===e.type){let t=round(e.points.otherPoint.y);r[t]||(r[t]=[]),r[t].push(e.points)}}return Object.values(n).concat(Object.values(r)).map(e=>({id:(0,d.E)(),type:"points",points:(0,o.D8)(e.map(e=>c.B.From(e.otherPoint)).concat(e.map(e=>c.B.From(e.thisPoint))),(e,t)=>e.equals(t))}))}getGapSnapLines({selectionPageBounds:e,nearestSnapsX:t,nearestSnapsY:n}){let{vertical:r,horizontal:i}=this.getVisibleGaps(),o={top:e.sides[0],right:e.sides[1],bottom:[e.corners[3],e.corners[2]],left:[e.corners[0],e.corners[3]]},a=[];if(t.length>0)for(let n of t){if("points"===n.type)continue;let{gap:{breadthIntersection:t,startEdge:r,startNode:l,endNode:c,length:p,endEdge:h}}=n;switch(n.type){case"gap_center":{let n=(p-e.width)/2,g=(0,u.mW)(t[0],t[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:(0,d.E)(),gaps:[...findAdjacentGaps(i,l.id,n,"backward",g),{startEdge:r,endEdge:o.left},{startEdge:o.right,endEdge:h},...findAdjacentGaps(i,c.id,n,"forward",g)]});break}case"gap_duplicate":{let g=(0,u.mW)(t[0],t[1],e.minY,e.maxY);a.push({type:"gaps",direction:"horizontal",id:(0,d.E)(),gaps:"left"===n.protrusionDirection?[{startEdge:o.right,endEdge:r.map(e=>e.clone().addXY(-l.pageBounds.width,0))},{startEdge:r,endEdge:h},...findAdjacentGaps(i,c.id,p,"forward",g)]:[...findAdjacentGaps(i,l.id,p,"backward",g),{startEdge:r,endEdge:h},{startEdge:h.map(e=>e.clone().addXY(n.gap.endNode.pageBounds.width,0)),endEdge:o.left}]})}}}if(n.length>0)for(let t of n){if("points"===t.type)continue;let{gap:{breadthIntersection:n,startEdge:i,startNode:l,endNode:c,length:p,endEdge:h}}=t;switch(t.type){case"gap_center":{let c=(p-e.height)/2,g=(0,u.mW)(n[0],n[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:(0,d.E)(),gaps:[...findAdjacentGaps(r,l.id,c,"backward",g),{startEdge:i,endEdge:o.top},{startEdge:o.bottom,endEdge:h},...findAdjacentGaps(r,t.gap.endNode.id,c,"forward",g)]});break}case"gap_duplicate":{let g=(0,u.mW)(n[0],n[1],e.minX,e.maxX);a.push({type:"gaps",direction:"vertical",id:(0,d.E)(),gaps:"top"===t.protrusionDirection?[{startEdge:o.bottom,endEdge:i.map(e=>e.clone().addXY(0,-l.pageBounds.height))},{startEdge:i,endEdge:h},...findAdjacentGaps(r,c.id,p,"forward",g)]:[...findAdjacentGaps(r,l.id,p,"backward",g),{startEdge:i,endEdge:h},{startEdge:h.map(e=>e.clone().addXY(0,c.pageBounds.height)),endEdge:o.top}]})}}}return dedupeGapSnaps(a),a}};function getResizeSnapPointsForHandle(e,t){let{minX:n,maxX:r,minY:i,maxY:o}=t,a=[];switch(e){case"top":case"left":case"top_left":case"any":a.push({id:"top_left",handle:"top_left",x:n,y:i})}switch(e){case"top":case"right":case"top_right":case"any":a.push({id:"top_right",handle:"top_right",x:r,y:i})}switch(e){case"bottom":case"right":case"bottom_right":case"any":a.push({id:"bottom_right",handle:"bottom_right",x:r,y:o})}switch(e){case"bottom":case"left":case"bottom_left":case"any":a.push({id:"bottom_left",handle:"bottom_left",x:n,y:o})}return a}__decorateClass([r.Fl],BoundsSnaps.prototype,"getSnapPointsCache",1),__decorateClass([r.Fl],BoundsSnaps.prototype,"getSnappablePoints",1),__decorateClass([r.Fl],BoundsSnaps.prototype,"getSnappableGapNodes",1),__decorateClass([r.Fl],BoundsSnaps.prototype,"getVisibleGaps",1);var g=Object.defineProperty,f=Object.getOwnPropertyDescriptor;let defaultGetSelfSnapOutline=()=>null,defaultGetSelfSnapPoints=()=>[];let HandleSnaps=class HandleSnaps{constructor(e){this.manager=e,this.editor=e.editor}editor;getSnapGeometryCache(){let{editor:e}=this;return e.store.createComputedCache("handle snap geometry",t=>{let n=e.getShapeUtil(t).getHandleSnapGeometry(t);return{outline:void 0===n.outline?e.getShapeGeometry(t):n.outline,points:n.points??[],getSelfSnapOutline:n.getSelfSnapOutline??defaultGetSelfSnapOutline,getSelfSnapPoints:n.getSelfSnapPoints??defaultGetSelfSnapPoints}})}*iterateSnapPointsInPageSpace(e,t){let n=this.getSnapGeometryCache().get(e)?.getSelfSnapPoints(t);if(n&&n.length){let t=(0,o.kP)(this.editor.getShapePageTransform(e));for(let e of n)yield t.applyToPoint(e)}for(let t of this.manager.getSnappableShapes()){if(t===e)continue;let n=this.getSnapGeometryCache().get(t)?.points;if(!n||!n.length)continue;let r=(0,o.kP)(this.editor.getShapePageTransform(t));for(let e of n)yield r.applyToPoint(e)}}*iterateSnapOutlines(e,t){let n=this.getSnapGeometryCache().get(e)?.getSelfSnapOutline(t);for(let t of(n&&(yield{shapeId:e,outline:n}),this.manager.getSnappableShapes())){if(t===e)continue;let n=this.getSnapGeometryCache().get(t)?.outline;n&&(yield{shapeId:t,outline:n})}}getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:n}){let r=this.manager.getSnapThreshold(),i=r,a=null;for(let r of this.iterateSnapPointsInPageSpace(e,t)){let e=c.B.Dist(n,r);e<i&&(i=e,a=r)}if(a)return a;let l=r,u=null;for(let{shapeId:r,outline:i}of this.iterateSnapOutlines(e,t)){let e=(0,o.kP)(this.editor.getShapePageTransform(r)),t=this.editor.getPointInShapeSpace(r,n),a=i.nearestPoint(t),d=e.applyToPoint(a),p=c.B.Dist(n,d);p<l&&(l=p,u=d)}return u||null}snapHandle({currentShapeId:e,handle:t}){let n=(0,o.kP)(this.editor.getShapePageTransform(e)),r=n.applyToPoint(t),i=this.getHandleSnapPosition({currentShapeId:e,handle:t,handleInPageSpace:r});return i?(this.manager.setIndicators([{id:(0,d.E)(),type:"points",points:[i]}]),{nudge:c.B.Sub(i,r)}):null}};((e,t,n,r)=>{for(var i,o=r>1?void 0:r?f(t,n):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&g(t,n,o)})([r.Fl],HandleSnaps.prototype,"getSnapGeometryCache",1);var m=Object.defineProperty,y=Object.getOwnPropertyDescriptor,SnapManager_decorateClass=(e,t,n,r)=>{for(var i,o=r>1?void 0:r?y(t,n):t,a=e.length-1;a>=0;a--)(i=e[a])&&(o=(r?i(t,n,o):i(o))||o);return r&&o&&m(t,n,o),o};let SnapManager=class SnapManager{constructor(e){this.editor=e,this.shapeBounds=new BoundsSnaps(this),this.handles=new HandleSnaps(this)}shapeBounds;handles;_snapIndicators=(0,r.cn)("snapLines",void 0);getIndicators(){return this._snapIndicators.get()??r.LZ}clearIndicators(){this.getIndicators().length&&this._snapIndicators.set(void 0)}setIndicators(e){this._snapIndicators.set(e)}getSnapThreshold(){return 8/this.editor.getZoomLevel()}getSnappableShapes(){let{editor:e}=this,t=e.getRenderingBounds(),n=e.getSelectedShapeIds(),r=new Set,collectSnappableShapesFromParent=o=>{if((0,i.YT)(o)){let t=e.getShape(o);t&&e.isShapeOfType(t,"frame")&&r.add(o)}let a=e.getSortedChildIdsForParent(o);for(let i of a){if(n.includes(i))continue;let o=e.getShape(i);if(!o)continue;let a=e.getShapeUtil(o);if(!a.canSnap(o))continue;let l=e.getShapePageBounds(i);if(l&&t.includes(l)){if(e.isShapeOfType(o,"group")){collectSnappableShapesFromParent(i);continue}r.add(i)}}};return collectSnappableShapesFromParent(this.getCurrentCommonAncestor()??e.getCurrentPageId()),r}getCurrentCommonAncestor(){return this.editor.findCommonAncestor(this.editor.getSelectedShapes())}};SnapManager_decorateClass([r.Fl],SnapManager.prototype,"getSnapThreshold",1),SnapManager_decorateClass([r.Fl],SnapManager.prototype,"getSnappableShapes",1),SnapManager_decorateClass([r.Fl],SnapManager.prototype,"getCurrentCommonAncestor",1)},3197:function(e,t,n){"use strict";n.d(t,{R:function(){return TextManager}});let r=/\r?\n|\r/g;function normalizeTextForDom(e){return e.replace(r,"\n").split("\n").map(e=>e||" ").join("\n")}let i={start:"left","start-legacy":"left",middle:"center","middle-legacy":"center",end:"right","end-legacy":"right"},o=/\s/;let TextManager=class TextManager{constructor(e){this.editor=e;let t=document.createElement("div");t.id="tldraw_text_measure",t.classList.add("tl-text"),t.classList.add("tl-text-measure"),t.tabIndex=-1,this.editor.getContainer().appendChild(t),this.baseElm=t}baseElm;measureText=(e,t)=>{let n=this.baseElm?.cloneNode();this.baseElm.insertAdjacentElement("afterend",n),n.setAttribute("dir","ltr"),n.style.setProperty("font-family",t.fontFamily),n.style.setProperty("font-style",t.fontStyle),n.style.setProperty("font-weight",t.fontWeight),n.style.setProperty("font-size",t.fontSize+"px"),n.style.setProperty("line-height",t.lineHeight*t.fontSize+"px"),n.style.setProperty("max-width",null===t.maxWidth?null:t.maxWidth+"px"),n.style.setProperty("min-width",t.minWidth??null),n.style.setProperty("padding",t.padding),n.textContent=normalizeTextForDom(e);let r=n.getBoundingClientRect();return n.remove(),{x:0,y:0,w:r.width,h:r.height}};measureElementTextNodeSpans(e,{shouldTruncateToFirstLine:t=!1}={}){let n=[],r=e.getBoundingClientRect(),i=-r.left,a=-r.top,l=new Range,c=e.childNodes[0],u=0,d=null,p=null,h=0,g=!1;for(let r of e.childNodes)if(r.nodeType===Node.TEXT_NODE)for(let e of r.textContent??""){l.setStart(c,u),l.setEnd(c,u+e.length);let r=l.getClientRects(),f=r[r.length-1],m=f.top+a,y=f.left+i,b=f.right+i,w=o.test(e);if(w===p&&m===h&&d)d.box.w=b-d.box.x,d.text+=e;else{if(d){if(t&&m!==h){g=!0;break}n.push(d)}d={box:{x:y,y:m,w:f.width,h:f.height},text:e}}p=w,h=m,u+=e.length}return d&&n.push(d),{spans:n,didTruncate:g}}measureTextSpans(e,t){if(""===e)return[];let n=this.baseElm?.cloneNode();this.baseElm.insertAdjacentElement("afterend",n);let r=Math.ceil(t.width-2*t.padding);n.style.setProperty("width",`${r}px`),n.style.setProperty("height","min-content"),n.style.setProperty("dir","ltr"),n.style.setProperty("font-size",`${t.fontSize}px`),n.style.setProperty("font-family",t.fontFamily),n.style.setProperty("font-weight",t.fontWeight),n.style.setProperty("line-height",`${t.lineHeight*t.fontSize}px`),n.style.setProperty("text-align",i[t.textAlign]);let o="truncate-ellipsis"===t.overflow||"truncate-clip"===t.overflow;o&&(n.style.setProperty("overflow-wrap","anywhere"),n.style.setProperty("word-break","break-all"));let a=normalizeTextForDom(e);n.textContent=a;let{spans:l,didTruncate:c}=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:o});if("truncate-ellipsis"===t.overflow&&c){n.textContent="";let e=Math.ceil(this.measureElementTextNodeSpans(n).spans[0].box.w);n.style.setProperty("width",`${r-e}px`),n.textContent=a;let i=this.measureElementTextNodeSpans(n,{shouldTruncateToFirstLine:!0}).spans,o=i[i.length-1];return i.push({text:"",box:{x:Math.min(o.box.x+o.box.w,t.width-t.padding-e),y:o.box.y,w:e,h:o.box.h}}),i}return n.remove(),l}}},6541:function(e,t,n){"use strict";n.d(t,{r:function(){return TickManager}});var r=n(4204);let TickManager=class TickManager{constructor(e){this.editor=e,this.editor.disposables.add(this.dispose),this.start()}raf;isPaused=!0;last=0;t=0;start=()=>{this.isPaused=!1,cancelAnimationFrame(this.raf),this.raf=requestAnimationFrame(this.tick),this.last=Date.now()};tick=()=>{if(this.isPaused)return;let e=Date.now(),t=e-this.last;if(this.last=e,this.t+=t,this.editor.emit("frame",t),this.t<16){this.raf=requestAnimationFrame(this.tick);return}this.t-=16,this.updatePointerVelocity(t),this.editor.emit("tick",t),this.raf=requestAnimationFrame(this.tick)};dispose=()=>{this.isPaused=!0,cancelAnimationFrame(this.raf)};prevPoint=new r.B;updatePointerVelocity=e=>{let{prevPoint:t,editor:{inputs:{currentScreenPoint:n,pointerVelocity:i}}}=this;if(0===e)return;let o=r.B.Sub(n,t);this.prevPoint=n.clone();let a=o.len(),l=a?o.div(a):new r.B(0,0),c=i.clone().lrp(l.mul(a/e),.5);.01>Math.abs(c.x)&&(c.x=0),.01>Math.abs(c.y)&&(c.y=0),i.equals(c)||(this.editor.inputs.pointerVelocity=c)}}},6393:function(e,t,n){"use strict";n.d(t,{K:function(){return UserPreferencesManager}});var r=n(9502),i=n(5894),o=Object.defineProperty,a=Object.getOwnPropertyDescriptor,__decorateClass=(e,t,n,r)=>{for(var i,l=r>1?void 0:r?a(t,n):t,c=e.length-1;c>=0;c--)(i=e[c])&&(l=(r?i(t,n,l):i(l))||l);return r&&l&&o(t,n,l),l};let UserPreferencesManager=class UserPreferencesManager{constructor(e,t){this.user=e,this.inferDarkMode=t}updateUserPreferences=e=>{this.user.setUserPreferences({...this.user.userPreferences.get(),...e})};getUserPreferences(){return{id:this.getId(),name:this.getName(),locale:this.getLocale(),color:this.getColor(),animationSpeed:this.getAnimationSpeed(),isSnapMode:this.getIsSnapMode(),isDarkMode:this.getIsDarkMode(),isWrapMode:this.getIsWrapMode()}}getIsDarkMode(){return this.user.userPreferences.get().isDarkMode??(!!this.inferDarkMode&&(0,i.ng)())}getEdgeScrollSpeed(){return this.user.userPreferences.get().edgeScrollSpeed??i.ks.edgeScrollSpeed}getAnimationSpeed(){return this.user.userPreferences.get().animationSpeed??i.ks.animationSpeed}getId(){return this.user.userPreferences.get().id}getName(){return this.user.userPreferences.get().name??i.ks.name}getLocale(){return this.user.userPreferences.get().locale??i.ks.locale}getColor(){return this.user.userPreferences.get().color??i.ks.color}getIsSnapMode(){return this.user.userPreferences.get().isSnapMode??i.ks.isSnapMode}getIsWrapMode(){return this.user.userPreferences.get().isWrapMode??i.ks.isWrapMode}};__decorateClass([r.Fl],UserPreferencesManager.prototype,"getUserPreferences",1),__decorateClass([r.Fl],UserPreferencesManager.prototype,"getIsDarkMode",1),__decorateClass([r.Fl],UserPreferencesManager.prototype,"getEdgeScrollSpeed",1),__decorateClass([r.Fl],UserPreferencesManager.prototype,"getAnimationSpeed",1),__decorateClass([r.Fl],UserPreferencesManager.prototype,"getId",1),__decorateClass([r.Fl],UserPreferencesManager.prototype,"getName",1),__decorateClass([r.Fl],UserPreferencesManager.prototype,"getLocale",1),__decorateClass([r.Fl],UserPreferencesManager.prototype,"getColor",1),__decorateClass([r.Fl],UserPreferencesManager.prototype,"getIsSnapMode",1),__decorateClass([r.Fl],UserPreferencesManager.prototype,"getIsWrapMode",1)},5859:function(e,t,n){"use strict";n.d(t,{E:function(){return ShapeUtil}});let ShapeUtil=class ShapeUtil{constructor(e){this.editor=e}static props;static migrations;static type;canSnap=()=>!0;canScroll=()=>!1;canUnmount=()=>!0;canBind=(e,t)=>!0;canEdit=()=>!1;canResize=()=>!0;canEditInReadOnly=()=>!1;canCrop=()=>!1;providesBackgroundForChildren(e){return!1}hideResizeHandles=()=>!1;hideRotateHandle=()=>!1;hideSelectionBoundsBg=()=>!1;hideSelectionBoundsFg=()=>!1;isAspectRatioLocked=()=>!1;canReceiveNewChildrenOfType(e,t){return!1}canDropShapes(e,t){return!1}expandSelectionOutlinePx(e){return 0}getCanvasSvgDefs(){return[]}getBoundsSnapGeometry(e){return{}}getHandleSnapGeometry(e){return{}}onBeforeCreate;onBeforeUpdate;onDragShapesOver;onDragShapesOut;onDropShapesOver;onResizeStart;onResize;onResizeEnd;onTranslateStart;onTranslate;onTranslateEnd;onHandleDrag;onRotateStart;onRotate;onRotateEnd;onBindingChange;onChildrenChange;onDoubleClickHandle;onDoubleClickEdge;onDoubleClick;onClick;onEditEnd}},2772:function(e,t,n){"use strict";n.d(t,{Q:function(){return GroupShapeUtil}});var r=n(7437),i=n(6934),o=n(7295),a=n(7684),l=n(2042),c=n(6368),u=n(9234),d=n(5859),p=n(9502),h=n(3373);function getPerfectDashProps(e,t,n={}){let{closed:r=!1,snap:i=1,start:o="outset",end:a="outset",lengthRatio:l=2,style:c="dashed"}=n,u=0,d=0,p=1,h=0,g=0;switch(c){case"dashed":p=1,u=Math.min(t*l,e/4);break;case"dotted":u=t/(p=100);break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||("outset"===o?(e+=u/2,g+=u/2):"skip"===o&&(e-=u,g-=u),"outset"===a?e+=u/2:"skip"!==a||(e-=u)),d=Math.floor(e/u/(2*p)),(d-=d%i)<3&&"dashed"===c?e/t<5?(u=e,d=1,h=0):(u=.333*e,h=.333*e):(u=e/(d=Math.max(d,3))/(2*p),r?(g=u/2,h=(e-d*u)/d):h=(e-d*u)/Math.max(1,d-1)),{strokeDasharray:[u,h].join(" "),strokeDashoffset:g.toString()}}function DashedOutlineBox({bounds:e,className:t}){let n=(0,h.j)(),i=(0,p.Hg)("zoom level",()=>n.getZoomLevel(),[n]);return(0,r.jsx)("g",{className:t,pointerEvents:"none",strokeLinecap:"round",strokeLinejoin:"round",children:e.sides.map((e,t)=>{let{strokeDasharray:n,strokeDashoffset:o}=getPerfectDashProps(e[0].dist(e[1]),1/i,{style:"dashed",lengthRatio:4});return(0,r.jsx)("line",{x1:e[0].x,y1:e[0].y,x2:e[1].x,y2:e[1].y,strokeDasharray:n,strokeDashoffset:o},t)})})}let GroupShapeUtil=class GroupShapeUtil extends d.E{static type="group";static props=i.A7;static migrations=i.c4;hideSelectionBoundsFg=()=>!0;canBind=()=>!1;getDefaultProps(){return{}}getGeometry(e){let t=this.editor.getSortedChildIdsForParent(e.id);return 0===t.length?new u.z({width:1,height:1,isFilled:!1}):new a.m({children:t.map(e=>{let t=this.editor.getShape(e),n=this.editor.getShapeGeometry(e),r=this.editor.getShapeLocalTransform(t).applyToPoints(n.vertices);return n.isClosed?new l.w({points:r,isFilled:!0}):new c.q({points:r})})})}component(e){let t=this.editor.getErasingShapeIds().includes(e.id),{hintingShapeIds:n}=this.editor.getCurrentPageState(),i=n.length>0&&n.some(t=>t!==e.id&&this.editor.isShapeOfType(this.editor.getShape(t),"group")),a=this.editor.getCurrentPageState().focusedGroupId!==e.id;if(!t&&(a||i))return null;let l=this.editor.getShapeGeometry(e).bounds;return(0,r.jsx)(o.g,{id:e.id,children:(0,r.jsx)(DashedOutlineBox,{className:"tl-group",bounds:l})})}indicator(e){let t=this.editor.getShapeGeometry(e).bounds;return(0,r.jsx)(DashedOutlineBox,{className:"",bounds:t})}onChildrenChange=e=>{let t=this.editor.getSortedChildIdsForParent(e.id);if(0===t.length){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.deleteShapes([e.id]);return}if(1===t.length){this.editor.getCurrentPageState().focusedGroupId===e.id&&this.editor.popFocusedGroupId(),this.editor.reparentShapes(t,e.parentId),this.editor.deleteShapes([e.id]);return}}}},4214:function(e,t,n){"use strict";n.d(t,{p:function(){return getCurvedArrowInfo}});var r=n(5404),i=n(4204),o=n(224),a=n(6166),l=n(7761),c=n(3308);function getCurvedArrowInfo(e,t,n=0){let{arrowheadEnd:u,arrowheadStart:d}=t.props,p=t.props.bend+n;if(Math.abs(p)>Math.abs(t.props.bend*l.Od))return(0,c.r)(e,t);let h=(0,l.Qs)(e,t),g=i.B.Med(h.start,h.end),f=i.B.Sub(h.end,h.start),m=i.B.Len(f)?f.uni():i.B.From(f),y=i.B.Add(g,m.per().mul(-p)),b=(0,l.Up)(e,t.props.start),w=(0,l.Up)(e,t.props.end),S=h.start.clone(),v=h.end.clone(),x=y.clone();if(i.B.Equals(S,v))return{isStraight:!0,start:{handle:S,point:S,arrowhead:t.props.arrowheadStart},end:{handle:v,point:v,arrowhead:t.props.arrowheadEnd},middle:x,isValid:!1,length:0};let T=t.props.bend<0,P=T?a.VK:a.pc,C=getArcInfo(S,v,x),k=i.B.Angle(C.center,S),I=i.B.Angle(C.center,v),E=P(k,I);if(0===C.length||0===C.size||!(0,a.AV)(C.length)||!(0,a.AV)(C.size))return(0,c.r)(e,t);let _=S.clone(),M=v.clone(),j=x.clone(),A=e.getShapePageTransform(t),$=0,D=0,O=l.Kn;if(b&&!b.isExact){let n;let i=r._.applyToPoint(A,_),a=r._.applyToPoint(A,C.center),c=r._.applyToPoint(A,M),u=r._.Inverse(b.transform),p=r._.applyToPoint(u,i),h=r._.applyToPoint(u,a),g=r._.applyToPoint(u,c),{isClosed:f}=b,m=f?o.h9:o.XS,y=m(h,C.radius,b.outline);if(y){let e=h.angle(p),t=h.angle(g),r=P(e,t);y=y.filter(t=>P(e,h.angle(t))<=r);let i=.25*r;y.sort(f?(t,n)=>Math.abs(P(e,h.angle(t))-i)<Math.abs(P(e,h.angle(n))-i)?-1:1:(t,n)=>P(e,h.angle(t))<P(e,h.angle(n))?-1:1),n=y[0]??(f?void 0:p)}else n=f?void 0:p;if(n&&(_.setTo(e.getPointInShapeSpace(t,r._.applyToPoint(b.transform,n))),b.didIntersect=!0,"none"!==d)){let e=l.L$[t.props.size]/2+("size"in b.shape.props?l.L$[b.shape.props.size]/2:0);$=l.oF+e,O+=e}}if(w&&!w.isExact){let n;let i=r._.applyToPoint(A,_),a=r._.applyToPoint(A,M),c=r._.applyToPoint(A,C.center),d=r._.Inverse(w.transform),p=r._.applyToPoint(d,i),h=r._.applyToPoint(d,c),g=r._.applyToPoint(d,a),f=w.isClosed,m=f?o.h9:o.XS,y=m(h,C.radius,w.outline);if(y){let e=h.angle(p),t=h.angle(g),r=P(e,t),i=.75*r;(y=y.filter(t=>P(e,h.angle(t))<=r)).sort(f?(t,n)=>Math.abs(P(e,h.angle(t))-i)<Math.abs(P(e,h.angle(n))-i)?-1:1:(t,n)=>P(e,h.angle(t))<P(e,h.angle(n))?-1:1),n=y[0]?y[0]:f?void 0:g}else n=f?void 0:g;if(n&&(M.setTo(e.getPointInShapeSpace(t,r._.applyToPoint(w.transform,n))),w.didIntersect=!0,"none"!==u)){let e=l.L$[t.props.size]/2+("size"in w.shape.props?l.L$[w.shape.props.size]/2:0);D=l.oF+e,O+=e}}let B=i.B.Angle(C.center,_),F=i.B.Angle(C.center,M),U=P(B,F),L=U*C.radius,R=_.clone(),z=M.clone();if(0!==$){let e=$/L*(T?1:-1),t=i.B.FromAngle(B+U*e);R.setTo(C.center).add(t.mul(C.radius))}if(0!==D){let e=D/L*(T?-1:1),t=i.B.FromAngle(F+U*e);z.setTo(C.center).add(t.mul(C.radius))}let N=i.B.Dist(R,z);if(N<O&&(0!==$&&0!==D?($*=-1.5,D*=-1.5):0!==$?$*=-2:0!==D&&(D*=-2)),0!==$){let e=$/L*(T?1:-1),t=i.B.FromAngle(B+U*e);_.setTo(C.center).add(t.mul(C.radius))}if(0!==D){let e=D/L*(T?-1:1),t=i.B.FromAngle(F+U*e);M.setTo(C.center).add(t.mul(C.radius))}if(b&&w&&!b.isExact&&!w.isExact){L=(U=P(B=i.B.Angle(C.center,_),F=i.B.Angle(C.center,M)))*C.radius;let t=(0,l.xO)(e,b.shape.id,w.shape.id);if("double-bound"===t&&L<30)_.setTo(S),M.setTo(v),j.setTo(x);else if("safe"===t&&(b&&!b.didIntersect&&_.setTo(S),w&&!w.didIntersect||P(k,B)>P(k,F))){let e=Math.min(.9,l.Kn/L)*(T?1:-1),t=i.B.FromAngle(B+U*e);M.setTo(C.center).add(t.mul(C.radius))}}placeCenterHandle(C.center,C.radius,_,M,j,E,T),_.equals(M)&&(_.setTo(j.clone().addXY(1,1)),M.setTo(j.clone().subXY(1,1))),S.setTo(_),v.setTo(M),x.setTo(j);let V=getArcInfo(S,v,x);return{isStraight:!1,start:{point:S,handle:h.start,arrowhead:t.props.arrowheadStart},end:{point:v,handle:h.end,arrowhead:t.props.arrowheadEnd},middle:x,handleArc:C,bodyArc:V,isValid:0!==V.length&&isFinite(V.center.x)&&isFinite(V.center.y)}}function getArcInfo(e,t,n){let r=-2*(e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y),o={x:((e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y))/r,y:((e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x))/r},l=i.B.Dist(o,e),c=+i.B.Clockwise(e,n,t),u=Math.hypot(e.y-t.y,e.x-t.x),d=Math.hypot(t.y-n.y,t.x-n.x),p=Math.hypot(n.y-e.y,n.x-e.x),h=2*Math.acos((d*d+p*p-u*u)/(2*d*p)),g=+(a.PI>h),f=(a.yo-h)*(c?1:-1);return{center:o,radius:l,size:f,length:f*l,largeArcFlag:g,sweepFlag:c}}function placeCenterHandle(e,t,n,r,o,l,c){let u=i.B.Angle(e,n),d=i.B.Angle(e,r),p=(0,a.VK)(u,d);c||(p=a.yo-p);let h=i.B.FromAngle(u+p*(.5*(c?1:-1)));if(o.setTo(e).add(h.mul(t)),p>l){o.rotWith(e,a.PI);let t=r.clone();r.setTo(n),n.setTo(t)}}},7761:function(e,t,n){"use strict";n.d(t,{Kn:function(){return a},L$:function(){return u},Od:function(){return c},Qs:function(){return getArrowTerminalsInArrowSpace},Up:function(){return getBoundShapeInfoForTerminal},el:function(){return getIsArrowStraight},oF:function(){return l},xO:function(){return getBoundShapeRelationships}});var r=n(5404),i=n(4204),o=n(7684);function getIsArrowStraight(e){return 8>Math.abs(e.props.bend)}function getBoundShapeInfoForTerminal(e,t){if("point"===t.type)return;let n=e.getShape(t.boundShapeId),r=e.getShapePageTransform(n),i=e.getShapeGeometry(n),a=i instanceof o.m?i.children[0].vertices:i.vertices;return{shape:n,transform:r,isClosed:i.isClosed,isExact:t.isExact,didIntersect:!1,outline:a}}function getArrowTerminalInArrowSpace(e,t,n,o){if("point"===n.type)return i.B.From(n);let a=e.getShape(n.boundShapeId);if(!a)return new i.B(0,0);{let{point:l,size:c}=e.getShapeGeometry(a).bounds,u=i.B.Add(l,i.B.MulV(n.isPrecise||o?n.normalizedAnchor:{x:.5,y:.5},c)),d=r._.applyToPoint(e.getShapePageTransform(a),u),p=r._.applyToPoint(r._.Inverse(t),d);return p}}function getArrowTerminalsInArrowSpace(e,t){let n,r;let i=e.getShapePageTransform(t);"binding"===t.props.start.type&&"binding"===t.props.end.type&&(n=t.props.start.boundShapeId,r=t.props.end.boundShapeId);let o=getBoundShapeRelationships(e,n,r),a=getArrowTerminalInArrowSpace(e,i,t.props.start,"double-bound"===o||"start-contains-end"===o),l=getArrowTerminalInArrowSpace(e,i,t.props.end,"double-bound"===o||"end-contains-start"===o);return{start:a,end:l}}let a=10,l=10,c=10,u={s:2,m:3.5,l:5,xl:10};function getBoundShapeRelationships(e,t,n){if(!t||!n)return"safe";if(t===n)return"double-bound";let r=e.getShapePageBounds(t),i=e.getShapePageBounds(n);if(r&&i){if(r.contains(i))return"start-contains-end";if(i.contains(r))return"end-contains-start"}return"safe"}},3308:function(e,t,n){"use strict";n.d(t,{r:function(){return getStraightArrowInfo}});var r=n(5404),i=n(4204),o=n(224),a=n(7761);function getStraightArrowInfo(e,t){let{start:n,end:r,arrowheadStart:o,arrowheadEnd:l}=t.props,c=(0,a.Qs)(e,t),u=c.start.clone(),d=c.end.clone(),p=i.B.Med(u,d);if(i.B.Equals(u,d))return{isStraight:!0,start:{handle:u,point:u,arrowhead:t.props.arrowheadStart},end:{handle:d,point:d,arrowhead:t.props.arrowheadEnd},middle:p,isValid:!1,length:0};let h=i.B.Sub(d,u).uni(),g=(0,a.Up)(e,n),f=(0,a.Up)(e,r),m=e.getShapePageTransform(t);updateArrowheadPointWithBoundShape(d,c.start,m,f),updateArrowheadPointWithBoundShape(u,c.end,m,g);let y=0,b=0,w=0,S=0,v=a.Kn,x=g&&f&&g.shape===f.shape,T=g&&f?(0,a.xO)(e,g.shape.id,f.shape.id):"safe";"safe"===T&&g&&f&&!x&&!g.isExact&&!f.isExact&&(f.didIntersect&&!g.didIntersect?g.isClosed&&u.setTo(d.clone().add(h.clone().mul(a.Kn))):!f.didIntersect&&f.isClosed&&d.setTo(u.clone().sub(h.clone().mul(a.Kn))));let P=i.B.Sub(d,u),C=i.B.Len(P)?P.uni():i.B.From(P),k=!i.B.Equals(C,h);x||("start-contains-end"!==T&&g&&"none"!==o&&!g.isExact&&(w=a.L$[t.props.size]/2+("size"in g.shape.props?a.L$[g.shape.props.size]/2:0),y=a.oF+w,v+=w),"end-contains-start"===T||!f||"none"===l||f.isExact||(S=a.L$[t.props.size]/2+("size"in f.shape.props?a.L$[f.shape.props.size]/2:0),b=a.oF+S,v+=S));let I=u.clone().add(C.clone().mul(y*(k?-1:1))),E=d.clone().sub(C.clone().mul(b*(k?-1:1))),_=i.B.Dist(I,E);_<v&&(0!==y&&0!==b?(y*=-1.5,b*=-1.5):0!==y?y*=-1:0!==b&&(b*=-1)),u.add(C.clone().mul(y*(k?-1:1))),d.sub(C.clone().mul(b*(k?-1:1))),k?(g&&f&&d.setTo(i.B.Add(u,C.clone().mul(-a.Kn))),p.setTo(i.B.Med(c.start,c.end))):p.setTo(i.B.Med(u,d));let M=i.B.Dist(u,d);return{isStraight:!0,start:{handle:c.start,point:u,arrowhead:t.props.arrowheadStart},end:{handle:c.end,point:d,arrowhead:t.props.arrowheadEnd},middle:p,isValid:M>0,length:M}}function updateArrowheadPointWithBoundShape(e,t,n,a){let l;if(void 0===a||a.isExact)return;let c=r._.applyToPoint(n,t),u=r._.applyToPoint(n,e),d=r._.applyToPoint(r._.Inverse(a.transform),c),p=r._.applyToPoint(r._.Inverse(a.transform),u),h=a.isClosed,g=h?o.qZ:o.Gc,f=g(d,p,a.outline);if(null!==f&&(l=f.sort((e,t)=>i.B.Dist(e,d)-i.B.Dist(t,d))[0]??(h?void 0:p)),void 0===l)return;let m=r._.applyToPoint(a.transform,l),y=r._.applyToPoint(r._.Inverse(n),m);e.setTo(y),a.didIntersect=!0}},9040:function(e,t,n){"use strict";n.d(t,{m:function(){return RootState}});var r=n(2797);let RootState=class RootState extends r.n{static id="root";static initial="";static children=()=>[];onKeyDown=e=>{if("KeyZ"===e.code&&!(e.shiftKey||e.ctrlKey)){let t=this.getCurrent();t&&t.getCurrent()?.id==="idle"&&this.children.zoom&&this.editor.setCurrentTool("zoom",{...e,onInteractionEnd:t.id})}}}},2797:function(e,t,n){"use strict";n.d(t,{n:function(){return StateNode}});var r=n(9502),i=n(521);let StateNode=class StateNode{constructor(e,t){this.editor=e;let{id:n,children:i,initial:o}=this.constructor;this.id=n,this._isActive=(0,r.cn)("toolIsActive"+this.id,!1),this._current=(0,r.cn)("toolState"+this.id,void 0),this._path=(0,r.Fl)("toolPath"+this.id,()=>{let e=this.getCurrent();return this.id+(e?`.${e.getPath()}`:"")}),this.parent=t??{},this.parent?i&&o?(this.type="branch",this.initial=o,this.children=Object.fromEntries(i().map(e=>[e.id,new e(this.editor,this)])),this._current.set(this.children[this.initial])):this.type="leaf":(this.type="root",i&&o&&(this.initial=o,this.children=Object.fromEntries(i().map(e=>[e.id,new e(this.editor,this)])),this._current.set(this.children[this.initial])))}static id;static initial;static children;id;type;shapeType;initial;children;parent;getPath(){return this._path.get()}_path;getCurrent(){return this._current.get()}_current;getIsActive(){return this._isActive.get()}_isActive;transition=(e,t={})=>{let n=e.split("."),r=this;for(let e=0;e<n.length;e++){let i=n[e],o=r.getCurrent(),a=r.children?.[i];if(!a)throw Error(`${r.id} - no child state exists with the id ${i}.`);if(o?.id!==a.id&&(o?.exit(t,i),r._current.set(a),a.enter(t,o?.id||"initial"),!a.getIsActive()))break;r=a}return this};handleEvent=e=>{let t=i.J[e.name],n=this.getCurrent();this[t]?.(e),this.getCurrent()===n&&this.getIsActive()&&n?.handleEvent(e)};enter=(e,t)=>{if(this._isActive.set(!0),this.onEnter?.(e,t),this.onTick&&this.editor.on("tick",this.onTick),this.children&&this.initial&&this.getIsActive()){let n=this.children[this.initial];this._current.set(n),n.enter(e,t)}};exit=(e,t)=>{this._isActive.set(!1),this.onTick&&this.editor.off("tick",this.onTick),this.onExit?.(e,t),this.getIsActive()||this.getCurrent()?.exit(e,t)};_currentToolIdMask=(0,r.cn)("curent tool id mask",void 0);getCurrentToolIdMask(){return this._currentToolIdMask.get()}setCurrentToolIdMask(e){this._currentToolIdMask.set(e)}onWheel;onPointerDown;onPointerMove;onPointerUp;onDoubleClick;onTripleClick;onQuadrupleClick;onRightClick;onMiddleClick;onKeyDown;onKeyUp;onKeyRepeat;onCancel;onComplete;onInterrupt;onEnter;onExit;onTick}},521:function(e,t,n){"use strict";n.d(t,{J:function(){return r}});let r={wheel:"onWheel",pointer_down:"onPointerDown",pointer_move:"onPointerMove",pointer_up:"onPointerUp",right_click:"onRightClick",middle_click:"onMiddleClick",key_down:"onKeyDown",key_up:"onKeyUp",key_repeat:"onKeyRepeat",cancel:"onCancel",complete:"onComplete",interrupt:"onInterrupt",double_click:"onDoubleClick",triple_click:"onTripleClick",quadruple_click:"onQuadrupleClick"}},3373:function(e,t,n){"use strict";n.d(t,{j:function(){return useEditor},r:function(){return i}});var r=n(2265);let i=r.createContext({});function useEditor(){return r.useContext(i)}},696:function(e,t,n){"use strict";n.d(t,{Ee:function(){return flipSelectionHandleX},Op:function(){return flipSelectionHandleY},dC:function(){return rotateSelectionHandle},m3:function(){return isSelectionCorner},rf:function(){return a},xu:function(){return Box}});var r=n(4204),i=n(6166);let Box=class Box{constructor(e=0,t=0,n=0,r=0){this.x=e,this.y=t,this.w=n,this.h=r}x=0;y=0;w=0;h=0;get point(){return new r.B(this.x,this.y)}set point(e){this.x=e.x,this.y=e.y}get minX(){return this.x}set minX(e){this.x=e}get midX(){return this.x+this.w/2}get maxX(){return this.x+this.w}get minY(){return this.y}set minY(e){this.y=e}get midY(){return this.y+this.h/2}get maxY(){return this.y+this.h}get width(){return this.w}set width(e){this.w=e}get height(){return this.h}set height(e){this.h=e}get aspectRatio(){return this.width/this.height}get center(){return new r.B(this.midX,this.midY)}set center(e){this.minX=e.x-this.width/2,this.minY=e.y-this.height/2}get corners(){return[new r.B(this.minX,this.minY),new r.B(this.maxX,this.minY),new r.B(this.maxX,this.maxY),new r.B(this.minX,this.maxY)]}get cornersAndCenter(){return[new r.B(this.minX,this.minY),new r.B(this.maxX,this.minY),new r.B(this.maxX,this.maxY),new r.B(this.minX,this.maxY),this.center]}get sides(){let{corners:e}=this;return[[e[0],e[1]],[e[1],e[2]],[e[2],e[3]],[e[3],e[0]]]}get size(){return new r.B(this.w,this.h)}toFixed(){return this.x=(0,i.Zd)(this.x),this.y=(0,i.Zd)(this.y),this.w=(0,i.Zd)(this.w),this.h=(0,i.Zd)(this.h),this}setTo(e){return this.x=e.x,this.y=e.y,this.w=e.w,this.h=e.h,this}set(e=0,t=0,n=0,r=0){return this.x=e,this.y=t,this.w=n,this.h=r,this}expand(e){let t=Math.min(this.minX,e.minX),n=Math.min(this.minY,e.minY),r=Math.max(this.maxX,e.maxX),i=Math.max(this.maxY,e.maxY);return this.x=t,this.y=n,this.w=r-t,this.h=i-n,this}expandBy(e){return this.x-=e,this.y-=e,this.w+=2*e,this.h+=2*e,this}scale(e){return this.x/=e,this.y/=e,this.w/=e,this.h/=e,this}clone(){let{x:e,y:t,w:n,h:r}=this;return new Box(e,t,n,r)}translate(e){return this.x+=e.x,this.y+=e.y,this}snapToGrid(e){let t=Math.round(this.minX/e)*e,n=Math.round(this.minY/e)*e,r=Math.round(this.maxX/e)*e,i=Math.round(this.maxY/e)*e;this.minX=t,this.minY=n,this.width=Math.max(1,r-t),this.height=Math.max(1,i-n)}collides(e){return Box.Collides(this,e)}contains(e){return Box.Contains(this,e)}includes(e){return Box.Includes(this,e)}containsPoint(e,t=0){return Box.ContainsPoint(this,e,t)}getHandlePoint(e){switch(e){case"top_left":return new r.B(this.minX,this.minY);case"top_right":return new r.B(this.maxX,this.minY);case"bottom_left":return new r.B(this.minX,this.maxY);case"bottom_right":return new r.B(this.maxX,this.maxY);case"top":return new r.B(this.midX,this.minY);case"right":return new r.B(this.maxX,this.midY);case"bottom":return new r.B(this.midX,this.maxY);case"left":return new r.B(this.minX,this.midY)}}toJson(){return{x:this.minX,y:this.minY,w:this.w,h:this.h}}resize(e,t,n){let{minX:r,minY:i,maxX:o,maxY:a}=this,{minX:l,minY:c,maxX:u,maxY:d}=this;switch(e){case"left":case"top_left":case"bottom_left":l+=t;break;case"right":case"top_right":case"bottom_right":u+=t}switch(e){case"top":case"top_left":case"top_right":c+=n;break;case"bottom":case"bottom_left":case"bottom_right":d+=n}let p=(u-l)/(o-r),h=(d-c)/(a-i);if(p<0){let e=u;u=l,l=e}if(h<0){let e=d;d=c,c=e}this.minX=l,this.minY=c,this.width=Math.abs(u-l),this.height=Math.abs(d-c)}union(e){let t=Math.min(this.minX,e.x),n=Math.min(this.minY,e.y),r=Math.max(this.maxX,e.w+e.x),i=Math.max(this.maxY,e.h+e.y);return this.x=t,this.y=n,this.width=r-t,this.height=i-n,this}static From(e){return new Box(e.x,e.y,e.w,e.h)}static FromCenter(e,t){return new Box(e.x-t.x/2,e.y-t.y/2,t.x,t.y)}static FromPoints(e){let t;if(0===e.length)return new Box;let n=1/0,r=1/0,i=-1/0,o=-1/0;for(let a=0,l=e.length;a<l;a++)n=Math.min((t=e[a]).x,n),r=Math.min(t.y,r),i=Math.max(t.x,i),o=Math.max(t.y,o);return new Box(n,r,i-n,o-r)}static Expand(e,t){let n=Math.min(t.minX,e.minX),r=Math.min(t.minY,e.minY),i=Math.max(t.maxX,e.maxX),o=Math.max(t.maxY,e.maxY);return new Box(n,r,i-n,o-r)}static ExpandBy(e,t){return new Box(e.minX-t,e.minY-t,e.width+2*t,e.height+2*t)}static Collides=(e,t)=>!(e.maxX<t.minX||e.minX>t.maxX||e.maxY<t.minY||e.minY>t.maxY);static Contains=(e,t)=>e.minX<t.minX&&e.minY<t.minY&&e.maxY>t.maxY&&e.maxX>t.maxX;static Includes=(e,t)=>Box.Collides(e,t)||Box.Contains(e,t);static ContainsPoint=(e,t,n=0)=>!(t.x<e.minX-n||t.y<e.minY-n||t.x>e.maxX+n||t.y>e.maxY+n);static Common=e=>{let t=1/0,n=1/0,r=-1/0,i=-1/0;for(let o=0;o<e.length;o++){let a=e[o];t=Math.min(t,a.minX),n=Math.min(n,a.minY),r=Math.max(r,a.maxX),i=Math.max(i,a.maxY)}return new Box(t,n,r-t,i-n)};static Sides=(e,t=0)=>{let{corners:n}=e;return[[n[0],n[1]],[n[1],n[2]],[n[2],n[3]],[n[3],n[0]]]};static Resize(e,t,n,r,i=!1){let{minX:o,minY:a,maxX:l,maxY:c}=e,{minX:u,minY:d,maxX:p,maxY:h}=e;switch(t){case"left":case"top_left":case"bottom_left":u+=n;break;case"right":case"top_right":case"bottom_right":p+=n}switch(t){case"top":case"top_left":case"top_right":d+=r;break;case"bottom":case"bottom_left":case"bottom_right":h+=r}let g=(p-u)/(l-o),f=(h-d)/(c-a);if(i){let e=(l-o)/(c-a),n=Math.abs(p-u),r=Math.abs(h-d),i=n*(f<0?1:-1)*(1/e),m=r*(g<0?1:-1)*e,y=e<n/r;switch(t){case"top_left":y?d=h+i:u=p+m;break;case"top_right":y?d=h+i:p=u-m;break;case"bottom_right":y?h=d-i:p=u-m;break;case"bottom_left":y?h=d-i:u=p+m;break;case"bottom":case"top":{let t=(u+p)/2,n=r*e;u=t-n/2,p=t+n/2;break}case"left":case"right":{let t=(d+h)/2,r=n/e;d=t-r/2,h=t+r/2}}}if(g<0){let e=p;p=u,u=e}if(f<0){let e=h;h=d,d=e}let m=new Box(u,d,Math.abs(p-u),Math.abs(h-d));return{box:m,scaleX:+(m.width/e.width*(g>0?1:-1)).toFixed(5),scaleY:+(m.height/e.height*(f>0?1:-1)).toFixed(5)}}equals(e){return Box.Equals(this,e)}static Equals(e,t){return t.x===e.x&&t.y===e.y&&t.w===e.w&&t.h===e.h}zeroFix(){return this.w=Math.max(1,this.w),this.h=Math.max(1,this.h),this}static ZeroFix(e){return new Box(e.x,e.y,Math.max(1,e.w),Math.max(1,e.h))}};function flipSelectionHandleY(e){switch(e){case"top":return"bottom";case"bottom":return"top";case"top_left":return"bottom_left";case"top_right":return"bottom_right";case"bottom_left":return"top_left";case"bottom_right":return"top_right";default:return e}}function flipSelectionHandleX(e){switch(e){case"left":return"right";case"right":return"left";case"top_left":return"top_right";case"top_right":return"top_left";case"bottom_left":return"bottom_right";case"bottom_right":return"bottom_left";default:return e}}let o=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function rotateSelectionHandle(e,t){t%=i.yo;let n=Math.round(t/(i.PI/4)),r=o.indexOf(e);return o[(r+n)%o.length]}function isSelectionCorner(e){return"top_left"===e||"top_right"===e||"bottom_right"===e||"bottom_left"===e}let a={top_left_rotate:"top_left",top_right_rotate:"top_right",bottom_right_rotate:"bottom_right",bottom_left_rotate:"bottom_left",mobile_rotate:"top_left"}},5404:function(e,t,n){"use strict";n.d(t,{_:function(){return Mat}});var r=n(696),i=n(6166),o=n(4204);let Mat=class Mat{constructor(e,t,n,r,i,o){this.a=e,this.b=t,this.c=n,this.d=r,this.e=i,this.f=o}a=1;b=0;c=0;d=1;e=0;f=0;equals(e){return this.a===e.a&&this.b===e.b&&this.c===e.c&&this.d===e.d&&this.e===e.e&&this.f===e.f}identity(){return this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}multiply(e){let{a:t,b:n,c:r,d:i,e:o,f:a}=this;return this.a=t*e.a+r*e.b,this.c=t*e.c+r*e.d,this.e=t*e.e+r*e.f+o,this.b=n*e.a+i*e.b,this.d=n*e.c+i*e.d,this.f=n*e.e+i*e.f+a,this}rotate(e,t,n){return 0===e?this:void 0===t?this.multiply(Mat.Rotate(e)):this.translate(t,n).multiply(Mat.Rotate(e)).translate(-t,-n)}translate(e,t){return this.multiply(Mat.Translate(e,t))}scale(e,t){return this.multiply(Mat.Scale(e,t))}invert(){let{a:e,b:t,c:n,d:r,e:i,f:o}=this,a=e*r-t*n;return this.a=r/a,this.b=-(t/a),this.c=-(n/a),this.d=e/a,this.e=-((r*i-n*o)/a),this.f=(t*i-e*o)/a,this}applyToPoint(e){return Mat.applyToPoint(this,e)}applyToPoints(e){return Mat.applyToPoints(this,e)}rotation(){return Mat.Rotation(this)}point(){return Mat.Point(this)}decomposed(){return Mat.Decompose(this)}toCssString(){return Mat.toCssString(this)}setTo(e){return Object.assign(this,e),this}decompose(){return Mat.Decompose(this)}clone(){return new Mat(this.a,this.b,this.c,this.d,this.e,this.f)}static Identity(){return new Mat(1,0,0,1,0,0)}static Translate(e,t){return new Mat(1,0,0,1,e,t)}static Rotate(e,t,n){if(0===e)return Mat.Identity();let r=Math.cos(e),i=Math.sin(e),o=new Mat(r,i,-i,r,0,0);return void 0===t?o:Mat.Compose(Mat.Translate(t,n),o,Mat.Translate(-t,-n))}static Scale=(e,t,n,r)=>{let i=new Mat(e,0,0,t,0,0);return void 0===n?i:Mat.Compose(Mat.Translate(n,r),i,Mat.Translate(-n,-r))};static Multiply(e,t){return{a:e.a*t.a+e.c*t.b,c:e.a*t.c+e.c*t.d,e:e.a*t.e+e.c*t.f+e.e,b:e.b*t.a+e.d*t.b,d:e.b*t.c+e.d*t.d,f:e.b*t.e+e.d*t.f+e.f}}static Inverse(e){let t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:-(e.b/t),c:-(e.c/t),d:e.a/t,e:-((e.d*e.e-e.c*e.f)/t),f:(e.b*e.e-e.a*e.f)/t}}static Absolute(e){let t=e.a*e.d-e.b*e.c;return{a:e.d/t,b:-(e.b/t),c:-(e.c/t),d:e.a/t,e:(e.d*e.e-e.c*e.f)/t,f:-((e.b*e.e-e.a*e.f)/t)}}static Compose(...e){let t=Mat.Identity();for(let n=0,r=e.length;n<r;n++)t.multiply(e[n]);return t}static Point(e){return new o.B(e.e,e.f)}static Rotation(e){let t;if(0!==e.a||0!==e.c){let n=Math.hypot(e.a,e.c);t=Math.acos(e.a/n)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){let n=Math.hypot(e.b,e.d);t=i.pj+Math.acos(e.b/n)*(e.d>0?-1:1)}else t=0;return(0,i.Ci)(t)}static Decompose(e){let t,n,r;if(0!==e.a||0!==e.c){let i=Math.hypot(e.a,e.c);t=i,n=(e.a*e.d-e.b*e.c)/i,r=Math.acos(e.a/i)*(e.c>0?-1:1)}else if(0!==e.b||0!==e.d){let o=Math.hypot(e.b,e.d);t=(e.a*e.d-e.b*e.c)/o,n=o,r=i.pj+Math.acos(e.b/o)*(e.d>0?-1:1)}else t=0,n=0,r=0;return{x:e.e,y:e.f,scaleX:t,scaleY:n,rotation:(0,i.Ci)(r)}}static Smooth(e,t=1e10){return e.a=Math.round(e.a*t)/t,e.b=Math.round(e.b*t)/t,e.c=Math.round(e.c*t)/t,e.d=Math.round(e.d*t)/t,e.e=Math.round(e.e*t)/t,e.f=Math.round(e.f*t)/t,e}static toCssString(e){return`matrix(${(0,i.$Z)(e.a)}, ${(0,i.$Z)(e.b)}, ${(0,i.$Z)(e.c)}, ${(0,i.$Z)(e.d)}, ${(0,i.$Z)(e.e)}, ${(0,i.$Z)(e.f)})`}static applyToPoint(e,t){return new o.B(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z)}static applyToXY(e,t,n){return[e.a*t+e.c*n+e.e,e.b*t+e.d*n+e.f]}static applyToPoints(e,t){return t.map(t=>new o.B(e.a*t.x+e.c*t.y+e.e,e.b*t.x+e.d*t.y+e.f,t.z))}static applyToBounds(e,t){return new r.xu(e.e+t.minX,e.f+t.minY,t.width,t.height)}static From(e){return new Mat(e.a,e.b,e.c,e.d,e.e,e.f)}static Cast(e){return e instanceof Mat?e:Mat.From(e)}}},4204:function(e,t,n){"use strict";n.d(t,{B:function(){return Vec}});var r=n(1986);let Vec=class Vec{constructor(e=0,t=0,n=1){this.x=e,this.y=t,this.z=n}get pressure(){return this.z}set(e=this.x,t=this.y,n=this.z){return this.x=e,this.y=t,this.z=n,this}setTo({x:e=0,y:t=0,z:n=1}){return this.x=e,this.y=t,this.z=n,this}rot(e){if(0===e)return this;let{x:t,y:n}=this,r=Math.sin(e),i=Math.cos(e);return this.x=t*i-n*r,this.y=t*r+n*i,this}rotWith(e,t){if(0===t)return this;let n=this.x-e.x,r=this.y-e.y,i=Math.sin(t),o=Math.cos(t);return this.x=e.x+(n*o-r*i),this.y=e.y+(n*i+r*o),this}clone(){let{x:e,y:t,z:n}=this;return new Vec(e,t,n)}sub(e){return this.x-=e.x,this.y-=e.y,this}subXY(e,t){return this.x-=e,this.y-=t,this}subScalar(e){return this.x-=e,this.y-=e,this}add(e){return this.x+=e.x,this.y+=e.y,this}addXY(e,t){return this.x+=e,this.y+=t,this}addScalar(e){return this.x+=e,this.y+=e,this}clamp(e,t){return this.x=Math.max(this.x,e),this.y=Math.max(this.y,e),void 0!==t&&(this.x=Math.min(this.x,t),this.y=Math.min(this.y,t)),this}div(e){return this.x/=e,this.y/=e,this}divV(e){return this.x/=e.x,this.y/=e.y,this}mul(e){return this.x*=e,this.y*=e,this}mulV(e){return this.x*=e.x,this.y*=e.y,this}abs(){return this.x=Math.abs(this.x),this.y=Math.abs(this.y),this}nudge(e,t){let n=Vec.Tan(e,this);return this.add(n.mul(t))}neg(){return this.x*=-1,this.y*=-1,this}cross(e){return this.x=this.y*e.z-this.z*e.y,this.y=this.z*e.x-this.x*e.z,this}dpr(e){return Vec.Dpr(this,e)}cpr(e){return Vec.Cpr(this,e)}len2(){return Vec.Len2(this)}len(){return Vec.Len(this)}pry(e){return Vec.Pry(this,e)}per(){let{x:e,y:t}=this;return this.x=t,this.y=-e,this}uni(){return Vec.Uni(this)}tan(e){return Vec.Tan(this,e)}dist(e){return Vec.Dist(this,e)}distanceToLineSegment(e,t){return Vec.DistanceToLineSegment(e,t,this)}slope(e){return Vec.Slope(this,e)}snapToGrid(e){return this.x=Math.round(this.x/e)*e,this.y=Math.round(this.y/e)*e,this}angle(e){return Vec.Angle(this,e)}toAngle(){return Vec.ToAngle(this)}lrp(e,t){return this.x=this.x+(e.x-this.x)*t,this.y=this.y+(e.y-this.y)*t,this}equals(e){return Vec.Equals(this,e)}equalsXY(e,t){return Vec.EqualsXY(this,e,t)}norm(){let e=this.len();return this.x=0===e?0:this.x/e,this.y=0===e?0:this.y/e,this}toFixed(){return Vec.ToFixed(this)}toString(){return Vec.ToString(Vec.ToFixed(this))}toJson(){return Vec.ToJson(this)}toArray(){return Vec.ToArray(this)}static Add(e,t){return new Vec(e.x+t.x,e.y+t.y)}static AddXY(e,t,n){return new Vec(e.x+t,e.y+n)}static Sub(e,t){return new Vec(e.x-t.x,e.y-t.y)}static SubXY(e,t,n){return new Vec(e.x-t,e.y-n)}static AddScalar(e,t){return new Vec(e.x+t,e.y+t)}static SubScalar(e,t){return new Vec(e.x-t,e.y-t)}static Div(e,t){return new Vec(e.x/t,e.y/t)}static Mul(e,t){return new Vec(e.x*t,e.y*t)}static DivV(e,t){return new Vec(e.x/t.x,e.y/t.y)}static MulV(e,t){return new Vec(e.x*t.x,e.y*t.y)}static Neg(e){return new Vec(-e.x,-e.y)}static Per(e){return new Vec(e.y,-e.x)}static Dist2(e,t){return Vec.Sub(e,t).len2()}static Abs(e){return new Vec(Math.abs(e.x),Math.abs(e.y))}static Dist(e,t){return Math.hypot(e.y-t.y,e.x-t.x)}static Dpr(e,t){return e.x*t.x+e.y*t.y}static Cross(e,t){return new Vec(e.y*t.z-e.z*t.y,e.z*t.x-e.x*t.z)}static Cpr(e,t){return e.x*t.y-t.x*e.y}static Len2(e){return e.x*e.x+e.y*e.y}static Len(e){return Math.hypot(e.x,e.y)}static Pry(e,t){return Vec.Dpr(e,t)/Vec.Len(t)}static Uni(e){return Vec.Div(e,Vec.Len(e))}static Tan(e,t){return Vec.Uni(Vec.Sub(e,t))}static Min(e,t){return new Vec(Math.min(e.x,t.x),Math.min(e.y,t.y))}static Max(e,t){return new Vec(Math.max(e.x,t.x),Math.max(e.y,t.y))}static From({x:e,y:t,z:n=1}){return new Vec(e,t,n)}static FromArray(e){return new Vec(e[0],e[1])}static Rot(e,t=0){let n=Math.sin(t),r=Math.cos(t);return new Vec(e.x*r-e.y*n,e.x*n+e.y*r)}static RotWith(e,t,n){let r=e.x-t.x,i=e.y-t.y,o=Math.sin(n),a=Math.cos(n);return new Vec(t.x+(r*a-i*o),t.y+(r*o+i*a))}static NearestPointOnLineThroughPoint(e,t,n){return Vec.Mul(t,Vec.Sub(n,e).pry(t)).add(e)}static NearestPointOnLineSegment(e,t,n,r=!0){let i=Vec.Tan(t,e),o=Vec.Add(e,Vec.Mul(i,Vec.Sub(n,e).pry(i)));if(r){if(o.x<Math.min(e.x,t.x))return Vec.Cast(e.x<t.x?e:t);if(o.x>Math.max(e.x,t.x))return Vec.Cast(e.x>t.x?e:t);if(o.y<Math.min(e.y,t.y))return Vec.Cast(e.y<t.y?e:t);if(o.y>Math.max(e.y,t.y))return Vec.Cast(e.y>t.y?e:t)}return o}static DistanceToLineThroughPoint(e,t,n){return Vec.Dist(n,Vec.NearestPointOnLineThroughPoint(e,t,n))}static DistanceToLineSegment(e,t,n,r=!0){return Vec.Dist(n,Vec.NearestPointOnLineSegment(e,t,n,r))}static Snap(e,t=1){return new Vec(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}static Cast(e){return e instanceof Vec?e:Vec.From(e)}static Slope(e,t){return e.x===t.y?NaN:(e.y-t.y)/(e.x-t.x)}static IsNaN(e){return isNaN(e.x)||isNaN(e.y)}static Angle(e,t){return Math.atan2(t.y-e.y,t.x-e.x)}static Lrp(e,t,n){return Vec.Sub(t,e).mul(n).add(e)}static Med(e,t){return new Vec((e.x+t.x)/2,(e.y+t.y)/2)}static Equals(e,t){return 1e-4>Math.abs(e.x-t.x)&&1e-4>Math.abs(e.y-t.y)}static EqualsXY(e,t,n){return e.x===t&&e.y===n}static Clockwise(e,t,n){return(n.x-e.x)*(t.y-e.y)-(t.x-e.x)*(n.y-e.y)<0}static Rescale(e,t){let n=Vec.Len(e);return new Vec(t*e.x/n,t*e.y/n)}static ScaleWithOrigin(e,t,n){return Vec.Sub(e,n).mul(t).add(n)}static ToFixed(e,t=2){return new Vec(+e.x.toFixed(t),+e.y.toFixed(t),+e.z.toFixed(t))}static Nudge(e,t,n){return Vec.Add(e,Vec.Tan(t,e).mul(n))}static ToString(e){return`${e.x}, ${e.y}`}static ToAngle(e){let t=Math.atan2(e.y,e.x);return t<0&&(t+=2*Math.PI),t}static FromAngle(e,t=1){return new Vec(Math.cos(e)*t,Math.sin(e)*t)}static ToArray(e){return[e.x,e.y,e.z]}static ToJson(e){let{x:t,y:n,z:r}=e;return{x:t,y:n,z:r}}static Average(e){let t=e.length,n=new Vec(0,0);for(let r=0;r<t;r++)n.add(e[r]);return n.div(t)}static Clamp(e,t,n){return void 0===n?new Vec(Math.min(Math.max(e.x,t)),Math.min(Math.max(e.y,t))):new Vec(Math.min(Math.max(e.x,t),n),Math.min(Math.max(e.y,t),n))}static PointsBetween(e,t,n=6){let i=[];for(let o=0;o<n;o++){let a=r.L.easeInQuad(o/(n-1)),l=Vec.Lrp(e,t,a);l.z=Math.min(1,.5+.65*Math.abs(.5-ease(a))),i.push(l)}return i}static SnapToGrid(e,t=8){return new Vec(Math.round(e.x/t)*t,Math.round(e.y/t)*t)}};let ease=e=>e<.5?2*e*e:-1+(4-2*e)*e},1986:function(e,t,n){"use strict";n.d(t,{L:function(){return r}});let r={linear:e=>e,easeInQuad:e=>e*e,easeOutQuad:e=>e*(2-e),easeInOutQuad:e=>e<.5?2*e*e:-1+(4-2*e)*e,easeInCubic:e=>e*e*e,easeOutCubic:e=>--e*e*e+1,easeInOutCubic:e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,easeInQuart:e=>e*e*e*e,easeOutQuart:e=>1- --e*e*e*e,easeInOutQuart:e=>e<.5?8*e*e*e*e:1-8*--e*e*e*e,easeInQuint:e=>e*e*e*e*e,easeOutQuint:e=>1+--e*e*e*e*e,easeInOutQuint:e=>e<.5?16*e*e*e*e*e:1+16*--e*e*e*e*e,easeInSine:e=>1-Math.cos(e*Math.PI/2),easeOutSine:e=>Math.sin(e*Math.PI/2),easeInOutSine:e=>-(Math.cos(Math.PI*e)-1)/2,easeInExpo:e=>e<=0?0:Math.pow(2,10*e-10),easeOutExpo:e=>e>=1?1:1-Math.pow(2,-10*e),easeInOutExpo:e=>e<=0?0:e>=1?1:e<.5?Math.pow(2,20*e-10)/2:(2-Math.pow(2,-20*e+10))/2}},4137:function(e,t,n){"use strict";n.d(t,{W:function(){return Edge2d}});var r=n(4204),i=n(224),o=n(4519);let Edge2d=class Edge2d extends o.l{start;end;d;u;ul;constructor(e){super({...e,isClosed:!1,isFilled:!1});let{start:t,end:n}=e;this.start=t,this.end=n,this.d=t.clone().sub(n),this.u=this.d.clone().uni(),this.ul=this.u.len()}_length;get length(){return this._length?this._length:this.d.len()}midPoint(){return this.start.lrp(this.end,.5)}getVertices(){return[this.start,this.end]}nearestPoint(e){let{start:t,end:n,u:i,ul:o}=this;if(0===o)return t;let a=r.B.Sub(e,t).dpr(i)/o,l=t.x+i.x*a;if(l<Math.min(t.x,n.x))return t.x<n.x?t:n;if(l>Math.max(t.x,n.x))return t.x>n.x?t:n;let c=t.y+i.y*a;return c<Math.min(t.y,n.y)?t.y<n.y?t:n:c>Math.max(t.y,n.y)?t.y>n.y?t:n:new r.B(l,c)}hitTestLineSegment(e,t,n){return(0,i.cB)(e,t,this.start,this.end)}}},4519:function(e,t,n){"use strict";n.d(t,{l:function(){return Geometry2d}});var r=n(696),i=n(4204),o=n(6166);let Geometry2d=class Geometry2d{isFilled=!1;isClosed=!0;isLabel=!1;debugColor;ignore;constructor(e){this.isFilled=e.isFilled,this.isClosed=e.isClosed,this.isLabel=e.isLabel??!1,this.debugColor=e.debugColor,this.ignore=e.ignore}hitTestPoint(e,t=0,n=!1){return this.distanceToPoint(e,n)<=t}distanceToPoint(e,t=!1){let n=e.dist(this.nearestPoint(e));return this.isClosed&&(this.isFilled||t)&&(0,o.Of)(e,this.vertices)?-n:n}distanceToLineSegment(e,t){let n=this.nearestPointOnLineSegment(e,t),r=i.B.DistanceToLineSegment(e,t,n);return this.isClosed&&this.isFilled&&(0,o.Of)(n,this.vertices)?-r:r}hitTestLineSegment(e,t,n=0){return this.distanceToLineSegment(e,t)<=n}nearestPointOnLineSegment(e,t){let n,r=1/0;for(let o=0;o<this.vertices.length;o++){let a=this.vertices[o],l=i.B.DistanceToLineSegment(e,t,a);l<r&&(r=l,n=a)}if(!n)throw Error("nearest point not found");return n}isPointInBounds(e,t=0){let{bounds:n}=this;return!(e.x<n.minX-t||e.y<n.minY-t||e.x>n.maxX+t||e.y>n.maxY+t)}_vertices;get vertices(){return this._vertices||(this._vertices=this.getVertices()),this._vertices}getBounds(){return r.xu.FromPoints(this.vertices)}_bounds;get bounds(){return this._bounds||(this._bounds=this.getBounds()),this._bounds}get center(){return this.bounds.center}_area;get area(){return this._area||(this._area=this.getArea()),this._area}getArea(){if(!this.isClosed)return 0;let{vertices:e}=this,t=0;for(let n=0,r=e.length;n<r;n++){let i=e[n],o=e[(n+1)%r];t+=i.x*o.y-o.x*i.y}return t/2}toSimpleSvgPath(){let e="",{vertices:t}=this,n=t.length;if(0===n)return e;e+=`M${t[0].x},${t[0].y}`;for(let r=1;r<n;r++)e+=`L${t[r].x},${t[r].y}`;return this.isClosed&&(e+="Z"),e}}},7684:function(e,t,n){"use strict";n.d(t,{m:function(){return Group2d}});var r=n(696),i=n(4519);let Group2d=class Group2d extends i.l{children=[];ignoredChildren=[];constructor(e){for(let t of(super({...e,isClosed:!0,isFilled:!1}),e.children))t.ignore?this.ignoredChildren.push(t):this.children.push(t);if(0===this.children.length)throw Error("Group2d must have at least one child")}getVertices(){return this.children.filter(e=>!e.isLabel).flatMap(e=>e.vertices)}nearestPoint(e){let t,n=1/0,{children:r}=this;if(0===r.length)throw Error("no children");for(let i of r){let r=i.nearestPoint(e),o=r.dist(e);o<n&&(n=o,t=r)}if(!t)throw Error("nearest point not found");return t}distanceToPoint(e,t=!1){return Math.min(...this.children.map((n,r)=>n.distanceToPoint(e,t||r>0)))}hitTestPoint(e,t,n){return!!this.children.filter(e=>!e.isLabel).find(r=>r.hitTestPoint(e,t,n))}hitTestLineSegment(e,t,n){return!!this.children.filter(e=>!e.isLabel).find(r=>r.hitTestLineSegment(e,t,n))}getArea(){return this.children[0].area}toSimpleSvgPath(){let e="";for(let t of this.children)e+=t.toSimpleSvgPath();let t=r.xu.FromPoints(this.vertices).corners;for(let n=0,r=t.length;n<r;n++){let i=t[n],o=t[(n-1+r)%r],a=i.dist(o),l=t[(n+1)%r],c=i.dist(l),u=i.clone().lrp(o,4/a),d=i.clone().lrp(l,4/c);e+=`M${u.x},${u.y} L${i.x},${i.y} L${d.x},${d.y} `}return e}}},2042:function(e,t,n){"use strict";n.d(t,{w:function(){return Polygon2d}});var r=n(6368);let Polygon2d=class Polygon2d extends r.q{constructor(e){super({...e}),this.isClosed=!0}}},6368:function(e,t,n){"use strict";n.d(t,{q:function(){return Polyline2d}});var r=n(4137),i=n(4519);let Polyline2d=class Polyline2d extends i.l{points;constructor(e){super({isClosed:!1,isFilled:!1,...e});let{points:t}=e;this.points=t}_segments;get segments(){if(!this._segments){this._segments=[];let{vertices:e}=this;for(let t=0,n=e.length-1;t<n;t++){let n=e[t],i=e[t+1];this._segments.push(new r.W({start:n,end:i}))}this.isClosed&&this._segments.push(new r.W({start:e[e.length-1],end:e[0]}))}return this._segments}_length;get length(){return this._length||(this._length=this.segments.reduce((e,t)=>e+t.length,0)),this._length}getVertices(){return this.points}nearestPoint(e){let t,n;let{segments:r}=this,i=this.points[0],o=1/0;for(let a=0;a<r.length;a++)(n=(t=r[a].nearestPoint(e)).dist(e))<o&&(i=t,o=n);return i}hitTestLineSegment(e,t,n){return this.segments.some(r=>r.hitTestLineSegment(e,t,n))}}},9234:function(e,t,n){"use strict";n.d(t,{z:function(){return Rectangle2d}});var r=n(696),i=n(4204),o=n(2042);let Rectangle2d=class Rectangle2d extends o.w{x;y;w;h;constructor(e){let{x:t=0,y:n=0,width:r,height:o}=e;super({...e,points:[new i.B(t,n),new i.B(t+r,n),new i.B(t+r,n+o),new i.B(t,n+o)]}),this.x=t,this.y=n,this.w=r,this.h=o}getBounds(){return new r.xu(this.x,this.y,this.w,this.h)}}},224:function(e,t,n){"use strict";n.d(t,{Gc:function(){return intersectLineSegmentPolyline},S3:function(){return intersectPolygonBounds},T9:function(){return intersectLineSegmentLineSegment},UQ:function(){return polygonsIntersect},XS:function(){return intersectCirclePolyline},ZM:function(){return intersectLineSegmentCircle},bO:function(){return intersectCircleCircle},cB:function(){return linesIntersect},h9:function(){return intersectCirclePolygon},qZ:function(){return intersectLineSegmentPolygon},tY:function(){return intersectPolygonPolygon}});var r=n(6166),i=n(4204);function intersectLineSegmentLineSegment(e,t,n,r){let o=e.x-n.x,a=e.y-n.y,l=r.x-n.x,c=r.y-n.y,u=t.x-e.x,d=t.y-e.y,p=l*a-c*o,h=u*a-d*o,g=c*u-l*d;if(0===p||0===h||0===g)return null;if(0!==g){let t=p/g,n=h/g;if(0<=t&&t<=1&&0<=n&&n<=1)return i.B.AddXY(e,t*u,t*d)}return null}function intersectLineSegmentCircle(e,t,n,r){let o=(t.x-e.x)*(t.x-e.x)+(t.y-e.y)*(t.y-e.y),a=2*((t.x-e.x)*(e.x-n.x)+(t.y-e.y)*(e.y-n.y)),l=n.x*n.x+n.y*n.y+e.x*e.x+e.y*e.y-2*(n.x*e.x+n.y*e.y)-r*r,c=a*a-4*o*l;if(c<0||0===c)return null;let u=Math.sqrt(c),d=(-a+u)/(2*o),p=(-a-u)/(2*o);if((d<0||d>1)&&(p<0||p>1))return null;let h=[];return(0<=d&&d<=1&&h.push(i.B.Lrp(e,t,d)),0<=p&&p<=1&&h.push(i.B.Lrp(e,t,p)),0===h.length)?null:h}function intersectLineSegmentPolyline(e,t,n){let r;let i=[];for(let o=0,a=n.length-1;o<a;o++)(r=intersectLineSegmentLineSegment(e,t,n[o],n[o+1]))&&i.push(r);return 0===i.length?null:i}function intersectLineSegmentPolygon(e,t,n){let r;let i=[];for(let o=1,a=n.length;o<a+1;o++)(r=intersectLineSegmentLineSegment(e,t,n[o-1],n[o%n.length]))&&i.push(r);return 0===i.length?null:i}function intersectCircleCircle(e,t,n,r){let o=n.x-e.x,a=n.y-e.y,l=Math.sqrt(o*o+a*a),c=(l*l-r*r+t*t)/(2*l),u=Math.sqrt(t*t-c*c);return o/=l,a/=l,[new i.B(e.x+o*c-a*u,e.y+a*c+o*u),new i.B(e.x+o*c+a*u,e.y+a*c-o*u)]}function intersectCirclePolygon(e,t,n){let r;let i=[];for(let o=0,a=n.length;o<a;o++)(r=intersectLineSegmentCircle(n[o],n[(o+1)%n.length],e,t))&&i.push(...r);return 0===i.length?null:i}function intersectCirclePolyline(e,t,n){let r;let i=[];for(let o=1,a=n.length;o<a;o++)(r=intersectLineSegmentCircle(n[o-1],n[o],e,t))&&i.push(...r);return 0===i.length?null:i}function intersectPolygonBounds(e,t){let n;let r=[];for(let i of t.sides)(n=intersectLineSegmentPolygon(i[0],i[1],e))&&r.push(...n);return 0===r.length?null:r}function ccw(e,t,n){return(n.y-e.y)*(t.x-e.x)>(t.y-e.y)*(n.x-e.x)}function linesIntersect(e,t,n,r){return ccw(e,n,r)!==ccw(t,n,r)&&ccw(e,t,n)!==ccw(e,t,r)}function intersectPolygonPolygon(e,t){let n,i,o,a;let l=new Map;for(let i=0,o=e.length;i<o;i++)if(n=e[i],(0,r.Of)(n,t)){let e=getPointId(n);l.has(e)||l.set(e,n)}for(let i=0,o=t.length;i<o;i++)if(n=t[i],(0,r.Of)(n,e)){let e=getPointId(n);l.has(e)||l.set(e,n)}for(let r=0,c=e.length;r<c;r++){n=e[r],i=e[(r+1)%e.length];for(let e=0,r=t.length;e<r;e++){o=t[e],a=t[(e+1)%t.length];let r=intersectLineSegmentLineSegment(n,i,o,a);if(null!==r){let e=getPointId(r);l.has(e)||l.set(e,r)}}}return 0===l.size?null:orderClockwise([...l.values()])}function getPointId(e){return`${e.x},${e.y}`}function orderClockwise(e){let t=i.B.Average(e);return e.sort((e,n)=>i.B.Angle(t,e)-i.B.Angle(t,n))}function polygonsIntersect(e,t){let n,r;for(let i=0,o=e.length;i<o;i++){n=e[i],r=e[(i+1)%o];for(let e=0,i=t.length;e<i;e++)if(linesIntersect(n,r,t[e],t[(e+1)%i]))return!0}return!1}},6166:function(e,t,n){"use strict";n.d(t,{$Z:function(){return toDomPrecision},AV:function(){return isSafeFloat},C2:function(){return approximately},Ci:function(){return clampRadians},D4:function(){return getArcMeasure},FH:function(){return toFixed},Ht:function(){return degreesToRadians},Oe:function(){return getPolygonVertices},Of:function(){return pointInPolygon},PI:function(){return i},Rp:function(){return perimeterOfEllipse},VK:function(){return clockwiseAngleDist},XD:function(){return getPointOnCircle},Y8:function(){return average},Yk:function(){return precise},Z7:function(){return shortAngleDist},Zd:function(){return toPrecision},_G:function(){return areAnglesCompatible},dv:function(){return l},ep:function(){return rangesOverlap},f5:function(){return canonicalizeRotation},mR:function(){return angleDistance},mW:function(){return rangeIntersection},nD:function(){return snapAngle},pc:function(){return counterClockwiseAngleDist},pj:function(){return o},rW:function(){return getPointInArcT},uZ:function(){return clamp},vi:function(){return radiansToDegrees},yo:function(){return a}});var r=n(4204);function precise(e){return`${toDomPrecision(e.x)},${toDomPrecision(e.y)} `}function average(e,t){return`${toDomPrecision((e.x+t.x)/2)},${toDomPrecision((e.y+t.y)/2)} `}let i=Math.PI,o=i/2,a=2*i,l=Math.sin;function clamp(e,t,n){return Math.max(t,void 0!==n?Math.min(e,n):e)}function toPrecision(e,t=1e10){return e?Math.round(e*t)/t:0}function approximately(e,t,n=1e-6){return Math.abs(e-t)<=n}function perimeterOfEllipse(e,t){let n=Math.pow(e-t,2)/Math.pow(e+t,2);return i*(e+t)*(1+3*n/(10+Math.sqrt(4-3*n)))}function canonicalizeRotation(e){return(e%=a)<0?e+=a:0===e&&(e=0),e}function clockwiseAngleDist(e,t){return(e=canonicalizeRotation(e))>(t=canonicalizeRotation(t))&&(t+=a),t-e}function counterClockwiseAngleDist(e,t){return a-clockwiseAngleDist(e,t)}function shortAngleDist(e,t){let n=(t-e)%a;return 2*n%a-n}function clampRadians(e){return(a+e)%a}function snapAngle(e,t){let n=a/t,r=Math.floor((clampRadians(e)+n/2)/n)*n%a;return r<i&&(r+=a),r>i&&(r-=a),r}function areAnglesCompatible(e,t){return e===t||approximately(e%(Math.PI/2)-t%(Math.PI/2),0)}function degreesToRadians(e){return e*i/180}function radiansToDegrees(e){return 180*e/i}function getPointOnCircle(e,t,n){return new r.B(e.x,e.y).add(r.B.FromAngle(n,t))}function getPolygonVertices(e,t,n){let i=e/2,l=t/2,c=[],u=1/0,d=-1/0,p=1/0,h=-1/0;for(let e=0;e<n;e++){let t=a/n,g=-o+e*t,f=i+i*Math.cos(g),m=l+l*Math.sin(g);f<u&&(u=f),m<p&&(p=m),f>d&&(d=f),m>h&&(h=m),c.push(new r.B(f,m))}let g=d-u,f=h-p;if(0!=e-g||0!=t-f)for(let n=0;n<c.length;n++){let r=c[n];r.x=(r.x-u)/g*e,r.y=(r.y-p)/f*t}return c}function rangesOverlap(e,t,n,r){return e<r&&n<t}function rangeIntersection(e,t,n,r){let i=Math.max(e,n),o=Math.min(t,r);return i<=o?[i,o]:null}function cross(e,t,n){return(t.x-e.x)*(n.y-e.y)-(n.x-e.x)*(t.y-e.y)}function pointInPolygon(e,t){let n,i,o=0;for(let a=0;a<t.length;a++){if((n=t[a]).x===e.x&&n.y===e.y||(i=t[(a+1)%t.length],r.B.Dist(e,n)+r.B.Dist(e,i)===r.B.Dist(n,i)))return!0;n.y<=e.y?i.y>e.y&&cross(n,i,e)>0&&(o+=1):i.y<=e.y&&0>cross(n,i,e)&&(o-=1)}return 0!==o}function toDomPrecision(e){return+e.toFixed(4)}function toFixed(e){return+e.toFixed(2)}let isSafeFloat=e=>Math.abs(e)<Number.MAX_SAFE_INTEGER;function angleDistance(e,t,n){let r=n<0?clockwiseAngleDist(e,t):counterClockwiseAngleDist(e,t);return r}function getPointInArcT(e,t,n,r){let o;if(Math.abs(e)>i){o=shortAngleDist(t,r);let i=shortAngleDist(r,n);return Math.abs(o)<Math.abs(i)?o/e:(e-i)/e}{o=shortAngleDist(t,r);let n=o/e;return Math.sign(o)!==Math.sign(e)?Math.abs(n)>.5?1:0:n}}function getArcMeasure(e,t,n,r){let i=2*((t-e)%a)%a-(t-e)%a;return r?(a-Math.abs(i))*(n?1:-1):i}},7539:function(e,t,n){"use strict";n.d(t,{_:function(){return ReadonlySharedStyleMap},o:function(){return SharedStyleMap}});var r=n(3112);function sharedStyleEquals(e,t){if(!t)return!1;switch(e.type){case"mixed":return"mixed"===t.type;case"shared":return"shared"===t.type&&e.value===t.value;default:throw(0,r.iP)(e)}}let ReadonlySharedStyleMap=class ReadonlySharedStyleMap{map;constructor(e){this.map=new Map(e)}get(e){return this.map.get(e)}getAsKnownValue(e){let t=this.get(e);if(t&&"mixed"!==t.type)return t.value}get size(){return this.map.size}equals(e){if(this.size!==e.size)return!1;let t=new Set;for(let[n,r]of this){if(!sharedStyleEquals(r,e.get(n)))return!1;t.add(n)}for(let[n,r]of e)if(!t.has(n)&&!sharedStyleEquals(r,this.get(n)))return!1;return!0}keys(){return this.map.keys()}values(){return this.map.values()}entries(){return this.map.entries()}[Symbol.iterator](){return this.map[Symbol.iterator]()}};let SharedStyleMap=class SharedStyleMap extends ReadonlySharedStyleMap{set(e,t){this.map.set(e,t)}applyValue(e,t){let n=this.get(e);if(!n){this.set(e,{type:"shared",value:t});return}switch(n.type){case"mixed":return;case"shared":n.value!==t&&this.set(e,{type:"mixed"});return;default:(0,r.iP)(n,"type")}}}},1230:function(e,t,n){"use strict";n.d(t,{_:function(){return WeakMapCache}});let WeakMapCache=class WeakMapCache{items=new WeakMap;get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}access(e){return this.items.get(e)}set(e,t){this.items.set(e,t)}has(e){return this.items.has(e)}invalidate(e){this.items.delete(e)}bust(){this.items=new WeakMap}}},5279:function(e,t,n){"use strict";function dataUrlToFile(e,t,n){return fetch(e).then(function(e){return e.arrayBuffer()}).then(function(e){return new File([e],t,{type:n})})}n.d(t,{B:function(){return dataUrlToFile}})},1605:function(e,t,n){"use strict";function getIncrementedName(e,t){let n=e,r=new Set(t);for(;r.has(n);)n=/^.*(\d+)$/.exec(n)?.[1]?n.replace(/(\d+)(?=\D?)$/,e=>(+e+1).toString()):`${n} 1`;return n}n.d(t,{u:function(){return getIncrementedName}})},853:function(e,t,n){"use strict";n.d(t,{B:function(){return getReorderingShapesChanges}});var r=n(3112);function getReorderingShapesChanges(e,t,n){if(0===n.length)return[];let i=new Map;for(let t of(0,r.oA)(n.map(t=>e.getShape(t)))){let{parentId:n}=t;i.has(n)||i.set(n,{children:(0,r.oA)(e.getSortedChildIdsForParent(n).map(t=>e.getShape(t))),moving:new Set}),i.get(n).moving.add(t)}let o=[];switch(t){case"toBack":i.forEach(({moving:e,children:t})=>reorderToBack(e,t,o));break;case"toFront":i.forEach(({moving:e,children:t})=>reorderToFront(e,t,o));break;case"forward":i.forEach(({moving:e,children:t})=>reorderForward(e,t,o));break;case"backward":i.forEach(({moving:e,children:t})=>reorderBackward(e,t,o))}return o}function reorderToBack(e,t,n){let i,o;let a=t.length;if(e.size!==a){for(let n=0;n<a;n++){let r=t[n];if(e.has(r))i=r.index,e.delete(r);else{o=r.index;break}}if(0===e.size)return;{let t=(0,r.Xv)(i,o,e.size);n.push(...Array.from(e.values()).sort(r.hl).map((e,n)=>({...e,index:t[n]})))}}}function reorderToFront(e,t,n){let i,o;let a=t.length;if(e.size!==a){for(let n=a-1;n>-1;n--){let r=t[n];if(e.has(r))o=r.index,e.delete(r);else{i=r.index;break}}if(0===e.size)return;{let t=(0,r.Xv)(i,o,e.size);n.push(...Array.from(e.values()).sort(r.hl).map((e,n)=>({...e,index:t[n]})))}}}function reorderForward(e,t,n){let i=t.length;if(e.size===i)return;let o={name:"skipping"};for(let a=0;a<i;a++){let i=e.has(t[a]);switch(o.name){case"skipping":if(!i)continue;o={name:"selecting",selectIndex:a};break;case"selecting":{if(i)continue;let{selectIndex:e}=o;(0,r.Xv)(t[a].index,t[a+1]?.index,a-e).forEach((r,i)=>n.push({...t[e+i],index:r})),o={name:"skipping"}}}}}function reorderBackward(e,t,n){let i=t.length;if(e.size===i)return;let o={name:"skipping"};for(let a=i-1;a>-1;a--){let i=e.has(t[a]);switch(o.name){case"skipping":if(!i)continue;o={name:"selecting",selectIndex:a};break;case"selecting":if(i)continue;(0,r.Xv)(t[a-1]?.index,t[a].index,o.selectIndex-a).forEach((e,r)=>{n.push({...t[a+r+1],index:e})}),o={name:"skipping"}}}}},7556:function(e,t,n){"use strict";n.d(t,{Z:function(){return applyRotationToSnapshotShapes},o:function(){return getRotationSnapshot}});var r=n(6934),i=n(3112),o=n(5404),a=n(6166),l=n(4204);function getRotationSnapshot({editor:e}){let t=e.getSelectedShapes(),n=e.getSelectionRotation(),r=e.getSelectionRotatedPageBounds(),{inputs:{originPagePoint:o}}=e;if(!r)return null;let a=r.center.clone().rotWith(r.point,n);return{selectionPageCenter:a,initialCursorAngle:a.angle(o),initialSelectionRotation:n,shapeSnapshots:t.map(t=>({shape:(0,i.v4)(t),initialPagePoint:e.getShapePageTransform(t.id).point()}))}}function applyRotationToSnapshotShapes({delta:e,editor:t,snapshot:n,stage:i}){let{selectionPageCenter:c,shapeSnapshots:u}=n;t.updateShapes(u.map(({shape:n,initialPagePoint:i})=>{let u=(0,r.YT)(n.parentId)?t.getShapePageTransform(n.parentId):o._.Identity(),d=l.B.RotWith(i,c,e),p=o._.applyToPoint(o._.Inverse(u),d),h=(0,a.f5)(n.rotation+e);return{id:n.id,type:n.type,x:p.x,y:p.y,rotation:h}}));let d=[];u.forEach(({shape:e})=>{let n=t.getShape(e.id);if(!n)return;let r=t.getShapeUtil(e);if("start"===i||"one-off"===i){let t=r.onRotateStart?.(e);t&&d.push(t)}let o=r.onRotate?.(e,n);if(o&&d.push(o),"end"===i||"one-off"===i){let t=r.onRotateEnd?.(e,n);t&&d.push(t)}}),d.length>0&&t.updateShapes(d)}},1034:function(e,t,n){"use strict";n.d(t,{E:function(){return uniqueId}});let nanoid=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((e,t)=>((t&=63)<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");function uniqueId(){return nanoid()}},9502:function(e,t,n){"use strict";function isChild(e){return e&&"object"==typeof e&&"parents"in e}function haveParentsChanged(e){for(let t=0,n=e.parents.length;t<n;t++)if(e.parents[t].__unsafe__getWithoutCapture(!0),e.parents[t].lastChangedEpoch!==e.parentEpochs[t])return!0;return!1}n.d(t,{LZ:function(){return r},R0:function(){return a},SB:function(){return i},cn:function(){return Atom_atom},Fl:function(){return computed},e1:function(){return isUninitialized},Ym:function(){return react},zH:function(){return reactor},j:function(){return track},ay:function(){return transact},PS:function(){return transaction},vc:function(){return useComputed},BK:function(){return useQuickReactor},vC:function(){return useReactor},uC:function(){return useStateTracking},Hg:function(){return useValue},iJ:function(){return whyAmIRunning},qo:function(){return withDiff}});let detach=(e,t)=>{if(e.children.remove(t)&&e.children.isEmpty&&isChild(e))for(let t=0,n=e.parents.length;t<n;t++)detach(e.parents[t],e)},attach=(e,t)=>{if(e.children.add(t)&&isChild(e))for(let t=0,n=e.parents.length;t<n;t++)attach(e.parents[t],e)};function equals(e,t){let n=e===t||Object.is(e,t)||!!(e&&t&&"function"==typeof e.equals&&e.equals(t));return n}function singleton(e,t){let n=Symbol.for(`com.tldraw.state/${e}`),r=globalThis;return r[n]??=t(),r[n]}let r=singleton("empty_array",()=>Object.freeze([]));let ArraySet=class ArraySet{arraySize=0;array=Array(8);set=null;get isEmpty(){if(this.array)return 0===this.arraySize;if(this.set)return 0===this.set.size;throw Error("no set or array")}add(e){if(this.array){let t=this.array.indexOf(e);return -1===t&&(this.arraySize<8?(this.array[this.arraySize]=e,this.arraySize++):(this.set=new Set(this.array),this.array=null,this.set.add(e)),!0)}if(this.set)return!this.set.has(e)&&(this.set.add(e),!0);throw Error("no set or array")}remove(e){if(this.array){let t=this.array.indexOf(e);return -1!==t&&(this.array[t]=void 0,this.arraySize--,t!==this.arraySize&&(this.array[t]=this.array[this.arraySize],this.array[this.arraySize]=void 0),!0)}if(this.set)return!!this.set.has(e)&&(this.set.delete(e),!0);throw Error("no set or array")}visit(e){if(this.array){for(let t=0;t<this.arraySize;t++){let n=this.array[t];void 0!==n&&e(n)}return}if(this.set){this.set.forEach(e);return}throw Error("no set or array")}};let i=Symbol.for("com.tldraw.state/RESET_VALUE");let HistoryBuffer=class HistoryBuffer{constructor(e){this.capacity=e,this.buffer=Array(e)}index=0;buffer;pushEntry(e,t,n){if(void 0!==n){if(n===i){this.clear();return}this.buffer[this.index]=[e,t,n],this.index=(this.index+1)%this.capacity}}clear(){this.index=0,this.buffer.fill(void 0)}getChangesSince(e){let{index:t,capacity:n,buffer:r}=this;for(let i=0;i<n;i++){let o=(t-1+n-i)%n,a=r[o];if(!a)break;let[l,c]=a;if(0===i&&e>=c)return[];if(l<=e&&e<c){let e=i+1,t=Array(e);for(let i=0;i<e;i++)t[i]=r[(o+i)%n][2];return t}}return i}};let CaptureStackFrame=class CaptureStackFrame{constructor(e,t){this.below=e,this.child=t}offset=0;numNewParents=0;maybeRemoved};let o=singleton("capture",()=>({stack:null}));function startCapturingParents(e){o.stack=new CaptureStackFrame(o.stack,e)}function stopCapturingParents(){let e=o.stack;o.stack=e.below;let t=e.numNewParents>0||e.offset!==e.child.parents.length;if(t){for(let t=e.offset;t<e.child.parents.length;t++){let n=e.child.parents[t],r=e.child.parents.indexOf(n)>=e.offset;r&&detach(n,e.child)}if(e.child.parents.length=e.offset,e.child.parentEpochs.length=e.offset,o.stack?.maybeRemoved)for(let t=0;t<o.stack.maybeRemoved.length;t++){let n=o.stack.maybeRemoved[t];-1===e.child.parents.indexOf(n)&&detach(n,e.child)}}}function maybeCaptureParent(e){if(o.stack){let t=o.stack.child.parents.indexOf(e);if(t<0&&(o.stack.numNewParents++,o.stack.child.isActivelyListening&&attach(e,o.stack.child)),t<0||t>=o.stack.offset){if(t!==o.stack.offset&&t>0){let e=o.stack.child.parents[o.stack.offset];o.stack.maybeRemoved?-1===o.stack.maybeRemoved.indexOf(e)&&o.stack.maybeRemoved.push(e):o.stack.maybeRemoved=[e]}o.stack.child.parents[o.stack.offset]=e,o.stack.child.parentEpochs[o.stack.offset]=e.lastChangedEpoch,o.stack.offset++}}}function whyAmIRunning(){let e=o.stack?.child;if(!e)throw Error("whyAmIRunning() called outside of a reactive context");let t=[];for(let n=0;n<e.parents.length;n++){let r=e.parents[n];r.lastChangedEpoch>e.parentEpochs[n]&&t.push(r)}if(0===t.length)console.log(e.name,"is running but none of the parents changed");else for(let n of(console.log(e.name,"is running because:"),t))console.log("	",n.name,"changed =>",n.__unsafe__getWithoutCapture(!0))}let __EffectScheduler__=class __EffectScheduler__{constructor(e,t,n){this.name=e,this.runEffect=t,this._scheduleEffect=n?.scheduleEffect}_isActivelyListening=!1;get isActivelyListening(){return this._isActivelyListening}lastTraversedEpoch=-1;lastReactedEpoch=-1;_scheduleCount=0;get scheduleCount(){return this._scheduleCount}parentEpochs=[];parents=[];_scheduleEffect;maybeScheduleEffect(){if(this._isActivelyListening&&this.lastReactedEpoch!==getGlobalEpoch()){if(this.parents.length&&!haveParentsChanged(this)){this.lastReactedEpoch=getGlobalEpoch();return}this.scheduleEffect()}}scheduleEffect(){this._scheduleCount++,this._scheduleEffect?this._scheduleEffect(this.maybeExecute):this.execute()}maybeExecute=()=>{this._isActivelyListening&&this.execute()};attach(){this._isActivelyListening=!0;for(let e=0,t=this.parents.length;e<t;e++)attach(this.parents[e],this)}detach(){this._isActivelyListening=!1;for(let e=0,t=this.parents.length;e<t;e++)detach(this.parents[e],this)}execute(){try{startCapturingParents(this);let e=this.runEffect(this.lastReactedEpoch);return this.lastReactedEpoch=getGlobalEpoch(),e}finally{stopCapturingParents()}}};let a=singleton("EffectScheduler",()=>__EffectScheduler__);function react(e,t,n){let r=new a(e,t,n);return r.attach(),r.scheduleEffect(),()=>{r.detach()}}function reactor(e,t,n){let r=new a(e,t,n);return{scheduler:r,start:e=>{let t=e?.force??!1;r.attach(),t?r.scheduleEffect():r.maybeScheduleEffect()},stop:()=>{r.detach()}}}let Transaction=class Transaction{constructor(e){this.parent=e}initialAtomValues=new Map;get isRoot(){return null===this.parent}commit(){if(this.isRoot){let e=this.initialAtomValues;this.initialAtomValues=new Map,flushChanges(e.keys())}else this.initialAtomValues.forEach((e,t)=>{this.parent.initialAtomValues.has(t)||this.parent.initialAtomValues.set(t,e)})}abort(){l.globalEpoch++,this.initialAtomValues.forEach((e,t)=>{t.set(e),t.historyBuffer?.clear()}),this.commit()}};let l=singleton("transactions",()=>({globalEpoch:0,globalIsReacting:!1,currentTransaction:null}));function getGlobalEpoch(){return l.globalEpoch}function flushChanges(e){if(l.globalIsReacting)throw Error("cannot change atoms during reaction cycle");try{l.globalIsReacting=!0;let t=new Set,traverse=e=>{e.lastTraversedEpoch!==l.globalEpoch&&(e.lastTraversedEpoch=l.globalEpoch,e instanceof a?t.add(e):e.children.visit(traverse))};for(let t of e)t.children.visit(traverse);for(let e of t)e.maybeScheduleEffect()}finally{l.globalIsReacting=!1}}function atomDidChange(e,t){l.currentTransaction?l.currentTransaction.initialAtomValues.has(e)||l.currentTransaction.initialAtomValues.set(e,t):flushChanges([e])}function advanceGlobalEpoch(){l.globalEpoch++}function transaction(e){let t=new Transaction(l.currentTransaction);l.currentTransaction=t;try{let n=!1,r=e(()=>n=!0);return n?t.abort():t.commit(),r}catch(e){throw t.abort(),e}finally{l.currentTransaction=l.currentTransaction.parent}}function transact(e){return l.currentTransaction?e():transaction(e)}let __Atom__=class __Atom__{constructor(e,t,n){if(this.name=e,this.current=t,this.isEqual=n?.isEqual??null,!n)return;n.historyLength&&(this.historyBuffer=new HistoryBuffer(n.historyLength)),this.computeDiff=n.computeDiff}isEqual;computeDiff;lastChangedEpoch=getGlobalEpoch();children=new ArraySet;historyBuffer;__unsafe__getWithoutCapture(e){return this.current}get(){return maybeCaptureParent(this),this.current}set(e,t){if(this.isEqual?.(this.current,e)??equals(this.current,e))return this.current;advanceGlobalEpoch(),this.historyBuffer&&this.historyBuffer.pushEntry(this.lastChangedEpoch,getGlobalEpoch(),t??this.computeDiff?.(this.current,e,this.lastChangedEpoch,getGlobalEpoch())??i),this.lastChangedEpoch=getGlobalEpoch();let n=this.current;return this.current=e,atomDidChange(this,n),e}update(e){return this.set(e(this.current))}getDiffSince(e){return(maybeCaptureParent(this),e>=this.lastChangedEpoch)?r:this.historyBuffer?.getChangesSince(e)??i}};let c=singleton("Atom",()=>__Atom__);function Atom_atom(e,t,n){return new c(e,t,n)}let u=!1;function logComputedGetterWarning(){u||(u=!0,console.warn(`Using \`@computed\` as a decorator for getters is deprecated and will be removed in the near future. Please refactor to use \`@computed\` as a decorator for methods.

// Before
@computed
get foo() {
	return 'foo'
}

// After
@computed
getFoo() {
	return 'foo'
}
`))}let d=Symbol.for("com.tldraw.state/UNINITIALIZED"),isUninitialized=e=>e===d,p=singleton("WithDiff",()=>class{constructor(e,t){this.value=e,this.diff=t}});function withDiff(e,t){return new p(e,t)}let __UNSAFE__Computed=class __UNSAFE__Computed{constructor(e,t,n){this.name=e,this.derive=t,n?.historyLength&&(this.historyBuffer=new HistoryBuffer(n.historyLength)),this.computeDiff=n?.computeDiff,this.isEqual=n?.isEqual??equals}lastChangedEpoch=-1;lastTraversedEpoch=-1;lastCheckedEpoch=-1;parents=[];parentEpochs=[];children=new ArraySet;get isActivelyListening(){return!this.children.isEmpty}historyBuffer;state=d;error=null;computeDiff;isEqual;__unsafe__getWithoutCapture(e){let t=-1===this.lastChangedEpoch;if(!t&&(this.lastCheckedEpoch===getGlobalEpoch()||!haveParentsChanged(this))){if(this.lastCheckedEpoch=getGlobalEpoch(),!this.error||e)return this.state;throw this.error.thrownValue}try{startCapturingParents(this);let e=this.derive(this.state,this.lastCheckedEpoch),t=e instanceof p?e.value:e,n=this.state===d;if(n||!this.isEqual(t,this.state)){if(this.historyBuffer&&!n){let n=e instanceof p?e.diff:void 0;this.historyBuffer.pushEntry(this.lastChangedEpoch,getGlobalEpoch(),n??this.computeDiff?.(this.state,t,this.lastCheckedEpoch,getGlobalEpoch())??i)}this.lastChangedEpoch=getGlobalEpoch(),this.state=t}return this.error=null,this.lastCheckedEpoch=getGlobalEpoch(),this.state}catch(t){if(this.state!==d&&(this.state=d,this.lastChangedEpoch=getGlobalEpoch()),this.lastCheckedEpoch=getGlobalEpoch(),this.historyBuffer&&this.historyBuffer.clear(),this.error={thrownValue:t},!e)throw t;return this.state}finally{stopCapturingParents()}}get(){try{return this.__unsafe__getWithoutCapture()}finally{maybeCaptureParent(this)}}getDiffSince(e){return(this.__unsafe__getWithoutCapture(!0),maybeCaptureParent(this),e>=this.lastChangedEpoch)?r:this.historyBuffer?.getChangesSince(e)??i}};let h=singleton("Computed",()=>__UNSAFE__Computed);function computedMethodAnnotation(e={},t,n,r){let i=r.value,o=Symbol.for("__@tldraw/state__computed__"+n);return r.value=function(){let t=this[o];return t||Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:t=new h(n,i.bind(this),e)}),t.get()},r.value[g]=!0,r}function computedAnnotation(e={},t,n,r){return r.get?(logComputedGetterWarning(),computedGetterAnnotation(e,t,n,r)):computedMethodAnnotation(e,t,n,r)}function computedGetterAnnotation(e={},t,n,r){let i=r.get,o=Symbol.for("__@tldraw/state__computed__"+n);return r.get=function(){let t=this[o];return t||Object.defineProperty(this,o,{enumerable:!1,configurable:!1,writable:!1,value:t=new h(n,i.bind(this),e)}),t.get()},r}let g="@@__isComputedMethod__@@";function computed(){if(1==arguments.length){let e=arguments[0];return(t,n,r)=>computedAnnotation(e,t,n,r)}return"string"==typeof arguments[0]?new h(arguments[0],arguments[1],arguments[2]):computedAnnotation(void 0,arguments[0],arguments[1],arguments[2])}let f=singleton("apiVersion",()=>1);if(1!==f)throw Error("You have multiple incompatible versions of @tldraw/state in your app. Please deduplicate the package.");var m=n(2265);function useStateTracking(e,t){let n=m.useRef(t);n.current=t;let[r,i,o]=m.useMemo(()=>{let t=null,r=new a(`useStateTracking(${e})`,()=>n.current?.(),{scheduleEffect(){t?.()}});return[r,e=>(t=e,()=>{t=null}),()=>r.scheduleCount]},[e]);return m.useSyncExternalStore(i,o,o),m.useEffect(()=>(r.attach(),r.maybeScheduleEffect(),()=>{r.detach()}),[r]),r.execute()}let y={apply:(e,t,n)=>useStateTracking(e.displayName??e.name??"tracked(???)",()=>e.apply(t,n))},b=Symbol.for("react.memo"),w=Symbol.for("react.forward_ref");function track(e){let t=null,n=e.$$typeof;return(n===b&&(t=(e=e.type).compare),n===w)?(0,m.memo)((0,m.forwardRef)(new Proxy(e.render,y))):(0,m.memo)(new Proxy(e,y),t)}function useComputed(){let e=arguments[0],t=arguments[1],n=3==arguments.length?void 0:arguments[2],r=3==arguments.length?arguments[2]:arguments[3];return(0,m.useMemo)(()=>computed(`useComputed(${e})`,t,n),r)}function useQuickReactor(e,t,n=r){(0,m.useEffect)(()=>{let n=new a(e,t);return n.attach(),n.execute(),()=>{n.detach()}},n)}function useReactor(e,t,n=[]){let r=(0,m.useMemo)(()=>new a(e,t,{scheduleEffect:e=>requestAnimationFrame(e)}),n);(0,m.useEffect)(()=>(r.attach(),r.execute(),()=>{r.detach()}),[r])}function useValue(){let e=arguments,t=3===e.length?e[2]:[e[0]],n=3===e.length?e[0]:`useValue(${e[0].name})`,r=(0,m.useRef)(!0);r.current=!0;let i=(0,m.useMemo)(()=>1===e.length?e[0]:computed(n,()=>{if(r.current)return e[1]();try{return e[1]()}catch{return{}}}),t);try{let{subscribe:e,getSnapshot:t}=(0,m.useMemo)(()=>({subscribe:e=>react(`useValue(${n})`,()=>{i.get(),e()}),getSnapshot:()=>i.get()}),[i]);return(0,m.useSyncExternalStore)(e,t,t)}finally{r.current=!1}}},932:function(e,t,n){"use strict";n.d(t,{mW:function(){return IncrementalSetConstructor},qx:function(){return l},oX:function(){return RecordType},yh:function(){return Store},sS:function(){return StoreSchema},lS:function(){return assertIdType},ix:function(){return compareRecordVersions},$F:function(){return compareSchemas},ju:function(){return createRecordType},zn:function(){return defineMigrations},ZV:function(){return devFreeze},C$:function(){return getRecordVersion},Te:function(){return migrate},wJ:function(){return migrateRecord},kJ:function(){return reverseRecordsDiff},bs:function(){return squashRecordDiffs}});let IncrementalSetConstructor=class IncrementalSetConstructor{constructor(e){this.previousValue=e}nextValue;diff;get(){let e=this.diff?.removed?.size??0,t=this.diff?.added?.size??0;if(0!==e||0!==t)return{value:this.nextValue,diff:this.diff}}_add(e,t){this.nextValue??=new Set(this.previousValue),this.nextValue.add(e),this.diff??={},t?this.diff.removed?.delete(e):(this.diff.added??=new Set,this.diff.added.add(e))}add(e){let t=this.previousValue.has(e);if(t){let n=this.diff?.removed?.has(e);if(!n)return;return this._add(e,t)}let n=this.nextValue?.has(e);n||this._add(e,t)}_remove(e,t){this.nextValue??=new Set(this.previousValue),this.nextValue.delete(e),this.diff??={},t?(this.diff.removed??=new Set,this.diff.removed.add(e)):this.diff.added?.delete(e)}remove(e){let t=this.previousValue.has(e);if(!t){let n=this.diff?.added?.has(e);if(!n)return;return this._remove(e,t)}let n=this.diff?.removed?.has(e);n||this._remove(e,t)}};var r,i=n(3112);let nanoid=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((e,t)=>((t&=63)<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");let RecordType=class RecordType{constructor(e,t){this.typeName=e,this.createDefaultProperties=t.createDefaultProperties,this.migrations=t.migrations,this.validator=t.validator??{validate:e=>e},this.scope=t.scope??"document"}createDefaultProperties;migrations;validator;scope;create(e){let t={...this.createDefaultProperties(),id:this.createId()};for(let[n,r]of Object.entries(e))void 0!==r&&(t[n]=r);return t.typeName=this.typeName,t}clone(e){return{...(0,i.v4)(e),id:this.createId()}}createId(e){return this.typeName+":"+(e??nanoid())}createCustomId(e){return this.typeName+":"+e}parseId(e){if(!this.isId(e))throw Error(`ID "${e}" is not a valid ID for type "${this.typeName}"`);return e.slice(this.typeName.length+1)}isInstance=e=>e?.typeName===this.typeName;isId(e){if(!e)return!1;for(let t=0;t<this.typeName.length;t++)if(e[t]!==this.typeName[t])return!1;return":"===e[this.typeName.length]}withDefaultProperties(e){return new RecordType(this.typeName,{createDefaultProperties:e,migrations:this.migrations,validator:this.validator,scope:this.scope})}validate(e,t){return t&&this.validator.validateUsingKnownGoodVersion?this.validator.validateUsingKnownGoodVersion(t,e):this.validator.validate(e)}};function createRecordType(e,t){return new RecordType(e,{createDefaultProperties:()=>({}),migrations:t.migrations??{currentVersion:0,firstVersion:0,migrators:{}},validator:t.validator,scope:t.scope})}function assertIdType(e,t){if(!e||!t.isId(e))throw Error(`string ${JSON.stringify(e)} is not a valid ${t.typeName} id`)}var o=n(9502);let Cache=class Cache{items=new WeakMap;get(e,t){return this.items.has(e)||this.items.set(e,t(e)),this.items.get(e)}};var a=n(9780);function intersectSets(e){if(0===e.length)return new Set;let t=e[0],n=e.slice(1),r=new Set;for(let e of t)n.every(t=>t.has(e))&&r.add(e);return r}function diffSets(e,t){let n={};for(let r of t)e.has(r)||(n.added??=new Set,n.added.add(r));for(let r of e)t.has(r)||(n.removed??=new Set,n.removed.add(r));return n.added||n.removed?n:void 0}function objectMatchesQuery(e,t){for(let[n,r]of Object.entries(e)){let e=t[n];if("eq"in r&&e!==r.eq||"neq"in r&&e===r.neq||"gt"in r&&("number"!=typeof e||e<=r.gt))return!1}return!0}function executeQuery(e,t,n){let r=Object.fromEntries(Object.keys(n).map(e=>[e,new Set]));for(let[i,o]of Object.entries(n))if("eq"in o){let n=e.index(t,i),a=n.get().get(o.eq);if(a)for(let e of a)r[i].add(e)}else if("neq"in o){let n=e.index(t,i);for(let[e,t]of n.get())if(e!==o.neq)for(let e of t)r[i].add(e)}else if("gt"in o){let n=e.index(t,i);for(let[e,t]of n.get())if(e>o.gt)for(let e of t)r[i].add(e)}return intersectSets(Object.values(r))}let StoreQueries=class StoreQueries{constructor(e,t){this.atoms=e,this.history=t}indexCache=new Map;historyCache=new Map;filterHistory(e){if(this.historyCache.has(e))return this.historyCache.get(e);let t=(0,o.Fl)("filterHistory:"+e,(t,n)=>{if((0,o.e1)(t))return this.history.get();let r=this.history.getDiffSince(n);if(r===o.SB)return this.history.get();let a={added:{},removed:{},updated:{}},l=0,c=0,u=0;for(let t of r){for(let n of(0,i.UM)(t.added))if(n.typeName===e){if(a.removed[n.id]){let e=a.removed[n.id];delete a.removed[n.id],c--,e!==n&&(a.updated[n.id]=[e,n],u++)}else a.added[n.id]=n,l++}for(let[n,r]of(0,i.UM)(t.updated))r.typeName===e&&(a.added[r.id]?a.added[r.id]=r:a.updated[r.id]?a.updated[r.id]=[a.updated[r.id][0],r]:(a.updated[r.id]=[n,r],u++));for(let n of(0,i.UM)(t.removed))n.typeName===e&&(a.added[n.id]?(delete a.added[n.id],l--):(a.updated[n.id]?(a.removed[n.id]=a.updated[n.id][0],delete a.updated[n.id],u--):a.removed[n.id]=n,c++))}return l||c||u?(0,o.qo)(this.history.get(),a):t},{historyLength:100});return this.historyCache.set(e,t),t}index(e,t){let n=e+":"+t;if(this.indexCache.has(n))return this.indexCache.get(n);let r=this.__uncached_createIndex(e,t);return this.indexCache.set(n,r),r}__uncached_createIndex(e,t){let n=this.filterHistory(e),fromScratch=()=>{n.get();let r=new Map;for(let n of(0,i.UM)(this.atoms.get())){let i=n.get();if(i.typeName===e){let e=i[t];r.has(e)||r.set(e,new Set),r.get(e).add(i.id)}}return r};return(0,o.Fl)("index:"+e+":"+t,(r,a)=>{let l,c;if((0,o.e1)(r))return fromScratch();let u=n.getDiffSince(a);if(u===o.SB)return fromScratch();let d=new Map,add=(e,t)=>{let n=d.get(e);n||(n=new IncrementalSetConstructor(r.get(e)??new Set)),n.add(t),d.set(e,n)},remove=(e,t)=>{let n=d.get(e);n||(n=new IncrementalSetConstructor(r.get(e)??new Set)),n.remove(t),d.set(e,n)};for(let n of u){for(let r of(0,i.UM)(n.added))if(r.typeName===e){let e=r[t];add(e,r.id)}for(let[r,o]of(0,i.UM)(n.updated))if(o.typeName===e){let e=r[t],n=o[t];e!==n&&(remove(e,o.id),add(n,o.id))}for(let r of(0,i.UM)(n.removed))if(r.typeName===e){let e=r[t];remove(e,r.id)}}for(let[e,t]of d){let n=t.get();n&&(l||(l=new Map(r)),c||(c=new Map),0===n.value.size?l.delete(e):l.set(e,n.value),c.set(e,n.diff))}return l&&c?(0,o.qo)(l,c):r},{historyLength:100})}record(e,t=()=>({}),n="record:"+e+(t?":"+t.toString():"")){let r=this.ids(e,t,n);return(0,o.Fl)(n,()=>{for(let e of r.get())return this.atoms.get()[e]?.get()})}records(e,t=()=>({}),n="records:"+e+(t?":"+t.toString():"")){let r=this.ids(e,t,"ids:"+n);return(0,o.Fl)(n,()=>[...r.get()].map(e=>{let t=this.atoms.get()[e];if(!t)throw Error("no atom found for record id: "+e);return t.get()}))}ids(e,t=()=>({}),n="ids:"+e+(t?":"+t.toString():"")){let r=this.filterHistory(e),fromScratch=()=>{r.get();let n=t();return 0===Object.keys(n).length?new Set((0,i.UM)(this.atoms.get()).flatMap(t=>{let n=t.get();return n.typeName===e?n.id:[]})):executeQuery(this,e,n)},fromScratchWithDiff=e=>{let t=fromScratch(),n=diffSets(e,t);return n?(0,o.qo)(t,n):e},l=(0,o.Fl)("ids_query:"+n,t,{isEqual:a});return(0,o.Fl)("query:"+n,(t,n)=>{let a=l.get();if((0,o.e1)(t))return fromScratch();if(n<l.lastChangedEpoch)return fromScratchWithDiff(t);let c=r.getDiffSince(n);if(c===o.SB)return fromScratchWithDiff(t);let u=new IncrementalSetConstructor(t);for(let t of c){for(let n of(0,i.UM)(t.added))n.typeName===e&&objectMatchesQuery(a,n)&&u.add(n.id);for(let[n,r]of(0,i.UM)(t.updated))r.typeName===e&&(objectMatchesQuery(a,r)?u.add(r.id):u.remove(r.id));for(let n of(0,i.UM)(t.removed))n.typeName===e&&u.remove(n.id)}let d=u.get();return d?(0,o.qo)(d.value,d.diff):t},{historyLength:50})}exec(e,t){let n=executeQuery(this,e,t);if(0===n.size)return o.LZ;let r=this.atoms.get();return[...n].map(e=>r[e].get())}};function devFreeze(e){return e}let Store=class Store{id=nanoid();atoms=(0,o.cn)("store_atoms",{});history=(0,o.cn)("history",0,{historyLength:1e3});query=new StoreQueries(this.atoms,this.history);listeners=new Set;historyAccumulator=new HistoryAccumulator;historyReactor;schema;props;scopedTypes;constructor(e){let{initialData:t,schema:n}=e;this.schema=n,this.props=e.props,t&&this.atoms.set((0,i.Ls)((0,i.EP)(t).map(([e,t])=>[e,(0,o.cn)("atom:"+e,this.schema.validateRecord(this,t,"initialize",null))]))),this.historyReactor=(0,o.zH)("Store.historyReactor",()=>{this.history.get(),this._flushHistory()},{scheduleEffect:e=>(0,i.xP)(e)}),this.scopedTypes={document:new Set((0,i.UM)(this.schema.types).filter(e=>"document"===e.scope).map(e=>e.typeName)),session:new Set((0,i.UM)(this.schema.types).filter(e=>"session"===e.scope).map(e=>e.typeName)),presence:new Set((0,i.UM)(this.schema.types).filter(e=>"presence"===e.scope).map(e=>e.typeName))}}_flushHistory(){if(this.historyAccumulator.hasChanges()){let e=this.historyAccumulator.flush();for(let{changes:t,source:n}of e){let e=null,r=null,i=null;for(let{onHistory:o,filters:a}of this.listeners)if("all"===a.source||a.source===n){if("all"!==a.scope){if("document"===a.scope){if(!(r??=this.filterChangesByScope(t,"document")))continue;o({changes:r,source:n})}else if("session"===a.scope){if(!(e??=this.filterChangesByScope(t,"session")))continue;o({changes:e,source:n})}else{if(!(i??=this.filterChangesByScope(t,"presence")))continue;o({changes:i,source:n})}}else o({changes:t,source:n})}}}}filterChangesByScope(e,t){let n={added:(0,i.H4)(e.added,(e,n)=>this.scopedTypes[t].has(n.typeName)),updated:(0,i.H4)(e.updated,(e,n)=>this.scopedTypes[t].has(n[1].typeName)),removed:(0,i.H4)(e.removed,(e,n)=>this.scopedTypes[t].has(n.typeName))};return 0===Object.keys(n.added).length&&0===Object.keys(n.updated).length&&0===Object.keys(n.removed).length?null:n}updateHistory(e){this.historyAccumulator.add({changes:e,source:this.isMergingRemoteChanges?"remote":"user"}),0===this.listeners.size&&this.historyAccumulator.clear(),this.history.set(this.history.get()+1,e)}validate(e){this.allRecords().forEach(t=>this.schema.validateRecord(this,t,e,null))}onBeforeCreate;onAfterCreate;onBeforeChange;onAfterChange;onBeforeDelete;onAfterDelete;_runCallbacks=!0;put=(e,t)=>{(0,o.ay)(()=>{let n;let r={},i={},a=this.atoms.__unsafe__getWithoutCapture(),l=null,c=!1,u=this.onBeforeCreate&&this._runCallbacks?this.onBeforeCreate:null,d=this.onBeforeChange&&this._runCallbacks?this.onBeforeChange:null,p=this.isMergingRemoteChanges?"remote":"user";for(let h=0,g=e.length;h<g;h++){n=e[h];let g=(l??a)[n.id];if(g){let e=g.__unsafe__getWithoutCapture();d&&(n=d(e,n,p));let i=this.schema.validateRecord(this,n,t??"updateRecord",e);if(i===e)continue;g.set(n),c=!0,r[n.id]=[e,g.__unsafe__getWithoutCapture()]}else u&&(n=u(n,p)),c=!0,i[(n=this.schema.validateRecord(this,n,t??"createRecord",null)).id]=n,l||(l={...a}),l[n.id]=(0,o.cn)("atom:"+n.id,n)}if(l&&this.atoms.set(l),c&&(this.updateHistory({added:i,updated:r,removed:{}}),this._runCallbacks)){let{onAfterCreate:e,onAfterChange:t}=this;e&&Object.values(i).forEach(t=>{e(t,p)}),t&&Object.values(r).forEach(([e,n])=>{t(e,n,p)})}})};remove=e=>{(0,o.ay)(()=>{let t;let n=[],r=this.isMergingRemoteChanges?"remote":"user";if(this.onBeforeDelete&&this._runCallbacks)for(let t of e){let e=this.atoms.__unsafe__getWithoutCapture()[t];e&&!1===this.onBeforeDelete(e.get(),r)&&n.push(t)}if(this.atoms.update(r=>{let i;for(let o of e)!n.includes(o)&&o in r&&(i||(i={...r}),t||(t={}),delete i[o],t[o]=r[o].get());return i??r}),t&&(this.updateHistory({added:{},updated:{},removed:t}),this.onAfterDelete&&this._runCallbacks)){let n;for(let i=0,o=e.length;i<o;i++)(n=t[e[i]])&&this.onAfterDelete(n,r)}})};get=e=>this.atoms.get()[e]?.get();unsafeGetWithoutCapture=e=>this.atoms.get()[e]?.__unsafe__getWithoutCapture();serialize=(e="document")=>{let t={};for(let[n,r]of(0,i.EP)(this.atoms.get())){let i=r.get();("all"===e||this.scopedTypes[e].has(i.typeName))&&(t[n]=i)}return t};getSnapshot(e="document"){return{store:this.serialize(e),schema:this.schema.serialize()}}migrateSnapshot(e){let t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw Error(`Failed to migrate snapshot: ${t.reason}`);return{store:t.value,schema:this.schema.serialize()}}loadSnapshot(e){let t=this.schema.migrateStoreSnapshot(e);if("error"===t.type)throw Error(`Failed to migrate snapshot: ${t.reason}`);(0,o.ay)(()=>{this.clear(),this.put(Object.values(t.value)),this.ensureStoreIsUsable()})}allRecords=()=>(0,i.UM)(this.atoms.get()).map(e=>e.get());clear=()=>{this.remove((0,i.GH)(this.atoms.get()))};update=(e,t)=>{let n=this.atoms.get()[e];if(!n){console.error(`Record ${e} not found. This is probably an error`);return}this.put([t(n.__unsafe__getWithoutCapture())])};has=e=>!!this.atoms.get()[e];listen=(e,t)=>{this._flushHistory();let n={onHistory:e,filters:{source:t?.source??"all",scope:t?.scope??"all"}};return this.listeners.add(n),this.historyReactor.scheduler.isActivelyListening||this.historyReactor.start(),()=>{this.listeners.delete(n),0===this.listeners.size&&this.historyReactor.stop()}};isMergingRemoteChanges=!1;mergeRemoteChanges=e=>{if(this.isMergingRemoteChanges)return e();try{this.isMergingRemoteChanges=!0,(0,o.ay)(e)}finally{this.isMergingRemoteChanges=!1}};extractingChanges(e){let t=[],n=this.historyAccumulator.intercepting(e=>t.push(e.changes));try{return(0,o.ay)(e),squashRecordDiffs(t)}finally{n()}}applyDiff(e,t=!0){let n=this._runCallbacks;try{this._runCallbacks=t,(0,o.ay)(()=>{let t=(0,i.UM)(e.added).concat((0,i.UM)(e.updated).map(([e,t])=>t)),n=(0,i.GH)(e.removed);t.length&&this.put(t),n.length&&this.remove(n)})}finally{this._runCallbacks=n}}createComputedCache=(e,t,n)=>{let r=new Cache;return{get:i=>{let a=this.atoms.get()[i];if(a)return r.get(a,()=>{let r=n?(0,o.Fl)(a.name+":equals",()=>a.get(),{isEqual:n}):a;return(0,o.Fl)(e+":"+i,()=>t(r.get()))}).get()}}};createSelectedComputedCache=(e,t,n)=>{let r=new Cache;return{get:i=>{let a=this.atoms.get()[i];if(!a)return;let l=(0,o.Fl)(e+":"+i+":selector",()=>t(a.get()));return r.get(a,()=>(0,o.Fl)(e+":"+i,()=>n(l.get()))).get()}}};getRecordType=e=>{let t=this.schema.types[e.typeName];if(!t)throw Error(`Record type ${e.typeName} not found`);return t};_integrityChecker;ensureStoreIsUsable(){this._integrityChecker??=this.schema.createIntegrityChecker(this),this._integrityChecker?.()}_isPossiblyCorrupted=!1;markAsPossiblyCorrupted(){this._isPossiblyCorrupted=!0}isPossiblyCorrupted(){return this._isPossiblyCorrupted}};function squashRecordDiffs(e){let t={added:{},removed:{},updated:{}};for(let n of e){for(let[e,r]of(0,i.EP)(n.added))if(t.removed[e]){let n=t.removed[e];delete t.removed[e],n!==r&&(t.updated[e]=[n,r])}else t.added[e]=r;for(let[e,[r,o]]of(0,i.EP)(n.updated)){if(t.added[e]){t.added[e]=o,delete t.updated[e],delete t.removed[e];continue}if(t.updated[e]){t.updated[e]=[t.updated[e][0],o],delete t.removed[e];continue}t.updated[e]=n.updated[e],delete t.removed[e]}for(let[e,r]of(0,i.EP)(n.removed))t.added[e]?delete t.added[e]:t.updated[e]?(t.removed[e]=t.updated[e][0],delete t.updated[e]):t.removed[e]=r}return t}function squashHistoryEntries(e){let t;let n=[],r=e[0];for(let i=1,o=e.length;i<o;i++)t=e[i],r.source!==t.source?(n.push(r),r=t):r={source:r.source,changes:squashRecordDiffs([r.changes,t.changes])};return n.push(r),n}function reverseRecordsDiff(e){let t={added:e.removed,removed:e.added,updated:{}};for(let[n,r]of Object.values(e.updated))t.updated[n.id]=[r,n];return t}let HistoryAccumulator=class HistoryAccumulator{_history=[];_interceptors=new Set;intercepting(e){return this._interceptors.add(e),()=>{this._interceptors.delete(e)}}add(e){for(let t of(this._history.push(e),this._interceptors))t(e)}flush(){let e=squashHistoryEntries(this._history);return this._history=[],e}clear(){this._history=[]}hasChanges(){return this._history.length>0}};function isRecord(e){return"object"==typeof e&&null!==e&&"id"in e&&"typeName"in e}function defineMigrations(e){let{currentVersion:t,firstVersion:n,migrators:r={},subTypeKey:i,subTypeMigrations:o}=e;if("number"==typeof t&&"number"==typeof n){if(t===n)throw Error("Current version is equal to initial version.");if(t<n)throw Error("Current version is lower than initial version.")}return{firstVersion:n??0,currentVersion:t??0,migrators:r,subTypeKey:i,subTypeMigrations:o}}var l=((r=l||{}).IncompatibleSubtype="incompatible-subtype",r.UnknownType="unknown-type",r.TargetVersionTooNew="target-version-too-new",r.TargetVersionTooOld="target-version-too-old",r.MigrationError="migration-error",r.UnrecognizedSubtype="unrecognized-subtype",r);function getRecordVersion(e,t){let n=t.recordVersions[e.typeName];if(!n)return{rootVersion:0};if("subTypeKey"in n){let t=e[n.subTypeKey],r=n.subTypeVersions[t];return{rootVersion:n.version,subTypeVersion:r}}return{rootVersion:n.version}}function compareRecordVersions(e,t){if(e.rootVersion>t.rootVersion)return 1;if(e.rootVersion<t.rootVersion)return -1;if(null!=e.subTypeVersion&&null!=t.subTypeVersion){if(e.subTypeVersion>t.subTypeVersion)return 1;if(e.subTypeVersion<t.subTypeVersion)return -1}return 0}function migrateRecord({record:e,migrations:t,fromVersion:n,toVersion:r}){let i=n;if(!isRecord(e))throw Error("[migrateRecord] object is not a record");let{typeName:o,id:a,...l}=e,c=l;for(;i<r;){let e=i+1,n=t.migrators[e];if(!n)return{type:"error",reason:"target-version-too-new"};c=n.up(c),i=e}for(;i>r;){let e=i-1,n=t.migrators[i];if(!n)return{type:"error",reason:"target-version-too-old"};c=n.down(c),i=e}return{type:"success",value:{...c,id:a,typeName:o}}}function migrate({value:e,migrations:t,fromVersion:n,toVersion:r}){let i=n;for(;i<r;){let n=i+1,r=t.migrators[n];if(!r)return{type:"error",reason:"target-version-too-new"};e=r.up(e),i=n}for(;i>r;){let n=i-1,r=t.migrators[i];if(!r)return{type:"error",reason:"target-version-too-old"};e=r.down(e),i=n}return{type:"success",value:e}}let StoreSchema=class StoreSchema{constructor(e,t){this.types=e,this.options=t}static create(e,t){return new StoreSchema(e,t??{})}get currentStoreVersion(){return this.options.snapshotMigrations?.currentVersion??0}validateRecord(e,t,n,r){try{let e=(0,i.eg)(this.types,t.typeName);if(!e)throw Error(`Missing definition for record type ${t.typeName}`);return e.validate(t,r??void 0)}catch(i){if(this.options.onValidationFailure)return this.options.onValidationFailure({store:e,record:t,phase:n,recordBefore:r,error:i});throw i}}migratePersistedRecord(e,t,n="up"){let r=(0,i.eg)(this.types,e.typeName),o=t.recordVersions[e.typeName];if(!o||!r)return{type:"error",reason:l.UnknownType};let a=r.migrations.currentVersion,c=o.version;if(a!==c){let t="up"===n?migrateRecord({record:e,migrations:r.migrations,fromVersion:c,toVersion:a}):migrateRecord({record:e,migrations:r.migrations,fromVersion:a,toVersion:c});if("error"===t.type)return t;e=t.value}if(!r.migrations.subTypeKey)return{type:"success",value:e};let u=r.migrations.subTypeMigrations?.[e[r.migrations.subTypeKey]],d="subTypeVersions"in o?o.subTypeVersions[e[r.migrations.subTypeKey]]:void 0;if(void 0===u)return{type:"error",reason:l.UnrecognizedSubtype};if(void 0===d)return{type:"error",reason:l.IncompatibleSubtype};let p="up"===n?migrateRecord({record:e,migrations:u,fromVersion:d,toVersion:u.currentVersion}):migrateRecord({record:e,migrations:u,fromVersion:u.currentVersion,toVersion:d});return"error"===p.type?p:{type:"success",value:p.value}}migrateStoreSnapshot(e){let{store:t}=e,n=this.options.snapshotMigrations;if(!n)return{type:"success",value:t};let r=n.currentVersion,o=e.schema.storeVersion??0;if(r<o)return{type:"error",reason:l.TargetVersionTooOld};if(r>o){let e=migrate({value:t,migrations:n,fromVersion:o,toVersion:r});if("error"===e.type)return e;t=e.value}let a=[];for(let n of(0,i.UM)(t)){let t=this.migratePersistedRecord(n,e.schema);if("error"===t.type)return t;t.value&&t.value!==n&&a.push(t.value)}if(a.length)for(let e of(t={...t},a))t[e.id]=e;return{type:"success",value:t}}createIntegrityChecker(e){return this.options.createIntegrityChecker?.(e)??void 0}serialize(){return{schemaVersion:1,storeVersion:this.options.snapshotMigrations?.currentVersion??0,recordVersions:Object.fromEntries((0,i.UM)(this.types).map(e=>[e.typeName,e.migrations.subTypeKey&&e.migrations.subTypeMigrations?{version:e.migrations.currentVersion,subTypeKey:e.migrations.subTypeKey,subTypeVersions:e.migrations.subTypeMigrations?Object.fromEntries(Object.entries(e.migrations.subTypeMigrations).map(([e,t])=>[e,t.currentVersion])):void 0}:{version:e.migrations.currentVersion}]))}}serializeEarliestVersion(){return{schemaVersion:1,storeVersion:this.options.snapshotMigrations?.firstVersion??0,recordVersions:Object.fromEntries((0,i.UM)(this.types).map(e=>[e.typeName,e.migrations.subTypeKey&&e.migrations.subTypeMigrations?{version:e.migrations.firstVersion,subTypeKey:e.migrations.subTypeKey,subTypeVersions:e.migrations.subTypeMigrations?Object.fromEntries(Object.entries(e.migrations.subTypeMigrations).map(([e,t])=>[e,t.firstVersion])):void 0}:{version:e.migrations.firstVersion}]))}}};let compareSchemas=(e,t)=>{if(e.schemaVersion>t.schemaVersion)return 1;if(e.schemaVersion<t.schemaVersion)return -1;if(e.storeVersion>t.storeVersion)return 1;if(e.storeVersion<t.storeVersion)return -1;for(let n of Object.keys(e.recordVersions)){let r=e.recordVersions[n],i=t.recordVersions[n];if(r.version>i.version)return 1;if(r.version<i.version)return -1;if("subTypeVersions"in r&&!("subTypeVersions"in i))return 1;if(!("subTypeVersions"in r)&&"subTypeVersions"in i)return -1;if("subTypeVersions"in r&&"subTypeVersions"in i)for(let e of Object.keys(r.subTypeVersions)){let t=r.subTypeVersions[e],n=i.subTypeVersions[e];if(t>n)return 1;if(t<n)return -1}}return 0}},6934:function(e,t,n){"use strict";n.d(t,{ZJ:function(){return eP},TA:function(){return eT},Yk:function(){return eu},AN:function(){return d},R_:function(){return ef},qi:function(){return eg},ci:function(){return ey},pp:function(){return eb},p6:function(){return eS},Y8:function(){return ew},Xo:function(){return eG},ST:function(){return ev},HO:function(){return eW},_A:function(){return Y},Lu:function(){return eU},$I:function(){return EnumStyleProp},Zu:function(){return eZ},iS:function(){return O},AM:function(){return H},a2:function(){return th},t8:function(){return e4},ez:function(){return k},zh:function(){return L},fV:function(){return StyleProp},G4:function(){return X},PQ:function(){return _},LV:function(){return R},z:function(){return b},Vm:function(){return eE},si:function(){return ek},_3:function(){return i},TD:function(){return ec},$A:function(){return es},h9:function(){return ej},qU:function(){return e_},lz:function(){return h},MN:function(){return w},tL:function(){return createAssetValidator},GP:function(){return createPresenceStateDerivation},F1:function(){return createShapeId},JY:function(){return createShapeValidator},HH:function(){return createTLSchema},_l:function(){return eO},wu:function(){return e$},BF:function(){return eN},gB:function(){return eL},DW:function(){return eR},gR:function(){return eH},k7:function(){return eV},P3:function(){return eX},eG:function(){return eK},y6:function(){return getDefaultColorTheme},Bz:function(){return getDefaultTranslationLocale},DR:function(){return getShapePropKeysByStyle},c4:function(){return eQ},A7:function(){return eJ},J1:function(){return e1},VW:function(){return e0},yd:function(){return idValidator},y5:function(){return e6},Fc:function(){return e3},r5:function(){return isPageId},VV:function(){return isShape},YT:function(){return isShapeId},FH:function(){return te},BG:function(){return e7},C_:function(){return tr},m0:function(){return tt},jm:function(){return y},CF:function(){return x},Mv:function(){return M},cL:function(){return ep},gw:function(){return v},u5:function(){return j},pL:function(){return ta},XB:function(){return ti},AT:function(){return p},lY:function(){return tc},p$:function(){return ts}});var r=n(5958);function idValidator(e){return r.T.string.refine(t=>{if(!t.startsWith(`${e}:`))throw Error(`${e} ID must start with "${e}:"`);return t})}let i=idValidator("asset");function createAssetValidator(e,t){return r.T.object({id:i,typeName:r.T.literal("asset"),type:r.T.literal(e),props:t,meta:r.T.jsonValue})}var o=n(9502),a=n(932);let l=r.T.model("camera",r.T.object({typeName:r.T.literal("camera"),id:idValidator("camera"),x:r.T.number,y:r.T.number,z:r.T.number,meta:r.T.jsonValue})),c={AddMeta:1},u=(0,a.zn)({currentVersion:c.AddMeta,migrators:{[c.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),d=(0,a.ju)("camera",{validator:l,migrations:u,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,z:1,meta:{}})),p=r.T.object({x:r.T.number,y:r.T.number,z:r.T.number.optional()}),h=r.T.object({x:r.T.number,y:r.T.number,w:r.T.number,h:r.T.number}),g=new Set(["none","default","pointer","cross","grab","rotate","grabbing","resize-edge","resize-corner","text","move","ew-resize","ns-resize","nesw-resize","nwse-resize","nesw-rotate","nwse-rotate","swne-rotate","senw-rotate","zoom-in","zoom-out"]),f=r.T.setEnum(g),m=r.T.object({type:f,rotation:r.T.number}),y=r.T.number.check(e=>{if(e<0||e>1)throw new r.T.ValidationError("Opacity must be between 0 and 1")}),b=new Set(["accent","white","black","selection-stroke","selection-fill","laser","muted-1"]),w=r.T.setEnum(b),S=new Set(["starting","paused","active","stopping"]),v=r.T.object({id:r.T.string,points:r.T.arrayOf(p),size:r.T.positiveNumber,color:w,opacity:r.T.number,state:r.T.setEnum(S),delay:r.T.number,shrink:r.T.number,taper:r.T.boolean}),x=idValidator("page"),T=r.T.model("page",r.T.object({typeName:r.T.literal("page"),id:x,name:r.T.string,index:r.T.indexKey,meta:r.T.jsonValue})),P={AddMeta:1},C=(0,a.zn)({currentVersion:P.AddMeta,migrators:{[P.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),k=(0,a.ju)("page",{validator:T,migrations:C,scope:"document"}).withDefaultProperties(()=>({meta:{}}));function isPageId(e){return k.isId(e)}function createInstanceRecordType(e){let t={};for(let[n,i]of e)t[n]=r.T.optional(i);let n=r.T.model("instance",r.T.object({typeName:r.T.literal("instance"),id:idValidator("instance"),currentPageId:x,followingUserId:r.T.string.nullable(),brush:h.nullable(),opacityForNextShape:y,stylesForNextShape:r.T.object(t),cursor:m,scribbles:r.T.arrayOf(v),isFocusMode:r.T.boolean,isDebugMode:r.T.boolean,isToolLocked:r.T.boolean,exportBackground:r.T.boolean,screenBounds:h,insets:r.T.arrayOf(r.T.boolean),zoomBrush:h.nullable(),isPenMode:r.T.boolean,isGridMode:r.T.boolean,chatMessage:r.T.string,isChatting:r.T.boolean,highlightedUserIds:r.T.arrayOf(r.T.string),canMoveCamera:r.T.boolean,isFocused:r.T.boolean,devicePixelRatio:r.T.number,isCoarsePointer:r.T.boolean,isHoveringCanvas:r.T.boolean.nullable(),openMenus:r.T.arrayOf(r.T.string),isChangingStyle:r.T.boolean,isReadonly:r.T.boolean,meta:r.T.jsonValue,duplicateProps:r.T.object({shapeIds:r.T.arrayOf(idValidator("shape")),offset:r.T.object({x:r.T.number,y:r.T.number})}).nullable()}));return(0,a.ju)("instance",{migrations:E,validator:n,scope:"session"}).withDefaultProperties(()=>({followingUserId:null,opacityForNextShape:1,stylesForNextShape:{},brush:null,scribbles:[],cursor:{type:"default",rotation:0},isFocusMode:!1,exportBackground:!1,isDebugMode:!1,isToolLocked:!1,screenBounds:{x:0,y:0,w:1080,h:720},insets:[!1,!1,!1,!1],zoomBrush:null,isGridMode:!1,isPenMode:!1,chatMessage:"",isChatting:!1,highlightedUserIds:[],canMoveCamera:!0,isFocused:!1,devicePixelRatio:"undefined"==typeof window?1:window.devicePixelRatio,isCoarsePointer:!1,isHoveringCanvas:null,openMenus:[],isChangingStyle:!1,isReadonly:!1,meta:{},duplicateProps:null}))}idValidator("instance");let I={AddTransparentExportBgs:1,RemoveDialog:2,AddToolLockMode:3,RemoveExtraPropsForNextShape:4,AddLabelColor:5,AddFollowingUserId:6,RemoveAlignJustify:7,AddZoom:8,AddVerticalAlign:9,AddScribbleDelay:10,RemoveUserId:11,AddIsPenModeAndIsGridMode:12,HoistOpacity:13,AddChat:14,AddHighlightedUserIds:15,ReplacePropsForNextShapeWithStylesForNextShape:16,AddMeta:17,RemoveCursorColor:18,AddLonelyProperties:19,ReadOnlyReadonly:20,AddHoveringCanvas:21,AddScribbles:22,AddInset:23,AddDuplicateProps:24},E=(0,a.zn)({currentVersion:I.AddDuplicateProps,migrators:{[I.AddTransparentExportBgs]:{up:e=>({...e,exportBackground:!0}),down:({exportBackground:e,...t})=>t},[I.RemoveDialog]:{up:({dialog:e,...t})=>t,down:e=>({...e,dialog:null})},[I.AddToolLockMode]:{up:e=>({...e,isToolLocked:!1}),down:({isToolLocked:e,...t})=>t},[I.RemoveExtraPropsForNextShape]:{up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:Object.fromEntries(Object.entries(e).filter(([e])=>["color","labelColor","dash","fill","size","font","align","verticalAlign","icon","geo","arrowheadStart","arrowheadEnd","spline"].includes(e)))}),down:e=>e},[I.AddLabelColor]:{up:({propsForNextShape:e,...t})=>({...t,propsForNextShape:{...e,labelColor:"black"}}),down:e=>{let{labelColor:t,...n}=e.propsForNextShape;return{...e,propsForNextShape:{...n}}}},[I.AddFollowingUserId]:{up:e=>({...e,followingUserId:null}),down:({followingUserId:e,...t})=>t},[I.RemoveAlignJustify]:{up:e=>{let t=e.propsForNextShape.align;return"justify"===t&&(t="start"),{...e,propsForNextShape:{...e.propsForNextShape,align:t}}},down:e=>({...e})},[I.AddZoom]:{up:e=>({...e,zoomBrush:null}),down:({zoomBrush:e,...t})=>t},[I.AddVerticalAlign]:{up:e=>({...e,propsForNextShape:{...e.propsForNextShape,verticalAlign:"middle"}}),down:e=>{let{verticalAlign:t,...n}=e.propsForNextShape;return{...e,propsForNextShape:n}}},[I.AddScribbleDelay]:{up:e=>null!==e.scribble?{...e,scribble:{...e.scribble,delay:0}}:{...e},down:e=>{if(null!==e.scribble){let{delay:t,...n}=e.scribble;return{...e,scribble:n}}return{...e}}},[I.RemoveUserId]:{up:({userId:e,...t})=>t,down:e=>({...e,userId:"user:none"})},[I.AddIsPenModeAndIsGridMode]:{up:e=>({...e,isPenMode:!1,isGridMode:!1}),down:({isPenMode:e,isGridMode:t,...n})=>n},[I.HoistOpacity]:{up:({propsForNextShape:{opacity:e,...t},...n})=>({...n,opacityForNextShape:Number(e??"1"),propsForNextShape:t}),down:({opacityForNextShape:e,...t})=>({...t,propsForNextShape:{...t.propsForNextShape,opacity:e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}})},[I.AddChat]:{up:e=>({...e,chatMessage:"",isChatting:!1}),down:({chatMessage:e,isChatting:t,...n})=>n},[I.AddHighlightedUserIds]:{up:e=>({...e,highlightedUserIds:[]}),down:({highlightedUserIds:e,...t})=>t},[I.ReplacePropsForNextShapeWithStylesForNextShape]:{up:({propsForNextShape:e,...t})=>({...t,stylesForNextShape:{}}),down:({stylesForNextShape:e,...t})=>({...t,propsForNextShape:{color:"black",labelColor:"black",dash:"draw",fill:"none",size:"m",icon:"file",font:"draw",align:"middle",verticalAlign:"middle",geo:"rectangle",arrowheadStart:"none",arrowheadEnd:"arrow",spline:"line"}})},[I.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[I.RemoveCursorColor]:{up:e=>{let{color:t,...n}=e.cursor;return{...e,cursor:n}},down:e=>({...e,cursor:{...e.cursor,color:"black"}})},[I.AddLonelyProperties]:{up:e=>({...e,canMoveCamera:!0,isFocused:!1,devicePixelRatio:1,isCoarsePointer:!1,openMenus:[],isChangingStyle:!1,isReadOnly:!1}),down:({canMoveCamera:e,isFocused:t,devicePixelRatio:n,isCoarsePointer:r,openMenus:i,isChangingStyle:o,isReadOnly:a,...l})=>({...l})},[I.ReadOnlyReadonly]:{up:({isReadOnly:e,...t})=>({...t,isReadonly:e}),down:({isReadonly:e,...t})=>({...t,isReadOnly:e})},[I.AddHoveringCanvas]:{up:e=>({...e,isHoveringCanvas:null}),down:({isHoveringCanvas:e,...t})=>({...t})},[I.AddScribbles]:{up:({scribble:e,...t})=>({...t,scribbles:[]}),down:({scribbles:e,...t})=>({...t,scribble:null})},[I.AddInset]:{up:e=>({...e,insets:[!1,!1,!1,!1]}),down:({insets:e,...t})=>({...t})},[I.AddDuplicateProps]:{up:e=>({...e,duplicateProps:null}),down:({duplicateProps:e,...t})=>({...t})}}}),_="instance:instance",M=r.T.string.refine(e=>{if(!e.startsWith("page:")&&!e.startsWith("shape:"))throw Error('Parent ID must start with "page:" or "shape:"');return e}),j=idValidator("shape");function createShapeValidator(e,t,n){return r.T.object({id:j,typeName:r.T.literal("shape"),x:r.T.number,y:r.T.number,rotation:r.T.number,index:r.T.indexKey,parentId:M,type:r.T.literal(e),isLocked:r.T.boolean,opacity:y,props:t?r.T.object(t):r.T.jsonValue,meta:n?r.T.object(n):r.T.jsonValue})}let A=r.T.model("instance_page_state",r.T.object({typeName:r.T.literal("instance_page_state"),id:idValidator("instance_page_state"),pageId:x,selectedShapeIds:r.T.arrayOf(j),hintingShapeIds:r.T.arrayOf(j),erasingShapeIds:r.T.arrayOf(j),hoveredShapeId:j.nullable(),editingShapeId:j.nullable(),croppingShapeId:j.nullable(),focusedGroupId:j.nullable(),meta:r.T.jsonValue})),$={AddCroppingId:1,RemoveInstanceIdAndCameraId:2,AddMeta:3,RenameProperties:4,RenamePropertiesAgain:5},D=(0,a.zn)({currentVersion:$.RenamePropertiesAgain,migrators:{[$.AddCroppingId]:{up:e=>({...e,croppingShapeId:null}),down:({croppingShapeId:e,...t})=>t},[$.RemoveInstanceIdAndCameraId]:{up:({instanceId:e,cameraId:t,...n})=>n,down:e=>({...e,instanceId:_,cameraId:d.createId("void")})},[$.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[$.RenameProperties]:{up:e=>{let{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:a,focusedGroupId:l,...c}=e;return{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:a,focusedGroupId:l,...c}},down:e=>{let{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:a,focusedGroupId:l,...c}=e;return{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:a,focusedGroupId:l,...c}}},[$.RenamePropertiesAgain]:{up:e=>{let{selectedIds:t,hintingIds:n,erasingIds:r,hoveredId:i,editingId:o,croppingShapeId:a,croppingId:l,focusLayerId:c,...u}=e;return{...u,selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:a??l??null,focusedGroupId:c}},down:e=>{let{selectedShapeIds:t,hintingShapeIds:n,erasingShapeIds:r,hoveredShapeId:i,editingShapeId:o,croppingShapeId:a,focusedGroupId:l,...c}=e;return{...c,selectedIds:t,hintingIds:n,erasingIds:r,hoveredId:i,editingId:o,croppingId:a,focusLayerId:l}}}}}),O=(0,a.ju)("instance_page_state",{migrations:D,validator:A,scope:"session"}).withDefaultProperties(()=>({editingShapeId:null,croppingShapeId:null,selectedShapeIds:[],hoveredShapeId:null,erasingShapeIds:[],hintingShapeIds:[],focusedGroupId:null,meta:{}})),B=r.T.model("pointer",r.T.object({typeName:r.T.literal("pointer"),id:idValidator("pointer"),x:r.T.number,y:r.T.number,lastActivityTimestamp:r.T.number,meta:r.T.jsonValue})),F={AddMeta:1},U=(0,a.zn)({currentVersion:F.AddMeta,migrators:{[F.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),L=(0,a.ju)("pointer",{validator:B,migrations:U,scope:"session"}).withDefaultProperties(()=>({x:0,y:0,lastActivityTimestamp:0,meta:{}})),R=L.createId("pointer"),z=r.T.model("instance_presence",r.T.object({typeName:r.T.literal("instance_presence"),id:idValidator("instance_presence"),userId:r.T.string,userName:r.T.string,lastActivityTimestamp:r.T.number,followingUserId:r.T.string.nullable(),cursor:r.T.object({x:r.T.number,y:r.T.number,type:f,rotation:r.T.number}),color:r.T.string,camera:r.T.object({x:r.T.number,y:r.T.number,z:r.T.number}),screenBounds:h,selectedShapeIds:r.T.arrayOf(idValidator("shape")),currentPageId:idValidator("page"),brush:h.nullable(),scribbles:r.T.arrayOf(v),chatMessage:r.T.string,meta:r.T.jsonValue})),N={AddScribbleDelay:1,RemoveInstanceId:2,AddChatMessage:3,AddMeta:4,RenameSelectedShapeIds:5},V=(0,a.zn)({currentVersion:N.RenameSelectedShapeIds,migrators:{[N.AddScribbleDelay]:{up:e=>null!==e.scribble?{...e,scribble:{...e.scribble,delay:0}}:{...e},down:e=>{if(null!==e.scribble){let{delay:t,...n}=e.scribble;return{...e,scribble:n}}return{...e}}},[N.RemoveInstanceId]:{up:({instanceId:e,...t})=>t,down:e=>({...e,instanceId:_})},[N.AddChatMessage]:{up:e=>({...e,chatMessage:""}),down:({chatMessage:e,...t})=>t},[N.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})},[N.RenameSelectedShapeIds]:{up:e=>{let{selectedShapeIds:t,...n}=e;return{selectedShapeIds:t,...n}},down:e=>{let{selectedShapeIds:t,...n}=e;return{selectedShapeIds:t,...n}}}}}),H=(0,a.ju)("instance_presence",{migrations:V,validator:z,scope:"presence"}).withDefaultProperties(()=>({lastActivityTimestamp:0,followingUserId:null,color:"#FF0000",camera:{x:0,y:0,z:1},cursor:{x:0,y:0,type:"default",rotation:0},screenBounds:{x:0,y:0,w:1,h:1},selectedShapeIds:[],brush:null,scribbles:[],chatMessage:"",meta:{}})),createPresenceStateDerivation=(e,t)=>n=>(0,o.Fl)("instancePresence",()=>{let r=n.get(_),i=n.get(O.createId(r?.currentPageId)),o=n.get(d.createId(r?.currentPageId)),a=n.get(R),l=e.get();return i&&r&&o&&a&&l?H.create({id:t??H.createId(n.id),selectedShapeIds:i.selectedShapeIds,brush:r.brush,scribbles:r.scribbles,userId:l.id,userName:l.name,followingUserId:r.followingUserId,camera:{x:o.x,y:o.y,z:o.z},color:l.color,currentPageId:r.currentPageId,cursor:{x:a.x,y:a.y,rotation:r.cursor.rotation,type:r.cursor.type},lastActivityTimestamp:a.lastActivityTimestamp,screenBounds:r.screenBounds,chatMessage:r.chatMessage,meta:{}}):null});var G=n(3112);let W=r.T.model("document",r.T.object({typeName:r.T.literal("document"),id:r.T.literal("document:document"),gridSize:r.T.number,name:r.T.string,meta:r.T.jsonValue})),Z={AddName:1,AddMeta:2},K=(0,a.zn)({currentVersion:Z.AddMeta,migrators:{[Z.AddName]:{up:e=>({...e,name:""}),down:({name:e,...t})=>t},[Z.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),Y=(0,a.ju)("document",{migrations:K,validator:W,scope:"document"}).withDefaultProperties(()=>({gridSize:10,name:"",meta:{}})),X=Y.createId("document");function sortByIndex(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function redactRecordForErrorReporting(e){"asset"===e.typeName&&("src"in e&&(e.src="<redacted>"),"src"in e.props&&(e.props.src="<redacted>"))}let onValidationFailure=({error:e,phase:t,record:n,recordBefore:r})=>{throw(0,G.lw)(e,{tags:{origin:"store.validateRecord",storePhase:t,isExistingValidationIssue:"initialize"===t},extras:{recordBefore:r?redactRecordForErrorReporting((0,G.v4)(r)):void 0,recordAfter:redactRecordForErrorReporting((0,G.v4)(n))}}),e};function getDefaultPages(){return[k.create({id:"page:page",name:"Page 1",index:"a1",meta:{}})]}function createIntegrityChecker(e){let t=e.query.ids("page"),ensureStoreIsUsable=()=>{if(!e.has(X))return e.put([Y.create({id:X,name:e.props.defaultName})]),ensureStoreIsUsable();if(!e.has(R))return e.put([L.create({id:R})]),ensureStoreIsUsable();let n=t.get();if(0===n.size)return e.put(getDefaultPages()),ensureStoreIsUsable();let r=e.get(_);if(!r)return e.put([e.schema.types.instance.create({id:_,currentPageId:[...n].map(t=>e.get(t)).sort(sortByIndex)[0].id,exportBackground:!0})]),ensureStoreIsUsable();if(!n.has(r.currentPageId))return e.put([{...r,currentPageId:[...n].map(t=>e.get(t)).sort(sortByIndex)[0].id}]),ensureStoreIsUsable();let i=new Set,o=new Set;for(let t of n){let n=O.createId(t);e.has(n)||i.add(n);let r=d.createId(t);e.has(r)||o.add(r)}i.size>0&&e.put([...i].map(e=>O.create({id:e,pageId:O.parseId(e)}))),o.size>0&&e.put([...o].map(e=>d.create({id:e})))};return ensureStoreIsUsable}let J=createAssetValidator("bookmark",r.T.object({title:r.T.string,description:r.T.string,image:r.T.string,src:r.T.srcUrl.nullable()})),Q={MakeUrlsValid:1},ee=(0,a.zn)({currentVersion:Q.MakeUrlsValid,migrators:{[Q.MakeUrlsValid]:{up:e=>{let t=e.props.src;return t&&!r.T.srcUrl.isValid(t)?{...e,props:{...e.props,src:""}}:e},down:e=>e}}}),et=createAssetValidator("image",r.T.object({w:r.T.number,h:r.T.number,name:r.T.string,isAnimated:r.T.boolean,mimeType:r.T.string.nullable(),src:r.T.srcUrl.nullable()})),en={AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3},er=(0,a.zn)({currentVersion:en.MakeUrlsValid,migrators:{[en.AddIsAnimated]:{up:e=>({...e,props:{...e.props,isAnimated:!1}}),down:e=>{let{isAnimated:t,...n}=e.props;return{...e,props:n}}},[en.RenameWidthHeight]:{up:e=>{let{width:t,height:n,...r}=e.props;return{...e,props:{w:t,h:n,...r}}},down:e=>{let{w:t,h:n,...r}=e.props;return{...e,props:{width:t,height:n,...r}}}},[en.MakeUrlsValid]:{up:e=>{let t=e.props.src;return t&&!r.T.srcUrl.isValid(t)?{...e,props:{...e.props,src:""}}:e},down:e=>e}}}),ei=createAssetValidator("video",r.T.object({w:r.T.number,h:r.T.number,name:r.T.string,isAnimated:r.T.boolean,mimeType:r.T.string.nullable(),src:r.T.srcUrl.nullable()})),eo={AddIsAnimated:1,RenameWidthHeight:2,MakeUrlsValid:3},ea=(0,a.zn)({currentVersion:eo.MakeUrlsValid,migrators:{[eo.AddIsAnimated]:{up:e=>({...e,props:{...e.props,isAnimated:!1}}),down:e=>{let{isAnimated:t,...n}=e.props;return{...e,props:n}}},[eo.RenameWidthHeight]:{up:e=>{let{width:t,height:n,...r}=e.props;return{...e,props:{w:t,h:n,...r}}},down:e=>{let{w:t,h:n,...r}=e.props;return{...e,props:{width:t,height:n,...r}}}},[eo.MakeUrlsValid]:{up:e=>{let t=e.props.src;return t&&!r.T.srcUrl.isValid(t)?{...e,props:{...e.props,src:""}}:e},down:e=>e}}}),es=r.T.model("asset",r.T.union("type",{image:et,video:ei,bookmark:J})),el={AddMeta:1},ec=(0,a.zn)({subTypeKey:"type",subTypeMigrations:{image:er,video:ea,bookmark:ee},currentVersion:el.AddMeta,migrators:{[el.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}}),eu=(0,a.ju)("asset",{migrations:ec,validator:es,scope:"document"}).withDefaultProperties(()=>({meta:{}})),nanoid=(e=21)=>crypto.getRandomValues(new Uint8Array(e)).reduce((e,t)=>((t&=63)<36?e+=t.toString(36):t<62?e+=(t-26).toString(36).toUpperCase():t>62?e+="-":e+="_",e),"");let StyleProp=class StyleProp{constructor(e,t,n){this.id=e,this.defaultValue=t,this.type=n}static define(e,t){let{defaultValue:n,type:i=r.T.any}=t;return new StyleProp(e,n,i)}static defineEnum(e,t){let{defaultValue:n,values:r}=t;return new EnumStyleProp(e,n,r)}validate(e){return this.type.validate(e)}validateUsingKnownGoodVersion(e,t){return this.type.validateUsingKnownGoodVersion?this.type.validateUsingKnownGoodVersion(e,t):this.validate(t)}};let EnumStyleProp=class EnumStyleProp extends StyleProp{constructor(e,t,n){super(e,t,r.T.literalEnum(...n)),this.values=n}};let ed={AddIsLocked:1,HoistOpacity:2,AddMeta:3},ep=(0,a.zn)({currentVersion:ed.AddMeta,migrators:{[ed.AddIsLocked]:{up:e=>({...e,isLocked:!1}),down:e=>{let{isLocked:t,...n}=e;return{...n}}},[ed.HoistOpacity]:{up:({props:{opacity:e,...t},...n})=>({...n,opacity:Number(e??"1"),props:t}),down:({opacity:e,...t})=>({...t,props:{...t.props,opacity:e<.175?"0.1":e<.375?"0.25":e<.625?"0.5":e<.875?"0.75":"1"}})},[ed.AddMeta]:{up:e=>({...e,meta:{}}),down:({meta:e,...t})=>({...t})}}});function isShape(e){return!!e&&"shape"===e.typeName}function isShapeId(e){return!!e&&e.startsWith("shape:")}function createShapeId(e){return`shape:${e??nanoid()}`}function getShapePropKeysByStyle(e){let t=new Map;for(let[n,r]of Object.entries(e))if(r instanceof StyleProp){if(t.has(r))throw Error(`Duplicate style prop ${r.id}. Each style prop can only be used once within a shape.`);t.set(r,n)}return t}function createShapeRecordType(e){return(0,a.ju)("shape",{migrations:(0,a.zn)({currentVersion:ep.currentVersion,firstVersion:ep.firstVersion,migrators:ep.migrators,subTypeKey:"type",subTypeMigrations:(0,G.Fm)(e,(e,t)=>t.migrations??(0,a.zn)({}))}),scope:"document",validator:r.T.model("shape",r.T.union("type",(0,G.Fm)(e,(e,{props:t,meta:n})=>createShapeValidator(e,t,n))))}).withDefaultProperties(()=>({x:0,y:0,rotation:0,isLocked:!1,opacity:1,meta:{}}))}let eh=["black","grey","light-violet","violet","blue","light-blue","yellow","orange","green","light-green","light-red","red"],eg={lightMode:{id:"light",text:"#000000",background:"rgb(249, 250, 251)",solid:"#fcfffe",black:{solid:"#1d1d1d",semi:"#e8e8e8",pattern:"#494949",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}},blue:{solid:"#4263eb",semi:"#dce1f8",pattern:"#6681ee",highlight:{srgb:"#10acff",p3:"color(display-p3 0.308 0.6632 0.9996)"}},green:{solid:"#099268",semi:"#d3e9e3",pattern:"#39a785",highlight:{srgb:"#00ffc8",p3:"color(display-p3 0.2536 0.984 0.7981)"}},grey:{solid:"#adb5bd",semi:"#eceef0",pattern:"#bcc3c9",highlight:{srgb:"#cbe7f1",p3:"color(display-p3 0.8163 0.9023 0.9416)"}},"light-blue":{solid:"#4dabf7",semi:"#ddedfa",pattern:"#6fbbf8",highlight:{srgb:"#00f4ff",p3:"color(display-p3 0.1512 0.9414 0.9996)"}},"light-green":{solid:"#40c057",semi:"#dbf0e0",pattern:"#65cb78",highlight:{srgb:"#65f641",p3:"color(display-p3 0.563 0.9495 0.3857)"}},"light-red":{solid:"#ff8787",semi:"#f4dadb",pattern:"#fe9e9e",highlight:{srgb:"#ff7fa3",p3:"color(display-p3 0.9988 0.5301 0.6397)"}},"light-violet":{solid:"#e599f7",semi:"#f5eafa",pattern:"#e9acf8",highlight:{srgb:"#ff88ff",p3:"color(display-p3 0.9676 0.5652 0.9999)"}},orange:{solid:"#f76707",semi:"#f8e2d4",pattern:"#f78438",highlight:{srgb:"#ffa500",p3:"color(display-p3 0.9988 0.6905 0.266)"}},red:{solid:"#e03131",semi:"#f4dadb",pattern:"#e55959",highlight:{srgb:"#ff636e",p3:"color(display-p3 0.9992 0.4376 0.45)"}},violet:{solid:"#ae3ec9",semi:"#ecdcf2",pattern:"#bd63d3",highlight:{srgb:"#c77cff",p3:"color(display-p3 0.7469 0.5089 0.9995)"}},yellow:{solid:"#ffc078",semi:"#f9f0e6",pattern:"#fecb92",highlight:{srgb:"#fddd00",p3:"color(display-p3 0.972 0.8705 0.05)"}}},darkMode:{id:"dark",text:"hsl(210, 17%, 98%)",background:"hsl(240, 5%, 8%)",solid:"#010403",black:{solid:"#e1e1e1",semi:"#2c3036",pattern:"#989898",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}},blue:{solid:"#4263eb",semi:"#262d40",pattern:"#3a4b9e",highlight:{srgb:"#0079d2",p3:"color(display-p3 0.0032 0.4655 0.7991)"}},green:{solid:"#099268",semi:"#253231",pattern:"#366a53",highlight:{srgb:"#009774",p3:"color(display-p3 0.0085 0.582 0.4604)"}},grey:{solid:"#9398b0",semi:"#33373c",pattern:"#7c8187",highlight:{srgb:"#9cb4cb",p3:"color(display-p3 0.6299 0.7012 0.7856)"}},"light-blue":{solid:"#4dabf7",semi:"#2a3642",pattern:"#4d7aa9",highlight:{srgb:"#00bdc8",p3:"color(display-p3 0.0023 0.7259 0.7735)"}},"light-green":{solid:"#40c057",semi:"#2a3830",pattern:"#4e874e",highlight:{srgb:"#00a000",p3:"color(display-p3 0.2711 0.6172 0.0195)"}},"light-red":{solid:"#ff8787",semi:"#3b3235",pattern:"#a56767",highlight:{srgb:"#db005b",p3:"color(display-p3 0.7849 0.0585 0.3589)"}},"light-violet":{solid:"#e599f7",semi:"#383442",pattern:"#9770a9",highlight:{srgb:"#c400c7",p3:"color(display-p3 0.7024 0.0403 0.753)"}},orange:{solid:"#f76707",semi:"#3a2e2a",pattern:"#9f552d",highlight:{srgb:"#d07a00",p3:"color(display-p3 0.7699 0.4937 0.0085)"}},red:{solid:"#e03131",semi:"#36292b",pattern:"#8f3734",highlight:{srgb:"#de002c",p3:"color(display-p3 0.7978 0.0509 0.2035)"}},violet:{solid:"#ae3ec9",semi:"#31293c",pattern:"#763a8b",highlight:{srgb:"#9e00ee",p3:"color(display-p3 0.5651 0.0079 0.8986)"}},yellow:{solid:"#ffc034",semi:"#3c3934",pattern:"#fecb92",highlight:{srgb:"#d2b700",p3:"color(display-p3 0.8078 0.7225 0.0312)"}}}};function getDefaultColorTheme(e){return e.isDarkMode?eg.darkMode:eg.lightMode}let ef=StyleProp.defineEnum("tldraw:color",{defaultValue:"black",values:eh}),em=StyleProp.defineEnum("tldraw:labelColor",{defaultValue:"black",values:eh}),ey=StyleProp.defineEnum("tldraw:dash",{defaultValue:"draw",values:["draw","solid","dashed","dotted"]}),eb=StyleProp.defineEnum("tldraw:fill",{defaultValue:"none",values:["none","semi","solid","pattern"]}),ew=StyleProp.defineEnum("tldraw:font",{defaultValue:"draw",values:["draw","sans","serif","mono"]}),eS={draw:"'tldraw_draw', sans-serif",sans:"'tldraw_sans', sans-serif",serif:"'tldraw_serif', serif",mono:"'tldraw_mono', monospace"},ev=StyleProp.defineEnum("tldraw:size",{defaultValue:"m",values:["s","m","l","xl"]}),ex=["arrow","triangle","square","dot","pipe","diamond","inverted","bar","none"],eT=StyleProp.defineEnum("tldraw:arrowheadStart",{defaultValue:"none",values:ex}),eP=StyleProp.defineEnum("tldraw:arrowheadEnd",{defaultValue:"arrow",values:ex}),eC=r.T.union("type",{binding:r.T.object({type:r.T.literal("binding"),boundShapeId:j,normalizedAnchor:p,isExact:r.T.boolean,isPrecise:r.T.boolean}),point:r.T.object({type:r.T.literal("point"),x:r.T.number,y:r.T.number})}),ek={labelColor:em,color:ef,fill:eb,dash:ey,size:ev,arrowheadStart:eT,arrowheadEnd:eP,font:ew,start:eC,end:eC,bend:r.T.number,text:r.T.string,labelPosition:r.T.number},eI={AddLabelColor:1,AddIsPrecise:2,AddLabelPosition:3},eE=(0,a.zn)({currentVersion:eI.AddLabelPosition,migrators:{[eI.AddLabelColor]:{up:e=>({...e,props:{...e.props,labelColor:"black"}}),down:e=>{let{labelColor:t,...n}=e.props;return{...e,props:n}}},[eI.AddIsPrecise]:{up:e=>{let{start:t,end:n}=e.props;return{...e,props:{...e.props,start:"binding"===t.type?{...t,isPrecise:!(.5===t.normalizedAnchor.x&&.5===t.normalizedAnchor.y)}:t,end:"binding"===n.type?{...n,isPrecise:!(.5===n.normalizedAnchor.x&&.5===n.normalizedAnchor.y)}:n}}},down:e=>{let{start:t,end:n}=e.props,r={...t},i={...n};return"binding"===r.type&&(r.isPrecise||(r.normalizedAnchor={x:.5,y:.5}),delete r.isPrecise),"binding"===i.type&&(i.isPrecise||(i.normalizedAnchor={x:.5,y:.5}),delete i.isPrecise),{...e,props:{...e.props,start:r,end:i}}}},[eI.AddLabelPosition]:{up:e=>({...e,props:{...e.props,labelPosition:.5}}),down:e=>{let{labelPosition:t,...n}=e.props;return{...e,props:n}}}}}),e_={w:r.T.nonZeroNumber,h:r.T.nonZeroNumber,assetId:i.nullable(),url:r.T.linkUrl},eM={NullAssetId:1,MakeUrlsValid:2},ej=(0,a.zn)({currentVersion:eM.MakeUrlsValid,migrators:{[eM.NullAssetId]:{up:e=>void 0===e.props.assetId?{...e,props:{...e.props,assetId:null}}:e,down:e=>{if(null===e.props.assetId){let{assetId:t,...n}=e.props;return{...e,props:n}}return e}},[eM.MakeUrlsValid]:{up:e=>{let t=e.props.url;return""===t||r.T.linkUrl.isValid(e.props.url)?e:{...e,props:{...e.props,url:""}}},down:e=>e}}}),eA=r.T.object({type:r.T.literalEnum("free","straight"),points:r.T.arrayOf(p)}),e$={color:ef,fill:eb,dash:ey,size:ev,segments:r.T.arrayOf(eA),isComplete:r.T.boolean,isClosed:r.T.boolean,isPen:r.T.boolean},eD={AddInPen:1},eO=(0,a.zn)({currentVersion:eD.AddInPen,migrators:{[eD.AddInPen]:{up:e=>{let{points:t}=e.props.segments[0];if(0===t.length)return{...e,props:{...e.props,isPen:!1}};let n=!(0===t[0].z||.5===t[0].z);return t[1]&&(n=n&&!(0===t[1].z||.5===t[1].z)),{...e,props:{...e.props,isPen:n}}},down:e=>{let{isPen:t,...n}=e.props;return{...e,props:{...n}}}}}});var eB=n(2601);let eF=/(^\/r\/[^/]+\/?$)/,safeParseUrl=e=>{try{return new URL(e)}catch(e){return}},eU=[{type:"tldraw",title:"tldraw",hostnames:["beta.tldraw.com","tldraw.com","localhost:3000"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!0,overridePermissions:{"allow-top-navigation":!0},toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(eF))return e},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(eF))return e}},{type:"figma",title:"Figma",hostnames:["figma.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{if(e.match(/https:\/\/([\w\.-]+\.)?figma.com\/(file|proto)\/([0-9a-zA-Z]{22,128})(?:\/.*)?$/)&&!e.includes("figma.com/embed"))return`https://www.figma.com/embed?embed_host=share&url=${e}`},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/^\/embed\/?$/)){let e=t.searchParams.get("url");if(e)return e}}},{type:"google_maps",title:"Google Maps",hostnames:["google.*"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{if(e.includes("/maps/")){let t;let n=e.match(/@(.*),(.*),(.*)z/);if(n){let[,r,i,o]=n,a=new URL(e).host.replace("www.","");t=`https://${a}/maps/embed/v1/view?key=${eB.env.NEXT_PUBLIC_GC_API_KEY}&center=${r},${i}&zoom=${o}`}else t="";return t}},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(!t)return;let n=t.pathname.match(/^\/maps\/embed\/v1\/view\/?$/);if(n&&t.searchParams.has("center")&&t.searchParams.get("zoom")){let e=t.searchParams.get("zoom"),[n,r]=t.searchParams.get("center").split(",");return`https://www.google.com/maps/@${n},${r},${e}z`}}},{type:"val_town",title:"Val Town",hostnames:["val.town"],minWidth:260,minHeight:100,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=safeParseUrl(e),n=t&&t.pathname.match(/\/v\/([^/]+)\/?/);if(n)return`https://www.val.town/embed/${n[1]}`},fromEmbedUrl:e=>{let t=safeParseUrl(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://www.val.town/v/${n[1]}`}},{type:"codesandbox",title:"CodeSandbox",hostnames:["codesandbox.io"],minWidth:300,minHeight:300,width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=safeParseUrl(e),n=t&&t.pathname.match(/\/s\/([^/]+)\/?/);if(n)return`https://codesandbox.io/embed/${n[1]}`},fromEmbedUrl:e=>{let t=safeParseUrl(e),n=t&&t.pathname.match(/\/embed\/([^/]+)\/?/);if(n)return`https://codesandbox.io/s/${n[1]}`}},{type:"codepen",title:"Codepen",hostnames:["codepen.io"],minWidth:300,minHeight:300,width:520,height:400,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=e.match(/https:\/\/codepen.io\/([^/]+)\/pen\/([^/]+)/);if(t){let[e,n,r]=t;return`https://codepen.io/${n}/embed/${r}`}},fromEmbedUrl:e=>{let t=e.match(/https:\/\/codepen.io\/([^/]+)\/embed\/([^/]+)/);if(t){let[e,n,r]=t;return`https://codepen.io/${n}/pen/${r}`}}},{type:"scratch",title:"Scratch",hostnames:["scratch.mit.edu"],width:520,height:400,doesResize:!1,canUnmount:!1,toEmbedUrl:e=>{let t=e.match(/https?:\/\/scratch.mit.edu\/projects\/([^/]+)/);if(t){let[e,n]=t;return`https://scratch.mit.edu/projects/embed/${n}`}},fromEmbedUrl:e=>{let t=e.match(/https:\/\/scratch.mit.edu\/projects\/embed\/([^/]+)/);if(t){let[e,n]=t;return`https://scratch.mit.edu/projects/${n}`}}},{type:"youtube",title:"YouTube",hostnames:["*.youtube.com","youtube.com","youtu.be"],width:800,height:450,doesResize:!0,canUnmount:!1,overridePermissions:{"allow-presentation":!0},isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=safeParseUrl(e);if(!t)return;let n=t.hostname.replace(/^www./,"");if("youtu.be"===n){let e=t.pathname.split("/").filter(Boolean)[0];return`https://www.youtube.com/embed/${e}`}if(("youtube.com"===n||"m.youtube.com"===n)&&t.pathname.match(/^\/watch/)){let e=t.searchParams.get("v");return`https://www.youtube.com/embed/${e}`}},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(!t)return;let n=t.hostname.replace(/^www./,"");if("youtube.com"===n){let e=t.pathname.match(/^\/embed\/([^/]+)\/?/);if(e)return`https://www.youtube.com/watch?v=${e[1]}`}}},{type:"google_calendar",title:"Google Calendar",hostnames:["calendar.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,instructionLink:"https://support.google.com/calendar/answer/41207?hl=en",toEmbedUrl:e=>{let t=safeParseUrl(e),n=t?.searchParams.get("cid");if(t?.pathname.match(/\/calendar\/u\/0/)&&n){t.pathname="/calendar/embed";let e=Array.from(t.searchParams.keys());for(let n of e)t.searchParams.delete(n);return t.searchParams.set("src",n),t.href}},fromEmbedUrl:e=>{let t=safeParseUrl(e),n=t?.searchParams.get("src");if(t?.pathname.match(/\/calendar\/embed/)&&n){t.pathname="/calendar/u/0";let e=Array.from(t.searchParams.keys());for(let n of e)t.searchParams.delete(n);return t.searchParams.set("cid",n),t.href}}},{type:"google_slides",title:"Google Slides",hostnames:["docs.google.*"],width:720,height:500,minWidth:460,minHeight:360,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=safeParseUrl(e);if(t?.pathname.match(/^\/presentation/)&&t?.pathname.match(/\/pub\/?$/)){t.pathname=t.pathname.replace(/\/pub$/,"/embed");let e=Array.from(t.searchParams.keys());for(let n of e)t.searchParams.delete(n);return t.href}},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t?.pathname.match(/^\/presentation/)&&t?.pathname.match(/\/embed\/?$/)){t.pathname=t.pathname.replace(/\/embed$/,"/pub");let e=Array.from(t.searchParams.keys());for(let n of e)t.searchParams.delete(n);return t.href}}},{type:"github_gist",title:"GitHub Gist",hostnames:["gist.github.com"],width:720,height:500,doesResize:!0,canUnmount:!0,toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/\/([^/]+)\/([^/]+)/)){if(!e.split("/").pop())return;return e}}},{type:"replit",title:"Replit",hostnames:["replit.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/))return`${e}?embed=true`},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/\/@([^/]+)\/([^/]+)/)&&t.searchParams.has("embed"))return t.searchParams.delete("embed"),t.href}},{type:"felt",title:"Felt",hostnames:["felt.com"],width:720,height:500,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/^\/map\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/^\/embed\/map\//))return t.pathname=t.pathname.replace(/^\/embed/,""),t.href}},{type:"spotify",title:"Spotify",hostnames:["open.spotify.com"],width:720,height:500,minHeight:500,overrideOutlineRadius:12,doesResize:!0,canUnmount:!1,toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/^\/(artist|album)\//))return t.origin+"/embed"+t.pathname},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/^\/embed\/(artist|album)\//))return t.origin+t.pathname.replace(/^\/embed/,"")}},{type:"vimeo",title:"Vimeo",hostnames:["vimeo.com","player.vimeo.com"],width:640,height:360,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&"vimeo.com"===t.hostname&&t.pathname.match(/^\/[0-9]+/))return"https://player.vimeo.com/video/"+t.pathname.split("/")[1]+"?title=0&byline=0"},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&"player.vimeo.com"===t.hostname){let e=t.pathname.match(/^\/video\/([^/]+)\/?$/);if(e)return"https://vimeo.com/"+e[1]}}},{type:"excalidraw",title:"Excalidraw",hostnames:["excalidraw.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!0,toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.hash.match(/#room=/))return e},fromEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.hash.match(/#room=/))return e}},{type:"observable",title:"Observable",hostnames:["observablehq.com"],width:720,height:500,doesResize:!0,canUnmount:!1,isAspectRatioLocked:!1,backgroundColor:"#fff",toEmbedUrl:e=>{let t=safeParseUrl(e);if(t&&t.pathname.match(/^\/@([^/]+)\/([^/]+)\/?$/))return`${t.origin}/embed${t.pathname}?cell=*`;if(t&&t.pathname.match(/^\/d\/([^/]+)\/?$/)){let e=t.pathname.replace(/^\/d/,"");return`${t.origin}/embed${e}?cell=*`}},fromEmbedUrl:e=>{let t=safeParseUrl(e);return t&&t.pathname.match(/^\/embed\/@([^/]+)\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","")}#cell-*`:t&&t.pathname.match(/^\/embed\/([^/]+)\/?$/)?`${t.origin}${t.pathname.replace("/embed","/d")}#cell-*`:void 0}}],eL={"allow-downloads-without-user-activation":!1,"allow-downloads":!1,"allow-modals":!1,"allow-orientation-lock":!1,"allow-pointer-lock":!1,"allow-popups":!0,"allow-popups-to-escape-sandbox":!1,"allow-presentation":!1,"allow-storage-access-by-user-activation":!1,"allow-top-navigation":!1,"allow-top-navigation-by-user-activation":!1,"allow-scripts":!0,"allow-same-origin":!0,"allow-forms":!0},eR={w:r.T.nonZeroNumber,h:r.T.nonZeroNumber,url:r.T.string},ez={GenOriginalUrlInEmbed:1,RemoveDoesResize:2,RemoveTmpOldUrl:3,RemovePermissionOverrides:4},eN=(0,a.zn)({currentVersion:ez.RemovePermissionOverrides,migrators:{[ez.GenOriginalUrlInEmbed]:{up:e=>{let t;let n=e.props.url,r=new URL(n).host.replace("www.","");for(let e of eU)if(e.hostnames.includes(r))try{t=e.fromEmbedUrl(n)}catch(e){console.warn(e)}return{...e,props:{...e.props,tmpOldUrl:e.props.url,url:t??""}}},down:e=>{let t=e.props.tmpOldUrl;if(!t||""===t){let n=e.props.url,r=new URL(n).host.replace("www.","");for(let e of eU)if(e.hostnames.includes(r))try{t=e.toEmbedUrl(n)}catch(e){console.warn(e)}}let{tmpOldUrl:n,...r}=e.props;return{...e,props:{...r,url:t??""}}}},[ez.RemoveDoesResize]:{up:e=>{let{doesResize:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props,doesResize:!0}})},[ez.RemoveTmpOldUrl]:{up:e=>{let{tmpOldUrl:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props}})},[ez.RemovePermissionOverrides]:{up:e=>{let{overridePermissions:t,...n}=e.props;return{...e,props:{...n}}},down:e=>({...e,props:{...e.props}})}}}),eV={w:r.T.nonZeroNumber,h:r.T.nonZeroNumber,name:r.T.string},eH=(0,a.zn)({}),eG=StyleProp.defineEnum("tldraw:horizontalAlign",{defaultValue:"middle",values:["start","middle","end","start-legacy","end-legacy","middle-legacy"]}),eW=StyleProp.defineEnum("tldraw:verticalAlign",{defaultValue:"middle",values:["start","middle","end"]}),eZ=StyleProp.defineEnum("tldraw:geo",{defaultValue:"rectangle",values:["cloud","rectangle","ellipse","triangle","diamond","pentagon","hexagon","octagon","star","rhombus","rhombus-2","oval","trapezoid","arrow-right","arrow-left","arrow-up","arrow-down","x-box","check-box"]}),eK={geo:eZ,labelColor:em,color:ef,fill:eb,dash:ey,size:ev,font:ew,align:eG,verticalAlign:eW,url:r.T.linkUrl,w:r.T.nonZeroNumber,h:r.T.nonZeroNumber,growY:r.T.positiveNumber,text:r.T.string},eY={AddUrlProp:1,AddLabelColor:2,RemoveJustify:3,AddCheckBox:4,AddVerticalAlign:5,MigrateLegacyAlign:6,AddCloud:7,MakeUrlsValid:8},eX=(0,a.zn)({currentVersion:eY.MakeUrlsValid,migrators:{[eY.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...n}=e.props;return{...e,props:n}}},[eY.AddLabelColor]:{up:e=>({...e,props:{...e.props,labelColor:"black"}}),down:e=>{let{labelColor:t,...n}=e.props;return{...e,props:n}}},[eY.RemoveJustify]:{up:e=>{let t=e.props.align;return"justify"===t&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})},[eY.AddCheckBox]:{up:e=>({...e}),down:e=>({...e,props:{...e.props,geo:"check-box"===e.props.geo?"rectangle":e.props.geo}})},[eY.AddVerticalAlign]:{up:e=>({...e,props:{...e.props,verticalAlign:"middle"}}),down:e=>{let{verticalAlign:t,...n}=e.props;return{...e,props:n}}},[eY.MigrateLegacyAlign]:{up:e=>{let t;switch(e.props.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy"}return{...e,props:{...e.props,align:t}}},down:e=>{let t;switch(e.props.align){case"start-legacy":t="start";break;case"end-legacy":t="end";break;case"middle-legacy":t="middle";break;default:t=e.props.align}return{...e,props:{...e.props,align:t}}}},[eY.AddCloud]:{up:e=>e,down:e=>{if("cloud"===e.props.geo)return{...e,props:{...e.props,geo:"rectangle"}}}},[eY.MakeUrlsValid]:{up:e=>{let t=e.props.url;return""===t||r.T.linkUrl.isValid(e.props.url)?e:{...e,props:{...e.props,url:""}}},down:e=>e}}}),eJ={},eQ=(0,a.zn)({}),e0={color:ef,size:ev,segments:r.T.arrayOf(eA),isComplete:r.T.boolean,isPen:r.T.boolean},e1=(0,a.zn)({}),e2=r.T.object({topLeft:p,bottomRight:p}),e3={w:r.T.nonZeroNumber,h:r.T.nonZeroNumber,playing:r.T.boolean,url:r.T.linkUrl,assetId:i.nullable(),crop:e2.nullable()},e5={AddUrlProp:1,AddCropProp:2,MakeUrlsValid:3},e6=(0,a.zn)({currentVersion:e5.MakeUrlsValid,migrators:{[e5.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...n}=e.props;return{...e,props:n}}},[e5.AddCropProp]:{up:e=>({...e,props:{...e.props,crop:null}}),down:e=>{let{crop:t,...n}=e.props;return{...e,props:n}}},[e5.MakeUrlsValid]:{up:e=>{let t=e.props.url;return""===t||r.T.linkUrl.isValid(e.props.url)?e:{...e,props:{...e.props,url:""}}},down:e=>e}}}),e4=StyleProp.defineEnum("tldraw:spline",{defaultValue:"line",values:["cubic","line"]}),e8=r.T.object({id:r.T.string,index:r.T.indexKey,x:r.T.number,y:r.T.number}),e7={color:ef,dash:ey,size:ev,spline:e4,points:r.T.dict(r.T.string,e8)},e9={AddSnapHandles:1,RemoveExtraHandleProps:2,HandlesToPoints:3,PointIndexIds:4},te=(0,a.zn)({currentVersion:e9.PointIndexIds,migrators:{[e9.AddSnapHandles]:{up:e=>{let t=(0,G.p$)(e.props.handles);for(let e in t)t[e].canSnap=!0;return{...e,props:{...e.props,handles:t}}},down:e=>{let t=(0,G.p$)(e.props.handles);for(let e in t)delete t[e].canSnap;return{...e,props:{...e.props,handles:t}}}},[e9.RemoveExtraHandleProps]:{up:e=>({...e,props:{...e.props,handles:(0,G.Ls)(Object.values(e.props.handles).map(e=>[e.index,{x:e.x,y:e.y}]))}}),down:e=>{let t=Object.entries(e.props.handles).map(([e,t])=>({index:e,...t})).sort(G.hl);return{...e,props:{...e.props,handles:Object.fromEntries(t.map((e,n)=>{let r=0===n?"start":n===t.length-1?"end":`handle:${e.index}`;return[r,{id:r,type:"vertex",canBind:!1,canSnap:!0,index:e.index,x:e.x,y:e.y}]}))}}}},[e9.HandlesToPoints]:{up:e=>{let{handles:t,...n}=e.props,r=Object.entries(t).map(([e,{x:t,y:n}])=>({x:t,y:n,index:e})).sort(G.hl);return{...e,props:{...n,points:r.map(({x:e,y:t})=>({x:e,y:t}))}}},down:e=>{let{points:t,...n}=e.props,r=(0,G.H$)(t.length);return{...e,props:{...n,handles:Object.fromEntries(t.map((e,t)=>{let n=r[t];return[n,{x:e.x,y:e.y}]}))}}}},[e9.PointIndexIds]:{up:e=>{let{points:t,...n}=e.props,r=(0,G.H$)(t.length);return{...e,props:{...n,points:Object.fromEntries(t.map((e,t)=>{let n=r[t];return[n,{id:n,index:n,x:e.x,y:e.y}]}))}}},down:e=>{let t=Object.values(e.props.points).sort(G.hl);return{...e,props:{...e.props,points:t.map(({x:e,y:t})=>({x:e,y:t}))}}}}}}),tt={color:ef,size:ev,font:ew,align:eG,verticalAlign:eW,growY:r.T.positiveNumber,url:r.T.linkUrl,text:r.T.string},tn={AddUrlProp:1,RemoveJustify:2,MigrateLegacyAlign:3,AddVerticalAlign:4,MakeUrlsValid:5},tr=(0,a.zn)({currentVersion:tn.MakeUrlsValid,migrators:{[tn.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...n}=e.props;return{...e,props:n}}},[tn.RemoveJustify]:{up:e=>{let t=e.props.align;return"justify"===t&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})},[tn.MigrateLegacyAlign]:{up:e=>{let t;switch(e.props.align){case"start":t="start-legacy";break;case"end":t="end-legacy";break;default:t="middle-legacy"}return{...e,props:{...e.props,align:t}}},down:e=>{let t;switch(e.props.align){case"start-legacy":t="start";break;case"end-legacy":t="end";break;case"middle-legacy":t="middle";break;default:t=e.props.align}return{...e,props:{...e.props,align:t}}}},[tn.AddVerticalAlign]:{up:e=>({...e,props:{...e.props,verticalAlign:"middle"}}),down:e=>{let{verticalAlign:t,...n}=e.props;return{...e,props:n}}},[tn.MakeUrlsValid]:{up:e=>{let t=e.props.url;return""===t||r.T.linkUrl.isValid(e.props.url)?e:{...e,props:{...e.props,url:""}}},down:e=>e}}}),ti={color:ef,size:ev,font:ew,align:eG,w:r.T.nonZeroNumber,text:r.T.string,scale:r.T.nonZeroNumber,autoSize:r.T.boolean},to={RemoveJustify:1},ta=(0,a.zn)({currentVersion:to.RemoveJustify,migrators:{[to.RemoveJustify]:{up:e=>{let t=e.props.align;return"justify"===t&&(t="start"),{...e,props:{...e.props,align:t}}},down:e=>({...e})}}}),ts={w:r.T.nonZeroNumber,h:r.T.nonZeroNumber,time:r.T.number,playing:r.T.boolean,url:r.T.linkUrl,assetId:i.nullable()},tl={AddUrlProp:1,MakeUrlsValid:2},tc=(0,a.zn)({currentVersion:tl.MakeUrlsValid,migrators:{[tl.AddUrlProp]:{up:e=>({...e,props:{...e.props,url:""}}),down:e=>{let{url:t,...n}=e.props;return{...e,props:n}}},[tl.MakeUrlsValid]:{up:e=>{let t=e.props.url;return""===t||r.T.linkUrl.isValid(e.props.url)?e:{...e,props:{...e.props,url:""}}},down:e=>e}}}),tu={RemoveCodeAndIconShapeTypes:1,AddInstancePresenceType:2,RemoveTLUserAndPresenceAndAddPointer:3,RemoveUserDocument:4},td=(0,a.zn)({currentVersion:tu.RemoveUserDocument,migrators:{[tu.RemoveCodeAndIconShapeTypes]:{up:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>"shape"!==t.typeName||"icon"!==t.type&&"code"!==t.type)),down:e=>e},[tu.AddInstancePresenceType]:{up:e=>e,down:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>"instance_presence"!==t.typeName))},[tu.RemoveTLUserAndPresenceAndAddPointer]:{up:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>!t.typeName.match(/^(user|user_presence)$/))),down:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>"pointer"!==t.typeName))},[tu.RemoveUserDocument]:{up:e=>Object.fromEntries(Object.entries(e).filter(([e,t])=>!t.typeName.match("user_document"))),down:e=>e}}}),tp={arrow:{migrations:eE,props:ek},bookmark:{migrations:ej,props:e_},draw:{migrations:eO,props:e$},embed:{migrations:eN,props:eR},frame:{migrations:eH,props:eV},geo:{migrations:eX,props:eK},group:{migrations:eQ,props:eJ},highlight:{migrations:e1,props:e0},image:{migrations:e6,props:e3},line:{migrations:te,props:e7},note:{migrations:tr,props:tt},text:{migrations:ta,props:ti},video:{migrations:tc,props:ts}};function createTLSchema({shapes:e=tp}={}){let t=new Map;for(let n of(0,G.UM)(e))for(let e of getShapePropKeysByStyle(n.props??{}).keys()){if(t.has(e.id)&&t.get(e.id)!==e)throw Error(`Multiple StyleProp instances with the same id: ${e.id}`);t.set(e.id,e)}let n=createShapeRecordType(e),r=createInstanceRecordType(t);return a.sS.create({asset:eu,camera:d,document:Y,instance:r,instance_page_state:O,page:k,shape:n,instance_presence:H,pointer:L},{snapshotMigrations:td,onValidationFailure:onValidationFailure,createIntegrityChecker:createIntegrityChecker})}let th=[{locale:"ca",label:"Catal\xe0"},{locale:"cs",label:"etina"},{locale:"da",label:"Danish"},{locale:"de",label:"Deutsch"},{locale:"en",label:"English"},{locale:"es",label:"Espa\xf1ol"},{locale:"fr",label:"Fran\xe7ais"},{locale:"gl",label:"Galego"},{locale:"hr",label:"Hrvatski"},{locale:"it",label:"Italiano"},{locale:"hu",label:"Magyar"},{locale:"no",label:"Norwegian"},{locale:"pl",label:"Polski"},{locale:"pt-br",label:"Portugu\xeas - Brasil"},{locale:"pt-pt",label:"Portugu\xeas - Europeu"},{locale:"ro",label:"Rom\xe2n"},{locale:"ru",label:"Russian"},{locale:"sl",label:"Slovenina"},{locale:"fi",label:"Suomi"},{locale:"sv",label:"Svenska"},{locale:"vi",label:"Ting Vit"},{locale:"tr",label:"T\xfcrk\xe7e"},{locale:"uk",label:"Ukrainian"},{locale:"he",label:""},{locale:"ar",label:""},{locale:"fa",label:""},{locale:"ku",label:""},{locale:"ne",label:""},{locale:"hi-in",label:""},{locale:"te",label:""},{locale:"th",label:""},{locale:"my",label:""},{locale:"ko-kr",label:""},{locale:"ja",label:""},{locale:"zh-cn",label:""},{locale:"zh-tw",label:" ()"}];function getDefaultTranslationLocale(){let e="undefined"!=typeof window?window.navigator.languages??["en"]:["en"];return _getDefaultTranslationLocale(e)}function _getDefaultTranslationLocale(e){for(let t of e){let e=getSupportedLocale(t);if(e)return e}return"en"}let tg={zh:"zh-cn",pt:"pt-br",ko:"ko-kr",hi:"hi-in"};function getSupportedLocale(e){let t=th.find(t=>t.locale===e.toLowerCase());if(t)return t.locale;let[n,r]=e.split(/[-_]/).map(e=>e.toLowerCase());if(r){let e=th.find(e=>e.locale===n);if(e)return e.locale}return n in tg?tg[n]:null}},3112:function(e,t,n){"use strict";let r;function rotateArray(e,t){return e.map((n,r)=>e[(r+t)%e.length])}function dedupe(e,t){let n=[];t:for(let r of e){for(let e of n)if(t?t(r,e):r===e)continue t;n.push(r)}return n}function compact(e){return e.filter(e=>null!=e)}function last(e){return e[e.length-1]}function minBy(e,t){let n;let r=1/0;for(let i of e){let e=t(i);e<r&&(n=i,r=e)}return n}function partition(e,t){let n=[],r=[];for(let i of e)t(i)?n.push(i):r.push(i);return[n,r]}function areArraysShallowEqual(e,t){if(e===t)return!0;if(e.length!==t.length)return!1;for(let n=0;n<e.length;n++)if(!Object.is(e[n],t[n]))return!1;return!0}function throttle(e,t){let n,r;return function(...i){return n||(n=!0,setTimeout(()=>n=!1,t),r=e(...i)),r}}function omitFromStackTrace(e){let wrappedFn=(...t)=>{try{return e(...t)}catch(e){throw e instanceof Error&&Error.captureStackTrace&&Error.captureStackTrace(e,wrappedFn),e}};return wrappedFn}function noop(){}n.d(t,{P6:function(){return FileHelpers},xe:function(){return MediaHelpers},bM:function(){return PngHelpers},x4:function(){return i},R4:function(){return g},lw:function(){return annotateError},E8:function(){return areArraysShallowEqual},dn:function(){return areObjectsShallowEqual},hu:function(){return o},kP:function(){return a},oA:function(){return compact},Ds:function(){return debounce},D8:function(){return dedupe},p$:function(){return deepCopy},iP:function(){return exhaustiveSwitchError},H4:function(){return filterEntries},wi:function(){return getErrorAnnotations},lr:function(){return getFirstFromIterable},Aq:function(){return getHashForBuffer},pT:function(){return getHashForObject},jK:function(){return getHashForString},_L:function(){return getIndexAbove},Xg:function(){return getIndexBelow},eI:function(){return getIndexBetween},H$:function(){return getIndices},vw:function(){return getIndicesAbove},dk:function(){return getIndicesBelow},Xv:function(){return getIndicesBetween},eg:function(){return getOwnProperty},nr:function(){return object_hasOwnProperty},VN:function(){return invLerp},$K:function(){return isDefined},GT:function(){return isNonNull},cF:function(){return isNonNullish},Z$:function(){return last},t7:function(){return lerp},L8:function(){return lns},Fm:function(){return mapObjectMapValues},F:function(){return minBy},vm:function(){return modulate},ZT:function(){return noop},EP:function(){return objectMapEntries},Ls:function(){return objectMapFromEntries},GH:function(){return objectMapKeys},UM:function(){return objectMapValues},fP:function(){return omitFromStackTrace},uK:function(){return partition},un:function(){return promiseWithResolve},TE:function(){return rafThrottle},Vk:function(){return rng},R8:function(){return rotateArray},uv:function(){return sortById},hl:function(){return sortByIndex},v4:function(){return f},P2:function(){return throttle},xP:function(){return throttledRaf},LP:function(){return validateIndexKey},q4:function(){return warnDeprecatedGetter}});let i={ok:e=>({ok:!0,value:e}),err:e=>({ok:!1,error:e})};function exhaustiveSwitchError(e,t){let n=t&&e&&"object"==typeof e&&t in e?e[t]:e;throw Error(`Unknown switch case ${n}`)}let o=omitFromStackTrace((e,t)=>{if(!e)throw Error(t||"Assertion Error")}),a=omitFromStackTrace((e,t)=>{if(null==e)throw Error(t??"value must be defined");return e});function promiseWithResolve(){let e,t;let n=new Promise((n,r)=>{e=n,t=r});return Object.assign(n,{resolve:e,reject:t})}function debounce(e,t){let n;let fn=(...r)=>(n||((n={}).promise=new Promise((e,t)=>{n.resolve=e,n.reject=t})),clearTimeout(n.timeout),n.latestArgs=r,n.timeout=setTimeout(()=>{let t=n;n=void 0;try{t.resolve(e(...t.latestArgs))}catch(e){t.reject(e)}},t),n.promise);return fn.cancel=()=>{n&&clearTimeout(n.timeout)},fn}let l=new WeakMap;function annotateError(e,t){if("object"!=typeof e||null===e)return;let n=l.get(e);n||(n={tags:{},extras:{}},l.set(e,n)),t.tags&&(n.tags={...n.tags,...t.tags}),t.extras&&(n.extras={...n.extras,...t.extras})}function getErrorAnnotations(e){return l.get(e)??{tags:{},extras:{}}}let FileHelpers=class FileHelpers{static async base64ToFile(e){return fetch(e).then(function(e){return e.arrayBuffer()})}static async fileToBase64(e){return await new Promise((t,n)=>{if(e){let r=new FileReader;r.readAsDataURL(e),r.onload=()=>t(r.result),r.onerror=e=>n(e),r.onabort=e=>n(e)}})}};function getHashForString(e){let t=0;for(let n=0;n<e.length;n++)t=(t<<5)-t+e.charCodeAt(n)|0;return t+""}function getHashForObject(e){return getHashForString(JSON.stringify(e))}function getHashForBuffer(e){let t=new DataView(e),n=0;for(let e=0;e<t.byteLength;e++)n=(n<<5)-n+t.getUint8(e)|0;return n+""}function lns(e){let t=e.split("");return t.push(...t.splice(0,Math.round(t.length/5))),t.push(...t.splice(0,Math.round(t.length/4))),t.push(...t.splice(0,Math.round(t.length/3))),t.push(...t.splice(0,Math.round(t.length/2))),t.reverse().map(e=>+e?5>+e?5+ +e:+e>5?+e-5:e:e).join("")}function getFirstFromIterable(e){return e.values().next().value}let c=[0,1996959894,3993919788,2567524794,124634137,1886057615,3915621685,2657392035,249268274,2044508324,3772115230,2547177864,162941995,2125561021,3887607047,2428444049,498536548,1789927666,4089016648,2227061214,450548861,1843258603,4107580753,2211677639,325883990,1684777152,4251122042,2321926636,335633487,1661365465,4195302755,2366115317,997073096,1281953886,3579855332,2724688242,1006888145,1258607687,3524101629,2768942443,901097722,1119000684,3686517206,2898065728,853044451,1172266101,3705015759,2882616665,651767980,1373503546,3369554304,3218104598,565507253,1454621731,3485111705,3099436303,671266974,1594198024,3322730930,2970347812,795835527,1483230225,3244367275,3060149565,1994146192,31158534,2563907772,4023717930,1907459465,112637215,2680153253,3904427059,2013776290,251722036,2517215374,3775830040,2137656763,141376813,2439277719,3865271297,1802195444,476864866,2238001368,4066508878,1812370925,453092731,2181625025,4111451223,1706088902,314042704,2344532202,4240017532,1658658271,366619977,2362670323,4224994405,1303535960,984961486,2747007092,3569037538,1256170817,1037604311,2765210733,3554079995,1131014506,879679996,2909243462,3663771856,1141124467,855842277,2852801631,3708648649,1342533948,654459306,3188396048,3373015174,1466479909,544179635,3110523913,3462522015,1591671054,702138776,2966460450,3352799412,1504918807,783551873,3082640443,3233442989,3988292384,2596254646,62317068,1957810842,3939845945,2647816111,81470997,1943803523,3814918930,2489596804,225274430,2053790376,3826175755,2466906013,167816743,2097651377,4027552580,2265490386,503444072,1762050814,4150417245,2154129355,426522225,1852507879,4275313526,2312317920,282753626,1742555852,4189708143,2394877945,397917763,1622183637,3604390888,2714866558,953729732,1340076626,3518719985,2797360999,1068828381,1219638859,3624741850,2936675148,906185462,1090812512,3747672003,2825379669,829329135,1181335161,3412177804,3160834842,628085408,1382605366,3423369109,3138078467,570562233,1426400815,3317316542,2998733608,733239954,1555261956,3268935591,3050360625,752459403,1541320221,2607071920,3965973030,1969922972,40735498,2617837225,3943577151,1913087877,83908371,2512341634,3803740692,2075208622,213261112,2463272603,3855990285,2094854071,198958881,2262029012,4057260610,1759359992,534414190,2176718541,4139329115,1873836001,414664567,2282248934,4279200368,1711684554,285281116,2405801727,4167216745,1634467795,376229701,2685067896,3608007406,1308918612,956543938,2808555105,3495958263,1231636301,1047427035,2932959818,3654703836,1088359270,936918e3,2847714899,3736837829,1202900863,817233897,3183342108,3401237130,1404277552,615818150,3134207493,3453421203,1423857449,601450431,3009837614,3294710456,1567103746,711928724,3020668471,3272380065,1510334235,755167117];"undefined"!=typeof Int32Array&&(c=new Int32Array(c));let crc=(e,t)=>{let n=0===t?0:-1^~~t;for(let t=0;t<e.length;t++)n=c[(n^e[t])&255]^n>>>8;return -1^n};let PngHelpers=class PngHelpers{static isPng(e,t){return 137===e.getUint8(t+0)&&80===e.getUint8(t+1)&&78===e.getUint8(t+2)&&71===e.getUint8(t+3)&&13===e.getUint8(t+4)&&10===e.getUint8(t+5)&&26===e.getUint8(t+6)&&10===e.getUint8(t+7)}static getChunkType(e,t){return[String.fromCharCode(e.getUint8(t)),String.fromCharCode(e.getUint8(t+1)),String.fromCharCode(e.getUint8(t+2)),String.fromCharCode(e.getUint8(t+3))].join("")}static readChunks(e,t=0){let n={};if(!PngHelpers.isPng(e,t))throw Error("Not a PNG");for(t+=8;t<=e.buffer.byteLength;){let r=t,i=e.getInt32(t);t+=4;let o=PngHelpers.getChunkType(e,t);if("IDAT"===o&&n[o]){t+=i+4+4;continue}if("IEND"===o)break;n[o]={start:r,dataOffset:t+4,size:i},t+=i+4+4}return n}static parsePhys(e,t){return{ppux:e.getUint32(t),ppuy:e.getUint32(t+4),unit:e.getUint8(t+4)}}static findChunk(e,t){let n=PngHelpers.readChunks(e);return n[t]}static setPhysChunk(e,t=1,n){let r=46,i=0,o=PngHelpers.findChunk(e,"pHYs");o&&(r=o.start,i=o.size);let a=PngHelpers.findChunk(e,"IDAT");a&&(r=a.start,i=0);let l=new ArrayBuffer(21),c=new DataView(l);c.setUint32(0,9),c.setUint8(4,112),c.setUint8(5,72),c.setUint8(6,89),c.setUint8(7,115),c.setInt32(8,2835.5*t),c.setInt32(12,2835.5*t),c.setInt8(16,1);let u=new Uint8Array(l.slice(4,17));c.setInt32(17,crc(u));let d=e.buffer.slice(0,r),p=e.buffer.slice(r+i);return new Blob([d,l,p],n)}};let MediaHelpers=class MediaHelpers{static loadVideo(e){return new Promise((t,n)=>{let r=document.createElement("video");r.onloadeddata=()=>t(r),r.onerror=e=>{console.error(e),n(Error("Could not load video"))},r.crossOrigin="anonymous",r.src=e})}static loadImage(e){return new Promise((t,n)=>{let r=new Image;r.onload=()=>t(r),r.onerror=e=>{console.error(e),n(Error("Could not load image"))},r.crossOrigin="anonymous",r.src=e})}static blobToDataUrl(e){return new Promise((t,n)=>{let r=new FileReader;r.onload=()=>t(r.result),r.onerror=e=>{console.error(e),n(Error("Could not read blob"))},r.readAsDataURL(e)})}static async getVideoSize(e){return MediaHelpers.usingObjectURL(e,async e=>{let t=await MediaHelpers.loadVideo(e);return{w:t.videoWidth,h:t.videoHeight}})}static async getImageSize(e){let t=await MediaHelpers.usingObjectURL(e,MediaHelpers.loadImage);try{if("image/png"===e.type){let n=new DataView(await e.arrayBuffer());if(PngHelpers.isPng(n,0)){let e=PngHelpers.findChunk(n,"pHYs");if(e){let r=PngHelpers.parsePhys(n,e.dataOffset);if(0===r.unit&&r.ppux===r.ppuy){let e=Math.max(r.ppux/2834.5,1);return{w:Math.round(t.naturalWidth/e),h:Math.round(t.naturalHeight/e)}}}}}}catch(e){console.error(e)}return{w:t.naturalWidth,h:t.naturalHeight}}static async usingObjectURL(e,t){let n=URL.createObjectURL(e);try{return await t(n)}finally{URL.revokeObjectURL(n)}}};function lerp(e,t,n){return e+(t-e)*n}function invLerp(e,t,n){return(n-e)/(t-e)}function rng(e=""){let t=0,n=0,r=0,i=0;function next(){let e=t^t<<11;return t=n,n=r,r=i,(i^=(i>>>19^e^e>>>8)>>>0)/4294967296*2}for(let n=0;n<e.length+64;n++)t^=0|e.charCodeAt(n),next();return next}function modulate(e,t,n,r=!1){let[i,o]=t,[a,l]=n,c=a+(e-i)/(o-i)*(l-a);return r?a<l?Math.max(Math.min(c,l),a):Math.max(Math.min(c,a),l):c}function object_hasOwnProperty(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function getOwnProperty(e,t){if(object_hasOwnProperty(e,t))return e[t]}function deepCopy(e){if(!e)return e;if(Array.isArray(e)){let t=[],n=e.length;for(let r=0;r<n;r++)t.push(deepCopy(e[r]));return t}if("object"==typeof e){let t=Object.keys(e),n=t.length,r={};for(let i=0;i<n;i++){let n=t[i];r[n]=deepCopy(e[n])}return r}return e}function objectMapKeys(e){return Object.keys(e)}function objectMapValues(e){return Object.values(e)}function objectMapEntries(e){return Object.entries(e)}function objectMapFromEntries(e){return Object.fromEntries(e)}function filterEntries(e,t){let n={},r=!1;for(let[i,o]of objectMapEntries(e))t(i,o)?n[i]=o:r=!0;return r?n:e}function mapObjectMapValues(e,t){let n={};for(let[r,i]of objectMapEntries(e)){let e=t(r,i);n[r]=e}return n}function areObjectsShallowEqual(e,t){if(e===t)return!0;let n=new Set(Object.keys(e)),r=new Set(Object.keys(t));if(n.size!==r.size)return!1;for(let i of n)if(!r.has(i)||!Object.is(e[i],t[i]))return!1;return!0}var u=n(2601);let isTest=()=>void 0!==u&&!1,d=[],tick=()=>{let e=d.splice(0,d.length);for(let t of e)t()};function raf(){r||(r=requestAnimationFrame(()=>{r=void 0,tick()}))}function rafThrottle(e){return isTest()?e:()=>{d.includes(e)||(d.push(e),raf())}}function throttledRaf(e){if(isTest())return e();d.includes(e)||(d.push(e),raf())}let p="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",h="A00000000000000000000000000";function getIntegerLength(e){if(e>="a"&&e<="z")return e.charCodeAt(0)-97+2;if(e>="A"&&e<="Z")return 90-e.charCodeAt(0)+2;throw Error("Invalid index key head: "+e)}function validateInteger(e){if(e.length!==getIntegerLength(e.charAt(0)))throw Error("invalid integer part of index key: "+e)}function isNotUndefined(e){if(void 0===e)throw Error("n is undefined")}function incrementInteger(e){validateInteger(e);let[t,...n]=e.split(""),r=!0;for(let e=n.length-1;r&&e>=0;e--){let t=p.indexOf(n[e])+1;t===p.length?n[e]="0":(n[e]=p.charAt(t),r=!1)}if(!r)return t+n.join("");{if("Z"===t)return"a0";if("z"===t)return;let e=String.fromCharCode(t.charCodeAt(0)+1);return e>"a"?n.push("0"):n.pop(),e+n.join("")}}function decrementInteger(e){validateInteger(e);let[t,...n]=e.split(""),r=!0;for(let e=n.length-1;r&&e>=0;e--){let t=p.indexOf(n[e])-1;-1===t?n[e]=p.slice(-1):(n[e]=p.charAt(t),r=!1)}if(!r)return t+n.join("");{if("a"===t)return"Z"+p.slice(-1);if("A"===t)return;let e=String.fromCharCode(t.charCodeAt(0)-1);return e<"Z"?n.push(p.slice(-1)):n.pop(),e+n.join("")}}function midpoint(e,t){if(void 0!==t&&e>=t)throw Error(e+" >= "+t);if("0"===e.slice(-1)||t&&"0"===t.slice(-1))throw Error("trailing zero");if(t){let n=0;for(;(e.charAt(n)||"0")===t.charAt(n);)n++;if(n>0)return t.slice(0,n)+midpoint(e.slice(n),t.slice(n))}let n=e?p.indexOf(e.charAt(0)):0,r=void 0!==t?p.indexOf(t.charAt(0)):p.length;if(r-n>1){let e=Math.round(.5*(n+r));return p.charAt(e)}return t&&t.length>1?t.slice(0,1):p.charAt(n)+midpoint(e.slice(1),void 0)}function getIntegerPart(e){let t=getIntegerLength(e.charAt(0));if(t>e.length)throw Error("invalid index: "+e);return e.slice(0,t)}function validateOrder(e){if(e===h)throw Error("invalid index: "+e);let t=getIntegerPart(e),n=e.slice(t.length);if("0"===n.slice(-1))throw Error("invalid index: "+e)}function generateKeyBetween(e,t){if(void 0!==e&&validateOrder(e),void 0!==t&&validateOrder(t),void 0!==e&&void 0!==t&&e>=t)throw Error(e+" >= "+t);if(void 0===e&&void 0===t)return"a0";if(void 0===e){if(void 0===t)throw Error("b is undefined");let e=getIntegerPart(t),n=t.slice(e.length);if(e===h)return e+midpoint("",n);if(e<t)return e;let r=decrementInteger(e);return isNotUndefined(r),r}if(void 0===t){let t=getIntegerPart(e),n=e.slice(t.length),r=incrementInteger(t);return void 0===r?t+midpoint(n,void 0):r}let n=getIntegerPart(e),r=e.slice(n.length),i=getIntegerPart(t),o=t.slice(i.length);if(n===i)return n+midpoint(r,o);let a=incrementInteger(n);return isNotUndefined(a),a<t?a:n+midpoint(r,void 0)}function generateNKeysBetween(e,t,n){if(0===n)return[];if(1===n)return[generateKeyBetween(e,t)];if(void 0===t){let r=generateKeyBetween(e,t),i=[r];for(let e=0;e<n-1;e++)i.push(r=generateKeyBetween(r,t));return i}if(void 0===e){let r=generateKeyBetween(e,t),i=[r];for(let t=0;t<n-1;t++)i.push(r=generateKeyBetween(e,r));return i.reverse(),i}let r=Math.floor(n/2),i=generateKeyBetween(e,t);return[...generateNKeysBetween(e,i,r),i,...generateNKeysBetween(i,t,n-r-1)]}let g="a0";function validateIndexKey(e){validateOrder(e)}function getIndicesBetween(e,t,n){return generateNKeysBetween(e,t,n)}function getIndicesAbove(e,t){return generateNKeysBetween(e,void 0,t)}function getIndicesBelow(e,t){return generateNKeysBetween(void 0,e,t)}function getIndexBetween(e,t){return generateNKeysBetween(e,t,1)[0]}function getIndexAbove(e){return generateNKeysBetween(e,void 0,1)[0]}function getIndexBelow(e){return generateNKeysBetween(void 0,e,1)[0]}function getIndices(e,t="a1"){return[t,...generateNKeysBetween(t,void 0,e)]}function sortByIndex(e,t){return e.index<t.index?-1:e.index>t.index?1:0}function sortById(e,t){return e.id>t.id?1:-1}function isDefined(e){return void 0!==e}function isNonNull(e){return null!==e}function isNonNullish(e){return null!=e}let f="undefined"!=typeof window&&window.structuredClone?window.structuredClone:e=>e?JSON.parse(JSON.stringify(e)):e,m=new Set;function warnDeprecatedGetter(e){m.has(e)||(m.add(e),console.warn(`Using '${e}' is deprecated and will be removed in the near future. Please refactor to use 'get${e[0].toLocaleUpperCase()}${e.slice(1)}' instead.`))}},5958:function(e,t,n){"use strict";n.d(t,{UR:function(){return ArrayOfValidator},oy:function(){return DictValidator},kx:function(){return ObjectValidator},T:function(){return r},zr:function(){return UnionValidator},cX:function(){return Validator}});var r={};n.r(r),n.d(r,{ArrayOfValidator:function(){return ArrayOfValidator},DictValidator:function(){return DictValidator},ObjectValidator:function(){return ObjectValidator},UnionValidator:function(){return UnionValidator},ValidationError:function(){return ValidationError},Validator:function(){return Validator},any:function(){return a},array:function(){return y},arrayOf:function(){return arrayOf},bigint:function(){return m},boolean:function(){return f},dict:function(){return dict},indexKey:function(){return P},integer:function(){return p},jsonDict:function(){return jsonDict},jsonValue:function(){return w},linkUrl:function(){return v},literal:function(){return literal},literalEnum:function(){return literalEnum},model:function(){return model},nonZeroInteger:function(){return g},nonZeroNumber:function(){return d},nullable:function(){return nullable},number:function(){return c},object:function(){return object},optional:function(){return optional},positiveInteger:function(){return h},positiveNumber:function(){return u},setEnum:function(){return setEnum},srcUrl:function(){return T},string:function(){return l},union:function(){return union},unknown:function(){return o},unknownObject:function(){return b}});var i=n(3112);function formatPath(e){if(!e.length)return null;let t="";for(let n of e)"number"==typeof n?t+=`.${n}`:n.startsWith("(")?t.endsWith(")")?t=`${t.slice(0,-1)}, ${n.slice(1)}`:t+=n:t+=`.${n}`;return(t=t.replace(/id = [^,]+, /,"").replace(/id = [^)]+/,"")).startsWith(".")?t.slice(1):t}let ValidationError=class ValidationError extends Error{constructor(e,t=[]){let n=formatPath(t),r=e.split("\n").map((e,t)=>0===t?e:`  ${e}`).join("\n");super(t?`At ${n}: ${r}`:r),this.rawMessage=e,this.path=t}name="ValidationError"};function prefixError(e,t){try{return t()}catch(t){if(t instanceof ValidationError)throw new ValidationError(t.rawMessage,[e,...t.path]);throw new ValidationError(t.toString(),[e])}}function typeToString(e){if(null===e)return"null";if(Array.isArray(e))return"an array";let t=typeof e;switch(t){case"bigint":case"boolean":case"function":case"number":case"string":case"symbol":return`a ${t}`;case"object":return`an ${t}`;case"undefined":return"undefined";default:(0,i.iP)(t)}}let Validator=class Validator{constructor(e,t){this.validationFn=e,this.validateUsingKnownGoodVersionFn=t}validate(e){let t=this.validationFn(e);return t}validateUsingKnownGoodVersion(e,t){return Object.is(e,t)?e:this.validateUsingKnownGoodVersionFn?this.validateUsingKnownGoodVersionFn(e,t):this.validate(t)}isValid(e){try{return this.validate(e),!0}catch{return!1}}nullable(){return nullable(this)}optional(){return optional(this)}refine(e){return new Validator(t=>e(this.validate(t)),(t,n)=>{let r=this.validateUsingKnownGoodVersion(t,n);return Object.is(t,r)?t:e(r)})}check(e,t){return"string"==typeof e?this.refine(n=>(prefixError(`(check ${e})`,()=>t(n)),n)):this.refine(t=>(e(t),t))}};let ArrayOfValidator=class ArrayOfValidator extends Validator{constructor(e){super(t=>{let n=y.validate(t);for(let t=0;t<n.length;t++)prefixError(t,()=>e.validate(n[t]));return n},(t,n)=>{if(!e.validateUsingKnownGoodVersion)return this.validate(n);let r=y.validate(n),i=t.length!==r.length;for(let n=0;n<r.length;n++){let o=r[n];if(n>=t.length){i=!0,prefixError(n,()=>e.validate(o));continue}if(Object.is(t[n],o))continue;let a=prefixError(n,()=>e.validateUsingKnownGoodVersion(t[n],o));Object.is(a,t[n])||(i=!0)}return i?n:t}),this.itemValidator=e}nonEmpty(){return this.check(e=>{if(0===e.length)throw new ValidationError("Expected a non-empty array")})}lengthGreaterThan1(){return this.check(e=>{if(e.length<=1)throw new ValidationError("Expected an array with length greater than 1")})}};let ObjectValidator=class ObjectValidator extends Validator{constructor(e,t=!1){super(n=>{if("object"!=typeof n||null===n)throw new ValidationError(`Expected object, got ${typeToString(n)}`);for(let[t,r]of Object.entries(e))prefixError(t,()=>{r.validate((0,i.eg)(n,t))});if(!t){for(let t of Object.keys(n))if(!(0,i.nr)(e,t))throw new ValidationError("Unexpected property",[t])}return n},(n,r)=>{if("object"!=typeof r||null===r)throw new ValidationError(`Expected object, got ${typeToString(r)}`);let o=!1;for(let[t,a]of Object.entries(e)){let e=(0,i.eg)(n,t),l=(0,i.eg)(r,t);if(Object.is(e,l))continue;let c=prefixError(t,()=>a.validateUsingKnownGoodVersion?a.validateUsingKnownGoodVersion(e,l):a.validate(l));Object.is(c,e)||(o=!0)}if(!t){for(let t of Object.keys(r))if(!(0,i.nr)(e,t))throw new ValidationError("Unexpected property",[t])}for(let e of Object.keys(n))if(!(0,i.nr)(r,e)){o=!0;break}return o?r:n}),this.config=e,this.shouldAllowUnknownProperties=t}allowUnknownProperties(){return new ObjectValidator(this.config,!0)}extend(e){return new ObjectValidator({...this.config,...e})}};let UnionValidator=class UnionValidator extends Validator{constructor(e,t,n){super(t=>{this.expectObject(t);let{matchingSchema:n,variant:r}=this.getMatchingSchemaAndVariant(t);return void 0===n?this.unknownValueValidation(t,r):prefixError(`(${e} = ${r})`,()=>n.validate(t))},(t,n)=>{this.expectObject(n),this.expectObject(t);let{matchingSchema:r,variant:o}=this.getMatchingSchemaAndVariant(n);return void 0===r?this.unknownValueValidation(n,o):(0,i.eg)(t,e)!==(0,i.eg)(n,e)?prefixError(`(${e} = ${o})`,()=>r.validate(n)):prefixError(`(${e} = ${o})`,()=>r.validateUsingKnownGoodVersion?r.validateUsingKnownGoodVersion(t,n):r.validate(n))}),this.key=e,this.config=t,this.unknownValueValidation=n}expectObject(e){if("object"!=typeof e||null===e)throw new ValidationError(`Expected an object, got ${typeToString(e)}`,[])}getMatchingSchemaAndVariant(e){let t=(0,i.eg)(e,this.key);if("string"!=typeof t)throw new ValidationError(`Expected a string for key "${this.key}", got ${typeToString(t)}`);let n=(0,i.nr)(this.config,t)?this.config[t]:void 0;return{matchingSchema:n,variant:t}}validateUnknownVariants(e){return new UnionValidator(this.key,this.config,e)}};let DictValidator=class DictValidator extends Validator{constructor(e,t){super(n=>{if("object"!=typeof n||null===n)throw new ValidationError(`Expected object, got ${typeToString(n)}`);for(let[r,i]of Object.entries(n))prefixError(r,()=>{e.validate(r),t.validate(i)});return n},(n,r)=>{if("object"!=typeof r||null===r)throw new ValidationError(`Expected object, got ${typeToString(r)}`);let o=!1;for(let[a,l]of Object.entries(r)){if(!(0,i.nr)(n,a)){o=!0,prefixError(a,()=>{e.validate(a),t.validate(l)});continue}let r=(0,i.eg)(n,a),c=l;if(Object.is(r,c))continue;let u=prefixError(a,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(r,c):t.validate(c));Object.is(u,r)||(o=!0)}for(let e of Object.keys(n))if(!(0,i.nr)(r,e)){o=!0;break}return o?r:n}),this.keyValidator=e,this.valueValidator=t}};function typeofValidator(e){return new Validator(t=>{if(typeof t!==e)throw new ValidationError(`Expected ${e}, got ${typeToString(t)}`);return t})}let o=new Validator(e=>e),a=new Validator(e=>e),l=typeofValidator("string"),c=typeofValidator("number").check(e=>{if(Number.isNaN(e))throw new ValidationError("Expected a number, got NaN");if(!Number.isFinite(e))throw new ValidationError(`Expected a finite number, got ${e}`)}),u=c.check(e=>{if(e<0)throw new ValidationError(`Expected a positive number, got ${e}`)}),d=c.check(e=>{if(e<=0)throw new ValidationError(`Expected a non-zero positive number, got ${e}`)}),p=c.check(e=>{if(!Number.isInteger(e))throw new ValidationError(`Expected an integer, got ${e}`)}),h=p.check(e=>{if(e<0)throw new ValidationError(`Expected a positive integer, got ${e}`)}),g=p.check(e=>{if(e<=0)throw new ValidationError(`Expected a non-zero positive integer, got ${e}`)}),f=typeofValidator("boolean"),m=typeofValidator("bigint");function literal(e){return new Validator(t=>{if(t!==e)throw new ValidationError(`Expected ${e}, got ${JSON.stringify(t)}`);return e})}let y=new Validator(e=>{if(!Array.isArray(e))throw new ValidationError(`Expected an array, got ${typeToString(e)}`);return e});function arrayOf(e){return new ArrayOfValidator(e)}let b=new Validator(e=>{if("object"!=typeof e||null===e)throw new ValidationError(`Expected object, got ${typeToString(e)}`);return e});function object(e){return new ObjectValidator(e)}function isPlainObject(e){return"object"==typeof e&&null!==e&&(e.constructor===Object||!e.constructor)}function isValidJson(e){return null===e||"number"==typeof e||"string"==typeof e||"boolean"==typeof e||(Array.isArray(e)?e.every(isValidJson):!!isPlainObject(e)&&Object.values(e).every(isValidJson))}let w=new Validator(e=>{if(isValidJson(e))return e;throw new ValidationError(`Expected json serializable value, got ${typeof e}`)},(e,t)=>{if(Array.isArray(e)&&Array.isArray(t)){let n=e.length!==t.length;for(let r=0;r<t.length;r++){if(r>=e.length){n=!0,w.validate(t[r]);continue}let i=e[r],o=t[r];if(Object.is(i,o))continue;let a=w.validateUsingKnownGoodVersion(i,o);Object.is(a,i)||(n=!0)}return n?t:e}if(!(isPlainObject(e)&&isPlainObject(t)))return w.validate(t);{let n=!1;for(let r of Object.keys(t)){if(!(0,i.nr)(e,r)){n=!0,w.validate(t[r]);continue}let o=e[r],a=t[r];if(Object.is(o,a))continue;let l=w.validateUsingKnownGoodVersion(o,a);Object.is(l,o)||(n=!0)}for(let r of Object.keys(e))if(!(0,i.nr)(t,r)){n=!0;break}return n?t:e}});function jsonDict(){return dict(l,w)}function dict(e,t){return new DictValidator(e,t)}function union(e,t){return new UnionValidator(e,t,(n,r)=>{throw new ValidationError(`Expected one of ${Object.keys(t).map(e=>JSON.stringify(e)).join(" or ")}, got ${JSON.stringify(r)}`,[e])})}function model(e,t){return new Validator(n=>prefixError(e,()=>t.validate(n)),(n,r)=>prefixError(e,()=>t.validateUsingKnownGoodVersion?t.validateUsingKnownGoodVersion(n,r):t.validate(r)))}function setEnum(e){return new Validator(t=>{if(!e.has(t)){let n=Array.from(e,e=>JSON.stringify(e)).join(" or ");throw new ValidationError(`Expected ${n}, got ${t}`)}return t})}function optional(e){return new Validator(t=>{if(void 0!==t)return e.validate(t)},(t,n)=>{if((void 0!==t||void 0!==n)&&void 0!==n)return e.validateUsingKnownGoodVersion&&void 0!==t?e.validateUsingKnownGoodVersion(t,n):e.validate(n)})}function nullable(e){return new Validator(t=>null===t?null:e.validate(t),(t,n)=>null===n?null:e.validateUsingKnownGoodVersion&&null!==t?e.validateUsingKnownGoodVersion(t,n):e.validate(n))}function literalEnum(...e){return setEnum(new Set(e))}function parseUrl(e){try{return new URL(e)}catch(t){if(e.startsWith("/")||e.startsWith("./"))try{return new URL(e,"http://example.com")}catch(t){throw new ValidationError(`Expected a valid url, got ${JSON.stringify(e)}`)}throw new ValidationError(`Expected a valid url, got ${JSON.stringify(e)}`)}}let S=new Set(["http:","https:","mailto:"]),v=l.check(e=>{if(""===e)return;let t=parseUrl(e);if(!S.has(t.protocol.toLowerCase()))throw new ValidationError(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)}),x=new Set(["http:","https:","data:"]),T=l.check(e=>{if(""===e)return;let t=parseUrl(e);if(!x.has(t.protocol.toLowerCase()))throw new ValidationError(`Expected a valid url, got ${JSON.stringify(e)} (invalid protocol)`)}),P=l.refine(e=>{try{return(0,i.LP)(e),e}catch{throw new ValidationError(`Expected an index key, got ${JSON.stringify(e)}`)}})},4441:function(e,t,n){"use strict";n.r(t),n.d(t,{Analytics:function(){return Analytics},track:function(){return track}});var r=n(2265),initQueue=()=>{window.va||(window.va=function(...e){(window.vaq=window.vaq||[]).push(e)})};function isBrowser(){return"undefined"!=typeof window}function detectEnvironment(){return"production"}function setMode(e="auto"){if("auto"===e){window.vam=detectEnvironment();return}window.vam=e}function getMode(){let e=isBrowser()?window.vam:detectEnvironment();return e||"production"}function isProduction(){return"production"===getMode()}function isDevelopment(){return"development"===getMode()}function removeKey(e,{[e]:t,...n}){return n}function parseProperties(e,t){if(!e)return;let n=e,r=[];for(let[i,o]of Object.entries(e))"object"==typeof o&&null!==o&&(t.strip?n=removeKey(i,n):r.push(i));if(r.length>0&&!t.strip)throw Error(`The following properties are not valid: ${r.join(", ")}. Only strings, numbers, booleans, and null are allowed.`);return n}function inject(e={debug:!0}){var t;if(!isBrowser())return;setMode(e.mode),initQueue(),e.beforeSend&&(null==(t=window.va)||t.call(window,"beforeSend",e.beforeSend));let n=isDevelopment()?"https://va.vercel-scripts.com/v1/script.debug.js":"/_vercel/insights/script.js";if(document.head.querySelector(`script[src*="${n}"]`))return;let r=document.createElement("script");r.src=n,r.defer=!0,r.setAttribute("data-sdkn","@vercel/analytics"),r.setAttribute("data-sdkv","1.1.1"),r.onerror=()=>{let e=isDevelopment()?"Please check if any ad blockers are enabled and try again.":"Be sure to enable Web Analytics for your project and deploy again. See https://vercel.com/docs/analytics/quickstart for more information.";console.log(`[Vercel Web Analytics] Failed to load script from ${n}. ${e}`)},isDevelopment()&&!1===e.debug&&r.setAttribute("data-debug","false"),document.head.appendChild(r)}function track(e,t){var n,r;if(!isBrowser()){let e="[Vercel Web Analytics] Please import `track` from `@vercel/analytics/server` when using this function in a server environment";if(isProduction())console.warn(e);else throw Error(e);return}if(!t){null==(n=window.va)||n.call(window,"event",{name:e});return}try{let n=parseProperties(t,{strip:isProduction()});null==(r=window.va)||r.call(window,"event",{name:e,data:n})}catch(e){e instanceof Error&&isDevelopment()&&console.error(e)}}function Analytics({beforeSend:e,debug:t=!0,mode:n="auto"}){return(0,r.useEffect)(()=>{inject({beforeSend:e,debug:t,mode:n})},[e,t,n]),null}},5966:function(e,t,n){"use strict";let r,i,o;async function preloadFont(e,t){let{url:n,style:r="normal",weight:i="500",display:o,featureSettings:a,stretch:l,unicodeRange:c,variant:u,format:d}=t,p=new FontFace(e,`url(${n})`,{style:r,weight:i,display:o,featureSettings:a,stretch:l,unicodeRange:c,variant:u});return await p.load(),document.fonts.add(p),p.$$_url=n,p.$$_fontface=`
@font-face {
	font-family: ${p.family};
	font-stretch: ${p.stretch};
	font-weight: ${p.weight};
	font-style: ${p.style};
	src: url("${n}") format("${d}")
}`,p}n.r(t),n.d(t,{ANIMATION_MEDIUM_MS:function(){return _.KD},ANIMATION_SHORT_MS:function(){return _.uJ},AlignMenuItems:function(){return AlignMenuItems},Arc2d:function(){return Arc2d},ArrangeMenuSubmenu:function(){return ArrangeMenuSubmenu},ArrayOfValidator:function(){return x.UR},ArrowShapeArrowheadEndStyle:function(){return S.ZJ},ArrowShapeArrowheadStartStyle:function(){return S.TA},ArrowShapeTool:function(){return ArrowShapeTool},ArrowShapeUtil:function(){return ArrowShapeUtil},ArrowheadStylePickerSet:function(){return ArrowheadStylePickerSet},AssetRecordType:function(){return S.Yk},AssetUrlsProvider:function(){return AssetUrlsProvider},BaseBoxShapeTool:function(){return BaseBoxShapeTool},BaseBoxShapeUtil:function(){return BaseBoxShapeUtil},BookmarkShapeUtil:function(){return BookmarkShapeUtil},Box:function(){return eo.xu},BreakPointProvider:function(){return BreakPointProvider},CAMERA_SLIDE_FRICTION:function(){return _.$G},CameraRecordType:function(){return S.AN},Circle2d:function(){return Circle2d},ClipboardMenuGroup:function(){return ClipboardMenuGroup},CommonStylePickerSet:function(){return CommonStylePickerSet},ContainerProvider:function(){return ContainerProvider},ContextMenu:function(){return io},ConversionsMenuGroup:function(){return ConversionsMenuGroup},CopyMenuItem:function(){return CopyMenuItem},CubicBezier2d:function(){return CubicBezier2d},CubicSpline2d:function(){return CubicSpline2d},CutMenuItem:function(){return CutMenuItem},DEFAULT_ACCEPTED_IMG_TYPE:function(){return tj},DEFAULT_ACCEPTED_VID_TYPE:function(){return tA},DEFAULT_ANIMATION_OPTIONS:function(){return _.Xy},DOUBLE_CLICK_DURATION:function(){return _.qV},DRAG_DISTANCE:function(){return _.Sk},DebugFlags:function(){return DebugFlags},DefaultActionsMenu:function(){return ii},DefaultActionsMenuContent:function(){return DefaultActionsMenuContent},DefaultBackground:function(){return DefaultBackground},DefaultBrush:function(){return DefaultBrush},DefaultCanvas:function(){return DefaultCanvas},DefaultCollaboratorHint:function(){return DefaultCollaboratorHint},DefaultColorStyle:function(){return S.R_},DefaultColorThemePalette:function(){return S.qi},DefaultContextMenu:function(){return io},DefaultContextMenuContent:function(){return DefaultContextMenuContent},DefaultCursor:function(){return ew},DefaultDashStyle:function(){return S.ci},DefaultDebugMenu:function(){return DefaultDebugMenu},DefaultDebugMenuContent:function(){return DefaultDebugMenuContent},DefaultErrorFallback:function(){return DefaultErrorFallback},DefaultFillStyle:function(){return S.pp},DefaultFontFamilies:function(){return S.p6},DefaultFontStyle:function(){return S.Y8},DefaultGrid:function(){return DefaultGrid},DefaultHandle:function(){return DefaultHandle},DefaultHandles:function(){return DefaultHandles},DefaultHelpMenu:function(){return ic},DefaultHelpMenuContent:function(){return DefaultHelpMenuContent},DefaultHelperButtons:function(){return DefaultHelperButtons},DefaultHelperButtonsContent:function(){return DefaultHelperButtonsContent},DefaultHorizontalAlignStyle:function(){return S.Xo},DefaultHoveredShapeIndicator:function(){return DefaultHoveredShapeIndicator},DefaultKeyboardShortcutsDialog:function(){return id},DefaultKeyboardShortcutsDialogContent:function(){return DefaultKeyboardShortcutsDialogContent},DefaultMainMenu:function(){return ip},DefaultMainMenuContent:function(){return DefaultMainMenuContent},DefaultMinimap:function(){return DefaultMinimap},DefaultPageMenu:function(){return iy},DefaultQuickActions:function(){return ib},DefaultQuickActionsContent:function(){return DefaultQuickActionsContent},DefaultScribble:function(){return DefaultScribble},DefaultSelectionBackground:function(){return DefaultSelectionBackground},DefaultSelectionForeground:function(){return DefaultSelectionForeground},DefaultShapeIndicator:function(){return eS},DefaultSizeStyle:function(){return S.ST},DefaultSnapIndicator:function(){return DefaultSnapIndicator},DefaultSpinner:function(){return DefaultSpinner},DefaultStylePanel:function(){return iX},DefaultStylePanelContent:function(){return DefaultStylePanelContent},DefaultSvgDefs:function(){return DefaultSvgDefs},DefaultToolbar:function(){return oo},DefaultVerticalAlignStyle:function(){return S.HO},DefaultZoomMenu:function(){return os},DefaultZoomMenuContent:function(){return DefaultZoomMenuContent},DeleteMenuItem:function(){return DeleteMenuItem},DictValidator:function(){return x.oy},DistributeMenuItems:function(){return DistributeMenuItems},DocumentRecordType:function(){return S._A},DrawShapeTool:function(){return DrawShapeTool},DrawShapeUtil:function(){return DrawShapeUtil},DuplicateMenuItem:function(){return DuplicateMenuItem},EASINGS:function(){return tn.L},EMBED_DEFINITIONS:function(){return S.Lu},EMPTY_ARRAY:function(){return b.LZ},EVENT_NAME_MAP:function(){return tt.J},Edge2d:function(){return ta.W},EditLinkMenuItem:function(){return menu_items_EditLinkMenuItem},EditSubmenu:function(){return EditSubmenu},Editor:function(){return eP.M},EditorContext:function(){return I.r},Ellipse2d:function(){return Ellipse2d},EmbedShapeUtil:function(){return EmbedShapeUtil},EmbedsGroup:function(){return EmbedsGroup},EnumStyleProp:function(){return S.$I},EraserTool:function(){return EraserTool},ErrorBoundary:function(){return ErrorBoundary},ErrorScreen:function(){return ErrorScreen},ExampleDialog:function(){return ExampleDialog},ExportFileContentSubMenu:function(){return ExportFileContentSubMenu},ExtrasGroup:function(){return ExtrasGroup},FeatureFlags:function(){return FeatureFlags},FileHelpers:function(){return v.P6},FitFrameToContentMenuItem:function(){return FitFrameToContentMenuItem},FrameShapeTool:function(){return FrameShapeTool},FrameShapeUtil:function(){return FrameShapeUtil},GRID_STEPS:function(){return _.dW},GeoShapeGeoStyle:function(){return S.Zu},GeoShapeTool:function(){return GeoShapeTool},GeoShapeUtil:function(){return GeoShapeUtil},GeoStylePickerSet:function(){return GeoStylePickerSet},Geometry2d:function(){return ti.l},Group2d:function(){return es.m},GroupMenuItem:function(){return menu_items_GroupMenuItem},GroupOrUngroupMenuItem:function(){return GroupOrUngroupMenuItem},GroupShapeUtil:function(){return e7.Q},HALF_PI:function(){return E.pj},HASH_PATTERN_ZOOM_NAMES:function(){return _.iF},HIT_TEST_MARGIN:function(){return _.wM},HTMLContainer:function(){return HTMLContainer},HandTool:function(){return HandTool},HighlightShapeTool:function(){return HighlightShapeTool},HighlightShapeUtil:function(){return HighlightShapeUtil},ImageShapeUtil:function(){return ImageShapeUtil},IncrementalSetConstructor:function(){return w.mW},InstancePageStateRecordType:function(){return S.iS},InstancePresenceRecordType:function(){return S.AM},KeyboardShortcutsMenuItem:function(){return KeyboardShortcutsMenuItem},LANGUAGES:function(){return S.a2},LanguageMenu:function(){return il},LaserTool:function(){return LaserTool},LineShapeSplineStyle:function(){return S.t8},LineShapeTool:function(){return LineShapeTool},LineShapeUtil:function(){return LineShapeUtil},LoadingScreen:function(){return LoadingScreen},LockGroup:function(){return LockGroup},MAX_PAGES:function(){return _.Et},MAX_SHAPES_PER_PAGE:function(){return _.kx},MAX_ZOOM:function(){return _.sZ},MIN_ZOOM:function(){return _.Zj},MULTI_CLICK_DURATION:function(){return _.Pz},Mat:function(){return ea._},MediaHelpers:function(){return v.xe},MigrationFailureReason:function(){return w.qx},MiscMenuGroup:function(){return MiscMenuGroup},MoveToPageMenu:function(){return MoveToPageMenu},MultiShapeMenuGroup:function(){return MultiShapeMenuGroup},NoteShapeTool:function(){return NoteShapeTool},NoteShapeUtil:function(){return NoteShapeUtil},ObjectValidator:function(){return x.kx},OfflineIndicator:function(){return OfflineIndicator},OpacitySlider:function(){return OpacitySlider},OptionalErrorBoundary:function(){return OptionalErrorBoundary},PI:function(){return E.PI},PI2:function(){return E.yo},PageItemInput:function(){return PageItemInput},PageItemSubmenu:function(){return im},PageRecordType:function(){return S.ez},PasteMenuItem:function(){return PasteMenuItem},PngHelpers:function(){return v.bM},Point2d:function(){return Point2d},PointerRecordType:function(){return S.zh},Polygon2d:function(){return ts.w},Polyline2d:function(){return to.q},PreferencesGroup:function(){return PreferencesGroup},PrintItem:function(){return PrintItem},ROTATE_CORNER_TO_SELECTION_CORNER:function(){return eo.rf},ReadonlySharedStyleMap:function(){return tl._},RecordType:function(){return w.oX},Rectangle2d:function(){return e4.z},RemoveFrameMenuItem:function(){return RemoveFrameMenuItem},ReorderMenuItems:function(){return ReorderMenuItems},ReorderMenuSubmenu:function(){return ReorderMenuSubmenu},Result:function(){return v.x4},RotateCWMenuItem:function(){return RotateCWMenuItem},SIN:function(){return E.dv},SVGContainer:function(){return e3.g},SVG_PADDING:function(){return _.s_},SelectTool:function(){return SelectTool},SetSelectionGroup:function(){return SetSelectionGroup},ShapeSubmenu:function(){return ShapeSubmenu},ShapeUtil:function(){return e8.E},SharedStyleMap:function(){return tl.o},SnapManager:function(){return e6.f},Spinner:function(){return Spinner},SplineStylePickerSet:function(){return SplineStylePickerSet},StackMenuItems:function(){return StackMenuItems},Stadium2d:function(){return Stadium2d},StateNode:function(){return te.n},Store:function(){return w.yh},StoreSchema:function(){return w.sS},StyleProp:function(){return S.fV},T:function(){return x.T},TAB_ID:function(){return e$},TLDOCUMENT_ID:function(){return S.G4},TLDRAW_FILE_EXTENSION:function(){return oU},TLINSTANCE_ID:function(){return S.PQ},TLPOINTER_ID:function(){return S.LV},TL_CANVAS_UI_COLOR_TYPES:function(){return S.z},TextShapeTool:function(){return TextShapeTool},TextShapeUtil:function(){return TextShapeUtil},TextStylePickerSet:function(){return TextStylePickerSet},Tldraw:function(){return Tldraw},TldrawEditor:function(){return e1},TldrawHandles:function(){return TldrawHandles},TldrawHoveredShapeIndicator:function(){return TldrawHoveredShapeIndicator},TldrawImage:function(){return oT},TldrawScribble:function(){return TldrawScribble},TldrawSelectionBackground:function(){return TldrawSelectionBackground},TldrawSelectionForeground:function(){return ty},TldrawUi:function(){return oy},TldrawUiButton:function(){return nK},TldrawUiButtonCheck:function(){return TldrawUiButtonCheck},TldrawUiButtonIcon:function(){return TldrawUiButtonIcon},TldrawUiButtonLabel:function(){return TldrawUiButtonLabel},TldrawUiButtonPicker:function(){return iv},TldrawUiComponentsProvider:function(){return TldrawUiComponentsProvider},TldrawUiContextProvider:function(){return TldrawUiContextProvider},TldrawUiDialogBody:function(){return TldrawUiDialogBody},TldrawUiDialogCloseButton:function(){return TldrawUiDialogCloseButton},TldrawUiDialogFooter:function(){return TldrawUiDialogFooter},TldrawUiDialogHeader:function(){return TldrawUiDialogHeader},TldrawUiDialogTitle:function(){return TldrawUiDialogTitle},TldrawUiDropdownMenuCheckboxItem:function(){return TldrawUiDropdownMenuCheckboxItem},TldrawUiDropdownMenuContent:function(){return TldrawUiDropdownMenuContent},TldrawUiDropdownMenuGroup:function(){return TldrawUiDropdownMenuGroup},TldrawUiDropdownMenuIndicator:function(){return TldrawUiDropdownMenuIndicator},TldrawUiDropdownMenuItem:function(){return TldrawUiDropdownMenuItem},TldrawUiDropdownMenuRoot:function(){return TldrawUiDropdownMenuRoot},TldrawUiDropdownMenuSub:function(){return TldrawUiDropdownMenuSub},TldrawUiDropdownMenuSubTrigger:function(){return TldrawUiDropdownMenuSubTrigger},TldrawUiDropdownMenuTrigger:function(){return TldrawUiDropdownMenuTrigger},TldrawUiIcon:function(){return nY},TldrawUiInput:function(){return rj},TldrawUiKbd:function(){return TldrawUiKbd},TldrawUiMenuCheckboxItem:function(){return TldrawUiMenuCheckboxItem},TldrawUiMenuContextProvider:function(){return TldrawUiMenuContextProvider},TldrawUiMenuGroup:function(){return TldrawUiMenuGroup},TldrawUiMenuItem:function(){return TldrawUiMenuItem},TldrawUiMenuSubmenu:function(){return TldrawUiMenuSubmenu},TldrawUiPopover:function(){return TldrawUiPopover},TldrawUiPopoverContent:function(){return TldrawUiPopoverContent},TldrawUiPopoverTrigger:function(){return TldrawUiPopoverTrigger},TldrawUiSlider:function(){return iZ},ToggleAutoSizeMenuItem:function(){return ToggleAutoSizeMenuItem},ToggleDarkModeItem:function(){return ToggleDarkModeItem},ToggleDebugModeItem:function(){return ToggleDebugModeItem},ToggleEdgeScrollingItem:function(){return ToggleEdgeScrollingItem},ToggleFocusModeItem:function(){return ToggleFocusModeItem},ToggleGridItem:function(){return ToggleGridItem},ToggleLockMenuItem:function(){return ToggleLockMenuItem},ToggleReduceMotionItem:function(){return ToggleReduceMotionItem},ToggleSnapModeItem:function(){return ToggleSnapModeItem},ToggleToolLockItem:function(){return ToggleToolLockItem},ToggleTransparentBgMenuItem:function(){return ToggleTransparentBgMenuItem},ToggleWrapModeItem:function(){return ToggleWrapModeItem},USER_COLORS:function(){return e5.A6},UiEventsProvider:function(){return UiEventsProvider},UndoRedoGroup:function(){return UndoRedoGroup},UngroupMenuItem:function(){return menu_items_UngroupMenuItem},UnionValidator:function(){return x.zr},UnlockAllMenuItem:function(){return UnlockAllMenuItem},Validator:function(){return x.cX},Vec:function(){return et.B},VideoShapeUtil:function(){return VideoShapeUtil},ViewSubmenu:function(){return ViewSubmenu},WeakMapCache:function(){return tc._},ZERO_INDEX_KEY:function(){return v.R4},ZOOMS:function(){return _.E},ZoomOrRotateMenuItem:function(){return ZoomOrRotateMenuItem},ZoomTo100MenuItem:function(){return menu_items_ZoomTo100MenuItem},ZoomToFitMenuItem:function(){return ZoomToFitMenuItem},ZoomToSelectionMenuItem:function(){return ZoomToSelectionMenuItem},ZoomTool:function(){return ZoomTool},angleDistance:function(){return E.mR},annotateError:function(){return v.lw},applyRotationToSnapshotShapes:function(){return tp.Z},approximately:function(){return E.C2},areAnglesCompatible:function(){return E._G},areArraysShallowEqual:function(){return v.E8},areObjectsShallowEqual:function(){return v.dn},arrowShapeMigrations:function(){return S.Vm},arrowShapeProps:function(){return S.si},assert:function(){return v.hu},assertExists:function(){return v.kP},assertIdType:function(){return w.lS},assetIdValidator:function(){return S._3},assetMigrations:function(){return S.TD},assetValidator:function(){return S.$A},atom:function(){return b.cn},average:function(){return E.Y8},bookmarkShapeMigrations:function(){return S.h9},bookmarkShapeProps:function(){return S.qU},boxModelValidator:function(){return S.lz},buildFromV1Document:function(){return buildFromV1Document},canonicalizeRotation:function(){return E.f5},canvasUiColorTypeValidator:function(){return S.MN},clamp:function(){return E.uZ},clampRadians:function(){return E.Ci},clockwiseAngleDist:function(){return E.VK},compact:function(){return v.oA},compareRecordVersions:function(){return w.ix},compareSchemas:function(){return w.$F},computed:function(){return b.Fl},containBoxSize:function(){return containBoxSize},copyAs:function(){return copyAs},coreShapes:function(){return eX.u},counterClockwiseAngleDist:function(){return E.pc},createAssetValidator:function(){return S.tL},createPresenceStateDerivation:function(){return S.GP},createRecordType:function(){return w.ju},createSessionStateSnapshotSignal:function(){return createSessionStateSnapshotSignal},createShapeId:function(){return S.F1},createShapeValidator:function(){return S.JY},createTLSchema:function(){return S.HH},createTLStore:function(){return createTLStore},createTLUser:function(){return eT.L},dataUrlToFile:function(){return tu.B},debounce:function(){return v.Ds},debugFlags:function(){return $},dedupe:function(){return v.D8},deepCopy:function(){return v.p$},defaultShapeTools:function(){return tD},defaultShapeUtils:function(){return t6},defaultTools:function(){return nn},defaultUserPreferences:function(){return e5.ks},defineMigrations:function(){return w.zn},degreesToRadians:function(){return E.Ht},devFreeze:function(){return w.ZV},downsizeImage:function(){return downsizeImage},drawShapeMigrations:function(){return S._l},drawShapeProps:function(){return S.wu},embedShapeMigrations:function(){return S.BF},embedShapePermissionDefaults:function(){return S.gB},embedShapeProps:function(){return S.DW},exhaustiveSwitchError:function(){return v.iP},exportAs:function(){return exportAs},exportToBlob:function(){return exportToBlob},extractSessionStateFromLegacySnapshot:function(){return extractSessionStateFromLegacySnapshot},featureFlags:function(){return j},filterEntries:function(){return v.H4},fitFrameToContent:function(){return fitFrameToContent},frameShapeMigrations:function(){return S.gR},frameShapeProps:function(){return S.k7},geoShapeMigrations:function(){return S.P3},geoShapeProps:function(){return S.eG},getArcMeasure:function(){return E.D4},getArrowTerminalsInArrowSpace:function(){return e9.Qs},getCursor:function(){return getCursor},getDefaultColorTheme:function(){return S.y6},getDefaultTranslationLocale:function(){return S.Bz},getEmbedInfo:function(){return getEmbedInfo},getErrorAnnotations:function(){return v.wi},getFirstFromIterable:function(){return v.lr},getFreshUserPreferences:function(){return e5.MO},getHashForBuffer:function(){return v.Aq},getHashForObject:function(){return v.pT},getHashForString:function(){return v.jK},getIncrementedName:function(){return td.u},getIndexAbove:function(){return v._L},getIndexBelow:function(){return v.Xg},getIndexBetween:function(){return v.eI},getIndices:function(){return v.H$},getIndicesAbove:function(){return v.vw},getIndicesBelow:function(){return v.dk},getIndicesBetween:function(){return v.Xv},getOwnProperty:function(){return v.eg},getPointInArcT:function(){return E.rW},getPointOnCircle:function(){return E.XD},getPointerInfo:function(){return getPointerInfo},getPolygonVertices:function(){return E.Oe},getRecordVersion:function(){return w.C$},getRotationSnapshot:function(){return tp.o},getShapePropKeysByStyle:function(){return S.DR},getSvgAsImage:function(){return getSvgAsImage},getSvgAsString:function(){return getSvgAsString},getSvgPathFromPoints:function(){return getSvgPathFromPoints_getSvgPathFromPoints},getUserPreferences:function(){return e5.JM},groupShapeMigrations:function(){return S.c4},groupShapeProps:function(){return S.A7},hardReset:function(){return hardReset},hardResetEditor:function(){return hardResetEditor},hasOwnProperty:function(){return v.nr},highlightShapeMigrations:function(){return S.J1},highlightShapeProps:function(){return S.VW},idValidator:function(){return S.yd},imageShapeMigrations:function(){return S.y5},imageShapeProps:function(){return S.Fc},intersectCircleCircle:function(){return tr.bO},intersectCirclePolygon:function(){return tr.h9},intersectCirclePolyline:function(){return tr.XS},intersectLineSegmentCircle:function(){return tr.ZM},intersectLineSegmentLineSegment:function(){return tr.T9},intersectLineSegmentPolygon:function(){return tr.qZ},intersectLineSegmentPolyline:function(){return tr.Gc},intersectPolygonBounds:function(){return tr.S3},intersectPolygonPolygon:function(){return tr.tY},invLerp:function(){return v.VN},isDefined:function(){return v.$K},isGifAnimated:function(){return isGifAnimated},isNonNull:function(){return v.GT},isNonNullish:function(){return v.cF},isPageId:function(){return S.r5},isSafeFloat:function(){return E.AV},isShape:function(){return S.VV},isShapeId:function(){return S.YT},last:function(){return v.Z$},lerp:function(){return v.t7},lineShapeMigrations:function(){return S.FH},lineShapeProps:function(){return S.BG},linesIntersect:function(){return tr.cB},lns:function(){return v.L8},loadSessionStateSnapshotIntoStore:function(){return loadSessionStateSnapshotIntoStore},loopToHtmlElement:function(){return loopToHtmlElement},mapObjectMapValues:function(){return v.Fm},migrate:function(){return w.Te},migrateRecord:function(){return w.wJ},minBy:function(){return v.F},modulate:function(){return v.vm},moveCameraWhenCloseToEdge:function(){return moveCameraWhenCloseToEdge},noop:function(){return v.ZT},normalizeWheel:function(){return normalizeWheel},noteShapeMigrations:function(){return S.C_},noteShapeProps:function(){return S.m0},objectMapEntries:function(){return v.EP},objectMapFromEntries:function(){return v.Ls},objectMapKeys:function(){return v.GH},objectMapValues:function(){return v.UM},omitFromStackTrace:function(){return v.fP},opacityValidator:function(){return S.jm},openWindow:function(){return openWindow},pageIdValidator:function(){return S.CF},parentIdValidator:function(){return S.Mv},parseAndLoadDocument:function(){return parseAndLoadDocument},parseTldrawJsonFile:function(){return parseTldrawJsonFile},partition:function(){return v.uK},perimeterOfEllipse:function(){return E.Rp},pointInPolygon:function(){return E.Of},polygonsIntersect:function(){return tr.UQ},precise:function(){return E.Yk},preloadFont:function(){return preloadFont},preventDefault:function(){return preventDefault},promiseWithResolve:function(){return v.un},radiansToDegrees:function(){return E.vi},rafThrottle:function(){return v.TE},rangeIntersection:function(){return E.mW},react:function(){return b.Ym},refreshPage:function(){return refreshPage},releasePointerCapture:function(){return releasePointerCapture},removeFrame:function(){return removeFrame},resizeBox:function(){return resizeBox},reverseRecordsDiff:function(){return w.kJ},rng:function(){return v.Vk},rootShapeMigrations:function(){return S.cL},rotateArray:function(){return v.R8},rotateSelectionHandle:function(){return eo.dC},runtime:function(){return ex},scribbleValidator:function(){return S.gw},serializeTldrawJson:function(){return serializeTldrawJson},serializeTldrawJsonBlob:function(){return serializeTldrawJsonBlob},setDefaultEditorAssetUrls:function(){return setDefaultEditorAssetUrls},setDefaultUiAssetUrls:function(){return setDefaultUiAssetUrls},setPointerCapture:function(){return setPointerCapture},setRuntimeOverrides:function(){return setRuntimeOverrides},setUserPreferences:function(){return e5.yu},shapeIdValidator:function(){return S.u5},shortAngleDist:function(){return E.Z7},snapAngle:function(){return E.nD},sortById:function(){return v.uv},sortByIndex:function(){return v.hl},squashRecordDiffs:function(){return w.bs},stopEventPropagation:function(){return stopEventPropagation},structuredClone:function(){return v.v4},textShapeMigrations:function(){return S.pL},textShapeProps:function(){return S.XB},throttle:function(){return v.P2},throttledRaf:function(){return v.xP},toDomPrecision:function(){return E.$Z},toFixed:function(){return E.FH},toPrecision:function(){return E.Zd},toolbarItem:function(){return toolbarItem},track:function(){return b.j},transact:function(){return b.ay},transaction:function(){return b.PS},truncateStringWithEllipsis:function(){return truncateStringWithEllipsis},uniq:function(){return uniq},uniqueId:function(){return eM.E},unwrapLabel:function(){return unwrapLabel},useActions:function(){return useActions},useAssetUrls:function(){return useAssetUrls},useBreakpoint:function(){return useBreakpoint},useCanRedo:function(){return useCanRedo},useCanUndo:function(){return useCanUndo},useComputed:function(){return b.vc},useContainer:function(){return useContainer},useCopyAs:function(){return useCopyAs},useDefaultHelpers:function(){return useDefaultHelpers},useDialogs:function(){return useDialogs},useEditor:function(){return I.j},useEditorComponents:function(){return useEditorComponents},useExportAs:function(){return useExportAs},useIsCropping:function(){return useIsCropping},useIsDarkMode:function(){return useIsDarkMode},useIsEditing:function(){return useIsEditing},useKeyboardShortcuts:function(){return useKeyboardShortcuts},useLocalStorageState:function(){return useLocalStorageState},useLocalStore:function(){return useLocalStore},useMenuClipboardEvents:function(){return useMenuClipboardEvents},useMenuIsOpen:function(){return useMenuIsOpen},useNativeClipboardEvents:function(){return useNativeClipboardEvents},usePeerIds:function(){return usePeerIds},usePresence:function(){return usePresence},useQuickReactor:function(){return b.BK},useReactor:function(){return b.vC},useReadonly:function(){return useReadonly},useRelevantStyles:function(){return useRelevantStyles},useSelectionEvents:function(){return useSelectionEvents},useShallowArrayIdentity:function(){return useShallowArrayIdentity},useShallowObjectIdentity:function(){return useShallowObjectIdentity},useTLStore:function(){return useTLStore},useTldrawUiComponents:function(){return useTldrawUiComponents},useToasts:function(){return useToasts},useToolbarSchema:function(){return useToolbarSchema},useTools:function(){return useTools},useTransform:function(){return useTransform},useTranslation:function(){return useTranslation},useUiEvents:function(){return useUiEvents},useValue:function(){return b.Hg},validateIndexKey:function(){return v.LP},vecModelValidator:function(){return S.AT},videoShapeMigrations:function(){return S.lY},videoShapeProps:function(){return S.p$},warnDeprecatedGetter:function(){return v.q4},whyAmIRunning:function(){return b.iJ}});var a,l,c,u,d,p,h,g,f,m,y,b=n(9502),w=n(932),S=n(6934),v=n(3112),x=n(5958),T=n(7437),P=n(2265),C=n(2744);let k={error:null};let ErrorBoundary=class ErrorBoundary extends P.Component{static getDerivedStateFromError(e){return{error:e}}state=k;componentDidCatch(e){this.props.onError?.(e)}render(){let{error:e}=this.state;if(null!==e){let{fallback:t}=this.props;return(0,T.jsx)(t,{error:e})}return this.props.children}};function OptionalErrorBoundary({children:e,fallback:t,...n}){return null===t?(0,T.jsx)(T.Fragment,{children:e}):(0,T.jsx)(ErrorBoundary,{fallback:t,...n,children:e})}var I=n(3373);function DefaultBackground(){return(0,T.jsx)("div",{className:"tl-background"})}function useTransform(e,t,n,r,i,o){(0,P.useLayoutEffect)(()=>{let a=e.current;if(!a||void 0===t)return;let l=`translate(${t}px, ${n}px)`;void 0!==r&&(l+=` scale(${r})`),void 0!==i&&(l+=` rotate(${i}rad)`),o&&(l+=` translate(${o.x}px, ${o.y}px)`),a.style.transform=l})}var E=n(6166);let DefaultBrush=({brush:e,color:t,opacity:n,className:r})=>{let i=(0,P.useRef)(null);useTransform(i,e.x,e.y);let o=(0,E.$Z)(Math.max(1,e.w)),a=(0,E.$Z)(Math.max(1,e.h));return(0,T.jsx)("svg",{className:"tl-overlays__item",ref:i,children:t?(0,T.jsxs)("g",{className:"tl-brush",opacity:n,children:[(0,T.jsx)("rect",{width:o,height:a,fill:t,opacity:.75}),(0,T.jsx)("rect",{width:o,height:a,fill:"none",stroke:t,opacity:.1})]}):(0,T.jsx)("rect",{className:`tl-brush tl-brush__default ${r}`,width:o,height:a})})};var _=n(7655),M=n(2601);let j={},A=createDebugValue("pointerCaptureTrackingObject",{defaults:{all:new Map},shouldStoreForSession:!1}),$={preventDefaultLogging:createDebugValue("preventDefaultLogging",{defaults:{all:!1}}),pointerCaptureTracking:createDebugValue("pointerCaptureTracking",{defaults:{all:!1}}),elementRemovalLogging:createDebugValue("elementRemovalLogging",{defaults:{all:!1}}),debugSvg:createDebugValue("debugSvg",{defaults:{all:!1}}),showFps:createDebugValue("showFps",{defaults:{all:!1}}),throwToBlob:createDebugValue("throwToBlob",{defaults:{all:!1}}),resetConnectionEveryPing:createDebugValue("resetConnectionEveryPing",{defaults:{all:!1}}),debugCursors:createDebugValue("debugCursors",{defaults:{all:!1}}),forceSrgb:createDebugValue("forceSrgbColors",{defaults:{all:!1}}),debugGeometry:createDebugValue("debugGeometry",{defaults:{all:!1}}),hideShapes:createDebugValue("hideShapes",{defaults:{all:!1}}),documentName:createDebugValue("documentName",{defaults:{all:!1}})};if("undefined"!=typeof Element){let e=Element.prototype.removeChild;(0,b.Ym)("element removal logging",()=>{$.elementRemovalLogging.get()?Element.prototype.removeChild=function(t){return console.warn("[tldraw] removing child:",t),e.call(this,t)}:Element.prototype.removeChild=e})}function createDebugValue(e,{defaults:t,shouldStoreForSession:n=!0}){return createDebugValueBase({name:e,defaults:t,shouldStoreForSession:n})}function createDebugValueBase(e){let t=getDefaultValue(e),n=e.shouldStoreForSession?getStoredInitialValue(e.name):null,r=(0,b.cn)(`debug:${e.name}`,n??t);return"undefined"!=typeof window&&(e.shouldStoreForSession&&(0,b.Ym)(`debug:${e.name}`,()=>{let n=r.get();try{n===t?window.sessionStorage.removeItem(`tldraw_debug:${e.name}`):window.sessionStorage.setItem(`tldraw_debug:${e.name}`,JSON.stringify(n))}catch{}}),Object.defineProperty(window,`tldraw${e.name.replace(/^[a-z]/,e=>e.toUpperCase())}`,{get:()=>r.get(),set(e){r.set(e)},configurable:!0})),Object.assign(r,e)}function getStoredInitialValue(e){try{return JSON.parse(window?.sessionStorage.getItem(`tldraw_debug:${e}`)??"null")}catch(e){return null}}function readEnv(e){try{return e()}catch{return null}}function getDefaultValue(e){let t=readEnv(()=>M.env.TLDRAW_ENV)??readEnv(()=>M.env.VERCEL_PUBLIC_TLDRAW_ENV)??readEnv(()=>M.env.NEXT_PUBLIC_TLDRAW_ENV)??"production";switch(t){case"production":return e.defaults.production??e.defaults.all;case"preview":case"staging":return e.defaults.staging??e.defaults.all;default:return e.defaults.development??e.defaults.all}}function loopToHtmlElement(e){if(e instanceof HTMLElement)return e;if(e.parentElement)return loopToHtmlElement(e.parentElement);throw Error("Could not find a parent element of an HTML type!")}function preventDefault(e){e.preventDefault(),$.preventDefaultLogging.get()&&console.warn("preventDefault called on event:",e)}function setPointerCapture(e,t){if(e.setPointerCapture(t.pointerId),$.pointerCaptureTracking.get()){let n=A.get();n.set(e,(n.get(e)??0)+1),console.warn("setPointerCapture called on element:",e,t)}}function releasePointerCapture(e,t){if(e.hasPointerCapture(t.pointerId)&&(e.releasePointerCapture(t.pointerId),$.pointerCaptureTracking.get())){let n=A.get();1===n.get(e)?n.delete(e):n.has(e)?n.set(e,n.get(e)-1):console.warn("Release without capture"),console.warn("releasePointerCapture called on element:",e,t)}}let stopEventPropagation=e=>e.stopPropagation();function getPointerInfo(e){return e.isKilled=!0,{point:{x:e.clientX,y:e.clientY,z:e.pressure},shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey,pointerId:e.pointerId,button:e.button,isPen:"pen"===e.pointerType}}function useCanvasEvents(){let e=(0,I.j)(),t=(0,P.useMemo)(function(){let t,n;return{onPointerDown:function(t){if(!t.isKilled){if(2===t.button){e.dispatch({type:"pointer",target:"canvas",name:"right_click",...getPointerInfo(t)});return}(0===t.button||1===t.button||5===t.button)&&(setPointerCapture(t.currentTarget,t),e.dispatch({type:"pointer",target:"canvas",name:"pointer_down",...getPointerInfo(t)}),e.getOpenMenus().length>0&&(e.updateInstanceState({openMenus:[]}),document.body.click(),e.getContainer().focus()))}},onPointerMove:function(r){r.isKilled||r.clientX===t&&r.clientY===n||(t=r.clientX,n=r.clientY,e.dispatch({type:"pointer",target:"canvas",name:"pointer_move",...getPointerInfo(r)}))},onPointerUp:function(r){r.isKilled||0!==r.button&&1!==r.button&&2!==r.button&&5!==r.button||(t=r.clientX,n=r.clientY,releasePointerCapture(r.currentTarget,r),e.dispatch({type:"pointer",target:"canvas",name:"pointer_up",...getPointerInfo(r)}))},onPointerEnter:function(t){if(t.isKilled||e.getInstanceState().isPenMode&&"pen"!==t.pointerType)return;let n="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!!n||null})},onPointerLeave:function(t){if(t.isKilled||e.getInstanceState().isPenMode&&"pen"!==t.pointerType)return;let n="mouse"===t.pointerType||"pen"===t.pointerType;e.updateInstanceState({isHoveringCanvas:!n&&null})},onDragOver:function(e){preventDefault(e)},onDrop:async function(t){if(preventDefault(t),!t.dataTransfer?.files?.length)return;let n=Array.from(t.dataTransfer.files);await e.putExternalContent({type:"files",files:n,point:e.screenToPage({x:t.clientX,y:t.clientY}),ignoreParent:!1})},onTouchStart:function(e){e.isKilled=!0,document.body.click(),preventDefault(e)},onTouchEnd:function(e){e.isKilled=!0,"A"!==e.target.tagName&&"TEXTAREA"!==e.target.tagName&&preventDefault(e)},onClick:function(e){stopEventPropagation(e)}}},[e]);return t}function useCoarsePointer(){let e=(0,I.j)();(0,P.useEffect)(()=>{if(e.environment.isFirefox&&!e.environment.isAndroid&&!e.environment.isIos){e.updateInstanceState({isCoarsePointer:!1});return}if(window.matchMedia){let t=window.matchMedia("(pointer: coarse)"),handler=()=>{e.updateInstanceState({isCoarsePointer:!!t.matches})};if(handler(),t)return t.addEventListener("change",handler),()=>t.removeEventListener("change",handler)}},[e])}let D=(0,P.createContext)(null);function ContainerProvider({container:e,children:t}){return(0,T.jsx)(D.Provider,{value:e,children:t})}function useContainer(){return(0,v.kP)((0,P.useContext)(D),"useContainer used outside of <Tldraw />")}function useDocumentEvents(){let e=(0,I.j)(),t=useContainer(),n=(0,b.Hg)("isFocused",()=>e.getInstanceState().isFocused,[e]);(0,P.useEffect)(()=>{let t=null,updatePixelRatio=()=>{null!=t&&t();let n=`(resolution: ${window.devicePixelRatio}dppx)`,r=matchMedia(n),safariCb=e=>{"change"===e.type&&updatePixelRatio()};r.addEventListener?r.addEventListener("change",updatePixelRatio):r.addListener&&r.addListener(safariCb),t=()=>{r.removeEventListener?r.removeEventListener("change",updatePixelRatio):r.removeListener&&r.removeListener(safariCb)},e.updateInstanceState({devicePixelRatio:window.devicePixelRatio})};return updatePixelRatio(),()=>{t?.()}},[e]),(0,P.useEffect)(()=>{if(!n)return;let handleKeyDown=n=>{if(n.altKey&&(e.isIn("zoom")||!e.getPath().endsWith(".idle"))&&!isFocusingInput()&&preventDefault(n),n.isKilled)return;switch(n.isKilled=!0,n.key){case"=":case"-":case"0":if(n.metaKey||n.ctrlKey){preventDefault(n);return}break;case"Tab":default:if(isFocusingInput()||e.getIsMenuOpen())return;break;case",":return;case"Escape":if((e.getEditingShape()||e.getSelectedShapeIds().length>0)&&n.preventDefault(),e.getOpenMenus().length>0)return;e.inputs.keys.has("Escape")||(e.inputs.keys.add("Escape"),e.cancel(),t.focus());return}let r={type:"keyboard",name:n.repeat?"key_repeat":"key_down",key:n.key,code:n.code,shiftKey:n.shiftKey,altKey:n.altKey,ctrlKey:n.metaKey||n.ctrlKey};e.dispatch(r)},handleKeyUp=t=>{if(t.isKilled||(t.isKilled=!0,isFocusingInput()||e.getIsMenuOpen()||","===t.key))return;let n={type:"keyboard",name:"key_up",key:t.key,code:t.code,shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey};e.dispatch(n)};function handleTouchStart(n){if(t.contains(n.target)){let t=n.touches[0].pageX,r=n.touches[0].radiusX||0;(t-r<10||t+r>e.getViewportScreenBounds().width-10)&&(n.target?.tagName==="BUTTON"&&n.target?.click(),preventDefault(n))}}let handleWheel=e=>{t.contains(e.target)&&(e.ctrlKey||e.metaKey)&&preventDefault(e)};return t.addEventListener("touchstart",handleTouchStart,{passive:!1}),t.addEventListener("wheel",handleWheel,{passive:!1}),document.addEventListener("gesturestart",preventDefault),document.addEventListener("gesturechange",preventDefault),document.addEventListener("gestureend",preventDefault),t.addEventListener("keydown",handleKeyDown),t.addEventListener("keyup",handleKeyUp),()=>{t.removeEventListener("touchstart",handleTouchStart),t.removeEventListener("wheel",handleWheel),document.removeEventListener("gesturestart",preventDefault),document.removeEventListener("gesturechange",preventDefault),document.removeEventListener("gestureend",preventDefault),t.removeEventListener("keydown",handleKeyDown),t.removeEventListener("keyup",handleKeyUp)}},[e,t,n])}let O=["input","select","button","textarea"];function isFocusingInput(){let{activeElement:e}=document;return!!(e&&(e.getAttribute("contenteditable")||O.indexOf(e.tagName.toLowerCase())>-1))}let B=["textarea","input"];function useFixSafariDoubleTapZoomPencilEvents(e){let t=(0,I.j)();(0,P.useEffect)(()=>{let n=e.current;if(!n)return;let handleEvent=e=>{if(e instanceof PointerEvent&&"pen"===e.pointerType){e.isKilled=!0;let{target:n}=e;B.includes(n.tagName?.toLocaleLowerCase())||t.isIn("select.editing_shape")||preventDefault(e)}};return n.addEventListener("touchstart",handleEvent),n.addEventListener("touchend",handleEvent),()=>{n.removeEventListener("touchstart",handleEvent),n.removeEventListener("touchend",handleEvent)}},[t,e])}function clamp(e,t,n){return Math.max(t,Math.min(e,n))}let F={toVector:(e,t)=>(void 0===e&&(e=t),Array.isArray(e)?e:[e,e]),add:(e,t)=>[e[0]+t[0],e[1]+t[1]],sub:(e,t)=>[e[0]-t[0],e[1]-t[1]],addTo(e,t){e[0]+=t[0],e[1]+=t[1]},subTo(e,t){e[0]-=t[0],e[1]-=t[1]}};function rubberband(e,t,n){return 0===t||Math.abs(t)===1/0?Math.pow(e,5*n):e*t*n/(t+n*e)}function rubberbandIfOutOfBounds(e,t,n,r=.15){return 0===r?clamp(e,t,n):e<t?-rubberband(t-e,n-t,r)+t:e>n?+rubberband(e-n,n-t,r)+n:e}function computeRubberband(e,[t,n],[r,i]){let[[o,a],[l,c]]=e;return[rubberbandIfOutOfBounds(t,o,a,r),rubberbandIfOutOfBounds(n,l,c,i)]}function _toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function _toPropertyKey(e){var t=_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function _defineProperty(e,t,n){return(t=_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function _objectSpread2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ownKeys(Object(n),!0).forEach(function(t){_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}let U={pointer:{start:"down",change:"move",end:"up"},mouse:{start:"down",change:"move",end:"up"},touch:{start:"start",change:"move",end:"end"},gesture:{start:"start",change:"change",end:"end"}};function capitalize(e){return e?e[0].toUpperCase()+e.slice(1):""}let L=["enter","leave"];function hasCapture(e=!1,t){return e&&!L.includes(t)}function toHandlerProp(e,t="",n=!1){let r=U[e],i=r&&r[t]||t;return"on"+capitalize(e)+capitalize(i)+(hasCapture(n,i)?"Capture":"")}let R=["gotpointercapture","lostpointercapture"];function parseProp(e){let t=e.substring(2).toLowerCase(),n=!!~t.indexOf("passive");n&&(t=t.replace("passive",""));let r=R.includes(t)?"capturecapture":"capture",i=!!~t.indexOf(r);return i&&(t=t.replace("capture","")),{device:t,capture:i,passive:n}}function toDomEventType(e,t=""){let n=U[e],r=n&&n[t]||t;return e+r}function isTouch(e){return"touches"in e}function getPointerType(e){return isTouch(e)?"touch":"pointerType"in e?e.pointerType:"mouse"}function getCurrentTargetTouchList(e){return Array.from(e.touches).filter(t=>{var n,r;return t.target===e.currentTarget||(null===(n=e.currentTarget)||void 0===n||null===(r=n.contains)||void 0===r?void 0:r.call(n,t.target))})}function distanceAngle(e,t){try{let n=t.clientX-e.clientX,r=t.clientY-e.clientY,i=(t.clientX+e.clientX)/2,o=(t.clientY+e.clientY)/2;return{angle:-(180*Math.atan2(n,r))/Math.PI,distance:Math.hypot(n,r),origin:[i,o]}}catch(e){}return null}function touchIds(e){return getCurrentTargetTouchList(e).map(e=>e.identifier)}function touchDistanceAngle(e,t){let[n,r]=Array.from(e.touches).filter(e=>t.includes(e.identifier));return distanceAngle(n,r)}function wheelValues(e){let{deltaX:t,deltaY:n,deltaMode:r}=e;return 1===r?(t*=40,n*=40):2===r&&(t*=800,n*=800),[t,n]}function getEventDetails(e){let t={};if("buttons"in e&&(t.buttons=e.buttons),"shiftKey"in e){let{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o}=e;Object.assign(t,{shiftKey:n,altKey:r,metaKey:i,ctrlKey:o})}return t}function call(e,...t){return"function"==typeof e?e(...t):e}function noop(){}function chain(...e){return 0===e.length?noop:1===e.length?e[0]:function(){let t;for(let n of e)t=n.apply(this,arguments)||t;return t}}function assignDefault(e,t){return Object.assign({},t,e||{})}let Engine=class Engine{constructor(e,t,n){this.ctrl=e,this.args=t,this.key=n,this.state||(this.state={},this.computeValues([0,0]),this.computeInitial(),this.init&&this.init(),this.reset())}get state(){return this.ctrl.state[this.key]}set state(e){this.ctrl.state[this.key]=e}get shared(){return this.ctrl.state.shared}get eventStore(){return this.ctrl.gestureEventStores[this.key]}get timeoutStore(){return this.ctrl.gestureTimeoutStores[this.key]}get config(){return this.ctrl.config[this.key]}get sharedConfig(){return this.ctrl.config.shared}get handler(){return this.ctrl.handlers[this.key]}reset(){let{state:e,shared:t,ingKey:n,args:r}=this;t[n]=e._active=e.active=e._blocked=e._force=!1,e._step=[!1,!1],e.intentional=!1,e._movement=[0,0],e._distance=[0,0],e._direction=[0,0],e._delta=[0,0],e._bounds=[[-1/0,1/0],[-1/0,1/0]],e.args=r,e.axis=void 0,e.memo=void 0,e.elapsedTime=e.timeDelta=0,e.direction=[0,0],e.distance=[0,0],e.overflow=[0,0],e._movementBound=[!1,!1],e.velocity=[0,0],e.movement=[0,0],e.delta=[0,0],e.timeStamp=0}start(e){let t=this.state,n=this.config;t._active||(this.reset(),this.computeInitial(),t._active=!0,t.target=e.target,t.currentTarget=e.currentTarget,t.lastOffset=n.from?call(n.from,t):t.offset,t.offset=t.lastOffset,t.startTime=t.timeStamp=e.timeStamp)}computeValues(e){let t=this.state;t._values=e,t.values=this.config.transform(e)}computeInitial(){let e=this.state;e._initial=e._values,e.initial=e.values}compute(e){let{state:t,config:n,shared:r}=this;t.args=this.args;let i=0;if(e&&(t.event=e,n.preventDefault&&e.cancelable&&t.event.preventDefault(),t.type=e.type,r.touches=this.ctrl.pointerIds.size||this.ctrl.touchIds.size,r.locked=!!document.pointerLockElement,Object.assign(r,getEventDetails(e)),r.down=r.pressed=r.buttons%2==1||r.touches>0,i=e.timeStamp-t.timeStamp,t.timeStamp=e.timeStamp,t.elapsedTime=t.timeStamp-t.startTime),t._active){let e=t._delta.map(Math.abs);F.addTo(t._distance,e)}this.axisIntent&&this.axisIntent(e);let[o,a]=t._movement,[l,c]=n.threshold,{_step:u,values:d}=t;if(n.hasCustomTransform?(!1===u[0]&&(u[0]=Math.abs(o)>=l&&d[0]),!1===u[1]&&(u[1]=Math.abs(a)>=c&&d[1])):(!1===u[0]&&(u[0]=Math.abs(o)>=l&&Math.sign(o)*l),!1===u[1]&&(u[1]=Math.abs(a)>=c&&Math.sign(a)*c)),t.intentional=!1!==u[0]||!1!==u[1],!t.intentional)return;let p=[0,0];if(n.hasCustomTransform){let[e,t]=d;p[0]=!1!==u[0]?e-u[0]:0,p[1]=!1!==u[1]?t-u[1]:0}else p[0]=!1!==u[0]?o-u[0]:0,p[1]=!1!==u[1]?a-u[1]:0;this.restrictToAxis&&!t._blocked&&this.restrictToAxis(p);let h=t.offset,g=t._active&&!t._blocked||t.active;g&&(t.first=t._active&&!t.active,t.last=!t._active&&t.active,t.active=r[this.ingKey]=t._active,e&&(t.first&&("bounds"in n&&(t._bounds=call(n.bounds,t)),this.setup&&this.setup()),t.movement=p,this.computeOffset()));let[f,m]=t.offset,[[y,b],[w,S]]=t._bounds;t.overflow=[f<y?-1:f>b?1:0,m<w?-1:m>S?1:0],t._movementBound[0]=!!t.overflow[0]&&(!1===t._movementBound[0]?t._movement[0]:t._movementBound[0]),t._movementBound[1]=!!t.overflow[1]&&(!1===t._movementBound[1]?t._movement[1]:t._movementBound[1]);let v=t._active&&n.rubberband||[0,0];if(t.offset=computeRubberband(t._bounds,t.offset,v),t.delta=F.sub(t.offset,h),this.computeMovement(),g&&(!t.last||i>32)){t.delta=F.sub(t.offset,h);let e=t.delta.map(Math.abs);F.addTo(t.distance,e),t.direction=t.delta.map(Math.sign),t._direction=t._delta.map(Math.sign),!t.first&&i>0&&(t.velocity=[e[0]/i,e[1]/i],t.timeDelta=i)}}emit(){let e=this.state,t=this.shared,n=this.config;if(e._active||this.clean(),(e._blocked||!e.intentional)&&!e._force&&!n.triggerAllEvents)return;let r=this.handler(_objectSpread2(_objectSpread2(_objectSpread2({},t),e),{},{[this.aliasKey]:e.values}));void 0!==r&&(e.memo=r)}clean(){this.eventStore.clean(),this.timeoutStore.clean()}};function selectAxis([e,t],n){let r=Math.abs(e),i=Math.abs(t);return r>i&&r>n?"x":i>r&&i>n?"y":void 0}let CoordinatesEngine=class CoordinatesEngine extends Engine{constructor(...e){super(...e),_defineProperty(this,"aliasKey","xy")}reset(){super.reset(),this.state.axis=void 0}init(){this.state.offset=[0,0],this.state.lastOffset=[0,0]}computeOffset(){this.state.offset=F.add(this.state.lastOffset,this.state.movement)}computeMovement(){this.state.movement=F.sub(this.state.offset,this.state.lastOffset)}axisIntent(e){let t=this.state,n=this.config;if(!t.axis&&e){let r="object"==typeof n.axisThreshold?n.axisThreshold[getPointerType(e)]:n.axisThreshold;t.axis=selectAxis(t._movement,r)}t._blocked=(n.lockDirection||!!n.axis)&&!t.axis||!!n.axis&&n.axis!==t.axis}restrictToAxis(e){if(this.config.axis||this.config.lockDirection)switch(this.state.axis){case"x":e[1]=0;break;case"y":e[0]=0}}};let identity=e=>e,z={enabled:(e=!0)=>e,eventOptions:(e,t,n)=>_objectSpread2(_objectSpread2({},n.shared.eventOptions),e),preventDefault:(e=!1)=>e,triggerAllEvents:(e=!1)=>e,rubberband(e=0){switch(e){case!0:return[.15,.15];case!1:return[0,0];default:return F.toVector(e)}},from:e=>"function"==typeof e?e:null!=e?F.toVector(e):void 0,transform(e,t,n){let r=e||n.shared.transform;return this.hasCustomTransform=!!r,r||identity},threshold:e=>F.toVector(e,0)},N=0,V=_objectSpread2(_objectSpread2({},z),{},{axis(e,t,{axis:n}){if(this.lockDirection="lock"===n,!this.lockDirection)return n},axisThreshold:(e=N)=>e,bounds(e={}){if("function"==typeof e)return t=>V.bounds(e(t));if("current"in e)return()=>e.current;if("function"==typeof HTMLElement&&e instanceof HTMLElement)return e;let{left:t=-1/0,right:n=1/0,top:r=-1/0,bottom:i=1/0}=e;return[[t,n],[r,i]]}}),H="undefined"!=typeof window&&window.document&&window.document.createElement;function supportsTouchEvents(){return H&&"ontouchstart"in window}function isTouchScreen(){return supportsTouchEvents()||H&&window.navigator.maxTouchPoints>1}function supportsPointerEvents(){return H&&"onpointerdown"in window}function supportsPointerLock(){return H&&"exitPointerLock"in window.document}function supportsGestureEvents(){try{return"constructor"in GestureEvent}catch(e){return!1}}let G={isBrowser:H,gesture:supportsGestureEvents(),touch:supportsTouchEvents(),touchscreen:isTouchScreen(),pointer:supportsPointerEvents(),pointerLock:supportsPointerLock()},W=10,Z={mouse:0,touch:0,pen:8};function clampStateInternalMovementToBounds(e){let[t,n]=e.overflow,[r,i]=e._delta,[o,a]=e._direction;(t<0&&r>0&&o<0||t>0&&r<0&&o>0)&&(e._movement[0]=e._movementBound[0]),(n<0&&i>0&&a<0||n>0&&i<0&&a>0)&&(e._movement[1]=e._movementBound[1])}_objectSpread2(_objectSpread2({},V),{},{device(e,t,{pointer:{touch:n=!1,lock:r=!1,mouse:i=!1}={}}){return(this.pointerLock=r&&G.pointerLock,G.touch&&n)?"touch":this.pointerLock?"mouse":G.pointer&&!i?"pointer":G.touch?"touch":"mouse"},preventScrollAxis(e,t,{preventScroll:n}){if(this.preventScrollDelay="number"==typeof n?n:n||void 0===n&&e?250:void 0,G.touchscreen&&!1!==n)return e||(void 0!==n?"y":void 0)},pointerCapture(e,t,{pointer:{capture:n=!0,buttons:r=1,keys:i=!0}={}}){return this.pointerButtons=r,this.keys=i,!this.pointerLock&&"pointer"===this.device&&n},threshold(e,t,{filterTaps:n=!1,tapsThreshold:r=3,axis:i}){let o=F.toVector(e,n?r:i?1:0);return this.filterTaps=n,this.tapsThreshold=r,o},swipe({velocity:e=.5,distance:t=50,duration:n=250}={}){return{velocity:this.transform(F.toVector(e)),distance:this.transform(F.toVector(t)),duration:n}},delay(e=0){switch(e){case!0:return 180;case!1:return 0;default:return e}},axisThreshold:e=>e?_objectSpread2(_objectSpread2({},Z),e):Z,keyboardDisplacement:(e=W)=>e});let PinchEngine=class PinchEngine extends Engine{constructor(...e){super(...e),_defineProperty(this,"ingKey","pinching"),_defineProperty(this,"aliasKey","da")}init(){this.state.offset=[1,0],this.state.lastOffset=[1,0],this.state._pointerEvents=new Map}reset(){super.reset();let e=this.state;e._touchIds=[],e.canceled=!1,e.cancel=this.cancel.bind(this),e.turns=0}computeOffset(){let{type:e,movement:t,lastOffset:n}=this.state;"wheel"===e?this.state.offset=F.add(t,n):this.state.offset=[(1+t[0])*n[0],t[1]+n[1]]}computeMovement(){let{offset:e,lastOffset:t}=this.state;this.state.movement=[e[0]/t[0],e[1]-t[1]]}axisIntent(){let e=this.state,[t,n]=e._movement;if(!e.axis){let r=30*Math.abs(t)-Math.abs(n);r<0?e.axis="angle":r>0&&(e.axis="scale")}}restrictToAxis(e){this.config.lockDirection&&("scale"===this.state.axis?e[1]=0:"angle"===this.state.axis&&(e[0]=0))}cancel(){let e=this.state;e.canceled||setTimeout(()=>{e.canceled=!0,e._active=!1,this.compute(),this.emit()},0)}touchStart(e){this.ctrl.setEventIds(e);let t=this.state,n=this.ctrl.touchIds;if(t._active&&t._touchIds.every(e=>n.has(e))||n.size<2)return;this.start(e),t._touchIds=Array.from(n).slice(0,2);let r=touchDistanceAngle(e,t._touchIds);r&&this.pinchStart(e,r)}pointerStart(e){if(null!=e.buttons&&e.buttons%2!=1)return;this.ctrl.setEventIds(e),e.target.setPointerCapture(e.pointerId);let t=this.state,n=t._pointerEvents,r=this.ctrl.pointerIds;if(t._active&&Array.from(n.keys()).every(e=>r.has(e))||(n.size<2&&n.set(e.pointerId,e),t._pointerEvents.size<2))return;this.start(e);let i=distanceAngle(...Array.from(n.values()));i&&this.pinchStart(e,i)}pinchStart(e,t){let n=this.state;n.origin=t.origin,this.computeValues([t.distance,t.angle]),this.computeInitial(),this.compute(e),this.emit()}touchMove(e){if(!this.state._active)return;let t=touchDistanceAngle(e,this.state._touchIds);t&&this.pinchMove(e,t)}pointerMove(e){let t=this.state._pointerEvents;if(t.has(e.pointerId)&&t.set(e.pointerId,e),!this.state._active)return;let n=distanceAngle(...Array.from(t.values()));n&&this.pinchMove(e,n)}pinchMove(e,t){let n=this.state,r=n._values[1],i=t.angle-r,o=0;Math.abs(i)>270&&(o+=Math.sign(i)),this.computeValues([t.distance,t.angle-360*o]),n.origin=t.origin,n.turns=o,n._movement=[n._values[0]/n._initial[0]-1,n._values[1]-n._initial[1]],this.compute(e),this.emit()}touchEnd(e){this.ctrl.setEventIds(e),this.state._active&&this.state._touchIds.some(e=>!this.ctrl.touchIds.has(e))&&(this.state._active=!1,this.compute(e),this.emit())}pointerEnd(e){let t=this.state;this.ctrl.setEventIds(e);try{e.target.releasePointerCapture(e.pointerId)}catch(e){}t._pointerEvents.has(e.pointerId)&&t._pointerEvents.delete(e.pointerId),t._active&&t._pointerEvents.size<2&&(t._active=!1,this.compute(e),this.emit())}gestureStart(e){e.cancelable&&e.preventDefault();let t=this.state;t._active||(this.start(e),this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY],this.compute(e),this.emit())}gestureMove(e){if(e.cancelable&&e.preventDefault(),!this.state._active)return;let t=this.state;this.computeValues([e.scale,e.rotation]),t.origin=[e.clientX,e.clientY];let n=t._movement;t._movement=[e.scale-1,e.rotation],t._delta=F.sub(t._movement,n),this.compute(e),this.emit()}gestureEnd(e){this.state._active&&(this.state._active=!1,this.compute(e),this.emit())}wheel(e){let t=this.config.modifierKey;(!t||(Array.isArray(t)?t.find(t=>e[t]):e[t]))&&(this.state._active?this.wheelChange(e):this.wheelStart(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this)))}wheelStart(e){this.start(e),this.wheelChange(e)}wheelChange(e){let t="uv"in e;!t&&e.cancelable&&e.preventDefault();let n=this.state;n._delta=[-wheelValues(e)[1]/100*n.offset[0],0],F.addTo(n._movement,n._delta),clampStateInternalMovementToBounds(n),this.state.origin=[e.clientX,e.clientY],this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){let t=this.config.device;t&&(e(t,"start",this[t+"Start"].bind(this)),e(t,"change",this[t+"Move"].bind(this)),e(t,"end",this[t+"End"].bind(this)),e(t,"cancel",this[t+"End"].bind(this)),e("lostPointerCapture","",this[t+"End"].bind(this))),this.config.pinchOnWheel&&e("wheel","",this.wheel.bind(this),{passive:!1})}};let K=_objectSpread2(_objectSpread2({},z),{},{device(e,t,{shared:n,pointer:{touch:r=!1}={}}){if(n.target&&!G.touch&&G.gesture)return"gesture";if(G.touch&&r)return"touch";if(G.touchscreen){if(G.pointer)return"pointer";if(G.touch)return"touch"}},bounds(e,t,{scaleBounds:n={},angleBounds:r={}}){let _scaleBounds=e=>{let t=assignDefault(call(n,e),{min:-1/0,max:1/0});return[t.min,t.max]},_angleBounds=e=>{let t=assignDefault(call(r,e),{min:-1/0,max:1/0});return[t.min,t.max]};return"function"!=typeof n&&"function"!=typeof r?[_scaleBounds(),_angleBounds()]:e=>[_scaleBounds(e),_angleBounds(e)]},threshold(e,t,n){this.lockDirection="lock"===n.axis;let r=F.toVector(e,this.lockDirection?[.1,3]:0);return r},modifierKey:e=>void 0===e?"ctrlKey":e,pinchOnWheel:(e=!0)=>e});_objectSpread2(_objectSpread2({},V),{},{mouseOnly:(e=!0)=>e});let WheelEngine=class WheelEngine extends CoordinatesEngine{constructor(...e){super(...e),_defineProperty(this,"ingKey","wheeling")}wheel(e){this.state._active||this.start(e),this.wheelChange(e),this.timeoutStore.add("wheelEnd",this.wheelEnd.bind(this))}wheelChange(e){let t=this.state;t._delta=wheelValues(e),F.addTo(t._movement,t._delta),clampStateInternalMovementToBounds(t),this.compute(e),this.emit()}wheelEnd(){this.state._active&&(this.state._active=!1,this.compute(),this.emit())}bind(e){e("wheel","",this.wheel.bind(this))}};_objectSpread2(_objectSpread2({},V),{},{mouseOnly:(e=!0)=>e});let Y=new Map,X=new Map;function registerAction(e){Y.set(e.key,e.engine),X.set(e.key,e.resolver)}function _objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}function _objectWithoutProperties(e,t){if(null==e)return{};var n,r,i=_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}let J={target(e){if(e)return()=>"current"in e?e.current:e},enabled:(e=!0)=>e,window:(e=G.isBrowser?window:void 0)=>e,eventOptions:({passive:e=!0,capture:t=!1}={})=>({passive:e,capture:t}),transform:e=>e},Q=["target","eventOptions","window","enabled","transform"];function resolveWith(e={},t){let n={};for(let[r,i]of Object.entries(t))switch(typeof i){case"function":n[r]=i.call(n,e[r],r,e);break;case"object":n[r]=resolveWith(e[r],i);break;case"boolean":i&&(n[r]=e[r])}return n}function parse(e,t,n={}){let{target:r,eventOptions:i,window:o,enabled:a,transform:l}=e,c=_objectWithoutProperties(e,Q);if(n.shared=resolveWith({target:r,eventOptions:i,window:o,enabled:a,transform:l},J),t){let e=X.get(t);n[t]=resolveWith(_objectSpread2({shared:n.shared},c),e)}else for(let e in c){let t=X.get(e);t&&(n[e]=resolveWith(_objectSpread2({shared:n.shared},c[e]),t))}return n}let EventStore=class EventStore{constructor(e,t){_defineProperty(this,"_listeners",new Set),this._ctrl=e,this._gestureKey=t}add(e,t,n,r,i){let o=this._listeners,a=toDomEventType(t,n),l=this._gestureKey?this._ctrl.config[this._gestureKey].eventOptions:{},c=_objectSpread2(_objectSpread2({},l),i);e.addEventListener(a,r,c);let remove=()=>{e.removeEventListener(a,r,c),o.delete(remove)};return o.add(remove),remove}clean(){this._listeners.forEach(e=>e()),this._listeners.clear()}};let TimeoutStore=class TimeoutStore{constructor(){_defineProperty(this,"_timeouts",new Map)}add(e,t,n=140,...r){this.remove(e),this._timeouts.set(e,window.setTimeout(t,n,...r))}remove(e){let t=this._timeouts.get(e);t&&window.clearTimeout(t)}clean(){this._timeouts.forEach(e=>void window.clearTimeout(e)),this._timeouts.clear()}};let Controller=class Controller{constructor(e){_defineProperty(this,"gestures",new Set),_defineProperty(this,"_targetEventStore",new EventStore(this)),_defineProperty(this,"gestureEventStores",{}),_defineProperty(this,"gestureTimeoutStores",{}),_defineProperty(this,"handlers",{}),_defineProperty(this,"config",{}),_defineProperty(this,"pointerIds",new Set),_defineProperty(this,"touchIds",new Set),_defineProperty(this,"state",{shared:{shiftKey:!1,metaKey:!1,ctrlKey:!1,altKey:!1}}),resolveGestures(this,e)}setEventIds(e){return isTouch(e)?(this.touchIds=new Set(touchIds(e)),this.touchIds):"pointerId"in e?("pointerup"===e.type||"pointercancel"===e.type?this.pointerIds.delete(e.pointerId):"pointerdown"===e.type&&this.pointerIds.add(e.pointerId),this.pointerIds):void 0}applyHandlers(e,t){this.handlers=e,this.nativeHandlers=t}applyConfig(e,t){this.config=parse(e,t,this.config)}clean(){for(let e of(this._targetEventStore.clean(),this.gestures))this.gestureEventStores[e].clean(),this.gestureTimeoutStores[e].clean()}effect(){return this.config.shared.target&&this.bind(),()=>this._targetEventStore.clean()}bind(...e){let t;let n=this.config.shared,r={};if(!n.target||(t=n.target())){if(n.enabled){for(let n of this.gestures){let i=this.config[n],o=bindToProps(r,i.eventOptions,!!t);if(i.enabled){let t=Y.get(n);new t(this,e,n).bind(o)}}let i=bindToProps(r,n.eventOptions,!!t);for(let t in this.nativeHandlers)i(t,"",n=>this.nativeHandlers[t](_objectSpread2(_objectSpread2({},this.state.shared),{},{event:n,args:e})),void 0,!0)}for(let e in r)r[e]=chain(...r[e]);if(!t)return r;for(let e in r){let{device:n,capture:i,passive:o}=parseProp(e);this._targetEventStore.add(t,n,"",r[e],{capture:i,passive:o})}}}};function setupGesture(e,t){e.gestures.add(t),e.gestureEventStores[t]=new EventStore(e,t),e.gestureTimeoutStores[t]=new TimeoutStore}function resolveGestures(e,t){t.drag&&setupGesture(e,"drag"),t.wheel&&setupGesture(e,"wheel"),t.scroll&&setupGesture(e,"scroll"),t.move&&setupGesture(e,"move"),t.pinch&&setupGesture(e,"pinch"),t.hover&&setupGesture(e,"hover")}let bindToProps=(e,t,n)=>(r,i,o,a={},l=!1)=>{var c,u;let d=null!==(c=a.capture)&&void 0!==c?c:t.capture,p=null!==(u=a.passive)&&void 0!==u?u:t.passive,h=l?r:toHandlerProp(r,i,d);n&&p&&(h+="Passive"),e[h]=e[h]||[],e[h].push(o)},ee=/^on(Drag|Wheel|Scroll|Move|Pinch|Hover)/;function sortHandlers(e){let t={},n={},r=new Set;for(let i in e)ee.test(i)?(r.add(RegExp.lastMatch),n[i]=e[i]):t[i]=e[i];return[n,t,r]}function registerGesture(e,t,n,r,i,o){if(!e.has(n)||!Y.has(r))return;let a=n+"Start",l=n+"End";i[r]=e=>{let r;return e.first&&a in t&&t[a](e),n in t&&(r=t[n](e)),e.last&&l in t&&t[l](e),r},o[r]=o[r]||{}}function parseMergedHandlers(e,t){let[n,r,i]=sortHandlers(e),o={};return registerGesture(i,n,"onDrag","drag",o,t),registerGesture(i,n,"onWheel","wheel",o,t),registerGesture(i,n,"onScroll","scroll",o,t),registerGesture(i,n,"onPinch","pinch",o,t),registerGesture(i,n,"onMove","move",o,t),registerGesture(i,n,"onHover","hover",o,t),{handlers:o,config:t,nativeHandlers:r}}function useRecognizers(e,t={},n,r){let i=P.useMemo(()=>new Controller(e),[]);if(i.applyHandlers(e,r),i.applyConfig(t,n),P.useEffect(i.effect.bind(i)),P.useEffect(()=>i.clean.bind(i),[]),void 0===t.target)return i.bind.bind(i)}function createUseGesture(e){return e.forEach(registerAction),function(e,t){let{handlers:n,nativeHandlers:r,config:i}=parseMergedHandlers(e,t||{});return useRecognizers(n,i,void 0,r)}}n(2729);var et=n(4204);let en=/Mac|iPod|iPhone|iPad/.test("undefined"==typeof window?"node":window.navigator.platform);function normalizeWheel(e){let{deltaY:t,deltaX:n}=e,r=0;if(e.ctrlKey||e.altKey||e.metaKey){let n=Math.sign(e.deltaY),i=Math.abs(e.deltaY),o=t;i>10&&(o=10*n),r=o/100}else e.shiftKey&&!en&&(n=t,t=0);return{x:-n,y:-t,z:-r}}let er=createUseGesture([{key:"wheel",engine:WheelEngine,resolver:V},{key:"pinch",engine:PinchEngine,resolver:K}]),isWheelEndEvent=e=>void 0===o?(o=e,!1):e-o>120&&e-o<160?(o=e,!0):(o=e,!1);function useGestureEvents(e){let t=(0,I.j)(),n=P.useMemo(()=>{let n="not sure",r=1,i=1,o=1,a=0,l=new et.B,c=new et.B,updatePinchState=e=>{if(e&&(n="zooming"),"zooming"===n)return;let t=Math.abs(a-r),i=et.B.Dist(l,c);switch(n){case"not sure":t>24?n="zooming":i>16&&(n="panning");break;case"panning":t>64&&(n="zooming")}};return{onWheel:({event:e})=>{if(!t.getInstanceState().isFocused||(n="not sure",isWheelEndEvent(Date.now())))return;let r=t.getEditingShapeId();if(r){let e=t.getShape(r);if(e){let n=t.getShapeUtil(e);if(n.canScroll(e)){let e=t.getShapePageBounds(r);if(e?.containsPoint(t.inputs.currentPagePoint))return}}}preventDefault(e);let i=normalizeWheel(e);if(0===i.x&&0===i.y)return;let o={type:"wheel",name:"wheel",delta:i,point:new et.B(e.clientX,e.clientY),shiftKey:e.shiftKey,altKey:e.altKey,ctrlKey:e.metaKey||e.ctrlKey};t.dispatch(o)},onPinchStart:o=>{let a=e.current;n="not sure";let{event:u,origin:d,da:p}=o;!(u instanceof WheelEvent)&&(u.target===a||a?.contains(u.target))&&(c.x=d[0],c.y=d[1],l.x=d[0],l.y=d[1],r=p[0],i=t.getZoomLevel(),t.dispatch({type:"pinch",name:"pinch_start",point:{x:d[0],y:d[1],z:t.getZoomLevel()},delta:{x:0,y:0},shiftKey:u.shiftKey,altKey:u.altKey,ctrlKey:u.metaKey||u.ctrlKey}))},onPinchEnd:r=>{let i=e.current,{event:o,origin:a,offset:l}=r;if(o instanceof WheelEvent||!(o.target===i||i?.contains(o.target)))return;let c=l[0];n="not sure",requestAnimationFrame(()=>{t.dispatch({type:"pinch",name:"pinch_end",point:{x:a[0],y:a[1],z:c},delta:{x:a[0],y:a[1]},shiftKey:o.shiftKey,altKey:o.altKey,ctrlKey:o.metaKey||o.ctrlKey})})},onPinch:r=>{let l=e.current,{event:u,origin:d,offset:p,da:h}=r;if(u instanceof WheelEvent||!(u.target===l||l?.contains(u.target)))return;let g="gesturechange"===r.type||"gestureend"===r.type;a=h[0];let f=d[0]-c.x,m=d[1]-c.y;switch(c.x=d[0],c.y=d[1],updatePinchState(g),n){case"zooming":o=p[0],t.dispatch({type:"pinch",name:"pinch",point:{x:d[0],y:d[1],z:o},delta:{x:f,y:m},shiftKey:u.shiftKey,altKey:u.altKey,ctrlKey:u.metaKey||u.ctrlKey});break;case"panning":t.dispatch({type:"pinch",name:"pinch",point:{x:d[0],y:d[1],z:i},delta:{x:f,y:m},shiftKey:u.shiftKey,altKey:u.altKey,ctrlKey:u.metaKey||u.ctrlKey})}}}},[t,e]);er(n,{target:e,eventOptions:{passive:!1},pinch:{from:()=>[t.getZoomLevel(),0],scaleBounds:()=>({from:t.getZoomLevel(),max:8,min:.05})}})}function getHandle(e,t,n){let r=e.getShape(t),i=e.getShapeHandles(r);return{shape:r,handle:i.find(e=>e.id===n)}}function useHandleEvents(e,t){let n=(0,I.j)();return P.useMemo(()=>{let r,i;return{onPointerDown:r=>{if(r.isKilled)return;let i=loopToHtmlElement(r.currentTarget);setPointerCapture(i,r);let{shape:o,handle:a}=getHandle(n,e,t);a&&n.dispatch({type:"pointer",target:"handle",handle:a,shape:o,name:"pointer_down",...getPointerInfo(r)})},onPointerMove:o=>{if(o.isKilled||o.clientX===r&&o.clientY===i)return;r=o.clientX,i=o.clientY;let{shape:a,handle:l}=getHandle(n,e,t);l&&n.dispatch({type:"pointer",target:"handle",handle:l,shape:a,name:"pointer_move",...getPointerInfo(o)})},onPointerUp:r=>{if(r.isKilled)return;let i=loopToHtmlElement(r.currentTarget);releasePointerCapture(i,r);let{shape:o,handle:a}=getHandle(n,e,t);a&&n.dispatch({type:"pointer",target:"handle",handle:a,shape:o,name:"pointer_up",...getPointerInfo(r)})}}},[n,e,t])}var ei=n(6978),eo=n(696);function useScreenBounds(e){let t=(0,I.j)();(0,P.useLayoutEffect)(()=>{function updateScreenBounds(){let n=e.current;if(!n)return null;let r=n.getBoundingClientRect();t.updateViewportScreenBounds(new eo.xu(r.left||r.x,r.top||r.y,Math.max(r.width,1),Math.max(r.height,1)))}updateScreenBounds();let n=ei(updateScreenBounds,200,{trailing:!0}),r=setInterval(n,1e3);window.addEventListener("resize",n);let i=new ResizeObserver(e=>{e[0].contentRect&&n()}),o=e.current,a=null;return o&&(i.observe(o),(a=getNearestScrollableContainer(o)).addEventListener("scroll",n)),()=>{clearInterval(r),window.removeEventListener("resize",n),i.disconnect(),a?.removeEventListener("scroll",n)}},[t,e])}/*!
 * Author: excalidraw
 * MIT License: https://github.com/excalidraw/excalidraw/blob/master/LICENSE
 * https://github.com/excalidraw/excalidraw/blob/48c3465b19f10ec755b3eb84e21a01a468e96e43/packages/excalidraw/utils.ts#L600
 */let getNearestScrollableContainer=e=>{let t=e.parentElement;for(;t&&t!==document.body;){let{overflowY:e}=window.getComputedStyle(t),n=t.scrollHeight>t.clientHeight;if(n&&("auto"===e||"scroll"===e||"overlay"===e))return t;t=t.parentElement}return document};var ea=n(5404),es=n(7684);function useTick(e=!0){let[t,n]=(0,P.useState)(0),r=(0,I.j)();(0,P.useEffect)(()=>{if(!e)return;let update=()=>n(e=>e+1);return r.on("tick",update),()=>{r.off("tick",update)}},[r,e])}let el=(0,b.j)(function({showStroke:e=!0,showVertices:t=!0,showClosestPointOnOutline:n=!0}){let r=(0,I.j)();useTick(n);let i=r.getZoomLevel(),o=r.getRenderingShapes(),{inputs:{currentPagePoint:a}}=r;return(0,T.jsx)("svg",{style:{position:"absolute",pointerEvents:"none",zIndex:999999999,top:0,left:0,overflow:"visible"},children:o.map(o=>{let l=r.getShape(o.id);if("group"===l.type)return null;let c=r.getShapeGeometry(l),u=r.getShapePageTransform(l),d=r.getPointInShapeSpace(l,a),p=c.nearestPoint(d),h=c.distanceToPoint(d,!0),g=Math.abs(h)*i,{vertices:f}=c;return(0,T.jsxs)("g",{transform:u.toCssString(),strokeLinecap:"round",strokeLinejoin:"round",children:[e&&(0,T.jsx)(GeometryStroke,{geometry:c}),t&&f.map((e,t)=>(0,T.jsx)("circle",{cx:e.x,cy:e.y,r:"2",fill:`hsl(${(0,v.vm)(t,[0,f.length-1],[120,200])}, 100%, 50%)`,stroke:"black",strokeWidth:"1"},`v${t}`)),n&&g<150&&(0,T.jsx)("line",{x1:p.x,y1:p.y,x2:d.x,y2:d.y,opacity:1-g/150,stroke:h<0?"goldenrod":"dodgerblue",strokeWidth:"2"})]},o.id+"_outline")})})});function GeometryStroke({geometry:e}){return e instanceof es.m?(0,T.jsx)(T.Fragment,{children:[...e.children,...e.ignoredChildren].map((e,t)=>(0,T.jsx)(GeometryStroke,{geometry:e},t))}):(0,T.jsx)("path",{stroke:e.debugColor??"red",strokeWidth:"2",fill:"none",opacity:"1",d:e.toSimpleSvgPath()})}var ec=n(528);function uniq(e){return ec(e)}function usePeerIds(){let e=(0,I.j)(),t=(0,P.useMemo)(()=>e.store.query.records("instance_presence",()=>({userId:{neq:e.user.getId()}})),[e]),n=(0,b.vc)("userIds",()=>ec(t.get().map(e=>e.userId)).sort(),{isEqual:(e,t)=>e.join(",")===t.join?.(",")},[t]);return(0,b.Hg)(n)}function usePresence(e){let t=(0,I.j)(),n=(0,P.useMemo)(()=>t.store.query.records("instance_presence",()=>({userId:{eq:e}})),[t,e]),r=(0,b.Hg)(`latestPresence:${e}`,()=>n.get().slice().sort((e,t)=>t.lastActivityTimestamp-e.lastActivityTimestamp)[0],[]);return r??null}let eu=(0,b.j)(function(){let e=usePeerIds();return(0,T.jsx)(T.Fragment,{children:e.map(e=>(0,T.jsx)(ed,{collaboratorId:e},e))})}),ed=(0,b.j)(function({collaboratorId:e}){let t=(0,I.j)(),n=usePresence(e),r=useCollaboratorState(n);if(!(n&&n.currentPageId===t.getCurrentPageId()))return null;switch(r){case"inactive":{let{followingUserId:e,highlightedUserIds:r}=t.getInstanceState();if(!(e===n.userId||r.includes(n.userId)))return null;break}case"idle":{let{highlightedUserIds:e}=t.getInstanceState();if(n.followingUserId===t.user.getId()&&!(n.chatMessage||e.includes(n.userId)))return null}}return(0,T.jsx)(ep,{latestPresence:n})}),ep=(0,b.j)(function({latestPresence:e}){let t=(0,I.j)(),{CollaboratorBrush:n,CollaboratorScribble:r,CollaboratorCursor:i,CollaboratorHint:o,CollaboratorShapeIndicator:a}=useEditorComponents(),l=t.getZoomLevel(),c=t.getViewportPageBounds(),{userId:u,chatMessage:d,brush:p,scribbles:h,selectedShapeIds:g,userName:f,cursor:m,color:y}=e,b=!(m.x<c.minX-12/l||m.y<c.minY-16/l||m.x>c.maxX-12/l||m.y>c.maxY-16/l);return(0,T.jsxs)(T.Fragment,{children:[p&&n?(0,T.jsx)(n,{className:"tl-collaborator__brush",brush:p,color:y,opacity:.1},u+"_brush"):null,b&&i?(0,T.jsx)(i,{className:"tl-collaborator__cursor",point:m,color:y,zoom:l,name:"New User"!==f?f:null,chatMessage:d},u+"_cursor"):o?(0,T.jsx)(o,{className:"tl-collaborator__cursor-hint",point:m,color:y,zoom:l,viewport:c},u+"_cursor_hint"):null,r&&h.length?(0,T.jsx)(T.Fragment,{children:h.map(e=>(0,T.jsx)(r,{className:"tl-collaborator__scribble",scribble:e,color:y,zoom:l,opacity:"laser"===e.color?.5:.1},u+"_scribble_"+e.id))}):null,a&&g.map(e=>(0,T.jsx)(a,{className:"tl-collaborator__shape-indicator",shapeId:e,color:y,opacity:.5},u+"_"+e))]})});function getStateFromElapsedTime(e){return e>_.RZ?"inactive":e>_.O8?"idle":"active"}function useCollaboratorState(e){let t=(0,P.useRef)(e?.lastActivityTimestamp??-1),[n,r]=(0,P.useState)(()=>getStateFromElapsedTime(Date.now()-t.current));return(0,P.useEffect)(()=>{let e=setInterval(()=>{r(getStateFromElapsedTime(Date.now()-t.current))},_.MN);return()=>clearInterval(e)},[]),e&&(t.current=e.lastActivityTimestamp),n}function gcd(e,t){return 0===t?e:gcd(t,e%t)}function nearestMultiple(e){let t=e.toString().split(".")[1];if(!t)return 1;let n=Math.pow(10,t.length),r=parseInt(t,10);return n/gcd(r,n)}let eh=(0,b.j)(function({id:e,shape:t,util:n,index:r,backgroundIndex:i,opacity:o,isCulled:a}){let l=(0,I.j)(),{ShapeErrorFallback:c}=useEditorComponents(),u=P.useRef(null),d=P.useRef(null),p=P.useCallback((e,t)=>{u.current?.style.setProperty(e,t),d.current?.style.setProperty(e,t)},[]);(0,b.BK)("set shape container transform position",()=>{let t=l.getShape(e);if(!t)return;let n=l.getShapePageTransform(e),r=ea._.toCssString(n);p("transform",r)},[l,p]),(0,b.BK)("set shape container clip path",()=>{let t=l.getShape(e);if(!t)return null;let n=l.getShapeClipPath(e);p("clip-path",n??"none")},[l,p]),(0,b.BK)("set shape height and width",()=>{let t=l.getShape(e);if(!t)return null;let n=l.getShapeGeometry(t).bounds,r=Math.floor(100*l.getInstanceState().devicePixelRatio)/100,i=nearestMultiple(r),o=n.w%i,a=0===o?n.w:n.w+(i-o),c=n.h%i,u=0===c?n.h:n.h+(i-c);p("width",Math.max(a,i)+"px"),p("height",Math.max(u,i)+"px")},[l]),P.useLayoutEffect(()=>{p("opacity",o+""),u.current?.style.setProperty("z-index",r+""),d.current?.style.setProperty("z-index",i+"")},[o,r,i,p]);let h=P.useCallback(e=>{l.annotateError(e,{origin:"react.shape",willCrashApp:!1})},[l]);return t?(0,T.jsxs)(T.Fragment,{children:[n.backgroundComponent&&(0,T.jsx)("div",{ref:d,className:"tl-shape tl-shape-background","data-shape-type":t.type,draggable:!1,children:!a&&(0,T.jsx)(OptionalErrorBoundary,{fallback:c,onError:h,children:(0,T.jsx)(ef,{shape:t,util:n})})}),(0,T.jsx)("div",{ref:u,className:"tl-shape","data-shape-type":t.type,draggable:!1,children:a?(0,T.jsx)(em,{shape:t}):(0,T.jsx)(OptionalErrorBoundary,{fallback:c,onError:h,children:(0,T.jsx)(eg,{shape:t,util:n})})})]}):null}),eg=P.memo(function({shape:e,util:t}){return(0,b.uC)("InnerShape:"+e.type,()=>t.component(e))},(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta&&e.util===t.util),ef=P.memo(function({shape:e,util:t}){return(0,b.uC)("InnerShape:"+e.type,()=>t.backgroundComponent?.(e))},(e,t)=>e.shape.props===t.shape.props&&e.shape.meta===t.shape.meta),em=P.memo(function({shape:e}){let t=(0,I.j)(),n=t.getShapeGeometry(e).bounds;return(0,T.jsx)("div",{className:"tl-shape__culled",style:{transform:`translate(${(0,E.$Z)(n.minX)}px, ${(0,E.$Z)(n.minY)}px)`,width:Math.max(1,(0,E.$Z)(n.width)),height:Math.max(1,(0,E.$Z)(n.height))}})},()=>!0);function DefaultCanvas({className:e}){let t=(0,I.j)(),{Background:n,SvgDefs:r}=useEditorComponents(),i=P.useRef(null),o=P.useRef(null),a=P.useRef(null);useScreenBounds(i),useDocumentEvents(),useCoarsePointer(),useGestureEvents(i),useFixSafariDoubleTapZoomPencilEvents(i),(0,b.BK)("position layers",()=>{let e=o.current;if(!e)return;let n=a.current;if(!n)return;let{x:r,y:i,z:l}=t.getCamera(),c=l>=1?(0,v.vm)(l,[1,8],[.125,.5],!0):(0,v.vm)(l,[.1,1],[-2,.125],!0),u=`scale(${(0,E.$Z)(l)}) translate(${(0,E.$Z)(r+c)}px,${(0,E.$Z)(i+c)}px)`;e.style.setProperty("transform",u),n.style.setProperty("transform",u)},[t]);let l=useCanvasEvents(),c=(0,b.Hg)("shapeSvgDefs",()=>{let e=new Map;for(let n of(0,v.UM)(t.shapeUtils)){if(!n)return;let t=n.getCanvasSvgDefs();for(let{key:n,component:r}of t)e.has(n)||e.set(n,(0,T.jsx)(r,{},n))}return[...e.values()]},[t]),u=(0,b.Hg)("debug_shapes",()=>$.hideShapes.get(),[$]),d=(0,b.Hg)("debug_svg",()=>$.debugSvg.get(),[$]),p=(0,b.Hg)("debug_geometry",()=>$.debugGeometry.get(),[$]);return(0,T.jsxs)("div",{ref:i,draggable:!1,className:C("tl-canvas",e),"data-testid":"canvas",...l,children:[(0,T.jsx)("svg",{className:"tl-svg-context",children:(0,T.jsxs)("defs",{children:[c,Cursor&&(0,T.jsx)(Cursor,{}),(0,T.jsx)(CollaboratorHint,{}),(0,T.jsx)(ArrowheadDot,{}),(0,T.jsx)(ArrowheadCross,{}),r&&(0,T.jsx)(r,{})]})}),n&&(0,T.jsx)(n,{}),(0,T.jsx)(GridWrapper,{}),(0,T.jsxs)("div",{ref:o,className:"tl-html-layer tl-shapes",draggable:!1,children:[(0,T.jsx)(OnTheCanvasWrapper,{}),(0,T.jsx)(SelectionBackgroundWrapper,{}),u?null:d?(0,T.jsx)(ShapesWithSVGs,{}):(0,T.jsx)(ShapesToDisplay,{})]}),(0,T.jsxs)("div",{className:"tl-overlays",children:[(0,T.jsxs)("div",{ref:a,className:"tl-html-layer",children:[p?(0,T.jsx)(el,{}):null,(0,T.jsx)(HandlesWrapper,{}),(0,T.jsx)(BrushWrapper,{}),(0,T.jsx)(ScribbleWrapper,{}),(0,T.jsx)(ZoomBrushWrapper,{}),(0,T.jsx)(SelectedIdIndicators,{}),(0,T.jsx)(HoveredShapeIndicator,{}),(0,T.jsx)(ey,{}),(0,T.jsx)(SnapIndicatorWrapper,{}),(0,T.jsx)(SelectionForegroundWrapper,{}),(0,T.jsx)(eu,{})]}),(0,T.jsx)(InFrontOfTheCanvasWrapper,{})]})]})}function GridWrapper(){let e=(0,I.j)(),t=(0,b.Hg)("gridSize",()=>e.getDocumentSettings().gridSize,[e]),{x:n,y:r,z:i}=(0,b.Hg)("camera",()=>e.getCamera(),[e]),o=(0,b.Hg)("isGridMode",()=>e.getInstanceState().isGridMode,[e]),{Grid:a}=useEditorComponents();return a&&o?(0,T.jsx)(a,{x:n,y:r,z:i,size:t}):null}function ScribbleWrapper(){let e=(0,I.j)(),t=(0,b.Hg)("scribbles",()=>e.getInstanceState().scribbles,[e]),n=(0,b.Hg)("zoomLevel",()=>e.getZoomLevel(),[e]),{Scribble:r}=useEditorComponents();return r&&t.length?(0,T.jsx)(T.Fragment,{children:t.map(e=>(0,T.jsx)(r,{className:"tl-user-scribble",scribble:e,zoom:n},e.id))}):null}function BrushWrapper(){let e=(0,I.j)(),t=(0,b.Hg)("brush",()=>e.getInstanceState().brush,[e]),{Brush:n}=useEditorComponents();return n&&t?(0,T.jsx)(n,{className:"tl-user-brush",brush:t}):null}function ZoomBrushWrapper(){let e=(0,I.j)(),t=(0,b.Hg)("zoomBrush",()=>e.getInstanceState().zoomBrush,[e]),{ZoomBrush:n}=useEditorComponents();return n&&t?(0,T.jsx)(n,{className:"tl-user-brush tl-zoom-brush",brush:t}):null}function SnapIndicatorWrapper(){let e=(0,I.j)(),t=(0,b.Hg)("snapLines",()=>e.snaps.getIndicators(),[e]),n=(0,b.Hg)("zoomLevel",()=>e.getZoomLevel(),[e]),{SnapIndicator:r}=useEditorComponents();return r&&t.length>0?(0,T.jsx)(T.Fragment,{children:t.map(e=>(0,T.jsx)(r,{className:"tl-user-snapline",line:e,zoom:n},e.id))}):null}function HandlesWrapper(){let e=(0,I.j)(),{Handles:t}=useEditorComponents(),n=(0,b.Hg)("zoomLevel",()=>e.getZoomLevel(),[e]),r=(0,b.Hg)("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),i=(0,b.Hg)("isChangingStyle",()=>e.getInstanceState().isReadonly,[e]),o=(0,b.Hg)("isChangingStyle",()=>e.getInstanceState().isChangingStyle,[e]),a=(0,b.Hg)("onlySelectedShape",()=>e.getOnlySelectedShape(),[e]),l=(0,b.Hg)("transform",()=>a?e.getShapePageTransform(a):null,[e,a]),c=(0,b.Hg)("handles",()=>{if(!a)return null;let t=e.getShapeHandles(a);if(!t)return null;let i=(r?_.Pr:_.rQ)/n*2;return t.filter(e=>"virtual"!==e.type||!t.some(t=>t!==e&&"vertex"===t.type&&et.B.Dist(e,t)<i)).sort(e=>"vertex"===e.type?1:-1)},[e,a,n,r]);return t&&a&&!o&&!i&&c&&l?(0,T.jsx)(t,{children:(0,T.jsx)("g",{transform:ea._.toCssString(l),children:c.map(e=>(0,T.jsx)(HandleWrapper,{shapeId:a.id,handle:e,zoom:n,isCoarse:r},e.id))})}):null}function HandleWrapper({shapeId:e,handle:t,zoom:n,isCoarse:r}){let i=useHandleEvents(e,t.id),{Handle:o}=useEditorComponents();return o?(0,T.jsx)("g",{"aria-label":"handle",transform:`translate(${t.x}, ${t.y})`,...i,children:(0,T.jsx)(o,{shapeId:e,handle:t,zoom:n,isCoarse:r})}):null}function ShapesWithSVGs(){let e=(0,I.j)(),t=(0,b.Hg)("rendering shapes",()=>e.getRenderingShapes(),[e]);return(0,T.jsx)(T.Fragment,{children:t.map(e=>(0,T.jsxs)(P.Fragment,{children:[(0,T.jsx)(eh,{...e}),(0,T.jsx)(eb,{id:e.id})]},e.id+"_fragment"))})}function ShapesToDisplay(){let e=(0,I.j)(),t=(0,b.Hg)("rendering shapes",()=>e.getRenderingShapes(),[e]);return(0,T.jsx)(T.Fragment,{children:t.map(e=>(0,T.jsx)(eh,{...e},e.id+"_shape"))})}function SelectedIdIndicators(){let e=(0,I.j)(),t=(0,b.Hg)("selectedShapeIds",()=>e.getSelectedShapeIds(),[e]),n=(0,b.Hg)("should display selected ids",()=>e.isInAny("select.idle","select.brushing","select.scribble_brushing","select.editing_shape","select.pointing_shape","select.pointing_selection","select.pointing_handle")&&!e.getInstanceState().isChangingStyle,[e]),{ShapeIndicator:r}=useEditorComponents();return r&&n?(0,T.jsx)(T.Fragment,{children:t.map(e=>(0,T.jsx)(r,{className:"tl-user-indicator__selected",shapeId:e},e+"_indicator"))}):null}let HoveredShapeIndicator=function(){let e=(0,I.j)(),{HoveredShapeIndicator:t}=useEditorComponents(),n=(0,b.Hg)("coarse pointer",()=>e.getInstanceState().isCoarsePointer,[e]),r=(0,b.Hg)("hovering canvas",()=>e.getInstanceState().isHoveringCanvas,[e]),i=(0,b.Hg)("hovered id",()=>e.getCurrentPageState().hoveredShapeId,[e]);return!n&&r&&i&&t?(0,T.jsx)(t,{shapeId:i}):null},ey=(0,b.j)(function(){let e=(0,I.j)(),{ShapeIndicator:t}=useEditorComponents(),n=(0,v.D8)(e.getHintingShapeIds());return n.length&&t?(0,T.jsx)(T.Fragment,{children:n.map(e=>(0,T.jsx)(t,{className:"tl-user-indicator__hint",shapeId:e},e+"_hinting"))}):null});function Cursor(){return(0,T.jsxs)("g",{id:"cursor",children:[(0,T.jsxs)("g",{fill:"rgba(0,0,0,.2)",transform:"translate(-11,-11)",children:[(0,T.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,T.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,T.jsxs)("g",{fill:"white",transform:"translate(-12,-12)",children:[(0,T.jsx)("path",{d:"m12 24.4219v-16.015l11.591 11.619h-6.781l-.411.124z"}),(0,T.jsx)("path",{d:"m21.0845 25.0962-3.605 1.535-4.682-11.089 3.686-1.553z"})]}),(0,T.jsxs)("g",{fill:"currentColor",transform:"translate(-12,-12)",children:[(0,T.jsx)("path",{d:"m19.751 24.4155-1.844.774-3.1-7.374 1.841-.775z"}),(0,T.jsx)("path",{d:"m13 10.814v11.188l2.969-2.866.428-.139h4.768z"})]})]})}function CollaboratorHint(){return(0,T.jsx)("path",{id:"cursor_hint",fill:"currentColor",d:"M -2,-5 2,0 -2,5 Z"})}function ArrowheadDot(){return(0,T.jsx)("marker",{id:"arrowhead-dot",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"0",children:(0,T.jsx)("circle",{cx:"3",cy:"3",r:"2",strokeDasharray:"100%"})})}function ArrowheadCross(){return(0,T.jsxs)("marker",{id:"arrowhead-cross",className:"tl-arrow-hint",refX:"3.0",refY:"3.0",orient:"auto",children:[(0,T.jsx)("line",{x1:"1.5",y1:"1.5",x2:"4.5",y2:"4.5",strokeDasharray:"100%"}),(0,T.jsx)("line",{x1:"1.5",y1:"4.5",x2:"4.5",y2:"1.5",strokeDasharray:"100%"})]})}let eb=(0,b.j)(function({id:e}){let t=(0,I.j)(),n=t.getShape(e),[r,i]=P.useState(""),o=n?.parentId===t.getCurrentPageId();return(P.useEffect(()=>{if(!o)return;let n=null,r=(0,b.Ym)("shape to svg",async()=>{let r=Math.random();n=r;let o=t.getShapePageBounds(e),a=await t.getSvg([e],{padding:0,background:t.getInstanceState().exportBackground});a&&o&&n===r&&(a.style.setProperty("overflow","visible"),a.setAttribute("preserveAspectRatio","xMidYMin slice"),a.style.setProperty("transform",`translate(${o.x}px, ${o.y+o.h+12}px)`),a.style.setProperty("border","1px solid black"),i(a?.outerHTML))});return()=>{n=null,r()}},[t,e,o]),o)?(0,T.jsx)("div",{style:{paddingTop:12,position:"absolute"},children:(0,T.jsx)("div",{style:{display:"flex"},dangerouslySetInnerHTML:{__html:r}})}):null});function SelectionForegroundWrapper(){let e=(0,I.j)(),t=(0,b.Hg)("selection rotation",()=>e.getSelectionRotation(),[e]),n=(0,b.Hg)("selection bounds",()=>e.getSelectionRotatedPageBounds(),[e]),{SelectionForeground:r}=useEditorComponents();return n&&r?(0,T.jsx)(r,{bounds:n,rotation:t}):null}function SelectionBackgroundWrapper(){let e=(0,I.j)(),t=(0,b.Hg)("selection rotation",()=>e.getSelectionRotation(),[e]),n=(0,b.Hg)("selection bounds",()=>e.getSelectionRotatedPageBounds(),[e]),{SelectionBackground:r}=useEditorComponents();return n&&r?(0,T.jsx)(r,{bounds:n,rotation:t}):null}function OnTheCanvasWrapper(){let{OnTheCanvas:e}=useEditorComponents();return e?(0,T.jsx)(e,{}):null}function InFrontOfTheCanvasWrapper(){let{InFrontOfTheCanvas:e}=useEditorComponents();return e?(0,T.jsx)(e,{}):null}function DefaultCollaboratorHint({className:e,zoom:t,point:n,color:r,viewport:i,opacity:o=1}){let a=(0,P.useRef)(null);return useTransform(a,(0,E.uZ)(n.x,i.minX+5/t,i.maxX-5/t),(0,E.uZ)(n.y,i.minY+5/t,i.maxY-5/t),1/t,et.B.Angle(i.center,n)),(0,T.jsxs)("svg",{ref:a,className:C("tl-overlays__item",e),children:[(0,T.jsx)("use",{href:"#cursor_hint",color:r,strokeWidth:3,stroke:"var(--color-background)"}),(0,T.jsx)("use",{href:"#cursor_hint",color:r,opacity:o})]})}let ew=(0,P.memo)(function({className:e,zoom:t,point:n,color:r,name:i,chatMessage:o}){let a=(0,P.useRef)(null);return(useTransform(a,n?.x,n?.y,1/t),n)?(0,T.jsxs)("div",{ref:a,className:C("tl-overlays__item",e),children:[(0,T.jsx)("svg",{className:"tl-cursor",children:(0,T.jsx)("use",{href:"#cursor",color:r})}),o?(0,T.jsxs)(T.Fragment,{children:[i&&(0,T.jsx)("div",{className:"tl-nametag-title",style:{color:r},children:i}),(0,T.jsx)("div",{className:"tl-nametag-chat",style:{backgroundColor:r},children:o})]}):i&&(0,T.jsx)("div",{className:"tl-nametag",style:{backgroundColor:r},children:i})]}):null});function DefaultGrid({x:e,y:t,z:n,size:r}){return(0,T.jsxs)("svg",{className:"tl-grid",version:"1.1",xmlns:"http://www.w3.org/2000/svg",children:[(0,T.jsx)("defs",{children:_.dW.map(({min:i,mid:o,step:a},l)=>{let c=a*r*n,u=.5+e*n,d=.5+t*n,p=n<o?(0,v.vm)(n,[i,o],[0,1]):1;return(0,T.jsx)("pattern",{id:`grid-${a}`,width:c,height:c,patternUnits:"userSpaceOnUse",children:(0,T.jsx)("circle",{className:"tl-grid-dot",cx:u>0?u%c:c+u%c,cy:d>0?d%c:c+d%c,r:1,opacity:p})},`grid-pattern-${l}`)})}),_.dW.map(({step:e},t)=>(0,T.jsx)("rect",{width:"100%",height:"100%",fill:`url(#grid-${e})`},`grid-rect-${t}`))]})}function DefaultHandle({handle:e,isCoarse:t,className:n,zoom:r}){let i=(t?_.Pr:_.rQ)/r,o=("create"===e.type&&t?3:4)/r;return(0,T.jsxs)("g",{className:C("tl-handle",{"tl-handle__virtual":"virtual"===e.type,"tl-handle__create":"create"===e.type},n),children:[(0,T.jsx)("circle",{className:"tl-handle__bg",r:i}),(0,T.jsx)("circle",{className:"tl-handle__fg",r:o})]})}let DefaultHandles=({children:e})=>(0,T.jsx)("svg",{className:"tl-user-handles tl-overlays__item",children:e});function DefaultHoveredShapeIndicator({shapeId:e}){let{ShapeIndicator:t}=useEditorComponents();return t?(0,T.jsx)(t,{className:"tl-user-indicator__hovered",shapeId:e}):null}function getSvgPathFromPoints_getSvgPathFromPoints(e,t=!0){let n=e.length;if(n<2)return"";let r=e[0],i=e[1];if(2===n)return`M${(0,E.Yk)(r)}L${(0,E.Yk)(i)}`;let o="";for(let t=2,a=n-1;t<a;t++)r=e[t],i=e[t+1],o+=(0,E.Y8)(r,i);return t?`M${(0,E.Y8)(e[0],e[1])}Q${(0,E.Yk)(e[1])}${(0,E.Y8)(e[1],e[2])}T${o}${(0,E.Y8)(e[n-1],e[0])}${(0,E.Y8)(e[0],e[1])}Z`:`M${(0,E.Yk)(e[0])}Q${(0,E.Yk)(e[1])}${(0,E.Y8)(e[1],e[2])}${e.length>3?"T":""}${o}L${(0,E.Yk)(e[n-1])}`}function DefaultScribble({scribble:e,zoom:t,color:n,opacity:r,className:i}){return e.points.length?(0,T.jsx)("svg",{className:i?C("tl-overlays__item",i):i,children:(0,T.jsx)("path",{className:"tl-scribble",d:getSvgPathFromPoints_getSvgPathFromPoints(e.points,!1),stroke:n??`var(--color-${e.color})`,fill:"none",strokeWidth:8/t,opacity:r??e.opacity})}):null}function DefaultSelectionBackground({bounds:e,rotation:t}){let n=P.useRef(null);return useTransform(n,e.x,e.y,1,t),P.useLayoutEffect(()=>{let t=n.current;t&&(t.style.width=(0,E.$Z)(Math.max(1,e.width))+"px",t.style.height=(0,E.$Z)(Math.max(1,e.height))+"px")},[e.width,e.height]),(0,T.jsx)("div",{ref:n,className:"tl-selection__bg",draggable:!1})}function DefaultSelectionForeground({bounds:e,rotation:t}){let n=(0,I.j)(),r=(0,P.useRef)(null),i=(0,b.Hg)("only selected shape",()=>n.getOnlySelectedShape(),[n]),o=i?n.getShapeUtil(i).expandSelectionOutlinePx(i):0;return useTransform(r,e?.x,e?.y,1,t,{x:-o,y:-o}),e=e.clone().expandBy(o).zeroFix(),(0,T.jsx)("svg",{ref:r,className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:(0,T.jsx)("rect",{className:C("tl-selection__fg__outline"),width:(0,E.$Z)(e.width),height:(0,E.$Z)(e.height)})})}let DefaultShapeErrorFallback=()=>(0,T.jsx)("div",{className:"tl-shape-error-boundary"});let ShapeWithPropsEquality=class ShapeWithPropsEquality{constructor(e){this.shape=e}equals(e){return this.shape?.isLocked===e?.shape?.isLocked&&this.shape?.props===e?.shape?.props&&this.shape?.meta===e?.shape?.meta}};let EvenInnererIndicator=({shape:e,util:t})=>(0,b.uC)("Indicator:"+e.type,()=>t.indicator(e)),InnerIndicator=({editor:e,id:t})=>{let n=(0,b.Hg)("shape",()=>new ShapeWithPropsEquality(e.store.get(t)),[e,t]),{ShapeIndicatorErrorFallback:r}=useEditorComponents();return!n.shape||n.shape.isLocked?null:(0,T.jsx)(OptionalErrorBoundary,{fallback:r,onError:t=>e.annotateError(t,{origin:"react.shapeIndicator",willCrashApp:!1}),children:(0,T.jsx)(EvenInnererIndicator,{shape:n.shape,util:e.getShapeUtil(n.shape)},n.shape.id)})},eS=(0,P.memo)(function({shapeId:e,className:t,color:n,opacity:r}){let i=(0,I.j)(),o=(0,b.Hg)("transform",()=>{let t=i.getShapePageTransform(e);return t?t.toCssString():""},[i,e]);return(0,T.jsx)("svg",{className:C("tl-overlays__item",t),children:(0,T.jsx)("g",{className:"tl-shape-indicator",transform:o,stroke:n??"var(--color-selected)",opacity:r,children:(0,T.jsx)(InnerIndicator,{editor:i,id:e})})})}),DefaultShapeIndicatorErrorFallback=()=>(0,T.jsx)("circle",{cx:4,cy:4,r:8,strokeWidth:"1",stroke:"red"});function PointsSnapIndicator({points:e,zoom:t}){let n,r,i,o;let a=2.5/t,l=e.reduce((e,t)=>Math.min(e,t.x),1/0),c=e.reduce((e,t)=>Math.max(e,t.x),-1/0),u=e.reduce((e,t)=>Math.min(e,t.y),1/0),d=e.reduce((e,t)=>Math.max(e,t.y),-1/0),p=e.some(e=>e.x===l&&e.y===u);return p?(n=l,r=u,i=c,o=d):(n=l,r=d,i=c,o=u),(0,T.jsxs)("g",{className:"tl-snap-indicator",stroke:"lime",children:[(0,T.jsx)("line",{x1:n,y1:r,x2:i,y2:o}),e.map((e,t)=>(0,T.jsx)("g",{transform:`translate(${e.x},${e.y})`,children:(0,T.jsx)("path",{className:"tl-snap-point",d:`M ${-a},${-a} L ${a},${a} M ${-a},${a} L ${a},${-a}`})},t))]})}function GapsSnapIndicator({gaps:e,direction:t,zoom:n}){let r=3.5/n,i=[-1/0,1/0],o=null,a="horizontal"===t;for(let t of e)(o=(0,E.mW)(i[0],i[1],a?t.startEdge[0].y:t.startEdge[0].x,a?t.startEdge[1].y:t.startEdge[1].x))&&(i=o,(o=(0,E.mW)(i[0],i[1],a?t.endEdge[0].y:t.endEdge[0].x,a?t.endEdge[1].y:t.endEdge[1].x))&&(i=o));if(null===i)return null;let l=(i[0]+i[1])/2;return(0,T.jsx)("g",{className:"tl-snap-indicator",stroke:"cyan",children:e.map(({startEdge:e,endEdge:t},n)=>(0,T.jsx)(P.Fragment,{children:a?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("line",{x1:e[0].x,y1:l-2*r,x2:e[1].x,y2:l+2*r}),(0,T.jsx)("line",{x1:t[0].x,y1:l-2*r,x2:t[1].x,y2:l+2*r}),(0,T.jsx)("line",{x1:e[0].x,y1:l,x2:t[0].x,y2:l}),(0,T.jsx)("line",{x1:(e[0].x+t[0].x)/2,y1:l-r,x2:(e[0].x+t[0].x)/2,y2:l+r})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("line",{x1:l-2*r,y1:e[0].y,x2:l+2*r,y2:e[1].y}),(0,T.jsx)("line",{x1:l-2*r,y1:t[0].y,x2:l+2*r,y2:t[1].y}),(0,T.jsx)("line",{x1:l,y1:e[0].y,x2:l,y2:t[0].y}),(0,T.jsx)("line",{x1:l-r,y1:(e[0].y+t[0].y)/2,x2:l+r,y2:(e[0].y+t[0].y)/2})]})},n))})}function DefaultSnapIndicator({className:e,line:t,zoom:n}){return(0,T.jsx)("svg",{className:C("tl-overlays__item",e),children:"points"===t.type?(0,T.jsx)(PointsSnapIndicator,{...t,zoom:n}):"gaps"===t.type?(0,T.jsx)(GapsSnapIndicator,{...t,zoom:n}):null})}function DefaultSpinner(){return(0,T.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16",children:(0,T.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,T.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"var(--color-text-1)"}),(0,T.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"var(--color-text-1)",children:(0,T.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}let DefaultSvgDefs=()=>null;function useIdentity(e,t){let n=(0,P.useRef)(e);return t(e,n.current)?n.current:(n.current=e,e)}function useShallowArrayIdentity(e){return useIdentity(e,v.E8)}function useShallowObjectIdentity(e){return useIdentity(e,v.dn)}let ev=(0,P.createContext)({});function EditorComponentsProvider({overrides:e={},children:t}){let n=useShallowObjectIdentity(e);return(0,T.jsx)(ev.Provider,{value:(0,P.useMemo)(()=>({Background:DefaultBackground,SvgDefs:DefaultSvgDefs,Brush:DefaultBrush,ZoomBrush:DefaultBrush,ScreenshotBrush:DefaultBrush,CollaboratorBrush:DefaultBrush,Cursor:ew,CollaboratorCursor:ew,CollaboratorHint:DefaultCollaboratorHint,CollaboratorShapeIndicator:eS,Grid:DefaultGrid,Scribble:DefaultScribble,SnapIndicator:DefaultSnapIndicator,Handles:DefaultHandles,Handle:DefaultHandle,CollaboratorScribble:DefaultScribble,ErrorFallback:DefaultErrorFallback,ShapeErrorFallback:DefaultShapeErrorFallback,ShapeIndicatorErrorFallback:DefaultShapeIndicatorErrorFallback,Spinner:DefaultSpinner,SelectionBackground:DefaultSelectionBackground,SelectionForeground:DefaultSelectionForeground,HoveredShapeIndicator:DefaultHoveredShapeIndicator,ShapeIndicator:eS,OnTheCanvas:null,InFrontOfTheCanvas:null,Canvas:DefaultCanvas,...n}),[n]),children:t})}function useEditorComponents(){return(0,P.useContext)(ev)}let ex={openWindow:(e,t)=>window.open(e,t,"noopener noreferrer"),refreshPage:()=>window.location.reload(),hardReset:async()=>await window.__tldraw__hardReset?.()};function setRuntimeOverrides(e){Object.assign(ex,e)}function hardResetEditor(){ex.hardReset()}function refreshPage(){ex.refreshPage()}function DefaultErrorFallback_noop(){}let DefaultErrorFallback=({error:e,editor:t})=>{let n=(0,P.useRef)(null),[r,i]=(0,P.useState)(!1),[o,a]=(0,P.useState)(!1),[l,c]=(0,P.useState)(!1),{Canvas:u}=useEditorComponents(),d=e instanceof Error?e.message:String(e),p=e instanceof Error?e.stack:null,h=(0,b.Hg)("isDarkMode",()=>{try{if(t)return t.user.getIsDarkMode()}catch{}return null},[t]),[g,f]=(0,P.useState)(null);(0,P.useLayoutEffect)(()=>{null!==h&&f(h);let e=n.current?.parentElement,t=!1;for(;e;){if(e.classList.contains("tl-theme__dark")||e.classList.contains("tl-theme__light")){t=!0;break}e=e.parentElement}if(t){f(null);return}f(window.matchMedia("(prefers-color-scheme: dark)").matches)},[h]),(0,P.useEffect)(()=>{if(o){let e=setTimeout(()=>{a(!1)},2e3);return()=>clearTimeout(e)}},[o]);let resetLocalState=async()=>{hardResetEditor()},m=new URL("https://github.com/tldraw/tldraw/issues/new");return m.searchParams.set("title",d),m.searchParams.set("labels","bug"),m.searchParams.set("body",`Hey, I ran into an error while using tldraw:

\`\`\`js
${p??d}
\`\`\`

My browser: ${navigator.userAgent}`),(0,T.jsxs)("div",{ref:n,className:C("tl-container tl-error-boundary",null===g?"":g?"tl-theme__dark":"tl-theme__light"),children:[(0,T.jsx)("div",{className:"tl-error-boundary__overlay"}),t&&(0,T.jsx)(ErrorBoundary,{onError:DefaultErrorFallback_noop,fallback:()=>null,children:(0,T.jsx)(I.r.Provider,{value:t,children:(0,T.jsx)("div",{className:"tl-overlay tl-error-boundary__canvas",children:u?(0,T.jsx)(u,{}):null})})}),(0,T.jsx)("div",{className:C("tl-modal","tl-error-boundary__content",{"tl-error-boundary__content__expanded":r&&!l}),children:l?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("h2",{children:"Are you sure?"}),(0,T.jsx)("p",{children:"Resetting your data will delete your drawing and cannot be undone."}),(0,T.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,T.jsx)("button",{onClick:()=>c(!1),children:"Cancel"}),(0,T.jsx)("button",{className:"tl-error-boundary__reset",onClick:resetLocalState,children:"Reset data"})]})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("h2",{children:"Something's gone wrong."}),(0,T.jsxs)("p",{children:["Sorry, we encountered an error. Please refresh the page to continue. If you keep seeing this error, you can ",(0,T.jsx)("a",{href:m.toString(),children:"create a GitHub issue"})," or"," ",(0,T.jsx)("a",{href:"https://discord.gg/Cq6cPsTfNy",children:"ask for help on Discord"}),"."]}),r&&(0,T.jsxs)(T.Fragment,{children:["Message:",(0,T.jsx)("h4",{children:(0,T.jsx)("code",{children:d})}),"Stack trace:",(0,T.jsxs)("div",{className:"tl-error-boundary__content__error",children:[(0,T.jsx)("pre",{children:(0,T.jsx)("code",{children:p??d})}),(0,T.jsx)("button",{onClick:()=>{let e=document.createElement("textarea");e.value=p??d,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove(),a(!0)},children:o?"Copied!":"Copy"})]})]}),(0,T.jsxs)("div",{className:"tl-error-boundary__content__actions",children:[(0,T.jsx)("button",{onClick:()=>i(!r),children:r?"Hide details":"Show details"}),(0,T.jsxs)("div",{className:"tl-error-boundary__content__actions__group",children:[(0,T.jsx)("button",{className:"tl-error-boundary__reset",onClick:()=>c(!0),children:"Reset data"}),(0,T.jsx)("button",{className:"tl-error-boundary__refresh",onClick:()=>{refreshPage()},children:"Refresh Page"})]})]})]})})]})};var eT=n(7217),eP=n(418);function useIsDarkMode(){let e=(0,I.j)();return(0,b.Hg)("isDarkMode",()=>e.user.getIsDarkMode(),[e])}let eC="<path d='m19.7432 17.0869-4.072 4.068 2.829 2.828-8.473-.013-.013-8.47 2.841 2.842 4.075-4.068 1.414-1.415-2.844-2.842h8.486v8.484l-2.83-2.827z' fill='%23fff'/><path d='m18.6826 16.7334-4.427 4.424 1.828 1.828-5.056-.016-.014-5.054 1.842 1.841 4.428-4.422 2.474-2.475-1.844-1.843h5.073v5.071l-1.83-1.828z' fill='%23000'/>",ek="<path d='m9 17.9907v.005l5.997 5.996.001-3.999h1.999 2.02v4l5.98-6.001-5.98-5.999.001 4.019-2.021.002h-2l.001-4.022zm1.411.003 3.587-3.588-.001 2.587h3.5 2.521v-2.585l3.565 3.586-3.564 3.585-.001-2.585h-2.521l-3.499-.001-.001 2.586z' fill='%23fff'/><path d='m17.4971 18.9932h2.521v2.586l3.565-3.586-3.565-3.585v2.605h-2.521-3.5v-2.607l-3.586 3.587 3.586 3.586v-2.587z' fill='%23000'/>",eI='<path d="M22.4789 9.45728L25.9935 12.9942L22.4789 16.5283V14.1032C18.126 14.1502 14.6071 17.6737 14.5675 22.0283H17.05L13.513 25.543L9.97889 22.0283H12.5674C12.6071 16.5691 17.0214 12.1503 22.4789 12.1031L22.4789 9.45728Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M21.4789 7.03223L27.4035 12.9945L21.4789 18.9521V15.1868C18.4798 15.6549 16.1113 18.0273 15.649 21.0284H19.475L13.5128 26.953L7.55519 21.0284H11.6189C12.1243 15.8155 16.2679 11.6677 21.4789 11.1559L21.4789 7.03223ZM22.4789 12.1031C17.0214 12.1503 12.6071 16.5691 12.5674 22.0284H9.97889L13.513 25.543L17.05 22.0284H14.5675C14.5705 21.6896 14.5947 21.3558 14.6386 21.0284C15.1157 17.4741 17.9266 14.6592 21.4789 14.1761C21.8063 14.1316 22.1401 14.1069 22.4789 14.1032V16.5284L25.9935 12.9942L22.4789 9.45729L22.4789 12.1031Z" fill="white"/>';function getCursorCss(e,t,n,r,i,o=16,a=16){let l=(-n-t)*(E.PI/180),c=Math.sin(l),u=Math.cos(l);return`url("data:image/svg+xml,<svg height='32' width='32' viewBox='0 0 32 32' xmlns='http://www.w3.org/2000/svg' style='color: ${i};'><defs><filter id='shadow' y='-40%' x='-40%' width='180px' height='180%' color-interpolation-filters='sRGB'><feDropShadow dx='${1*u-1*c}' dy='${1*c+1*u}' stdDeviation='1.2' flood-opacity='.5'/></filter></defs><g fill='none' transform='rotate(${t+n} 16 16)${r?" scale(-1,-1) translate(0, -32)":""}' filter='url(%23shadow)'>`+e.replaceAll('"',"'")+`</g></svg>") ${o} ${a}, pointer`}let eE=["default","pointer","cross","move","grab","grabbing","text","zoom-in","zoom-out"],e_={none:()=>"none","ew-resize":(e,t,n)=>getCursorCss(ek,e,0,t,n),"ns-resize":(e,t,n)=>getCursorCss(ek,e,90,t,n),"nesw-resize":(e,t,n)=>getCursorCss(eC,e,0,t,n),"nwse-resize":(e,t,n)=>getCursorCss(eC,e,90,t,n),"nwse-rotate":(e,t,n)=>getCursorCss(eI,e,0,t,n),"nesw-rotate":(e,t,n)=>getCursorCss(eI,e,90,t,n),"senw-rotate":(e,t,n)=>getCursorCss(eI,e,180,t,n),"swne-rotate":(e,t,n)=>getCursorCss(eI,e,270,t,n)};function getCursor(e,t=0,n="black"){return e_[e]((0,E.vi)(t),!1,n)}function useCursor(){let e=(0,I.j)(),t=useContainer(),n=useIsDarkMode();(0,b.BK)("useCursor",()=>{let{type:r,rotation:i}=e.getInstanceState().cursor;if(eE.includes(r)){t.style.setProperty("--tl-cursor",`var(--tl-cursor-${r})`);return}t.style.setProperty("--tl-cursor",getCursor(r,i,n?"white":"black"))},[e,t,n])}function useDarkMode(){let e=(0,I.j)(),t=useContainer(),n=useIsDarkMode(),r=(0,b.Hg)($.forceSrgb);P.useEffect(()=>{n?(t.setAttribute("data-color-mode","dark"),t.classList.remove("tl-theme__light"),t.classList.add("tl-theme__dark")):(t.setAttribute("data-color-mode","light"),t.classList.remove("tl-theme__dark"),t.classList.add("tl-theme__light")),r?t.classList.add("tl-theme__force-sRGB"):t.classList.remove("tl-theme__force-sRGB")},[e,t,r,n])}function useEvent(e){let t=(0,P.useRef)();return(0,P.useLayoutEffect)(()=>{t.current=e}),(0,P.useDebugValue)(e),(0,P.useCallback)((...e)=>{let n=t.current;return(0,v.hu)(n,"fn does not exist"),n(...e)},[])}function useFocusEvents(e){let t=(0,I.j)(),n=useContainer();(0,P.useLayoutEffect)(()=>{e?(t.getInstanceState().isFocused||t.updateInstanceState({isFocused:!0}),t.getContainer().focus()):t.getInstanceState().isFocused&&t.updateInstanceState({isFocused:!1})},[t,n,e])}function useForceUpdate(){let[e,t]=(0,P.useState)(0);(0,P.useEffect)(()=>t(e=>e+1),[])}var eM=n(1034);let ej="TLDRAW_TAB_ID_v2",eA=globalThis.window;function iOS(){return!!eA&&(["iPad Simulator","iPhone Simulator","iPod Simulator","iPad","iPhone","iPod"].includes(eA.navigator.platform)||eA.navigator.userAgent.includes("Mac")&&"ontouchend"in document)}let e$=eA?eA[ej]??eA.sessionStorage[ej]??"TLDRAW_INSTANCE_STATE_V1_"+(0,eM.E)():"<error>";eA&&(eA[ej]=e$,iOS()?eA.sessionStorage[ej]=e$:delete eA.sessionStorage[ej]),eA?.addEventListener("beforeunload",()=>{eA.sessionStorage[ej]=e$});let eD=x.T.object({version:x.T.number,currentPageId:S.CF,isFocusMode:x.T.boolean,exportBackground:x.T.boolean,isDebugMode:x.T.boolean,isToolLocked:x.T.boolean,isGridMode:x.T.boolean,pageStates:x.T.arrayOf(x.T.object({pageId:S.CF,camera:x.T.object({x:x.T.number,y:x.T.number,z:x.T.number}),selectedShapeIds:x.T.arrayOf(S.u5),focusedGroupId:S.u5.nullable()}))}),eO=(0,w.zn)({currentVersion:0});function migrateAndValidateSessionStateSnapshot(e){if(!e||"object"!=typeof e)return console.warn("Invalid instance state"),null;if(!("version"in e)||"number"!=typeof e.version)return console.warn("No version in instance state"),null;let t=(0,w.Te)({value:e,fromVersion:e.version,toVersion:0,migrations:eO});if("error"===t.type)return console.warn(t.reason),null;let n={...t.value,version:0};try{eD.validate(n)}catch(e){return console.warn(e),null}return n}function createSessionStateSnapshotSignal(e){let t=e.query.ids("page");return(0,b.Fl)("sessionStateSnapshot",()=>{let n=e.get(S.PQ);if(!n)return null;let r=[...t.get()];return{version:0,currentPageId:n.currentPageId,exportBackground:n.exportBackground,isFocusMode:n.isFocusMode,isDebugMode:n.isDebugMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,pageStates:r.map(t=>{let n=e.get(S.iS.createId(t)),r=e.get(S.AN.createId(t));return{pageId:t,camera:{x:r?.x??0,y:r?.y??0,z:r?.z??1},selectedShapeIds:n?.selectedShapeIds??[],focusedGroupId:n?.focusedGroupId??null}})}})}function loadSessionStateSnapshotIntoStore(e,t){let n=migrateAndValidateSessionStateSnapshot(t);if(!n)return;let r=e.allRecords().filter(e=>"instance_page_state"===e.typeName||"camera"===e.typeName),i={added:{},updated:{},removed:{...(0,v.Ls)(r.map(e=>[e.id,e]))}};e.has(S.PQ)&&(i.removed[S.PQ]=e.get(S.PQ));let o={removed:{},updated:{},added:{[S.PQ]:e.schema.types.instance.create({id:S.PQ,currentPageId:n.currentPageId,isDebugMode:n.isDebugMode,isFocusMode:n.isFocusMode,isToolLocked:n.isToolLocked,isGridMode:n.isGridMode,exportBackground:n.exportBackground})}};for(let e of n.pageStates){let t=S.AN.createId(e.pageId),n=S.iS.createId(e.pageId);o.added[t]=S.AN.create({id:S.AN.createId(e.pageId),x:e.camera.x,y:e.camera.y,z:e.camera.z}),o.added[n]=S.iS.create({id:S.iS.createId(e.pageId),pageId:e.pageId,selectedShapeIds:e.selectedShapeIds,focusedGroupId:e.focusedGroupId})}(0,b.ay)(()=>{e.applyDiff((0,w.bs)([i,o])),e.ensureStoreIsUsable()})}function extractSessionStateFromLegacySnapshot(e){let t=[];for(let n of Object.values(e))n.typeName?.match(/^(instance.*|pointer|camera)$/)&&t.push(n);let n=t.filter(e=>"instance"===e.typeName&&e.id!==S.PQ)[0];if(!n)return null;let r={version:0,currentPageId:n.currentPageId,exportBackground:!!n.exportBackground,isFocusMode:!!n.isFocusMode,isDebugMode:!!n.isDebugMode,isToolLocked:!!n.isToolLocked,isGridMode:!1,pageStates:t.filter(e=>"instance_page_state"===e.typeName&&e.instanceId===n.id).map(t=>{let n=e[t.cameraId]??{x:0,y:0,z:1};return{pageId:t.pageId,camera:{x:n.x,y:n.y,z:n.z},selectedShapeIds:t.selectedShapeIds,focusedGroupId:t.focusedGroupId}})};try{return eD.validate(r),r}catch(e){return null}}function showCantWriteToIndexDbAlert(){window.alert(`Oops! We could not save changes to your browser's storage. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.
\u2022 If your hard disk is full, try clearing up some space and then reload the page.`)}function showCantReadFromIndexDbAlert(){window.alert(`Oops! We could not access your browser's storage\u2014and the app won't work correctly without that. We now need to reload the page and try again.

Keep seeing this message?
\u2022 If you're using tldraw in a private or "incognito" window, try loading tldraw in a regular window or in a different browser.`)}let instanceOfAny=(e,t)=>t.some(t=>e instanceof t);function getIdbProxyableTypes(){return r||(r=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])}function getCursorAdvanceMethods(){return i||(i=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])}let eB=new WeakMap,eF=new WeakMap,eU=new WeakMap,eL=new WeakMap,eR=new WeakMap;function promisifyRequest(e){let t=new Promise((t,n)=>{let unlisten=()=>{e.removeEventListener("success",success),e.removeEventListener("error",error)},success=()=>{t(wrap(e.result)),unlisten()},error=()=>{n(e.error),unlisten()};e.addEventListener("success",success),e.addEventListener("error",error)});return t.then(t=>{t instanceof IDBCursor&&eB.set(t,e)}).catch(()=>{}),eR.set(t,e),t}function cacheDonePromiseForTransaction(e){if(eF.has(e))return;let t=new Promise((t,n)=>{let unlisten=()=>{e.removeEventListener("complete",complete),e.removeEventListener("error",error),e.removeEventListener("abort",error)},complete=()=>{t(),unlisten()},error=()=>{n(e.error||new DOMException("AbortError","AbortError")),unlisten()};e.addEventListener("complete",complete),e.addEventListener("error",error),e.addEventListener("abort",error)});eF.set(e,t)}let ez={get(e,t,n){if(e instanceof IDBTransaction){if("done"===t)return eF.get(e);if("objectStoreNames"===t)return e.objectStoreNames||eU.get(e);if("store"===t)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return wrap(e[t])},set:(e,t,n)=>(e[t]=n,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function replaceTraps(e){ez=e(ez)}function wrapFunction(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?getCursorAdvanceMethods().includes(e)?function(...t){return e.apply(unwrap(this),t),wrap(eB.get(this))}:function(...t){return wrap(e.apply(unwrap(this),t))}:function(t,...n){let r=e.call(unwrap(this),t,...n);return eU.set(r,t.sort?t.sort():[t]),wrap(r)}}function transformCachableValue(e){return"function"==typeof e?wrapFunction(e):(e instanceof IDBTransaction&&cacheDonePromiseForTransaction(e),instanceOfAny(e,getIdbProxyableTypes()))?new Proxy(e,ez):e}function wrap(e){if(e instanceof IDBRequest)return promisifyRequest(e);if(eL.has(e))return eL.get(e);let t=transformCachableValue(e);return t!==e&&(eL.set(e,t),eR.set(t,e)),t}let unwrap=e=>eR.get(e);function openDB(e,t,{blocked:n,upgrade:r,blocking:i,terminated:o}={}){let a=indexedDB.open(e,t),l=wrap(a);return r&&a.addEventListener("upgradeneeded",e=>{r(wrap(a.result),e.oldVersion,e.newVersion,wrap(a.transaction),e)}),n&&a.addEventListener("blocked",e=>n(e.oldVersion,e.newVersion,e)),l.then(e=>{o&&e.addEventListener("close",()=>o()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),l}function deleteDB(e,{blocked:t}={}){let n=indexedDB.deleteDatabase(e);return t&&n.addEventListener("blocked",e=>t(e.oldVersion,e)),wrap(n).then(()=>void 0)}let eN=["get","getKey","getAll","getAllKeys","count"],eV=["put","add","delete","clear"],eH=new Map;function getMethod(e,t){if(!(e instanceof IDBDatabase&&!(t in e)&&"string"==typeof t))return;if(eH.get(t))return eH.get(t);let n=t.replace(/FromIndex$/,""),r=t!==n,i=eV.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!(i||eN.includes(n)))return;let method=async function(e,...t){let o=this.transaction(e,i?"readwrite":"readonly"),a=o.store;return r&&(a=a.index(t.shift())),(await Promise.all([a[n](...t),i&&o.done]))[0]};return eH.set(t,method),method}replaceTraps(e=>({...e,get:(t,n,r)=>getMethod(t,n)||e.get(t,n,r),has:(t,n)=>!!getMethod(t,n)||e.has(t,n)}));let eG="TLDRAW_DOCUMENT_v2",eW="TLDRAW_DB_NAME_INDEX_v2",eZ={Records:"records",Schema:"schema",SessionState:"session_state"};async function withDb(e,t){addDbName(e);let n=await openDB(e,3,{upgrade(e){e.objectStoreNames.contains(eZ.Records)||e.createObjectStore(eZ.Records),e.objectStoreNames.contains(eZ.Schema)||e.createObjectStore(eZ.Schema),e.objectStoreNames.contains(eZ.SessionState)||e.createObjectStore(eZ.SessionState)}});try{return await t(n)}finally{n.close()}}async function loadDataFromStore({persistenceKey:e,sessionId:t,didCancel:n}){let r=eG+e;if(getAllIndexDbNames().includes(r))return await pruneSessionState({persistenceKey:e,didCancel:n}),await withDb(r,async e=>{if(n?.())return;let r=e.transaction([eZ.Records,eZ.Schema,eZ.SessionState],"readonly"),i=r.objectStore(eZ.Records),o=r.objectStore(eZ.Schema),a=r.objectStore(eZ.SessionState),l=t?(await a.get(t))?.snapshot:null;if(!l){let e=await a.getAll();l=e.sort((e,t)=>e.updatedAt-t.updatedAt).pop()?.snapshot}let c={records:await i.getAll(),schema:await o.get(eZ.Schema),sessionStateSnapshot:l};if(n?.()){r.abort();return}return await r.done,c})}async function storeChangesInIndexedDb({persistenceKey:e,schema:t,changes:n,sessionId:r,sessionStateSnapshot:i,didCancel:o}){let a=eG+e;await withDb(a,async e=>{let a=e.transaction([eZ.Records,eZ.Schema,eZ.SessionState],"readwrite"),l=a.objectStore(eZ.Records),c=a.objectStore(eZ.Schema),u=a.objectStore(eZ.SessionState);for(let[e,t]of Object.entries(n.added))await l.put(t,e);for(let[e,t]of Object.values(n.updated))await l.put(t,t.id);for(let e of Object.keys(n.removed))await l.delete(e);if(c.put(t.serialize(),eZ.Schema),i&&r?u.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o?.())return a.abort();await a.done})}async function storeSnapshotInIndexedDb({persistenceKey:e,schema:t,snapshot:n,sessionId:r,sessionStateSnapshot:i,didCancel:o}){let a=eG+e;await withDb(a,async e=>{let a=e.transaction([eZ.Records,eZ.Schema,eZ.SessionState],"readwrite"),l=a.objectStore(eZ.Records),c=a.objectStore(eZ.Schema),u=a.objectStore(eZ.SessionState);for(let[e,t]of(await l.clear(),Object.entries(n)))await l.put(t,e);if(c.put(t.serialize(),eZ.Schema),i&&r?u.put({snapshot:i,updatedAt:Date.now(),id:r},r):(i||r)&&console.error("sessionStateSnapshot and instanceId must be provided together"),o?.())return a.abort();await a.done})}async function pruneSessionState({persistenceKey:e,didCancel:t}){await withDb(eG+e,async e=>{let n=e.transaction([eZ.SessionState],"readwrite"),r=n.objectStore(eZ.SessionState),i=(await r.getAll()).sort((e,t)=>e.updatedAt-t.updatedAt);if(i.length<10){await n.done;return}let o=i.slice(0,i.length-10);for(let{id:e}of o)await r.delete(e);if(t?.())return n.abort();await n.done})}function getAllIndexDbNames(){let e=JSON.parse(window?.localStorage.getItem(eW)||"[]")??[];return Array.isArray(e)?e:[]}function addDbName(e){let t=new Set(getAllIndexDbNames());t.add(e),window?.localStorage.setItem(eW,JSON.stringify([...t]))}let eK=Symbol("UPDATE_INSTANCE_STATE"),msg=e=>e;let BroadcastChannelMock=class BroadcastChannelMock{onmessage;constructor(e){}postMessage(e){}close(){}};let eY="undefined"==typeof BroadcastChannel?BroadcastChannelMock:BroadcastChannel;let TLLocalSyncClient=class TLLocalSyncClient{constructor(e,{persistenceKey:t,sessionId:n=e$,onLoad:r,onLoadError:i},o=new eY(`tldraw-tab-sync-${t}`)){this.store=e,this.channel=o,"undefined"!=typeof window&&(window.tlsync=this),this.persistenceKey=t,this.sessionId=n,this.serializedSchema=this.store.schema.serialize(),this.$sessionStateSnapshot=createSessionStateSnapshotSignal(this.store),this.disposables.add(e.listen(({changes:e})=>{this.diffQueue.push(e),this.channel.postMessage(msg({type:"diff",storeId:this.store.id,changes:e,schema:this.serializedSchema})),this.schedulePersist()},{source:"user",scope:"document"})),this.disposables.add(e.listen(()=>{this.diffQueue.push(eK),this.schedulePersist()},{scope:"session"})),this.connect(r,i),this.documentTypes=new Set(Object.values(this.store.schema.types).filter(e=>"document"===e.scope).map(e=>e.typeName))}disposables=new Set;diffQueue=[];didDispose=!1;shouldDoFullDBWrite=!0;isReloading=!1;persistenceKey;sessionId;serializedSchema;isDebugging=!1;documentTypes;$sessionStateSnapshot;initTime=Date.now();debug(...e){this.isDebugging&&console.debug(...e)}async connect(e,t){let n;this.debug("connecting");try{n=await loadDataFromStore({persistenceKey:this.persistenceKey,sessionId:this.sessionId,didCancel:()=>this.didDispose})}catch(e){t(e),showCantReadFromIndexDbAlert(),"undefined"!=typeof window&&window.location.reload();return}if(this.debug("loaded data from store",n,"didDispose",this.didDispose),!this.didDispose)try{if(n){let e=Object.fromEntries(n.records.map(e=>[e.id,e])),r=n.sessionStateSnapshot??extractSessionStateFromLegacySnapshot(e),i=this.store.schema.migrateStoreSnapshot({store:e,schema:n.schema??this.store.schema.serializeEarliestVersion()});if("error"===i.type){console.error("failed to migrate store",i),t(Error(`Failed to migrate store: ${i.reason}`));return}this.store.mergeRemoteChanges(()=>{this.store.put(Object.values(i.value).filter(e=>this.documentTypes.has(e.typeName)),"initialize")}),r&&loadSessionStateSnapshotIntoStore(this.store,r)}this.channel.onmessage=({data:e})=>{this.debug("got message",e);let n=(0,w.$F)(this.serializedSchema,e.schema??this.store.schema.serializeEarliestVersion());if(-1===n){let e=Date.now()-this.initTime;if(e<5e3){t(Error("Schema mismatch, please close other tabs and reload the page"));return}this.debug("reloading"),this.isReloading=!0,window?.location?.reload?.();return}if(1===n){this.debug("telling them to reload"),this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.shouldDoFullDBWrite=!0,this.persistIfNeeded();return}"diff"===e.type&&(this.debug("applying diff"),(0,b.ay)(()=>{this.store.mergeRemoteChanges(()=>{this.store.applyDiff(e.changes),this.store.ensureStoreIsUsable()})}))},this.channel.postMessage({type:"announce",schema:this.serializedSchema}),this.disposables.add(()=>{this.channel.close()}),e(this)}catch(e){if(this.debug("error loading data from store",e),this.didDispose)return;t(e);return}}close(){this.debug("closing"),this.didDispose=!0,this.disposables.forEach(e=>e())}isPersisting=!1;didLastWriteError=!1;scheduledPersistTimeout=null;schedulePersist(){this.debug("schedulePersist",this.scheduledPersistTimeout),this.scheduledPersistTimeout||(this.scheduledPersistTimeout=setTimeout(()=>{this.scheduledPersistTimeout=null,this.persistIfNeeded()},this.didLastWriteError?1e4:350))}persistIfNeeded(){this.debug("persistIfNeeded",{isPersisting:this.isPersisting,isReloading:this.isReloading,shouldDoFullDBWrite:this.shouldDoFullDBWrite,diffQueueLength:this.diffQueue.length,storeIsPossiblyCorrupt:this.store.isPossiblyCorrupted()}),this.scheduledPersistTimeout&&(clearTimeout(this.scheduledPersistTimeout),this.scheduledPersistTimeout=null),this.isPersisting||this.isReloading||this.store.isPossiblyCorrupted()||!this.shouldDoFullDBWrite&&!(this.diffQueue.length>0)||this.doPersist()}async doPersist(){(0,v.hu)(!this.isPersisting,"persist already in progress"),this.isPersisting=!0,this.debug("doPersist start");let e=this.diffQueue;this.diffQueue=[];try{if(this.shouldDoFullDBWrite)this.shouldDoFullDBWrite=!1,await storeSnapshotInIndexedDb({persistenceKey:this.persistenceKey,schema:this.store.schema,snapshot:this.store.serialize(),didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()});else{let t=(0,w.bs)(e.filter(e=>e!==eK));await storeChangesInIndexedDb({persistenceKey:this.persistenceKey,changes:t,schema:this.store.schema,didCancel:()=>this.didDispose,sessionId:this.sessionId,sessionStateSnapshot:this.$sessionStateSnapshot.get()})}this.didLastWriteError=!1}catch(e){this.shouldDoFullDBWrite=!0,this.didLastWriteError=!0,console.error("failed to store changes in indexed db",e),showCantWriteToIndexDbAlert(),"undefined"!=typeof window&&window.location.reload()}this.isPersisting=!1,this.debug("doPersist end"),this.schedulePersist()}};var eX=n(9968);function createTLStore({initialData:e,defaultName:t="",...n}){let r="schema"in n&&n.schema?n.schema:(0,S.HH)({shapes:currentPageShapesToShapeMap((0,eX.m)("shapeUtils"in n&&n.shapeUtils?n.shapeUtils:[]))});return new w.yh({schema:r,initialData:e,props:{defaultName:t}})}function currentPageShapesToShapeMap(e){return Object.fromEntries(e.map(e=>[e.type,{props:e.props,migrations:e.migrations}]))}function createStore(e){let t=createTLStore(e);return e.snapshot&&t.loadSnapshot(e.snapshot),{store:t,opts:e}}function useTLStore(e){let[t,n]=(0,P.useState)(()=>createStore(e));if(!(0,v.dn)(t.opts,e)){let t=createStore(e);return n(t),t.store}return t.store}function useLocalStore({persistenceKey:e,sessionId:t,...n}){let[r,i]=(0,P.useState)(null),o=useTLStore(n);return(0,P.useEffect)(()=>{let n=(0,eM.E)();if(!e){i({id:n,storeWithStatus:{status:"not-synced",store:o}});return}i({id:n,storeWithStatus:{status:"loading"}});let setStoreWithStatus=e=>{i(t=>t?.id===n?{id:n,storeWithStatus:e}:t)},r=new TLLocalSyncClient(o,{sessionId:t,persistenceKey:e,onLoad(){setStoreWithStatus({store:o,status:"synced-local"})},onLoadError(e){setStoreWithStatus({status:"error",error:e})}});return()=>{i(e=>e?.id===n?null:e),r.close()}},[e,o,t]),r?.storeWithStatus??{status:"loading"}}let eJ=!1;if("undefined"!=typeof window){let e=window.navigator.userAgent,t=!!e.match(/iPad/i)||!!e.match(/iPhone/i),n=!!e.match(/WebKit/i);eJ=t&&n&&!e.match(/CriOS/i)}function useSafariFocusOutFix(){let e=(0,I.j)();P.useEffect(()=>{if(eJ)return document.addEventListener("focusout",handleFocusOut),()=>document.removeEventListener("focusout",handleFocusOut);function handleFocusOut(t){(t.target instanceof HTMLInputElement&&"text"===t.target.type||t.target instanceof HTMLTextAreaElement)&&e.complete()}},[e])}function useZoomCss(){let e=(0,I.j)(),t=useContainer();P.useEffect(()=>{let setScale=e=>t.style.setProperty("--tl-zoom",e.toString()),n=(0,v.Ds)(setScale,100),r=new b.R0("useZoomCss",()=>{let t=e.getCurrentPageShapeIds().size;t<300?setScale(e.getZoomLevel()):n(e.getZoomLevel())});return r.attach(),r.execute(),()=>{r.detach()}},[e,t])}let eQ=[],e0=[],e1=(0,P.memo)(function({store:e,components:t,className:n,user:r,...i}){let[o,a]=P.useState(null),l=(0,P.useMemo)(()=>r??(0,eT.L)(),[r]),c=t?.ErrorFallback===void 0?DefaultErrorFallback:t?.ErrorFallback,u={...i,shapeUtils:i.shapeUtils??eQ,tools:i.tools??e0,components:t};return(0,T.jsx)("div",{ref:a,draggable:!1,className:C("tl-container tl-theme__light",n),onPointerDown:stopEventPropagation,tabIndex:-1,children:(0,T.jsx)(OptionalErrorBoundary,{fallback:c,onError:e=>(0,v.lw)(e,{tags:{origin:"react.tldraw-before-app"}}),children:o&&(0,T.jsx)(ContainerProvider,{container:o,children:(0,T.jsx)(EditorComponentsProvider,{overrides:t,children:e?e instanceof w.yh?(0,T.jsx)(TldrawEditorWithReadyStore,{...u,store:e,user:l}):(0,T.jsx)(e2,{...u,store:e,user:l}):(0,T.jsx)(TldrawEditorWithOwnStore,{...u,store:e,user:l})})})})})});function TldrawEditorWithOwnStore(e){let{defaultName:t,snapshot:n,initialData:r,shapeUtils:i,persistenceKey:o,sessionId:a,user:l}=e,c=useLocalStore({shapeUtils:i,initialData:r,persistenceKey:o,sessionId:a,defaultName:t,snapshot:n});return(0,T.jsx)(e2,{...e,store:c,user:l})}let e2=(0,P.memo)(function({store:e,user:t,...n}){let r=useContainer();(0,P.useLayoutEffect)(()=>{t.userPreferences.get().isDarkMode&&(r.classList.remove("tl-theme__light"),r.classList.add("tl-theme__dark"))},[r,t]);let{LoadingScreen:i}=useEditorComponents();switch(e.status){case"error":throw e.error;case"loading":return i?(0,T.jsx)(i,{}):null}return(0,T.jsx)(TldrawEditorWithReadyStore,{...n,store:e.store,user:t})});function TldrawEditorWithReadyStore({onMount:e,children:t,store:n,tools:r,shapeUtils:i,user:o,initialState:a,autoFocus:l=!0,inferDarkMode:c}){let{ErrorFallback:u}=useEditorComponents(),d=useContainer(),[p,h]=(0,P.useState)(null);(0,P.useLayoutEffect)(()=>{let e=new eP.M({store:n,shapeUtils:i,tools:r,getContainer:()=>d,user:o,initialState:a,inferDarkMode:c});return h(e),()=>{e.dispose()}},[d,i,r,n,o,a,c]);let g=(0,P.useSyncExternalStore)((0,P.useCallback)(e=>p?(p.on("crash",e),()=>p.off("crash",e)):()=>{},[p]),()=>p?.getCrashingError()??null),{Canvas:f}=useEditorComponents();return p?(0,T.jsx)(OptionalErrorBoundary,{fallback:u,onError:e=>p.annotateError(e,{origin:"react.tldraw",willCrashApp:!0}),children:g?(0,T.jsx)(Crash,{crashingError:g}):(0,T.jsx)(I.r.Provider,{value:p,children:(0,T.jsx)(Layout,{autoFocus:l,onMount:e,children:t??(f?(0,T.jsx)(f,{}):null)})})}):null}function Layout({children:e,onMount:t,autoFocus:n}){return useZoomCss(),useCursor(),useDarkMode(),useSafariFocusOutFix(),useForceUpdate(),useFocusEvents(n),useOnMount(t),(0,T.jsx)(T.Fragment,{children:e})}function Crash({crashingError:e}){throw e}function LoadingScreen({children:e}){return(0,T.jsx)("div",{className:"tl-loading",children:e})}function ErrorScreen({children:e}){return(0,T.jsx)("div",{className:"tl-loading",children:e})}function useOnMount(e){let t=(0,I.j)(),n=useEvent(t=>{let n=e?.(t);return t.emit("mount"),window.tldrawReady=!0,n});P.useLayoutEffect(()=>{if(t)return n?.(t)},[t,n])}function HTMLContainer({children:e,className:t="",...n}){return(0,T.jsx)("div",{...n,className:`tl-html-container ${t}`,children:e})}var e3=n(7295),e5=n(5894),e6=n(6076),e4=n(9234),e8=n(5859);function resizeBox(e,t,n={}){let{newPoint:r,handle:i,scaleX:o,scaleY:a}=t,{minWidth:l=1,maxWidth:c=1/0,minHeight:u=1,maxHeight:d=1/0}=n,p=e.props.w*o,h=e.props.h*a,g=new et.B(0,0);if(p>0){if(p<l){switch(i){case"top_left":case"left":case"bottom_left":g.x=p-l;break;case"top":case"bottom":g.x=(p-l)/2;break;default:g.x=0}p=l}}else if(g.x=p,(p=-p)<l){switch(i){case"top_left":case"left":case"bottom_left":g.x=-p;break;default:g.x=-l}p=l}if(h>0){if(h<u){switch(i){case"top_left":case"top":case"top_right":g.y=h-u;break;case"right":case"left":g.y=(h-u)/2;break;default:g.y=0}h=u}}else if(g.y=h,(h=-h)<u){switch(i){case"top_left":case"top":case"top_right":g.y=-h;break;default:g.y=-u}h=u}let{x:f,y:m}=g.rot(e.rotation).add(r);return{x:f,y:m,props:{w:Math.min(c,p),h:Math.min(d,h)}}}let BaseBoxShapeUtil=class BaseBoxShapeUtil extends e8.E{getGeometry(e){return new e4.z({width:e.props.w,height:e.props.h,isFilled:!0})}onResize=(e,t)=>resizeBox(e,t);getHandleSnapGeometry(e){return{points:this.getGeometry(e).bounds.cornersAndCenter}}};var e7=n(2772),e9=n(7761),te=n(2797);let Idle=class Idle extends te.n{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}};let Pointing=class Pointing extends te.n{static id="pointing";markId="";wasFocusedOnEnter=!1;onEnter=()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen()};onPointerMove=e=>{if(this.editor.inputs.isDragging){let{originPagePoint:t}=this.editor.inputs,n=this.parent.shapeType,r=(0,S.F1)();this.markId=`creating:${r}`,this.editor.mark(this.markId),this.editor.createShapes([{id:r,type:n,x:t.x,y:t.y,props:{w:1,h:1}}]).select(r),this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:this.parent.id,onCreate:this.parent.onCreate})}};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};complete(){let{originPagePoint:e}=this.editor.inputs;if(!this.wasFocusedOnEnter)return;this.editor.mark(this.markId);let t=this.parent.shapeType,n=(0,S.F1)();this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:t,x:e.x,y:e.y}]);let r=this.editor.getShape(n),{w:i,h:o}=this.editor.getShapeUtil(r).getDefaultProps(),a=new et.B(i/2,o/2),l=this.editor.getShapeParentTransform(r);l&&a.rot(-l.rotation()),this.editor.updateShapes([{id:n,type:t,x:r.x-a.x,y:r.y-a.y}]),this.editor.setSelectedShapes([n]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select.idle")}cancel(){this.parent.transition("idle")}};let BaseBoxShapeTool=class BaseBoxShapeTool extends te.n{static id="box";static initial="idle";static children=()=>[Idle,Pointing];onCreate};var tt=n(521);function useIsCropping(e){let t=(0,I.j)();return(0,b.Hg)("isCropping",()=>t.getCroppingShapeId()===e,[t,e])}function useIsEditing(e){let t=(0,I.j)();return(0,b.Hg)("isEditing",()=>t.getEditingShapeId()===e,[t,e])}function useSelectionEvents(e){let t=(0,I.j)(),n=(0,P.useMemo)(function(){let n,r;return{onPointerDown:n=>{if(n.isKilled)return;if(2===n.button){t.dispatch({type:"pointer",target:"selection",handle:e,name:"right_click",...getPointerInfo(n)});return}if(0!==n.button)return;let r=loopToHtmlElement(n.currentTarget);function releaseCapture(){r.removeEventListener("pointerup",releaseCapture),releasePointerCapture(r,n)}setPointerCapture(r,n),r.addEventListener("pointerup",releaseCapture),t.dispatch({name:"pointer_down",type:"pointer",target:"selection",handle:e,...getPointerInfo(n)}),stopEventPropagation(n)},onPointerMove:function(i){i.isKilled||0!==i.button||i.clientX===n&&i.clientY===r||(n=i.clientX,r=i.clientY,t.dispatch({name:"pointer_move",type:"pointer",target:"selection",handle:e,...getPointerInfo(i)}))},onPointerUp:n=>{n.isKilled||0!==n.button||t.dispatch({name:"pointer_up",type:"pointer",target:"selection",handle:e,...getPointerInfo(n)})}}},[t,e]);return n}var tn=n(1986),tr=n(224),ti=n(4519);function getVerticesCountForLength(e,t=20){return Math.max(8,Math.ceil(e/t))}let Arc2d=class Arc2d extends ti.l{_center;radius;start;end;measure;length;angleStart;angleEnd;constructor(e){super({...e,isFilled:!1,isClosed:!1});let{center:t,radius:n,sweepFlag:r,largeArcFlag:i,start:o,end:a}=e;if(o.equals(a))throw Error("Arc must have different start and end points.");this.angleStart=et.B.Angle(t,o),this.angleEnd=et.B.Angle(t,a),this.measure=(0,E.D4)(this.angleStart,this.angleEnd,r,i),this.length=this.measure*n,this.start=o,this.end=a,this._center=t,this.radius=n}nearestPoint(e){let t;let{_center:n,measure:r,radius:i,angleEnd:o,angleStart:a,start:l,end:c}=this,u=(0,E.rW)(r,a,o,n.angle(e));if(u<=0)return l;if(u>=1)return c;let d=n.clone().add(e.clone().sub(n).uni().mul(i)),p=1/0;for(let n of[l,c,d])e.dist(n)<p&&(t=n,p=e.dist(n));if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t,n){let{_center:r,radius:i,measure:o,angleStart:a,angleEnd:l}=this,c=(0,tr.ZM)(e,t,r,i);return null!==c&&c.some(e=>{let t=(0,E.rW)(o,a,l,r.angle(e));return t>=0&&t<=1})}getVertices(){let{_center:e,measure:t,length:n,radius:r,angleStart:i}=this,o=[];for(let a=0,l=getVerticesCountForLength(Math.abs(n));a<l+1;a++){let n=a/l*t,c=i+n;o.push((0,E.XD)(e,r,c))}return o}};let Circle2d=class Circle2d extends ti.l{constructor(e){super({isClosed:!0,...e}),this.config=e;let{x:t=0,y:n=0,radius:r}=e;this.x=t,this.y=n,this._center=new et.B(r+t,r+n),this.radius=r}_center;radius;x;y;getBounds(){return new eo.xu(this.x,this.y,2*this.radius,2*this.radius)}getVertices(){let{_center:e,radius:t}=this,n=E.yo*t,r=[];for(let i=0,o=getVerticesCountForLength(n);i<o;i++){let n=i/o*E.yo;r.push((0,E.XD)(e,t,n))}return r}nearestPoint(e){let{_center:t,radius:n}=this;return t.equals(e)?et.B.AddXY(t,n,0):t.clone().add(e.clone().sub(t).uni().mul(n))}hitTestLineSegment(e,t,n){let{_center:r,radius:i}=this;return null!==(0,tr.ZM)(e,t,r,i)}};var to=n(6368);let CubicBezier2d=class CubicBezier2d extends to.q{a;b;c;d;constructor(e){let{start:t,cp1:n,cp2:r,end:i}=e;super({...e,points:[t,i]}),this.a=t,this.b=n,this.c=r,this.d=i}getVertices(){let e=[],{a:t,b:n,c:r,d:i}=this;for(let o=0;o<=10;o++){let a=o/10;e.push(new et.B((1-a)*(1-a)*(1-a)*t.x+3*((1-a)*(1-a))*a*n.x+3*(1-a)*(a*a)*r.x+a*a*a*i.x,(1-a)*(1-a)*(1-a)*t.y+3*((1-a)*(1-a))*a*n.y+3*(1-a)*(a*a)*r.y+a*a*a*i.y))}return e}midPoint(){return getAtT(this,.5)}nearestPoint(e){let t;let n=1/0;for(let r of this.segments){let i=r.nearestPoint(e),o=i.dist(e);o<n&&(t=i,n=o)}if(!t)throw Error("nearest point not found");return t}};function getAtT(e,t){let{a:n,b:r,c:i,d:o}=e;return new et.B((1-t)*(1-t)*(1-t)*n.x+3*((1-t)*(1-t))*t*r.x+3*(1-t)*(t*t)*i.x+t*t*t*o.x,(1-t)*(1-t)*(1-t)*n.y+3*((1-t)*(1-t))*t*r.y+3*(1-t)*(t*t)*i.y+t*t*t*o.y)}let CubicSpline2d=class CubicSpline2d extends ti.l{points;constructor(e){super({...e,isClosed:!1,isFilled:!1});let{points:t}=e;this.points=t}_segments;get segments(){if(!this._segments){this._segments=[];let{points:e}=this,t=e.length,n=t-2;for(let r=0;r<t-1;r++){let t=0===r?e[0]:e[r-1],i=e[r],o=e[r+1],a=r===n?o:e[r+2],l=0===r?t:new et.B(i.x+(o.x-t.x)/6*1.25,i.y+(o.y-t.y)/6*1.25),c=r===n?o:new et.B(o.x-(a.x-i.x)/6*1.25,o.y-(a.y-i.y)/6*1.25);this._segments.push(new CubicBezier2d({start:i,cp1:l,cp2:c,end:o}))}}return this._segments}_length;get length(){return this._length||(this._length=this.segments.reduce((e,t)=>e+t.length,0)),this._length}getVertices(){let e=this.segments.reduce((e,t)=>e.concat(t.vertices),[]);return e.push(this.points[this.points.length-1]),e}nearestPoint(e){let t;let n=1/0;for(let r of this.segments){let i=r.nearestPoint(e),o=i.dist(e);o<n&&(t=i,n=o)}if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t,n){return this.segments.some(r=>r.hitTestLineSegment(e,t,n))}};var ta=n(4137);let Ellipse2d=class Ellipse2d extends ti.l{constructor(e){super({...e,isClosed:!0}),this.config=e;let{width:t,height:n}=e;this.w=t,this.h=n}w;h;_edges;get edges(){if(!this._edges){let{vertices:e}=this;this._edges=[];for(let t=0,n=e.length;t<n;t++){let r=e[t],i=e[(t+1)%n];this._edges.push(new ta.W({start:r,end:i}))}}return this._edges}getVertices(){let e=Math.max(1,this.w),t=Math.max(1,this.h),n=e/2,r=t/2,i=Math.pow(n-r,2)/Math.pow(n+r,2),o=E.PI*(n+r)*(1+3*i/(10+Math.sqrt(4-3*i))),a=getVerticesCountForLength(o),l=E.yo/a,c=Math.cos(l),u=Math.sin(l),d=0,p=1,h=0,g=1,f=Array(a);for(let e=0;e<a;e++)f[e]=new et.B(n+n*p,r+r*d),h=u*p+c*d,g=c*p-u*d,d=h,p=g;return f}nearestPoint(e){let t;let n=1/0;for(let r of this.edges){let i=r.nearestPoint(e),o=i.dist(e);o<n&&(t=i,n=o)}if(!t)throw Error("nearest point not found");return t}hitTestLineSegment(e,t,n){return this.edges.some(r=>r.hitTestLineSegment(e,t,n))}getBounds(){return new eo.xu(0,0,this.w,this.h)}};let Point2d=class Point2d extends ti.l{point;constructor(e){super({...e,isClosed:!0,isFilled:!0});let{point:t}=e;this.point=t}getVertices(){return[this.point]}nearestPoint(){return this.point}hitTestLineSegment(e,t,n){return et.B.DistanceToLineSegment(e,t,this.point)<n}};var ts=n(2042);let Stadium2d=class Stadium2d extends Ellipse2d{constructor(e){super({...e}),this.config=e}getVertices(){let e=Math.max(1,this.w),t=Math.max(1,this.h),n=e/2,r=t/2,i=Array(18);if(t>e)for(let e=0;e<9;e++){let r=-E.PI+E.PI*e/8,o=E.PI*e/8;i[e]=new et.B(n+n*Math.cos(r),n+n*Math.sin(r)),i[e+9]=new et.B(n+n*Math.cos(o),t-n+n*Math.sin(o))}else for(let n=0;n<9;n++){let o=-E.pj+E.PI*n/8,a=E.pj+-(E.PI*n)/8;i[n]=new et.B(e-r+r*Math.cos(o),t-r+r*Math.sin(o)),i[n+9]=new et.B(r-r*Math.cos(a),t-r+r*Math.sin(a))}return i}};var tl=n(7539),tc=n(1230),tu=n(5279);function getEdgeProximityFactor(e,t,n,r,i){let o=_.rF,a=n?_.EB:0,l=e-a,c=e+a,u=r?0:o,d=i?t:t-o;return l<u?Math.min(1,(u-l)/o):c>d?-Math.min(1,(c-d)/o):0}function moveCameraWhenCloseToEdge(e){if(!e.inputs.isDragging||e.inputs.isPanning||!e.getInstanceState().canMoveCamera)return;let{inputs:{currentScreenPoint:{x:t,y:n}}}=e,r=e.getZoomLevel(),i=e.getViewportScreenBounds(),o=i.w<1e3?.612:1,a=i.h<1e3?.612:1,{isCoarsePointer:l,insets:[c,u,d,p]}=e.getInstanceState(),h=getEdgeProximityFactor(t,i.w,l,p,u),g=getEdgeProximityFactor(n,i.h,l,c,d);if(0===h&&0===g)return;let f=e.user.getEdgeScrollSpeed()*_.a,m=e.getCamera();e.setCamera({x:m.x+f*h*o/r,y:m.y+f*g*a/r})}var td=n(1605),tp=n(7556);async function hardReset({shouldReload:e=!0}={}){sessionStorage.clear(),await Promise.all(getAllIndexDbNames().map(e=>deleteDB(e))),localStorage.clear(),e&&window.location.reload()}function openWindow(e,t="_blank"){ex.openWindow(e,t)}function shapesWithUnboundArrows(e){let t=e.getSelectedShapeIds(),n=t.map(t=>e.getShape(t));return n.filter(t=>!(!t||e.isShapeOfType(t,"arrow")&&"binding"===t.props.start.type||e.isShapeOfType(t,"arrow")&&"binding"===t.props.end.type))}"undefined"!=typeof window&&(window.__tldraw__hardReset=hardReset),n(9645),n(6930),n(4770),n(2880),n(9304);let useThreeStackableItems=()=>{let e=(0,I.j)();return(0,b.Hg)("threeStackableItems",()=>shapesWithUnboundArrows(e).length>2,[e])},useAllowGroup=()=>{let e=(0,I.j)();return(0,b.Hg)("allow group",()=>{let t=e.getSelectedShapes();if(t.length<2)return!1;for(let n of t)if(e.isShapeOfType(n,"arrow")){let{start:e,end:r}=n.props;if("binding"===e.type&&!t.some(t=>t.id===e.boundShapeId)||"binding"===r.type&&!t.some(e=>e.id===r.boundShapeId))return!1}return!0},[e])},useAllowUngroup=()=>{let e=(0,I.j)();return(0,b.Hg)("allowUngroup",()=>e.getSelectedShapeIds().some(t=>e.getShape(t)?.type==="group"),[e])},th="undefined"!=typeof window&&"navigator"in window&&!!navigator.clipboard&&!!navigator.clipboard.read;function useAnySelectedShapesCount(e,t){let n=(0,I.j)();return(0,b.Hg)("selectedShapes",()=>{let r=n.getSelectedShapes().length;return void 0===e?void 0===t?r:r<=t:void 0===t?r>=e:r>=e&&r<=t},[n,e,t])}function useUnlockedSelectedShapesCount(e,t){let n=(0,I.j)();return(0,b.Hg)("selectedShapes",()=>{let r=n.getSelectedShapes().filter(e=>!n.isShapeOrAncestorLocked(e)).length;return void 0===e?void 0===t?r:r<=t:void 0===t?r>=e:r>=e&&r<=t},[n])}function useShowAutoSizeToggle(){let e=(0,I.j)();return(0,b.Hg)("showAutoSizeToggle",()=>{let t=e.getSelectedShapes();return 1===t.length&&e.isShapeOfType(t[0],"text")&&!1===t[0].props.autoSize},[e])}function useHasLinkShapeSelected(){let e=(0,I.j)();return(0,b.Hg)("hasLinkShapeSelected",()=>{let t=e.getOnlySelectedShape();return!!(t&&"embed"!==t.type&&"url"in t.props)},[e])}function useOnlyFlippableShape(){let e=(0,I.j)();return(0,b.Hg)("onlyFlippableShape",()=>{let t=e.getSelectedShapes();return 1===t.length&&t.every(t=>e.isShapeOfType(t,"group")||e.isShapeOfType(t,"arrow")||e.isShapeOfType(t,"line")||e.isShapeOfType(t,"draw"))},[e])}function useCanRedo(){let e=(0,I.j)();return(0,b.Hg)("useCanRedo",()=>e.getCanRedo(),[e])}function useCanUndo(){let e=(0,I.j)();return(0,b.Hg)("useCanUndo",()=>e.getCanUndo(),[e])}function TldrawHandles({children:e}){let t=(0,I.j)(),n=(0,b.Hg)("shouldDisplayHandles",()=>t.isInAny("select.idle","select.pointing_handle"),[t]);return n?(0,T.jsx)("svg",{className:"tl-user-handles tl-overlays__item",children:e}):null}function TldrawHoveredShapeIndicator({shapeId:e}){let t=(0,I.j)(),{ShapeIndicator:n}=useEditorComponents(),r=(0,b.Hg)("show hovered",()=>t.isIn("select.editing_shape")?t.getHoveredShapeId()!==t.getEditingShapeId():t.isInAny("select.idle"),[t]);return n&&r?(0,T.jsx)(n,{className:"tl-user-indicator__hovered",shapeId:e}):null}let{PI:tg}=Math,tf=tg+1e-4;function getStrokeOutlineTracks(e,t={}){let n;let{size:r=16,smoothing:i=.5}=t;if(0===e.length||r<=0)return{left:[],right:[]};let o=e[0],a=e[e.length-1],l=a.runningLength,c=Math.pow(r*i,2),u=[],d=[],p=e[0].vector,h=e[0].point,g=h,f=h,m=g,y=!1;for(let t=0;t<e.length;t++){n=e[t];let{point:r,vector:i}=e[t],b=n.vector.dpr(p),w=(t<e.length-1?e[t+1]:e[t]).vector,S=t<e.length-1?w.dpr(n.vector):1,v=b<0&&!y,x=null!==S&&S<.2;if(v||x){if(S>-.62&&l-n.runningLength>n.radius){let e=p.clone().mul(n.radius),t=p.clone().cpr(w);t<0?(f=et.B.Add(r,e),m=et.B.Sub(r,e)):(f=et.B.Sub(r,e),m=et.B.Add(r,e)),u.push(f),d.push(m)}else{let e=p.clone().mul(n.radius).per(),t=et.B.Sub(n.input,e);for(let e=1/13,r=0;r<1;r+=e)f=et.B.RotWith(t,n.input,tf*r),u.push(f),m=et.B.RotWith(t,n.input,tf+-(tf*r)),d.push(m)}h=f,g=m,x&&(y=!0);continue}if(y=!1,n===o||n===a){let e=et.B.Per(i).mul(n.radius);u.push(et.B.Sub(r,e)),d.push(et.B.Add(r,e));continue}let T=et.B.Lrp(w,i,S).per().mul(n.radius);f=et.B.Sub(r,T),(t<=1||et.B.Dist2(h,f)>c)&&(u.push(f),h=f),m=et.B.Add(r,T),(t<=1||et.B.Dist2(g,m)>c)&&(d.push(m),g=m),p=i}return{left:u,right:d}}function getStrokeOutlinePoints_getStrokeOutlinePoints(e,t={}){let{size:n=16,start:r={},end:i={},last:o=!1}=t,{cap:a=!0}=r,{cap:l=!0}=i;if(0===e.length||n<=0)return[];let c=e[0],u=e[e.length-1],d=u.runningLength,p=!1===r.taper?0:!0===r.taper?Math.max(n,d):r.taper,h=!1===i.taper?0:!0===i.taper?Math.max(n,d):i.taper,{left:g,right:f}=getStrokeOutlineTracks(e,t),m=c.point,y=e.length>1?e[e.length-1].point:et.B.AddXY(c.point,1,1);if(1===e.length&&(!(p||h)||o)){let e=et.B.Add(m,et.B.Sub(m,y).uni().per().mul(-c.radius)),t=[];for(let n=1/13,r=n;r<=1;r+=n)t.push(et.B.RotWith(e,m,2*tf*r));return t}let b=[];if(p||h&&1===e.length);else if(a)for(let e=1/8,t=e;t<=1;t+=e){let e=et.B.RotWith(f[0],m,tf*t);b.push(e)}else{let e=et.B.Sub(g[0],f[0]),t=et.B.Mul(e,.5),n=et.B.Mul(e,.51);b.push(et.B.Sub(m,t),et.B.Sub(m,n),et.B.Add(m,n),et.B.Add(m,t))}let w=[],S=u.vector.clone().per().neg();if(h||p&&1===e.length)w.push(y);else if(l){let e=et.B.Add(y,et.B.Mul(S,u.radius));for(let t=1/29,n=t;n<1;n+=t)w.push(et.B.RotWith(e,y,3*tf*n))}else w.push(et.B.Add(y,et.B.Mul(S,u.radius)),et.B.Add(y,et.B.Mul(S,.99*u.radius)),et.B.Sub(y,et.B.Mul(S,.99*u.radius)),et.B.Sub(y,et.B.Mul(S,u.radius)));return g.concat(w,f.reverse(),b)}function getStrokePoints(e,t={}){let n,r;let{streamline:i=.5,size:o=16,simulatePressure:a=!1}=t;if(0===e.length)return[];let l=.15+(1-i)*.85,c=e.map(et.B.From),u=0;if(!a){let e=c[0];for(;e&&!(e.z>=.025);)c.shift(),e=c[0]}if(!a){let e=c[c.length-1];for(;e&&!(e.z>=.01);)c.pop(),e=c[c.length-1]}if(0===c.length)return[{point:et.B.From(e[0]),input:et.B.From(e[0]),pressure:a?.5:.15,vector:new et.B(1,1),distance:0,runningLength:0,radius:1}];let d=c[1];for(;d&&!(et.B.Dist(d,c[0])>o/3);)c[0].z=Math.max(c[0].z,d.z),c.splice(1,1),d=c[1];let p=c.pop();for(d=c[c.length-1];d&&!(et.B.Dist(d,p)>o/3);)c.pop(),d=c[c.length-1],u++;c.push(p);let h=t.last||!t.simulatePressure||c.length>1&&et.B.Dist(c[c.length-1],c[c.length-2])<o||u>0;if(2===c.length&&t.simulatePressure){let e=c[1];c=c.slice(0,-1);for(let t=1;t<5;t++){let n=et.B.Lrp(c[0],e,t/4);n.z=(c[0].z+(e.z-c[0].z))*t/4,c.push(n)}}let g=[{point:c[0],input:c[0],pressure:a?.5:c[0].z,vector:new et.B(1,1),distance:0,runningLength:0,radius:1}],f=0,m=g[0];h&&i>0&&c.push(c[c.length-1].clone());for(let e=1,i=c.length;e<i;e++)if(n=!l||t.last&&e===i-1?c[e].clone():c[e].clone().lrp(m.point,1-l),!m.point.equals(n)){if(f+=r=et.B.Dist(n,m.point),e<4&&f<o)continue;m={input:c[e],point:n,pressure:a?.5:c[e].z,vector:et.B.Sub(m.point,n).uni(),distance:r,runningLength:f,radius:1},g.push(m)}if(g[1]?.vector&&(g[0].vector=g[1].vector.clone()),f<1){let e=Math.max(.5,...g.map(e=>e.pressure));g.forEach(t=>t.pressure=e)}return g}let{min:tm}=Math;function setStrokePointRadii(e,t){let n,r;let{size:i=16,thinning:o=.5,simulatePressure:a=!0,easing:l=e=>e,start:c={},end:u={}}=t,{easing:d=tn.L.easeOutQuad}=c,{easing:p=tn.L.easeOutCubic}=u,h=e[e.length-1].runningLength,g=e[0].pressure;if(!a&&h<i){let t=e.reduce((e,t)=>Math.max(e,t.pressure),.5);return e.forEach(e=>{e.pressure=t,e.radius=i*l(.5-o*(.5-e.pressure))}),e}{let t;for(let n=0,o=e.length;n<o&&!((r=e[n]).runningLength>5*i);n++){let e=tm(1,r.distance/i);if(a){let n=tm(1,1-e);t=tm(1,g+(n-g)*(.275*e))}else t=tm(1,g+(r.pressure-g)*.5);g+=(t-g)*.5}for(let t=0;t<e.length;t++){if(r=e[t],o){let{pressure:e}=r,t=tm(1,r.distance/i);if(a){let n=tm(1,1-t);e=tm(1,g+(n-g)*(.275*t))}else e=tm(1,g+(e-g)*(.275*t));r.radius=i*l(.5-o*(.5-e)),g=e}else r.radius=i/2;void 0===n&&(n=r.radius)}}let f=!1===c.taper?0:!0===c.taper?Math.max(i,h):c.taper,m=!1===u.taper?0:!0===u.taper?Math.max(i,h):u.taper;if(f||m)for(let t=0;t<e.length;t++){r=e[t];let{runningLength:n}=r,i=n<f?d(n/f):1,o=h-n<m?p((h-n)/m):1;r.radius=Math.max(.01,r.radius*Math.min(i,o))}return e}function getStroke(e,t={}){return getStrokeOutlinePoints_getStrokeOutlinePoints(setStrokePointRadii(getStrokePoints(e,t),t),t)}function TldrawScribble({scribble:e,zoom:t,color:n,opacity:r,className:i}){let o;if(!e.points.length)return null;let a=getStroke(e.points,{size:e.size/t,start:{taper:e.taper,easing:tn.L.linear},last:"stopping"===e.state,simulatePressure:!1,streamline:.32});if(a.length<4){let n=e.size/t/2,{x:r,y:i}=e.points[e.points.length-1];o=`M ${r-n},${i} a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 ${-(2*n)},0`}else o=getSvgPathFromPoints_getSvgPathFromPoints(a);return(0,T.jsx)("svg",{className:i?C("tl-overlays__item",i):i,children:(0,T.jsx)("path",{className:"tl-scribble",d:o,fill:n??`var(--color-${e.color})`,opacity:r??e.opacity})})}let TldrawSelectionBackground=({bounds:e,rotation:t})=>{let n=(0,I.j)(),r=(0,b.Hg)("should display",()=>n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_shape","select.pointing_selection","text.resizing"),[n]);return r?(0,T.jsx)(DefaultSelectionBackground,{bounds:e,rotation:t}):null};function useReadonly(){let e=(0,I.j)();return(0,b.Hg)("isReadonlyMode",()=>e.getInstanceState().isReadonly,[e])}function TldrawCropHandles({size:e,width:t,height:n,hideAlternateHandles:r}){let i=(0,E.$Z)(e/3),o=i/2;return(0,T.jsxs)("svg",{className:"tl-overlays__item",children:[(0,T.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${(0,E.$Z)(0-o)},${(0,E.$Z)(e)} 
						${(0,E.$Z)(0-o)},${(0,E.$Z)(0-o)} 
						${(0,E.$Z)(e)},${(0,E.$Z)(0-o)}`,strokeWidth:i,"data-testid":"selection.crop.top_left","aria-label":"top_left handle"}),(0,T.jsx)("line",{className:C("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:(0,E.$Z)(t/2-e),y1:(0,E.$Z)(0-o),x2:(0,E.$Z)(t/2+e),y2:(0,E.$Z)(0-o),strokeWidth:i,"data-testid":"selection.crop.top","aria-label":"top handle"}),(0,T.jsx)("polyline",{className:C("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${(0,E.$Z)(t-e)},${(0,E.$Z)(0-o)} 
						${(0,E.$Z)(t+o)},${(0,E.$Z)(0-o)} 
						${(0,E.$Z)(t+o)},${(0,E.$Z)(e)}`,strokeWidth:i,"data-testid":"selection.crop.top_right","aria-label":"top_right handle"}),(0,T.jsx)("line",{className:C("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:(0,E.$Z)(t+o),y1:(0,E.$Z)(n/2-e),x2:(0,E.$Z)(t+o),y2:(0,E.$Z)(n/2+e),strokeWidth:i,"data-testid":"selection.crop.right","aria-label":"right handle"}),(0,T.jsx)("polyline",{className:"tl-corner-crop-handle",points:`
						${(0,E.$Z)(t+o)},${(0,E.$Z)(n-e)} 
						${(0,E.$Z)(t+o)},${(0,E.$Z)(n+o)}
						${(0,E.$Z)(t-e)},${(0,E.$Z)(n+o)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_right","aria-label":"bottom_right handle"}),(0,T.jsx)("line",{className:C("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:(0,E.$Z)(t/2-e),y1:(0,E.$Z)(n+o),x2:(0,E.$Z)(t/2+e),y2:(0,E.$Z)(n+o),strokeWidth:i,"data-testid":"selection.crop.bottom","aria-label":"bottom handle"}),(0,T.jsx)("polyline",{className:C("tl-corner-crop-handle",{"tl-hidden":r}),points:`
						${(0,E.$Z)(0+e)},${(0,E.$Z)(n+o)} 
						${(0,E.$Z)(0-o)},${(0,E.$Z)(n+o)}
						${(0,E.$Z)(0-o)},${(0,E.$Z)(n-e)}`,strokeWidth:i,"data-testid":"selection.crop.bottom_left","aria-label":"bottom_left handle"}),(0,T.jsx)("line",{className:C("tl-corner-crop-edge-handle",{"tl-hidden":r}),x1:(0,E.$Z)(0-o),y1:(0,E.$Z)(n/2-e),x2:(0,E.$Z)(0-o),y2:(0,E.$Z)(n/2+e),strokeWidth:i,"data-testid":"selection.crop.left","aria-label":"left handle"})]})}let ty=(0,b.j)(function({bounds:e,rotation:t}){let n=(0,I.j)(),r=(0,P.useRef)(null),i=useReadonly(),o=useSelectionEvents("top"),a=useSelectionEvents("right"),l=useSelectionEvents("bottom"),c=useSelectionEvents("left"),u=useSelectionEvents("top_left"),d=useSelectionEvents("top_right"),p=useSelectionEvents("bottom_right"),h=useSelectionEvents("bottom_left"),g=!n.getIsMenuOpen()&&"default"===n.getInstanceState().cursor.type,f=n.getInstanceState().isCoarsePointer,m=n.getOnlySelectedShape(),y=m&&n.isShapeOrAncestorLocked(m),b=m?n.getShapeUtil(m).expandSelectionOutlinePx(m):0;if(useTransform(r,e?.x,e?.y,1,n.getSelectionRotation(),{x:-b,y:-b}),!e)return null;e=e.clone().expandBy(b).zeroFix();let w=n.getZoomLevel(),S=n.getInstanceState().isChangingStyle,v=e.width,x=e.height,k=8/w,_=v<2*k,M=x<2*k,j=v<4*k,A=x<4*k,$=v<5*k,D=x<5*k,O=f?1.75:1,B=6/w*O,F=(j?B/2:B)*(.75*O),U=(A?B/2:B)*(.75*O),L=(!m||!n.getShapeUtil(m).hideSelectionBoundsFg(m))&&!S,R=L&&n.isInAny("select.idle","select.brushing","select.scribble_brushing","select.pointing_canvas","select.pointing_selection","select.pointing_shape","select.crop.idle","select.crop.pointing_crop","select.pointing_resize_handle","select.pointing_crop_handle")||L&&n.isIn("select.resizing")&&m&&n.isShapeOfType(m,"text");m&&R&&n.environment.isFirefox&&n.isShapeOfType(m,"embed")&&(R=!1);let z=n.isInAny("select.pointing_crop_handle","select.crop.idle","select.crop.pointing_crop")&&!S&&!i,N=n.isInAny("select.idle","select.pointing_selection","select.pointing_shape","select.crop.idle")&&!S&&!i,V=!f&&!(_||M)&&(N||z)&&(!m||!n.getShapeUtil(m).hideRotateHandle(m))&&!y,H=f&&(!j||!A)&&(N||z)&&(!m||!n.getShapeUtil(m).hideRotateHandle(m))&&!y,G=N&&(!m||n.getShapeUtil(m).canResize(m)&&!n.getShapeUtil(m).hideResizeHandles(m))&&!z&&!y,W=_||M,Z=_&&M,K=$||D,Y=G||z,X=!V,J=!N||!Y,Q=!N||!Y||W,ee=!N||!Y||W,et=!N||!Y||Z&&!z,en=!0,er=!0;if(z)en=K,er=K;else if(G){en=W||Z||f;let e=f&&m&&"text"===m.type;er=en&&!e}let ei=Math.min(24/w,x-3*U),eo=N&&f&&m&&n.isShapeOfType(m,"text")&&ei*w>=4;return(0,T.jsx)("svg",{className:"tl-overlays__item tl-selection__fg","data-testid":"selection-foreground",children:(0,T.jsxs)("g",{ref:r,children:[R&&(0,T.jsx)("rect",{className:"tl-selection__fg__outline",width:(0,E.$Z)(v),height:(0,E.$Z)(x)}),(0,T.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.top-left",cx:0,cy:0,targetSize:B,corner:"top_left_rotate",cursor:g?getCursor("nwse-rotate",t):void 0,isHidden:X}),(0,T.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.top-right",cx:v+3*B,cy:0,targetSize:B,corner:"top_right_rotate",cursor:g?getCursor("nesw-rotate",t):void 0,isHidden:X}),(0,T.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.bottom-left",cx:0,cy:x+3*B,targetSize:B,corner:"bottom_left_rotate",cursor:g?getCursor("swne-rotate",t):void 0,isHidden:X}),(0,T.jsx)(RotateCornerHandle,{"data-testid":"selection.rotate.bottom-right",cx:v+3*B,cy:x+3*B,targetSize:B,corner:"bottom_right_rotate",cursor:g?getCursor("senw-rotate",t):void 0,isHidden:X}),(0,T.jsx)(MobileRotateHandle,{"data-testid":"selection.rotate.mobile",cx:j?-(1.5*B):v/2,cy:j?x/2:-(1.5*B),size:k,isHidden:!N||!H}),(0,T.jsx)("rect",{className:C("tl-transparent",{"tl-hidden":en}),"data-testid":"selection.resize.top","aria-label":"top target",pointerEvents:"all",x:0,y:(0,E.$Z)(0-(A?2*U:U)),width:(0,E.$Z)(v),height:(0,E.$Z)(Math.max(1,2*U)),style:g?{cursor:getCursor("ns-resize",t)}:void 0,...o}),(0,T.jsx)("rect",{className:C("tl-transparent",{"tl-hidden":er}),"data-testid":"selection.resize.right","aria-label":"right target",pointerEvents:"all",x:(0,E.$Z)(v-(j?0:F)),y:0,height:(0,E.$Z)(x),width:(0,E.$Z)(Math.max(1,2*F)),style:g?{cursor:getCursor("ew-resize",t)}:void 0,...a}),(0,T.jsx)("rect",{className:C("tl-transparent",{"tl-hidden":en}),"data-testid":"selection.resize.bottom","aria-label":"bottom target",pointerEvents:"all",x:0,y:(0,E.$Z)(x-(A?0:U)),width:(0,E.$Z)(v),height:(0,E.$Z)(Math.max(1,2*U)),style:g?{cursor:getCursor("ns-resize",t)}:void 0,...l}),(0,T.jsx)("rect",{className:C("tl-transparent",{"tl-hidden":er}),"data-testid":"selection.resize.left","aria-label":"left target",pointerEvents:"all",x:(0,E.$Z)(0-(j?2*F:F)),y:0,height:(0,E.$Z)(x),width:(0,E.$Z)(Math.max(1,2*F)),style:g?{cursor:getCursor("ew-resize",t)}:void 0,...c}),(0,T.jsx)("rect",{className:C("tl-transparent",{"tl-hidden":J}),"data-testid":"selection.target.top-left","aria-label":"top-left target",pointerEvents:"all",x:(0,E.$Z)(0-(j?2*F:1.5*F)),y:(0,E.$Z)(0-(A?2*U:1.5*U)),width:(0,E.$Z)(3*F),height:(0,E.$Z)(3*U),style:g?{cursor:getCursor("nwse-resize",t)}:void 0,...u}),(0,T.jsx)("rect",{className:C("tl-transparent",{"tl-hidden":Q}),"data-testid":"selection.target.top-right","aria-label":"top-right target",pointerEvents:"all",x:(0,E.$Z)(v-(j?0:1.5*F)),y:(0,E.$Z)(0-(A?2*U:1.5*U)),width:(0,E.$Z)(3*F),height:(0,E.$Z)(3*U),style:g?{cursor:getCursor("nesw-resize",t)}:void 0,...d}),(0,T.jsx)("rect",{className:C("tl-transparent",{"tl-hidden":et}),"data-testid":"selection.target.bottom-right","aria-label":"bottom-right target",pointerEvents:"all",x:(0,E.$Z)(v-(j?F:1.5*F)),y:(0,E.$Z)(x-(A?U:1.5*U)),width:(0,E.$Z)(3*F),height:(0,E.$Z)(3*U),style:g?{cursor:getCursor("nwse-resize",t)}:void 0,...p}),(0,T.jsx)("rect",{className:C("tl-transparent",{"tl-hidden":ee}),"data-testid":"selection.target.bottom-left","aria-label":"bottom-left target",pointerEvents:"all",x:(0,E.$Z)(0-(j?3*F:1.5*F)),y:(0,E.$Z)(x-(A?0:1.5*U)),width:(0,E.$Z)(3*F),height:(0,E.$Z)(3*U),style:g?{cursor:getCursor("nesw-resize",t)}:void 0,...h}),G&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("rect",{"data-testid":"selection.resize.top-left",className:C("tl-corner-handle",{"tl-hidden":J}),"aria-label":"top_left handle",x:(0,E.$Z)(0-k/2),y:(0,E.$Z)(0-k/2),width:(0,E.$Z)(k),height:(0,E.$Z)(k)}),(0,T.jsx)("rect",{"data-testid":"selection.resize.top-right",className:C("tl-corner-handle",{"tl-hidden":Q}),"aria-label":"top_right handle",x:(0,E.$Z)(v-k/2),y:(0,E.$Z)(0-k/2),width:(0,E.$Z)(k),height:(0,E.$Z)(k)}),(0,T.jsx)("rect",{"data-testid":"selection.resize.bottom-right",className:C("tl-corner-handle",{"tl-hidden":et}),"aria-label":"bottom_right handle",x:(0,E.$Z)(v-k/2),y:(0,E.$Z)(x-k/2),width:(0,E.$Z)(k),height:(0,E.$Z)(k)}),(0,T.jsx)("rect",{"data-testid":"selection.resize.bottom-left",className:C("tl-corner-handle",{"tl-hidden":ee}),"aria-label":"bottom_left handle",x:(0,E.$Z)(0-k/2),y:(0,E.$Z)(x-k/2),width:(0,E.$Z)(k),height:(0,E.$Z)(k)})]}),eo&&(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("rect",{"data-testid":"selection.text-resize.left.handle",className:"tl-text-handle","aria-label":"bottom_left handle",x:(0,E.$Z)(0-k/4),y:(0,E.$Z)(x/2-ei/2),rx:k/4,width:(0,E.$Z)(k/2),height:(0,E.$Z)(ei)}),(0,T.jsx)("rect",{"data-testid":"selection.text-resize.right.handle",className:"tl-text-handle","aria-label":"bottom_left handle",rx:k/4,x:(0,E.$Z)(v-k/4),y:(0,E.$Z)(x/2-ei/2),width:(0,E.$Z)(k/2),height:(0,E.$Z)(ei)})]}),z&&(0,T.jsx)(TldrawCropHandles,{size:k,width:v,height:x,hideAlternateHandles:K})]})})}),RotateCornerHandle=function({cx:e,cy:t,targetSize:n,corner:r,cursor:i,isHidden:o,"data-testid":a}){let l=useSelectionEvents(r);return(0,T.jsx)("rect",{className:C("tl-transparent","tl-rotate-corner",{"tl-hidden":o}),"data-testid":a,"aria-label":`${r} target`,pointerEvents:"all",x:(0,E.$Z)(e-3*n),y:(0,E.$Z)(t-3*n),width:(0,E.$Z)(Math.max(1,3*n)),height:(0,E.$Z)(Math.max(1,3*n)),cursor:i,...l})},tb=Math.sqrt(Math.PI),MobileRotateHandle=function({cx:e,cy:t,size:n,isHidden:r,"data-testid":i}){let o=useSelectionEvents("mobile_rotate"),a=(0,I.j)(),l=(0,b.Hg)("zoom level",()=>a.getZoomLevel(),[a]);return(0,T.jsxs)("g",{children:[(0,T.jsx)("circle",{"data-testid":i,pointerEvents:"all",className:C("tl-transparent","tl-mobile-rotate__bg",{"tl-hidden":r}),cx:e,cy:t,r:Math.max(14*(1/l),20/Math.max(1,l)),...o}),(0,T.jsx)("circle",{className:C("tl-mobile-rotate__fg",{"tl-hidden":r}),cx:e,cy:t,r:n/tb})]})},tw={lineHeight:1.35,fontWeight:"normal",fontVariant:"normal",fontStyle:"normal",padding:"0px"},tS={s:2,m:3.5,l:5,xl:10},tv={s:18,m:24,l:36,xl:44},tx={s:18,m:22,l:26,xl:32},tT={s:18,m:20,l:24,xl:28},tP={draw:"var(--tl-font-draw)",sans:"var(--tl-font-sans)",serif:"var(--tl-font-serif)",mono:"var(--tl-font-mono)"};/*!
 * canvas-size
 * v1.2.6
 * https://github.com/jhildenbiddle/canvas-size
 * (c) 2015-2023 John Hildenbiddle <http://hildenbiddle.com>
 * MIT license
 */function _iterableToArrayLimit(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,i,o,a,l=[],c=!0,u=!1;try{if(o=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(r=o.call(n)).done)&&(l.push(r.value),l.length!==t);c=!0);}catch(e){u=!0,i=e}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return l}}function canvas_size_esm_ownKeys(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function canvas_size_esm_objectSpread2(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?canvas_size_esm_ownKeys(Object(n),!0).forEach(function(t){canvas_size_esm_defineProperty(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):canvas_size_esm_ownKeys(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function canvas_size_esm_defineProperty(e,t,n){return(t=canvas_size_esm_toPropertyKey(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function canvas_size_esm_objectWithoutPropertiesLoose(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}function canvas_size_esm_objectWithoutProperties(e,t){if(null==e)return{};var n,r,i=canvas_size_esm_objectWithoutPropertiesLoose(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],!(t.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}function _slicedToArray(e,t){return _arrayWithHoles(e)||_iterableToArrayLimit(e,t)||_unsupportedIterableToArray(e,t)||_nonIterableRest()}function _toConsumableArray(e){return _arrayWithoutHoles(e)||_iterableToArray(e)||_unsupportedIterableToArray(e)||_nonIterableSpread()}function _arrayWithoutHoles(e){if(Array.isArray(e))return _arrayLikeToArray(e)}function _arrayWithHoles(e){if(Array.isArray(e))return e}function _iterableToArray(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function _unsupportedIterableToArray(e,t){if(e){if("string"==typeof e)return _arrayLikeToArray(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);if("Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _arrayLikeToArray(e,t)}}function _arrayLikeToArray(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=Array(t);n<t;n++)r[n]=e[n];return r}function _nonIterableSpread(){throw TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function _nonIterableRest(){throw TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function canvas_size_esm_toPrimitive(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var r=n.call(e,t||"default");if("object"!=typeof r)return r;throw TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}function canvas_size_esm_toPropertyKey(e){var t=canvas_size_esm_toPrimitive(e,"string");return"symbol"==typeof t?t:String(t)}function canvasTest(e){var t,n,r=e.sizes.shift(),i=Math.max(Math.ceil(r[0]),1),o=Math.max(Math.ceil(r[1]),1),a=[i-1,o-1,1,1],l=Date.now(),c="undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope;c?(t=new OffscreenCanvas(1,1),n=new OffscreenCanvas(i,o)):((t=document.createElement("canvas")).width=1,t.height=1,(n=document.createElement("canvas")).width=i,n.height=o);var u=t.getContext("2d"),d=n.getContext("2d");d&&(d.fillRect.apply(d,a),u.drawImage(n,i-1,o-1,1,1,0,0,1,1));var p=u&&0!==u.getImageData(0,0,1,1).data[3],h=Date.now()-l;return[t,n].forEach(function(e){e.height=0,e.width=0}),c?(postMessage({width:i,height:o,benchmark:h,isTestPass:p}),!p&&e.sizes.length&&canvasTest(e)):p?e.onSuccess(i,o,h):(e.onError(i,o,h),e.sizes.length&&canvasTest(e)),p}var tC={area:[16384,14188,11402,11180,10836,8192,4096,1],height:[8388607,65535,32767,16384,8192,4096,1],width:[4194303,65535,32767,16384,8192,4096,1]},tk=["onError","onSuccess"],tI={max:null,min:1,sizes:[],step:1024,usePromise:!1,useWorker:!1,onError:Function.prototype,onSuccess:Function.prototype},tE={};function createSizesArray(e){var t=e.width===e.height,n=1===e.height,r=1===e.width,i=[];if(e.width&&e.height)for(var o=e.min||tI.min,a=e.step||tI.step,l=Math.max(e.width,e.height);l>=o;){var c=t||n?l:1,u=t||r?l:1;i.push([c,u]),l-=a}else e.sizes.forEach(function(e){var o=t||n?e:1,a=t||r?e:1;i.push([o,a])});return i}function handleMethod(e){var t=window&&"HTMLCanvasElement"in window,n=window&&"OffscreenCanvas"in window,r=Date.now(),i=e.onError,o=e.onSuccess,a=canvas_size_esm_objectWithoutProperties(e,tk),l=null;if(!t)return!1;if(e.useWorker&&n){var c="\n            var canvasTest = ".concat(canvasTest.toString(),";\n            onmessage = function(e) {\n                canvasTest(e.data);\n            };\n        "),u=new Blob([c],{type:"application/javascript"}),d=URL.createObjectURL(u);l=new Worker(d),URL.revokeObjectURL(d),l.onmessage=function(e){var t=e.data,n=t.width,i=t.height,o=t.benchmark;t.isTestPass?(tE[r].onSuccess(n,i,o),delete tE[r]):tE[r].onError(n,i,o)}}return e.usePromise?new Promise(function(t,n){var c=canvas_size_esm_objectSpread2(canvas_size_esm_objectSpread2({},e),{},{onError:function(t,r,o){var a;if(0===e.sizes.length)a=!0;else{var l=_slicedToArray(e.sizes.slice(-1),1),c=_slicedToArray(l[0],2),u=c[0],d=c[1];a=t===u&&r===d}i(t,r,o),a&&n({width:t,height:r,benchmark:o})},onSuccess:function(e,n,r){o(e,n,r),t({width:e,height:n,benchmark:r})}});if(l){var u=c.onError,d=c.onSuccess;tE[r]={onError:u,onSuccess:d},l.postMessage(a)}else canvasTest(c)}):l?void(tE[r]={onError:i,onSuccess:o},l.postMessage(a)):canvasTest(e)}var t_={maxArea:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=createSizesArray({width:e.max,height:e.max,min:e.min,step:e.step,sizes:_toConsumableArray(tC.area)});return handleMethod(canvas_size_esm_objectSpread2(canvas_size_esm_objectSpread2(canvas_size_esm_objectSpread2({},tI),e),{},{sizes:t}))},maxHeight:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=createSizesArray({width:1,height:e.max,min:e.min,step:e.step,sizes:_toConsumableArray(tC.height)});return handleMethod(canvas_size_esm_objectSpread2(canvas_size_esm_objectSpread2(canvas_size_esm_objectSpread2({},tI),e),{},{sizes:t}))},maxWidth:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=createSizesArray({width:e.max,height:1,min:e.min,step:e.step,sizes:_toConsumableArray(tC.width)});return handleMethod(canvas_size_esm_objectSpread2(canvas_size_esm_objectSpread2(canvas_size_esm_objectSpread2({},tI),e),{},{sizes:t}))},test:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=canvas_size_esm_objectSpread2(canvas_size_esm_objectSpread2({},tI),e);return t.sizes=_toConsumableArray(t.sizes),t.width&&t.height&&(t.sizes=[[t.width,t.height]]),handleMethod(t)}};let tM=null;function getBrowserCanvasMaxSize(){return tM||(tM=calculateBrowserCanvasMaxSize()),tM}async function calculateBrowserCanvasMaxSize(){let e=await t_.maxWidth({usePromise:!0}),t=await t_.maxHeight({usePromise:!0}),n=await t_.maxArea({usePromise:!0});return{maxWidth:e.width,maxHeight:t.height,maxArea:n.width*n.height}}async function clampToBrowserMaxCanvasSize(e,t){if(e<=8192&&t<=8192&&e*t<=16777216)return[e,t];let{maxWidth:n,maxHeight:r,maxArea:i}=await getBrowserCanvasMaxSize(),o=e/t;if(e>n&&(t=(e=n)/o),t>r&&(e=(t=r)*o),e*t>i){let n=Math.sqrt(i/(e*t));e*=n,t*=n}return[e,t]}/*!
 * MIT License
 * Modified code originally from <https://github.com/qzb/is-animated>
 * Copyright (c) 2016 Jzef Sokoowski <j.k.sokolowski@gmail.com>
 */function getDataBlocksLength(e,t){let n=0;for(;e[t+n];)n+=e[t+n]+1;return n+1}function isGIF(e){let t=new TextDecoder("ascii"),n=t.decode(e.slice(0,3));return"GIF"===n}function isAnimated(e){let t,n;let r=new Uint8Array(e),i=0,o=0;if(!isGIF(e))return!1;for(t=128&r[10],n=7&r[10],i+=13+(t?3*Math.pow(2,n+1):0);o<2&&i<r.length;)switch(r[i]){case 44:o+=1,t=128&r[i+9],n=7&r[i+9],i+=10+(t?3*Math.pow(2,n+1):0),i+=getDataBlocksLength(r,i+1)+1;break;case 33:i+=2,i+=getDataBlocksLength(r,i);break;default:i=r.length}return o>1}function containBoxSize(e,t){let n=e.w/t.w,r=e.h/t.h;return n<=1&&r<=1?e:n>r?{w:e.w/n,h:e.h/n}:{w:e.w/r,h:e.h/r}}async function downsizeImage(e,t,n,r={}){let i=await v.xe.usingObjectURL(e,v.xe.loadImage),{type:o=e.type,quality:a=.92}=r,[l,c]=await clampToBrowserMaxCanvasSize(Math.min(2*t,i.naturalWidth),Math.min(2*n,i.naturalHeight)),u=document.createElement("canvas");u.width=l,u.height=c;let d=(0,v.kP)(u.getContext("2d",{willReadFrequently:!0}),"Could not get canvas context");return d.imageSmoothingEnabled=!0,d.imageSmoothingQuality="high",d.drawImage(i,0,0,l,c),new Promise((e,t)=>{u.toBlob(n=>{n?e(n):t(Error("Could not resize image"))},o,a)})}let tj=["image/jpeg","image/png","image/gif","image/svg+xml"],tA=["video/mp4","video/quicktime"];async function isGifAnimated(e){return isAnimated(await e.arrayBuffer())}function escapeStringRegexp(e){if("string"!=typeof e)throw TypeError("Expected a string");return e.replace(/[|\\{}()[\]^$+*?.]/g,"\\$&").replace(/-/g,"\\x2d")}function matchEmbedUrl(e){let t=new URL(e).host.replace("www.","");for(let n of S.Lu)if(checkHostnames(n.hostnames,t)){let t=n.fromEmbedUrl(e);if(t)return{definition:n,url:t,embedUrl:e}}}let globlikeRegExp=e=>e.split("*").map(e=>escapeStringRegexp(e)).join(".+"),checkHostnames=(e,t)=>!!e.find(e=>{let n=new RegExp(globlikeRegExp(e));return t.match(n)});function matchUrl(e){let t=new URL(e).host.replace("www.","");for(let n of S.Lu)if(checkHostnames(n.hostnames,t)){let t=n.toEmbedUrl(e);if(t)return{definition:n,embedUrl:t,url:e}}}function getEmbedInfoUnsafely(e){let t=matchUrl(e)??matchEmbedUrl(e);return t}function getEmbedInfo(e){try{return getEmbedInfoUnsafely(e)}catch(e){console.error(e)}}let TextHelpers=class TextHelpers{static insertTextFirefox(e,t){e.setRangeText(t,e.selectionStart||0,e.selectionEnd||0,"end"),e.dispatchEvent(new InputEvent("input",{data:t,inputType:"insertText",isComposing:!1}))}static insert(e,t){let n=e.ownerDocument,r=n.activeElement;r!==e&&e.focus(),n.execCommand("insertText",!1,t)||TextHelpers.insertTextFirefox(e,t),r===n.body?e.blur():r instanceof HTMLElement&&r!==e&&r.focus()}static set(e,t){e.select(),TextHelpers.insert(e,t)}static getSelection(e){let{selectionStart:t,selectionEnd:n}=e;return e.value.slice(t||void 0,n||void 0)}static wrapSelection(e,t,n){let{selectionStart:r,selectionEnd:i}=e,o=TextHelpers.getSelection(e);TextHelpers.insert(e,t+o+(n??t)),e.selectionStart=(r||0)+t.length,e.selectionEnd=(i||0)+t.length}static replace(e,t,n){let r=0;e.value.replace(t,(...t)=>{let i=r+t[t.length-2],o=t[0].length;e.selectionStart=i,e.selectionEnd=i+o;let a="string"==typeof n?n:n(...t);return TextHelpers.insert(e,a),e.selectionStart=i,r+=a.length-o,a})}static findLineEnd(e,t){let n=e.lastIndexOf("\n",t-1)+1;return"	"!==e.charAt(n)?t:n+1}static indent(e){let{selectionStart:t,selectionEnd:n,value:r}=e,i=r.slice(t,n),o=/\n/g.exec(i)?.length;if(o&&o>0){let i=r.lastIndexOf("\n",t-1)+1,o=e.value.slice(i,n-1),a=o.replace(/^|\n/g,"$&  "),l=a.length-o.length;e.setSelectionRange(i,n-1),TextHelpers.insert(e,a),e.setSelectionRange(t+1,n+l)}else TextHelpers.insert(e,"  ")}static unindent(e){let{selectionStart:t,selectionEnd:n,value:r}=e,i=r.lastIndexOf("\n",t-1)+1,o=TextHelpers.findLineEnd(r,n),a=e.value.slice(i,o),l=a.replace(/(^|\n)(\t| {1,2})/g,"$1"),c=a.length-l.length;e.setSelectionRange(i,o),TextHelpers.insert(e,l);let u=/\t| {1,2}/.exec(r.slice(i,t)),d=u?u[0].length:0,p=t-d;e.setSelectionRange(t-d,Math.max(p,n-c))}static indentCE(e){let t=window.getSelection(),n=e.innerText,r=getCaretIndex(e)??0,i=getCaretIndex(e)??0,o=n.slice(r,i),a=/\n/g.exec(o)?.length;if(a&&a>0){let o=n.lastIndexOf("\n",r-1)+1,a=n.slice(o,i-1),l=a.replace(/^|\n/g,"$&  "),c=l.length-a.length;t&&t.setBaseAndExtent(e,r+1,e,i+c)}else{let t=window.getSelection();e.innerText=n.slice(0,r)+"  "+n.slice(r),t?.setBaseAndExtent(e,r+1,e,r+2)}}static unindentCE(e){let t=window.getSelection(),n=e.innerText,r=getCaretIndex(e)??0,i=getCaretIndex(e)??0,o=n.lastIndexOf("\n",r-1)+1,a=TextHelpers.findLineEnd(n,i),l=n.slice(o,a),c=l.replace(/(^|\n)(\t| {1,2})/g,"$1"),u=l.length-c.length;if(t){t.setBaseAndExtent(e,o,e,a);let l=/\t| {1,2}/.exec(n.slice(o,r)),c=l?l[0].length:0,d=r-c;t.setBaseAndExtent(e,r-c,e,Math.max(d,i-u))}}static fixNewLines=/\r?\n|\r/g;static normalizeText(e){return e.replace(TextHelpers.fixNewLines,"\n")}static normalizeTextForDom(e){return e.replace(TextHelpers.fixNewLines,"\n").split("\n").map(e=>e||" ").join("\n")}};function getCaretIndex(e){if(void 0===window.getSelection)return;let t=window.getSelection();if(!t)return;let n=0;if(0!==t.rangeCount){let r=t.getRangeAt(0),i=r.cloneRange();i.selectNodeContents(e),i.setEnd(r.endContainer,r.endOffset),n=i.toString().length}return n}let t$=/[\u0590-\u05FF\u0600-\u06FF\u0750-\u077F\u08A0-\u08FF\uFB50-\uFDFF\uFE70-\uFEFF]/;function isRightToLeftLanguage(e){return t$.test(e)}function replaceTabsWithSpaces(e){return e.replace(/\t/g,"  ")}function stripCommonMinimumIndentation(e){let t=e.split("\n");for(;t[0]&&0===t[0].trim().length;)t.shift();let n=1/0;for(let e of t)if(e.trim().length>0){let t=e.length-e.trimStart().length;n=Math.min(n,t)}return t.map(e=>e.slice(n)).join("\n")}function stripTrailingWhitespace(e){return e.replace(/[ \t]+$/gm,"").replace(/\n+$/,"")}function cleanupText(e){return stripTrailingWhitespace(stripCommonMinimumIndentation(replaceTabsWithSpaces(e)))}let truncateStringWithEllipsis=(e,t)=>e.length<=t?e:e.substring(0,t-3)+"...";function registerDefaultExternalContentHandlers(e,{maxImageDimension:t,maxAssetSize:n,acceptedImageMimeTypes:r,acceptedVideoMimeTypes:i},{toasts:o,msg:a}){e.registerExternalAssetHandler("file",async({file:e})=>{let o=e.name,a=e,l=r.includes(a.type),c=i.includes(a.type);(0,v.hu)(l||c,`File type not allowed: ${a.type}`),(0,v.hu)(a.size<=n,`File size too big: ${(a.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`),"video/quicktime"===a.type&&(a=new Blob([a],{type:"video/mp4"}));let u=l?await v.xe.getImageSize(a):await v.xe.getVideoSize(a),d="image/gif"===a.type?await isGifAnimated(a):c,p=await (0,v.Aq)(await a.arrayBuffer());if(isFinite(t)){let e=containBoxSize(u,{w:t,h:t});u!==e&&("image/jpeg"===a.type||"image/png"===a.type)&&(u=e)}("image/jpeg"===a.type||"image/png"===a.type)&&(a=await downsizeImage(a,u.w,u.h,{type:a.type,quality:.92}));let h=S.Yk.createId(p),g=S.Yk.create({id:h,type:l?"image":"video",typeName:"asset",props:{name:o,src:await v.xe.blobToDataUrl(a),w:u.w,h:u.h,mimeType:a.type,isAnimated:d}});return g}),e.registerExternalAssetHandler("url",async({url:e})=>{let t;try{let n=await fetch(e,{method:"GET",mode:"no-cors"}),r=await n.text(),i=new DOMParser().parseFromString(r,"text/html");t={image:i.head.querySelector('meta[property="og:image"]')?.getAttribute("content")??"",title:i.head.querySelector('meta[property="og:title"]')?.getAttribute("content")??truncateStringWithEllipsis(e,32),description:i.head.querySelector('meta[property="og:description"]')?.getAttribute("content")??""}}catch(n){console.error(n),o.addToast({title:a("assets.url.failed")}),t={image:"",title:truncateStringWithEllipsis(e,32),description:""}}return{id:S.Yk.createId((0,v.jK)(e)),typeName:"asset",type:"bookmark",props:{src:e,description:t.description,image:t.image,title:t.title},meta:{}}}),e.registerExternalContentHandler("svg-text",async({point:t,text:n})=>{let r=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageCenter()),i=new DOMParser().parseFromString(n,"image/svg+xml").querySelector("svg");if(!i)throw Error("No <svg/> element present");let o=parseFloat(i.getAttribute("width")||"0"),a=parseFloat(i.getAttribute("height")||"0");if(!(o&&a)){document.body.appendChild(i);let e=i.getBoundingClientRect();document.body.removeChild(i),o=e.width,a=e.height}let l=await e.getAssetForExternalContent({type:"file",file:new File([n],"asset.svg",{type:"image/svg+xml"})});if(!l)throw Error("Could not create an asset");createShapesForAssets(e,[l],r)}),e.registerExternalContentHandler("embed",({point:t,url:n,embed:r})=>{let i=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageCenter()),{width:o,height:a}=r,l=(0,S.F1)(),c={id:l,type:"embed",x:i.x-(o||450)/2,y:i.y-(a||450)/2,props:{w:o,h:a,url:n}};e.createShapes([c]).select(l)}),e.registerExternalContentHandler("files",async({point:t,files:l})=>{let c=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageCenter()),u=new et.B(c.x,c.y),d=[];await Promise.all(l.map(async(t,l)=>{if(t.size>n)return console.warn(`File size too big: ${(t.size/1024).toFixed()}kb > ${(n/1024).toFixed()}kb`),null;if(!t.type)throw Error("No mime type");if(!r.concat(i).includes(t.type))return console.warn(`${t.name} not loaded - Extension not allowed.`),null;try{let n=await e.getAssetForExternalContent({type:"file",file:t});if(!n)throw Error("Could not create an asset");d[l]=n}catch(e){return o.addToast({title:a("assets.files.upload-failed")}),console.error(e),null}})),createShapesForAssets(e,(0,v.oA)(d),u)}),e.registerExternalContentHandler("text",async({point:t,text:n})=>{let r,i,o;let a=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageCenter()),l=e.getShapeUtil("text").getDefaultProps(),c=cleanupText(n),u="middle",d=c.split("\n").length>1,p=isRightToLeftLanguage(c);d&&(u=d?p?"end":"start":"middle");let h=e.textMeasure.measureText(c,{...tw,fontFamily:tP[l.font],fontSize:tv[l.size],maxWidth:null}),g=Math.min(d?.9*e.getViewportPageBounds().width:920,Math.max(200,.9*e.getViewportPageBounds().width));if(h.w>g){let t=e.textMeasure.measureText(c,{...tw,fontFamily:tP[l.font],fontSize:tv[l.size],maxWidth:g});r=t.w,i=t.h,o=!1,u=p?"end":"start"}else r=h.w,i=h.h,o=!0;a.y-i/2<e.getViewportPageBounds().minY+40&&(a.y=e.getViewportPageBounds().minY+40+i/2),e.createShapes([{id:(0,S.F1)(),type:"text",x:a.x-r/2,y:a.y-i/2,props:{text:c,align:u,autoSize:o,w:r}}])}),e.registerExternalContentHandler("url",async({point:t,url:n})=>{let r=getEmbedInfo(n);if(r)return e.putExternalContent({type:"embed",url:r.url,point:t,embed:r.definition});let i=t??(e.inputs.shiftKey?e.inputs.currentPagePoint:e.getViewportPageCenter()),l=S.Yk.createId((0,v.jK)(n)),c=createEmptyBookmarkShape(e,n,i),u=e.getAsset(l),d=!1;if(!u){d=!0;try{let t=await e.getAssetForExternalContent({type:"url",url:n});if(!t)throw Error("Could not create an asset");u=t}catch(e){o.addToast({title:a("assets.url.failed")});return}}e.batch(()=>{d&&e.createAssets([u]),e.updateShapes([{id:c.id,type:c.type,props:{assetId:u.id}}])})})}async function createShapesForAssets(e,t,n){if(!t.length)return[];let r=et.B.From(n),i=[];for(let e of t)switch(e.type){case"bookmark":i.push({id:(0,S.F1)(),type:"bookmark",x:r.x-150,y:r.y-160,opacity:1,props:{assetId:e.id,url:e.props.src}}),r.x+=300;break;case"image":i.push({id:(0,S.F1)(),type:"image",x:r.x-e.props.w/2,y:r.y-e.props.h/2,opacity:1,props:{assetId:e.id,w:e.props.w,h:e.props.h}}),r.x+=e.props.w;break;case"video":i.push({id:(0,S.F1)(),type:"video",x:r.x-e.props.w/2,y:r.y-e.props.h/2,opacity:1,props:{assetId:e.id,w:e.props.w,h:e.props.h}}),r.x+=e.props.w}return e.batch(()=>{let r=t.filter(t=>!e.getAsset(t.id));r.length&&e.createAssets(r),e.createShapes(i).select(...i.map(e=>e.id)),centerSelectionAroundPoint(e,n)}),i.map(e=>e.id)}function centerSelectionAroundPoint(e,t){let n=e.getViewportPageBounds(),r=e.getSelectionPageBounds();if(r){let n=r.center.sub(t);e.updateShapes(e.getSelectedShapes().map(t=>{let r=e.getShapeParentTransform(t).decompose().rotation,i=et.B.Rot(n,-r);return{id:t.id,type:t.type,x:t.x-i.x,y:t.y-i.y}}))}(r=e.getSelectionPageBounds())&&!n.contains(r)&&e.zoomToSelection()}function createEmptyBookmarkShape(e,t,n){let r={id:(0,S.F1)(),type:"bookmark",x:n.x-150,y:n.y-160,opacity:1,props:{assetId:null,url:t}};return e.batch(()=>{e.createShapes([r]).select(r.id),centerSelectionAroundPoint(e,n)}),e.getShape(r.id)}let Idle_Idle=class Idle_Idle extends te.n{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")};onKeyUp=e=>{if("Enter"===e.key){if(this.editor.getInstanceState().isReadonly)return null;let t=this.editor.getOnlySelectedShape();t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:t}))}}};let Pointing_Pointing=class Pointing_Pointing extends te.n{static id="pointing";shape;markId="";onEnter=()=>{this.didTimeout=!1;let e=this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{filter:e=>!e.isLocked&&this.editor.getShapeUtil(e).canBind(e),margin:0,hitInside:!0,renderingOnly:!0});e?this.editor.setHintingShapes([e.id]):this.createArrowShape(),this.startPreciseTimeout()};onExit=()=>{this.shape=void 0,this.editor.setHintingShapes([]),this.clearPreciseTimeout()};onPointerMove=()=>{if(this.editor.inputs.isDragging){if(this.shape||this.createArrowShape(),!this.shape)throw Error("expected shape");this.updateArrowShapeEndHandle(),this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,handle:this.editor.getShapeHandles(this.shape).find(e=>"end"===e.id),isCreating:!0,onInteractionEnd:"arrow"})}};onPointerUp=()=>{this.cancel()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.shape&&this.editor.bailToMark(this.markId),this.editor.setHintingShapes([]),this.parent.transition("idle")}createArrowShape(){let{originPagePoint:e}=this.editor.inputs,t=(0,S.F1)();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"arrow",x:e.x,y:e.y}]);let n=this.editor.getShape(t);if(!n)throw Error("expected shape");let r=this.editor.getShapeHandles(n);if(!r)throw Error("expected handles for arrow");let i=this.editor.getShapeUtil("arrow"),o=this.shape,a=r.find(e=>"start"===e.id),l=i.onHandleDrag?.(n,{handle:{...a,x:0,y:0},isPrecise:!0,initial:o});if(l){let e=l.props?.start;e?.type==="binding"&&this.editor.setHintingShapes([e.boundShapeId]),this.editor.updateShapes([l],{squashing:!0})}this.shape=this.editor.getShape(t),this.editor.select(t)}updateArrowShapeEndHandle(){let e=this.shape;if(!e)throw Error("expected shape");let t=this.editor.getShapeHandles(e);if(!t)throw Error("expected handles for arrow");let n={...e,props:{...e.props,end:{...e.props.end,x:0,y:0}}};{let r=this.editor.getShapeUtil("arrow"),i=this.shape,o=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint),a=t.find(e=>"end"===e.id),l=r.onHandleDrag?.(n,{handle:{...a,x:o.x,y:o.y},isPrecise:!1,initial:i});if(l){let e=l.props?.end;e?.type==="binding"&&this.editor.setHintingShapes([e.boundShapeId]),this.editor.updateShapes([l],{squashing:!0})}}{let e=this.editor.getShapeUtil("arrow"),r=this.shape,i=t.find(e=>"start"===e.id),o=e.onHandleDrag?.(n,{handle:{...i,x:0,y:0},isPrecise:this.didTimeout,initial:r});o&&this.editor.updateShapes([o],{squashing:!0})}this.shape=this.editor.getShape(e.id)}preciseTimeout=-1;didTimeout=!1;startPreciseTimeout(){this.preciseTimeout=window.setTimeout(()=>{this.getIsActive()&&(this.didTimeout=!0)},320)}clearPreciseTimeout(){clearTimeout(this.preciseTimeout)}};let ArrowShapeTool=class ArrowShapeTool extends te.n{static id="arrow";static initial="idle";static children=()=>[Idle_Idle,Pointing_Pointing];shapeType="arrow"};let Drawing=class Drawing extends te.n{static id="drawing";info={};initialShape;shapeType="highlight"===this.parent.id?"highlight":"draw";util=this.editor.getShapeUtil(this.shapeType);isPen=!1;segmentMode="free";didJustShiftClickToExtendPreviousShapeLine=!1;pagePointWhereCurrentSegmentChanged={};pagePointWhereNextSegmentChanged=null;lastRecordedPoint={};mergeNextPoint=!1;currentLineLength=0;canDraw=!1;markId=null;onEnter=e=>{this.markId=null,this.info=e,this.canDraw=!this.editor.getIsMenuOpen(),this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.canDraw&&this.startShape()};onPointerMove=()=>{let{editor:{inputs:e}}=this;if(this.isPen!==e.isPen){if(this.markId){this.editor.bailToMark(this.markId),this.startShape();return}}else!this.canDraw&&e.isDragging&&(this.startShape(),this.canDraw=!0);this.canDraw&&(e.isPen?et.B.Dist(e.currentPagePoint,this.lastRecordedPoint)>=1/this.editor.getZoomLevel()?(this.lastRecordedPoint=e.currentPagePoint.clone(),this.mergeNextPoint=!1):this.mergeNextPoint=!0:this.mergeNextPoint=!1,this.updateShapes())};onKeyDown=e=>{if("Shift"===e.key)switch(this.segmentMode){case"free":this.segmentMode="starting_straight",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_free":this.segmentMode="starting_straight"}this.updateShapes()};onKeyUp=e=>{if("Shift"===e.key)switch(this.editor.snaps.clearIndicators(),this.segmentMode){case"straight":this.segmentMode="starting_free",this.pagePointWhereNextSegmentChanged=this.editor.inputs.currentPagePoint.clone();break;case"starting_straight":this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free"}this.updateShapes()};onExit=()=>{this.editor.snaps.clearIndicators(),this.pagePointWhereCurrentSegmentChanged=this.editor.inputs.currentPagePoint.clone()};canClose(){return"highlight"!==this.shapeType}getIsClosed(e,t){if(!this.canClose())return!1;let n=tS[t],r=e[0].points[0],i=e[e.length-1],o=i.points[i.points.length-1];return r!==o&&this.currentLineLength>4*n&&et.B.Dist(r,o)<2*n}startShape(){let{inputs:{originPagePoint:e,isPen:t}}=this.editor;this.markId="draw start "+(0,eM.E)(),this.editor.mark(this.markId),this.isPen=t;let n=this.isPen?1.25*this.info.point.z:.5;if(this.segmentMode=this.editor.inputs.shiftKey?"straight":"free",this.didJustShiftClickToExtendPreviousShapeLine=!1,this.lastRecordedPoint=e.clone(),this.initialShape){let t=this.editor.getShape(this.initialShape.id);if(t&&"straight"===this.segmentMode){this.didJustShiftClickToExtendPreviousShapeLine=!0;let n=(0,v.Z$)(t.props.segments);if(!n)throw Error("Expected a previous segment!");let r=(0,v.Z$)(n.points);if(!r)throw Error("Expected a previous point!");let{x:i,y:o}=this.editor.getPointInShapeSpace(t,e).toFixed(),a=this.isPen?1.25*this.info.point.z:.5,l={type:this.segmentMode,points:[{x:r.x,y:r.y,z:+a.toFixed(2)},{x:i,y:o,z:+a.toFixed(2)}]},c=ea._.applyToPoint(this.editor.getShapePageTransform(t.id),r);this.pagePointWhereCurrentSegmentChanged=c,this.pagePointWhereNextSegmentChanged=null;let u=[...t.props.segments,l];this.currentLineLength=this.getLineLength(u);let d={id:t.id,type:this.shapeType,props:{segments:u}};this.canClose()&&(d.props.isClosed=this.getIsClosed(u,t.props.size)),this.editor.updateShapes([d]);return}}this.pagePointWhereCurrentSegmentChanged=e.clone();let r=(0,S.F1)();this.editor.createShapes([{id:r,type:this.shapeType,x:e.x,y:e.y,props:{isPen:this.isPen,segments:[{type:this.segmentMode,points:[{x:0,y:0,z:+n.toFixed(2)}]}]}}]),this.currentLineLength=0,this.initialShape=this.editor.getShape(r)}updateShapes(){let{inputs:e}=this.editor,{initialShape:t}=this;if(!t)return;let{id:n,props:{size:r}}=t,i=this.editor.getShape(n);if(!i)return;let{segments:o}=i.props,{x:a,y:l,z:c}=this.editor.getPointInShapeSpace(i,e.currentPagePoint).toFixed(),u={x:a,y:l,z:this.isPen?+(1.25*c).toFixed(2):.5};switch(this.segmentMode){case"starting_straight":{let{pagePointWhereNextSegmentChanged:t}=this;if(null===t)throw Error("We should have a point where the segment changed");let a=et.B.Dist(t,e.currentPagePoint)>_.Sk;if(a){let e;this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="straight";let t=(0,v.Z$)(o);if(!t)throw Error("Expected a previous segment!");let a=(0,v.Z$)(t.points);if(!a)throw Error("Expected a previous last point!");let l=this.editor.getPointInShapeSpace(i,this.pagePointWhereCurrentSegmentChanged).toFixed().toJson();if("straight"===t.type){this.currentLineLength+=et.B.Dist(a,l),e={type:"straight",points:[{...a},l]};let t=this.editor.getShapePageTransform(i);this.pagePointWhereCurrentSegmentChanged=ea._.applyToPoint(t,a)}else e={type:"straight",points:[l,u]};let c={id:n,type:this.shapeType,props:{segments:[...o,e]}};this.canClose()&&(c.props.isClosed=this.getIsClosed(o,r)),this.editor.updateShapes([c],{squashing:!0})}break}case"starting_free":{let{pagePointWhereNextSegmentChanged:t}=this;if(null===t)throw Error("We should have a point where the segment changed");let i=et.B.Dist(t,e.currentPagePoint)>_.Sk;if(i){this.pagePointWhereCurrentSegmentChanged=this.pagePointWhereNextSegmentChanged.clone(),this.pagePointWhereNextSegmentChanged=null,this.segmentMode="free";let e=o.slice(),t=e[e.length-1],i=(0,v.Z$)(t.points);if(!i)throw Error("No previous point!");let a={type:"free",points:[...et.B.PointsBetween(i,u,6).map(e=>e.toFixed().toJson())]},l=[...e,a];this.currentLineLength=this.getLineLength(l);let c={id:n,type:this.shapeType,props:{segments:l}};this.canClose()&&(c.props.isClosed=this.getIsClosed(l,r)),this.editor.updateShapes([c],{squashing:!0})}break}case"straight":{let e,t;let a=o.slice(),l=a[a.length-1],{pagePointWhereCurrentSegmentChanged:c}=this,{currentPagePoint:u,ctrlKey:d}=this.editor.inputs;if(!c)throw Error("We should have a point where the segment changed");let p=!1;this.didJustShiftClickToExtendPreviousShapeLine?this.editor.inputs.isDragging&&(p=!d,this.didJustShiftClickToExtendPreviousShapeLine=!1):p=!d;let h=this.editor.getPointInShapeSpace(i,u).toFixed().toJson(),g=!1,f=this.editor.user.getIsSnapMode()?!d:d;if(f&&a.length>2){let e;let n=8/this.editor.getZoomLevel();for(let r=0,i=o.length-2;r<i;r++){let i=o[r];if(!i)break;if("free"===i.type)continue;let a=i.points[0],l=(0,v.Z$)(i.points);if(!(a&&l))continue;let c=et.B.NearestPointOnLineSegment(a,l,h),u=et.B.Dist(c,h);if(u<n){e=c.toFixed().toJson(),n=u,t=i;break}}e&&(g=!0,h=e)}if(g&&t){let e=this.editor.getShapePageTransform(i),n=t.points[0],r=(0,v.Z$)(t.points);if(!r)throw Error("Expected a last point!");let o=ea._.applyToPoint(e,n),a=ea._.applyToPoint(e,r),l=ea._.applyToPoint(e,h);this.editor.snaps.setIndicators([{id:(0,eM.E)(),type:"points",points:[o,l,a]}])}else{if(this.editor.snaps.clearIndicators(),p){let t=et.B.Angle(c,u),n=(0,E.nD)(t,24),r=n-t;e=et.B.RotWith(u,c,r)}else e=u;h=this.editor.getPointInShapeSpace(i,e).toFixed().toJson()}this.currentLineLength+=et.B.Dist(l.points[0],h),a[a.length-1]={...l,type:"straight",points:[l.points[0],h]};let m={id:n,type:this.shapeType,props:{segments:a}};this.canClose()&&(m.props.isClosed=this.getIsClosed(o,r)),this.editor.updateShapes([m],{squashing:!0});break}case"free":{let e=o.slice(),t=e[e.length-1],i=[...t.points];if(i.length&&this.mergeNextPoint){let{z:e}=i[i.length-1];i[i.length-1]={x:u.x,y:u.y,z:e?Math.max(e,u.z):u.z}}else this.currentLineLength+=et.B.Dist(i[i.length-1],u),i.push(u);e[e.length-1]={...t,points:i},this.currentLineLength=this.getLineLength(e);let a={id:n,type:this.shapeType,props:{segments:e}};if(this.canClose()&&(a.props.isClosed=this.getIsClosed(e,r)),this.editor.updateShapes([a],{squashing:!0}),i.length>500){this.editor.updateShapes([{id:n,type:this.shapeType,props:{isComplete:!0}}]);let{currentPagePoint:e}=this.editor.inputs,t=(0,S.F1)();this.editor.createShapes([{id:t,type:this.shapeType,x:(0,E.FH)(e.x),y:(0,E.FH)(e.y),props:{isPen:this.isPen,segments:[{type:"free",points:[{x:0,y:0,z:this.isPen?+(1.25*c).toFixed():.5}]}]}}]),this.initialShape=(0,v.v4)(this.editor.getShape(t)),this.mergeNextPoint=!1,this.lastRecordedPoint=this.editor.inputs.currentPagePoint.clone(),this.currentLineLength=0}}}}getLineLength(e){let t=0;for(let n of e)for(let e=0;e<n.points.length-1;e++){let r=n.points[e],i=n.points[e+1];t+=et.B.Sub(i,r).len2()}return Math.sqrt(t)}onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.editor.inputs.isDragging||(this.markId&&this.editor.bailToMark(this.markId),this.cancel())};complete(){if(!this.canDraw){this.cancel();return}let{initialShape:e}=this;e&&(this.editor.updateShapes([{id:e.id,type:e.type,props:{isComplete:!0}}]),this.parent.transition("idle"))}cancel(){this.parent.transition("idle",this.info)}};let toolStates_Idle_Idle=class toolStates_Idle_Idle extends te.n{static id="idle";onPointerDown=e=>{this.parent.transition("drawing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}};let DrawShapeTool=class DrawShapeTool extends te.n{static id="draw";static initial="idle";static children=()=>[toolStates_Idle_Idle,Drawing];shapeType="draw";onExit=()=>{let e=this.children.drawing;e.initialShape=void 0}};let FrameShapeTool=class FrameShapeTool extends BaseBoxShapeTool{static id="frame";static initial="idle";shapeType="frame";onCreate=e=>{if(!e)return;let t=this.editor.getShapePageBounds(e),n=[],r=this.editor.getShapeAncestors(e).map(e=>e.id);this.editor.getSortedChildIdsForParent(e.parentId).map(i=>{let o=this.editor.getShape(i);if(!o||o.id===e.id||o.isLocked)return;let a=this.editor.getShapePageBounds(o);a&&t.contains(a)&&canEnclose(o,r,e)&&n.push(o.id)}),this.editor.reparentShapes(n,e.id),this.editor.getInstanceState().isToolLocked?this.editor.setCurrentTool("frame"):this.editor.setCurrentTool("select.idle")}};function canEnclose(e,t,n){return!t.includes(e.id)&&e.parentId===n.parentId}let geo_toolStates_Idle_Idle=class geo_toolStates_Idle_Idle extends te.n{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onKeyUp=e=>{if("Enter"===e.key){if(this.editor.getInstanceState().isReadonly)return null;let t=this.editor.getOnlySelectedShape();t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:t}))}};onCancel=()=>{this.editor.setCurrentTool("select")}};let toolStates_Pointing_Pointing=class toolStates_Pointing_Pointing extends te.n{static id="pointing";markId="";onPointerUp=()=>{this.complete()};onPointerMove=e=>{if(this.editor.inputs.isDragging){let{originPagePoint:t}=this.editor.inputs,n=(0,S.F1)();this.markId=`creating:${n}`,this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:"geo",x:t.x,y:t.y,props:{w:1,h:1,geo:this.editor.getStyleForNextShape(S.Zu)}}]).select(n).setCurrentTool("select.resizing",{...e,target:"selection",handle:"bottom_right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"geo"})}};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};complete(){let{originPagePoint:e}=this.editor.inputs,t=(0,S.F1)();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"geo",x:e.x,y:e.y,props:{geo:this.editor.getStyleForNextShape(S.Zu),w:1,h:1}}]);let n=this.editor.getShape(t);if(!n)return;let r="star"===n.props.geo?new eo.xu(0,0,200,190):"cloud"===n.props.geo?new eo.xu(0,0,300,180):new eo.xu(0,0,200,200),i=r.center,o=this.editor.getShapeParentTransform(n);o&&i.rot(-o.rotation()),this.editor.select(t),this.editor.updateShapes([{id:n.id,type:"geo",x:n.x-i.x,y:n.y-i.y,props:{geo:this.editor.getStyleForNextShape(S.Zu),w:r.width,h:r.height}}]),this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):this.editor.setCurrentTool("select",{})}cancel(){this.parent.transition("idle")}};let GeoShapeTool=class GeoShapeTool extends te.n{static id="geo";static initial="idle";static children=()=>[geo_toolStates_Idle_Idle,toolStates_Pointing_Pointing];shapeType="geo"};let HighlightShapeTool=class HighlightShapeTool extends te.n{static id="highlight";static initial="idle";static children=()=>[toolStates_Idle_Idle,Drawing];shapeType="highlight";onExit=()=>{let e=this.children.drawing;e.initialShape=void 0}};let line_toolStates_Idle_Idle=class line_toolStates_Idle_Idle extends te.n{static id="idle";shapeId="";onEnter=e=>{this.shapeId=e.shapeId,this.editor.setCursor({type:"cross",rotation:0})};onPointerDown=()=>{this.parent.transition("pointing",{shapeId:this.shapeId})};onCancel=()=>{this.editor.setCurrentTool("select")}};let line_toolStates_Pointing_Pointing=class line_toolStates_Pointing_Pointing extends te.n{static id="pointing";shape={};markId;onEnter=e=>{let{inputs:t}=this.editor,{currentPagePoint:n}=t;this.markId=void 0;let r=e.shapeId&&this.editor.getShape(e.shapeId);if(r&&t.shiftKey){this.markId=`creating:${r.id}`,this.editor.mark(this.markId),this.shape=r;let e=this.editor.getShapeHandles(this.shape);if(!e)return;let t=e.filter(e=>"vertex"===e.type).sort(v.hl),i=t[t.length-1],o=t[t.length-2],a=ea._.applyToPoint(this.editor.getShapeParentTransform(this.shape),new et.B(this.shape.x,this.shape.y)),l=et.B.Sub(n,a).addXY(.1,.1),c=(0,v.v4)(this.shape.props.points);if(2>et.B.Dist(i,o)||2>et.B.Dist(l,i))c[i.id]={id:i.id,index:i.index,x:l.x,y:l.y};else{let e=(0,v._L)(i.index);c[e]={id:e,index:e,x:l.x,y:l.y}}this.editor.updateShapes([{id:this.shape.id,type:this.shape.type,props:{points:c}}])}else{let e=(0,S.F1)();this.markId=`creating:${e}`,this.editor.mark(this.markId),this.editor.createShapes([{id:e,type:"line",x:n.x,y:n.y}]),this.editor.select(e),this.shape=this.editor.getShape(e)}};onPointerMove=()=>{if(this.shape&&this.editor.inputs.isDragging){let e=this.editor.getShapeHandles(this.shape);if(!e)throw this.markId&&this.editor.bailToMark(this.markId),Error("No handles found");let t=(0,v.Z$)(e);this.editor.setCurrentTool("select.dragging_handle",{shape:this.shape,isCreating:!0,handle:{...t,x:t.x-.1,y:t.y-.1},onInteractionEnd:"line"})}};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.parent.transition("idle"),this.markId&&this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators()};complete(){this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}cancel(){this.markId&&this.editor.bailToMark(this.markId),this.parent.transition("idle",{shapeId:this.shape.id}),this.editor.snaps.clearIndicators()}};let LineShapeTool=class LineShapeTool extends te.n{static id="line";static initial="idle";static children=()=>[line_toolStates_Idle_Idle,line_toolStates_Pointing_Pointing];shapeType="line"};let note_toolStates_Idle_Idle=class note_toolStates_Idle_Idle extends te.n{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onCancel=()=>{this.editor.setCurrentTool("select")}};let note_toolStates_Pointing_Pointing=class note_toolStates_Pointing_Pointing extends te.n{static id="pointing";dragged=!1;info={};wasFocusedOnEnter=!1;markId="";shape={};onEnter=()=>{this.wasFocusedOnEnter=!this.editor.getIsMenuOpen(),this.wasFocusedOnEnter&&(this.shape=this.createShape())};onPointerMove=e=>{this.editor.inputs.isDragging&&(this.wasFocusedOnEnter||(this.shape=this.createShape()),this.editor.setCurrentTool("select.translating",{...e,target:"shape",shape:this.shape,onInteractionEnd:"note",isCreating:!0,onCreate:()=>{this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape")}}))};onPointerUp=()=>{this.complete()};onInterrupt=()=>{this.cancel()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};complete(){this.wasFocusedOnEnter&&(this.editor.getInstanceState().isToolLocked?this.parent.transition("idle"):(this.editor.setEditingShape(this.shape.id),this.editor.setCurrentTool("select.editing_shape",{...this.info,target:"shape",shape:this.shape})))}cancel(){this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}createShape(){let{inputs:{originPagePoint:e}}=this.editor,t=(0,S.F1)();this.markId=`creating:${t}`,this.editor.mark(this.markId),this.editor.createShapes([{id:t,type:"note",x:e.x,y:e.y}]).select(t);let n=this.editor.getShape(t),r=this.editor.getShapeGeometry(n).bounds;return this.editor.updateShapes([{id:t,type:"note",x:n.x-r.width/2,y:n.y-r.height/2}]),this.editor.getShape(t)}};let NoteShapeTool=class NoteShapeTool extends te.n{static id="note";static initial="idle";static children=()=>[note_toolStates_Idle_Idle,note_toolStates_Pointing_Pointing];shapeType="note"};function updateHoveredId(e){let t;let n=e.getShapeAtPoint(e.inputs.currentPagePoint,{hitInside:!1,hitLabels:!1,margin:_.wM/e.getZoomLevel(),renderingOnly:!0});if(!n)return e.setHoveredShape(null);let r=e.getOutermostSelectableShape(n);return t=r===n?n:r.id===e.getFocusedGroupId()||e.getSelectedShapeIds().includes(r.id)?n:r,e.setHoveredShape(t.id)}let text_toolStates_Idle_Idle=class text_toolStates_Idle_Idle extends te.n{static id="idle";onPointerMove=e=>{switch(e.target){case"shape":case"canvas":updateHoveredId(this.editor)}};onPointerDown=e=>{this.parent.transition("pointing",e)};onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})};onKeyDown=e=>{if("Enter"===e.key){if(this.editor.getInstanceState().isReadonly)return null;let t=this.editor.getOnlySelectedShape();t&&this.editor.getShapeUtil(t).canEdit(t)&&(this.editor.setCurrentTool("select"),this.editor.setEditingShape(t.id),this.editor.root.getCurrent()?.transition("editing_shape",{...e,target:"shape",shape:t}))}};onCancel=()=>{this.editor.setCurrentTool("select")}};let text_toolStates_Pointing_Pointing=class text_toolStates_Pointing_Pointing extends te.n{static id="pointing";shape;markId="";onExit=()=>{this.editor.setHintingShapes([])};onPointerMove=e=>{if(this.editor.inputs.isDragging){let{inputs:{originPagePoint:t}}=this.editor,n=(0,S.F1)();if(this.markId=`creating:${n}`,this.editor.mark(this.markId),this.editor.createShapes([{id:n,type:"text",x:t.x,y:t.y,props:{text:"",autoSize:!1,w:20}}]),this.editor.select(n),this.shape=this.editor.getShape(n),!this.shape)return;let{shape:r}=this;this.editor.setCurrentTool("select.resizing",{...e,target:"selection",handle:"right",isCreating:!0,creationCursorOffset:{x:1,y:1},onInteractionEnd:"text",onCreate:()=>{this.editor.setEditingShape(r.id),this.editor.setCurrentTool("select.editing_shape")}})}};onPointerUp=()=>{this.complete()};onComplete=()=>{this.cancel()};onCancel=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.editor.mark("creating text shape");let e=(0,S.F1)(),{x:t,y:n}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:e,type:"text",x:t,y:n,props:{text:"",autoSize:!0}}]).select(e),this.editor.setEditingShape(e),this.editor.setCurrentTool("select"),this.editor.root.getCurrent()?.transition("editing_shape")}cancel(){this.parent.transition("idle"),this.editor.bailToMark(this.markId)}};let TextShapeTool=class TextShapeTool extends te.n{static id="text";static initial="idle";static children=()=>[text_toolStates_Idle_Idle,text_toolStates_Pointing_Pointing];shapeType="text"};let tD=[TextShapeTool,DrawShapeTool,GeoShapeTool,NoteShapeTool,LineShapeTool,FrameShapeTool,ArrowShapeTool,HighlightShapeTool];function useDefaultColorTheme(){return(0,S.y6)({isDarkMode:useIsDarkMode()})}let tO=P.memo(function({theme:e,d:t,color:n,fill:r}){switch(r){case"none":return null;case"solid":return(0,T.jsx)("path",{fill:e[n].semi,d:t});case"semi":return(0,T.jsx)("path",{fill:e.solid,d:t});case"pattern":return(0,T.jsx)(PatternFill,{theme:e,color:n,fill:r,d:t})}}),PatternFill=function({d:e,color:t,theme:n}){let r=(0,I.j)(),i=(0,b.Hg)("zoomLevel",()=>r.getZoomLevel(),[r]),o=.18>=r.getZoomLevel();return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("path",{fill:n[t].pattern,d:e}),(0,T.jsx)("path",{fill:o?n[t].semi:`url(#${_.iF[`${Math.ceil(i)}_${n.id}`]})`,d:e})]})};function getShapeFillSvg({d:e,color:t,fill:n,theme:r}){if("none"===n)return;if("pattern"===n){let n=document.createElementNS("http://www.w3.org/2000/svg","g"),i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d",e),i.setAttribute("fill",r[t].pattern);let o=document.createElementNS("http://www.w3.org/2000/svg","path");return o.setAttribute("d",e),o.setAttribute("fill","url(#hash_pattern)"),n.appendChild(i),n.appendChild(o),n}let i=document.createElementNS("http://www.w3.org/2000/svg","path");switch(i.setAttribute("d",e),n){case"semi":i.setAttribute("fill",r.solid);break;case"solid":i.setAttribute("fill",r[t].semi)}return i}function getSvgWithShapeFill(e,t){if(!t)return e;{let n=document.createElementNS("http://www.w3.org/2000/svg","g");return n.appendChild(t),n.appendChild(e),n}}function correctSpacesToNbsp(e){return e.replace(/\s/g,"\xa0")}function createTextSvgElementFromSpans(e,t,n){let{padding:r=0}=n,i=document.createElementNS("http://www.w3.org/2000/svg","text");if(i.setAttribute("font-size",n.fontSize+"px"),i.setAttribute("font-family",n.fontFamily),i.setAttribute("font-style",n.fontStyle),i.setAttribute("font-weight",n.fontWeight),i.setAttribute("line-height",n.lineHeight*n.fontSize+"px"),i.setAttribute("dominant-baseline","mathematical"),i.setAttribute("alignment-baseline","mathematical"),0===t.length)return i;let o=eo.xu.From(t[0].box);for(let{box:e}of t)o.union(e);let a=r+(n.offsetX??0),l=(n.offsetY??0)+n.fontSize/2+("start"===n.verticalTextAlign?r:"end"===n.verticalTextAlign?n.height-r-o.height:(Math.ceil(n.height)-o.height)/2),c=null;for(let{text:e,box:n}of t){let t=null!==c&&n.y>c;if(t){let e=document.createElementNS("http://www.w3.org/2000/svg","tspan");e.setAttribute("alignment-baseline","mathematical"),e.setAttribute("x",a+"px"),e.setAttribute("y",n.y+l+"px"),e.textContent="\n",i.appendChild(e)}let r=document.createElementNS("http://www.w3.org/2000/svg","tspan");r.setAttribute("alignment-baseline","mathematical"),r.setAttribute("x",n.x+a+"px"),r.setAttribute("y",n.y+l+"px");let o=correctSpacesToNbsp(e);r.textContent=o,i.appendChild(r),c=n.y}return n.stroke&&n.strokeWidth&&(i.setAttribute("stroke",n.stroke),i.setAttribute("stroke-width",n.strokeWidth+"px")),n.fill&&i.setAttribute("fill",n.fill),i}function getFontDefForExport(e){return{key:`${S.Y8.id}:${e}`,getElement:async()=>{let t=findFont(e);if(!t)return null;let n=t.$$_url,r=t.$$_fontface;if(!n||!r)return null;let i=await (await fetch(n)).blob(),o=await new Promise((e,t)=>{let n=new FileReader;n.onload=()=>e(n.result),n.onerror=t,n.readAsDataURL(i)}),a=r.replace(n,o),l=document.createElementNS("http://www.w3.org/2000/svg","style");return l.textContent=a,l}}}function findFont(e){let t=S.p6[e];for(let e of document.fonts)if(t.includes(e.family))return e;return null}function getFillDefForExport(e,t){return{key:`${S.Y8.id}:${e}`,getElement:async()=>{if("pattern"!==e)return null;let n=8/12,r=document.createElement("div");return r.innerHTML=`
				<svg>
					<defs>
						<mask id="hash_pattern_mask">
							<rect x="0" y="0" width="8" height="8" fill="white" />
							<g
								strokeLinecap="round"
								stroke="black"
							>
								<line x1="${1*n}" y1="${3*n}" x2="${3*n}" y2="${1*n}" />
								<line x1="${5*n}" y1="${7*n}" x2="${7*n}" y2="${5*n}" />
								<line x1="${9*n}" y1="${11*n}" x2="${11*n}" y2="${9*n}" />
							</g>
						</mask>
						<pattern
							id="hash_pattern"
							width="8"
							height="8"
							patternUnits="userSpaceOnUse"
						>
							<rect x="0" y="0" width="8" height="8" fill="${t.solid}" mask="url(#hash_pattern_mask)" />
						</pattern>
					</defs>
				</svg>
			`,Array.from(r.querySelectorAll("defs > *"))}}}function getFillDefForCanvas(){return{key:`${S.Y8.id}:pattern`,component:PatternFillDefForCanvas}}let generateImage=(e,t,n)=>new Promise((r,i)=>{let o=8*t*e,a=document.createElement("canvas");a.width=o,a.height=o;let l=a.getContext("2d");if(!l)return;l.fillStyle=n?"#212529":"#f8f9fa",l.fillRect(0,0,o,o),l.globalCompositeOperation="destination-out",l.lineCap="round",l.lineWidth=1.25*t*e;let c=8/12,s=n=>n*t*e;l.beginPath(),l.moveTo(s(1*c),s(3*c)),l.lineTo(s(3*c),s(1*c)),l.moveTo(s(5*c),s(7*c)),l.lineTo(s(7*c),s(5*c)),l.moveTo(s(9*c),s(11*c)),l.lineTo(s(11*c),s(9*c)),l.stroke(),a.toBlob(e=>{!e||$.throwToBlob.get()?i():r(e)})}),canvasBlob=(e,t)=>{let n=document.createElement("canvas");n.width=e[0],n.height=e[1];let r=n.getContext("2d");return r?(t(r),n.toDataURL()):""},getDefaultPatterns=()=>{let e=[];for(let t=1;t<=Math.ceil(_.sZ);t++){let n=canvasBlob([1,1],e=>{e.fillStyle=S.qi.lightMode.black.semi,e.fillRect(0,0,1,1)}),r=canvasBlob([1,1],e=>{e.fillStyle=S.qi.darkMode.black.semi,e.fillRect(0,0,1,1)});e.push({zoom:t,url:n,darkMode:!1}),e.push({zoom:t,url:r,darkMode:!0})}return e};function usePattern(){let e=(0,I.j)(),t=e.getInstanceState().devicePixelRatio,[n,r]=(0,P.useState)(!1),i=(0,P.useMemo)(()=>getDefaultPatterns(),[]),[o,a]=(0,P.useState)(i);(0,P.useEffect)(()=>{let e=[];for(let n=1;n<=Math.ceil(_.sZ);n++)e.push(generateImage(t,n,!1).then(e=>({zoom:n,url:URL.createObjectURL(e),darkMode:!1}))),e.push(generateImage(t,n,!0).then(e=>({zoom:n,url:URL.createObjectURL(e),darkMode:!0})));let n=!1;return Promise.all(e).then(e=>{n||(a(e),r(!0))}),()=>{n=!0,r(!1)}},[t]);let l=(0,T.jsx)(T.Fragment,{children:o.map(e=>{let t=e.zoom+(e.darkMode?"_dark":"_light");return(0,T.jsx)("pattern",{id:_.iF[t],width:8,height:8,patternUnits:"userSpaceOnUse",children:(0,T.jsx)("image",{href:e.url,width:8,height:8})},t)})});return{defs:l,isReady:n}}function PatternFillDefForCanvas(){let e=(0,I.j)(),t=(0,P.useRef)(null),{defs:n,isReady:r}=usePattern();return(0,P.useEffect)(()=>{if(r&&e.environment.isSafari){let e=findHtmlLayerParent(t.current);e&&requestAnimationFrame(()=>{e.style.display="none",requestAnimationFrame(()=>{e.style.display=""})})}},[e,r]),(0,T.jsx)("g",{ref:t,"data-testid":r?"ready-pattern-fill-defs":void 0,children:n})}function findHtmlLayerParent(e){return e.classList.contains("tl-html-layer")?e:e.parentElement?findHtmlLayerParent(e.parentElement):null}function getPerfectDashProps(e,t,n={}){let{closed:r=!1,snap:i=1,start:o="outset",end:a="outset",lengthRatio:l=2,style:c="dashed"}=n,u=0,d=0,p=1,h=0,g=0;switch(c){case"dashed":p=1,u=Math.min(t*l,e/4);break;case"dotted":u=t/(p=100);break;default:return{strokeDasharray:"none",strokeDashoffset:"none"}}return r||("outset"===o?(e+=u/2,g+=u/2):"skip"===o&&(e-=u,g-=u),"outset"===a?e+=u/2:"skip"!==a||(e-=u)),d=Math.floor(e/u/(2*p)),(d-=d%i)<3&&"dashed"===c?e/t<5?(u=e,d=1,h=0):(u=.333*e,h=.333*e):(u=e/(d=Math.max(d,3))/(2*p),r?(g=u/2,h=(e-d*u)/d):h=(e-d*u)/Math.max(1,d-1)),{strokeDasharray:[u,h].join(" "),strokeDashoffset:g.toString()}}let tB=new WeakMap;function getArrowLabelSize(e,t){let n=tB.get(t);if(n)return n;let r=e.getArrowInfo(t),i=0,o=0,a=r.isStraight?new ta.W({start:et.B.From(r.start.point),end:et.B.From(r.end.point)}):new Arc2d({center:et.B.Cast(r.handleArc.center),radius:r.handleArc.radius,start:et.B.Cast(r.start.point),end:et.B.Cast(r.end.point),sweepFlag:r.bodyArc.sweepFlag,largeArcFlag:r.bodyArc.largeArcFlag});if(t.props.text.trim()){let n=a.bounds,{w:r,h:l}=e.textMeasure.measureText(t.props.text,{...tw,fontFamily:tP[t.props.font],fontSize:tT[t.props.size],maxWidth:null});if(i=r,o=l,n.width>n.height){i=Math.max(Math.min(r,64),Math.min(n.width-64,r));let{w:a,h:l}=e.textMeasure.measureText(t.props.text,{...tw,fontFamily:tP[t.props.font],fontSize:tT[t.props.size],maxWidth:i});i=a,o=l}if(i>16*tT[t.props.size]){i=16*tT[t.props.size];let{w:n,h:r}=e.textMeasure.measureText(t.props.text,{...tw,fontFamily:tP[t.props.font],fontSize:tT[t.props.size],maxWidth:i});i=n,o=r}}let l=new et.B(i,o).addScalar(8.5);return tB.set(t,l),l}function getLabelToArrowPadding(e,t){let n=tS[t.props.size],r=20+(n-tS.s)*2+(n===tS.xl?20:0);return r}function getStraightArrowLabelRange(e,t,n){let r=getArrowLabelSize(e,t),i=getLabelToArrowPadding(e,t),o=et.B.Nudge(n.start.point,n.end.point,i),a=et.B.Nudge(n.end.point,n.start.point,i),l=(0,tr.qZ)(o,a,eo.xu.FromCenter(n.middle,r).corners);if(!l||2!==l.length)return{start:.5,end:.5};let[c,u]=l;et.B.Dist2(c,o)>et.B.Dist2(u,o)&&([u,c]=l);let d=o.add(et.B.Sub(n.middle,c)),p=a.add(et.B.Sub(n.middle,u)),h=et.B.Dist(n.start.point,d)/n.length,g=et.B.Dist(n.start.point,p)/n.length;return{start:h,end:g}}function getCurvedArrowLabelRange(e,t,n){let r=getArrowLabelSize(e,t),i=getLabelToArrowPadding(e,t),o=Math.sign(t.props.bend),a=i/n.handleArc.radius*o,l=et.B.Angle(n.bodyArc.center,n.start.point)-a,c=et.B.Angle(n.bodyArc.center,n.end.point)+a,u=(0,E.XD)(n.bodyArc.center,n.bodyArc.radius,l),d=(0,E.XD)(n.bodyArc.center,n.bodyArc.radius,c),p=[],h=intersectArcPolygon(n.bodyArc.center,n.bodyArc.radius,l,c,o,eo.xu.FromCenter(u,r).corners);p.push(new ts.w({points:eo.xu.FromCenter(u,r).corners,debugColor:"lime",isFilled:!1,ignore:!0}));let g=intersectArcPolygon(n.bodyArc.center,n.bodyArc.radius,l,c,o,eo.xu.FromCenter(d,r).corners);for(let e of(p.push(new ts.w({points:eo.xu.FromCenter(d,r).corners,debugColor:"lime",isFilled:!1,ignore:!0})),[...h??[],...g??[],u,d]))p.push(new Circle2d({x:e.x-3,y:e.y-3,radius:3,isFilled:!1,debugColor:"magenta",ignore:!0}));let f=(h&&furthest(n.start.point,h))??n.middle,m=(g&&furthest(n.end.point,g))??n.middle,y=et.B.Angle(n.bodyArc.center,n.start.point),b=et.B.Angle(n.bodyArc.center,n.end.point),w=et.B.Angle(n.bodyArc.center,f),S=et.B.Angle(n.bodyArc.center,m);if((0,E.mR)(y,w,o)>(0,E.mR)(y,S,o))return{start:.5,end:.5,dbg:p};let v=(0,E.mR)(y,b,o),x=(0,E.mR)(y,w,o)/v,T=(0,E.mR)(y,S,o)/v;return{start:x,end:T,dbg:p}}function getArrowLabelPosition(e,t){let n;let r=[],i=e.getArrowInfo(t),o="none"!==i.start.arrowhead,a="none"!==i.end.arrowhead;if(i.isStraight){let r=getStraightArrowLabelRange(e,t,i),l=(0,E.uZ)(t.props.labelPosition,o?r.start:0,a?r.end:1);l=l>=.48&&l<=.52?.5:l,n=et.B.Lrp(i.start.point,i.end.point,l)}else{let l=getCurvedArrowLabelRange(e,t,i);l.dbg&&r.push(...l.dbg);let c=(0,E.uZ)(t.props.labelPosition,o?l.start:0,a?l.end:1);c=c>=.48&&c<=.52?.5:c;let u=interpolateArcAngles(et.B.Angle(i.bodyArc.center,i.start.point),et.B.Angle(i.bodyArc.center,i.end.point),Math.sign(t.props.bend),c);n=(0,E.XD)(i.bodyArc.center,i.bodyArc.radius,u)}let l=getArrowLabelSize(e,t);return{box:eo.xu.FromCenter(n,l),debugGeom:r}}function intersectArcPolygon(e,t,n,r,i,o){let a=(0,tr.h9)(e,t,o),l=(0,E.mR)(n,r,i);return a?.filter(t=>{let r=E.mR(n,et.B.Angle(e,t),i);return r>=0&&r<=l})}function furthest(e,t){let n=null,r=-1/0;for(let i of t){let t=et.B.Dist2(e,i);t>r&&(n=i,r=t)}return n}function interpolateArcAngles(e,t,n,r){let i=(0,E.mR)(e,t,n);return e+-(i*r*n*1)}function getArrowPoints(e,t,n){let r;let i="end"===t?e.end.point:e.start.point,o="end"===t?e.start.point:e.end.point,a=e.isStraight?et.B.Dist(o,i):Math.abs(e.bodyArc.length),l=Math.max(Math.min(a/5,3*n),n);if(e.isStraight)r=et.B.Nudge(i,o,l);else{let n=(0,tr.bO)(i,l,e.handleArc.center,e.handleArc.radius);r="end"===t?e.handleArc.sweepFlag?n[0]:n[1]:e.handleArc.sweepFlag?n[1]:n[0]}return et.B.IsNaN(r)&&(r=e.start.point),{point:i,int:r}}function getArrowhead({point:e,int:t}){let n=et.B.RotWith(t,e,E.PI/6),r=et.B.RotWith(t,e,-E.PI/6);return`M ${n.x} ${n.y} L ${e.x} ${e.y} L ${r.x} ${r.y}`}function getTriangleHead({point:e,int:t}){let n=et.B.RotWith(t,e,E.PI/6),r=et.B.RotWith(t,e,-E.PI/6);return`M ${n.x} ${n.y} L ${e.x} ${e.y} L ${r.x} ${r.y} Z`}function getInvertedTriangleHead({point:e,int:t}){let n=et.B.Sub(t,e).div(2),r=et.B.Add(e,et.B.Rot(n,E.pj)),i=et.B.Sub(e,et.B.Rot(n,E.pj));return`M ${r.x} ${r.y} L ${t.x} ${t.y} L ${i.x} ${i.y} Z`}function getDotHead({point:e,int:t}){let n=et.B.Lrp(e,t,.45),r=et.B.Dist(n,e);return`M ${n.x-r},${n.y}
  a ${r},${r} 0 1,0 ${2*r},0
  a ${r},${r} 0 1,0 -${2*r},0 `}function getDiamondHead({point:e,int:t}){let n=et.B.Lrp(e,t,.75),r=et.B.RotWith(n,e,E.PI/4),i=et.B.RotWith(n,e,-E.PI/4),o=et.B.Lrp(r,i,.5);return o.add(et.B.Sub(o,e)),`M ${o.x} ${o.y} L ${r.x} ${r.y} ${e.x} ${e.y} L ${i.x} ${i.y} Z`}function getSquareHead({int:e,point:t}){let n=et.B.Lrp(t,e,.85),r=et.B.Sub(n,t).div(2),i=et.B.Add(t,et.B.Rot(r,E.pj)),o=et.B.Sub(t,et.B.Rot(r,E.pj)),a=et.B.Add(n,et.B.Rot(r,E.pj)),l=et.B.Sub(n,et.B.Rot(r,E.pj));return`M ${i.x} ${i.y} L ${a.x} ${a.y} L ${l.x} ${l.y} L ${o.x} ${o.y} Z`}function getBarHead({int:e,point:t}){let n=et.B.Sub(e,t).div(2),r=et.B.Add(t,et.B.Rot(n,E.pj)),i=et.B.Sub(t,et.B.Rot(n,E.pj));return`M ${r.x} ${r.y} L ${i.x} ${i.y}`}function getArrowheadPathForType(e,t,n){let r="end"===t?e.end.arrowhead:e.start.arrowhead;if("none"===r)return;let i=getArrowPoints(e,t,n);if(i){switch(r){case"bar":return getBarHead(i);case"square":return getSquareHead(i);case"diamond":return getDiamondHead(i);case"dot":return getDotHead(i);case"inverted":return getInvertedTriangleHead(i);case"arrow":return getArrowhead(i);case"triangle":return getTriangleHead(i)}return""}}function getCurvedArrowHandlePath(e){let{start:t,end:n,handleArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=e;return`M${t.handle.x},${t.handle.y} A${r} ${r} 0 ${i} ${o} ${n.handle.x},${n.handle.y}`}function getSolidCurvedArrowPath(e){let{start:t,end:n,bodyArc:{radius:r,largeArcFlag:i,sweepFlag:o}}=e;return`M${t.point.x},${t.point.y} A${r} ${r} 0 ${i} ${o} ${n.point.x},${n.point.y}`}function getArrowPath(e,t){return`M${e.x},${e.y}L${t.x},${t.y}`}function getStraightArrowHandlePath(e){return getArrowPath(e.start.handle,e.end.handle)}function getSolidStraightArrowPath(e){return getArrowPath(e.start.point,e.end.point)}function useEditableText(e,t,n){let r=(0,I.j)(),i=(0,P.useRef)(null),o=(0,P.useRef)(!1),a=(0,P.useRef)(),l=(0,b.Hg)("isEditing",()=>r.getEditingShapeId()===e,[r,e]);(0,P.useEffect)(()=>{let e=i.current;e&&l&&document.activeElement!==e&&e.focus()},[l]);let c=(0,P.useCallback)(()=>{let t=o.current;o.current=!1,requestAnimationFrame(()=>{let n=i.current;if(!n)return;let o=r.getShape(e);o&&(n.value=o.props.text,n.value.length&&!t&&n.select())})},[r,e]),u=(0,P.useCallback)(()=>{let t=a.current;requestAnimationFrame(()=>{let n=i.current,a=r.getEditingShapeId();if(n&&a){if(a===e){if(t){if(t.length){o.current=!0,n.focus();let e=window.getSelection();e&&t.forEach(t=>e.addRange(t))}else n.focus()}else n.focus()}}else window.getSelection()?.removeAllRanges(),r.complete()})},[r,e]),d=(0,P.useCallback)(e=>{if(l)switch(e.key){case"Enter":(e.ctrlKey||e.metaKey)&&r.complete();break;case"Tab":preventDefault(e),e.shiftKey?TextHelpers.unindent(e.currentTarget):TextHelpers.indent(e.currentTarget)}},[r,l]),p=(0,P.useCallback)(n=>{if(!l)return;let i=TextHelpers.normalizeText(n.currentTarget.value),o=i.replace(/\t/g,"  ");if(o!==i){let e=n.currentTarget.selectionStart;n.currentTarget.value=o,n.currentTarget.selectionStart=e+(o.length-i.length),n.currentTarget.selectionEnd=e+(o.length-i.length),i=o}r.updateShapes([{id:e,type:t,props:{text:i}}])},[r,e,t,l]),h=0===n.trim().length;(0,P.useEffect)(()=>{if(!l)return;let e=i.current;if(e){let updateSelection2=function(){let e=window.getSelection?.();if(e&&"None"!==e.type){let t=[];if(e)for(let n=0;n<e.rangeCount;n++)t.push(e.getRangeAt?.(n));a.current=t}};return document.addEventListener("selectionchange",updateSelection2),()=>{document.removeEventListener("selectionchange",updateSelection2)}}},[l]);let g=(0,P.useCallback)(t=>{r.dispatch({...getPointerInfo(t),type:"pointer",name:"pointer_down",target:"shape",shape:r.getShape(e)}),stopEventPropagation(t)},[r,e]);return{rInput:i,isEditing:l,handleFocus:c,handleBlur:u,handleKeyDown:d,handleChange:p,handleInputPointerDown:g,handleDoubleClick:stopEventPropagation,isEmpty:h}}let tF=P.memo(function({id:e,text:t,size:n,font:r,position:i,width:o,labelColor:a}){let{rInput:l,isEditing:c,handleFocus:u,handleBlur:d,handleKeyDown:p,handleChange:h,isEmpty:g,handleInputPointerDown:f,handleDoubleClick:m}=useEditableText(e,"arrow",t),y=TextHelpers.normalizeTextForDom(t),b=y.trim().length>0;return c||b?(0,T.jsx)("div",{className:"tl-arrow-label","data-font":r,"data-align":"center","data-hastext":!g,"data-isediting":c,style:{textAlign:"center",fontSize:tT[n],lineHeight:tT[n]*tw.lineHeight+"px",transform:`translate(${i.x}px, ${i.y}px)`,color:a},children:(0,T.jsxs)("div",{className:"tl-arrow-label__inner",children:[(0,T.jsx)("p",{style:{width:o||"9px"},children:t?TextHelpers.normalizeTextForDom(t):" "}),c&&(0,T.jsx)("textarea",{ref:l,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:t,onFocus:u,onChange:h,onKeyDown:p,onBlur:d,onTouchEnd:stopEventPropagation,onContextMenu:stopEventPropagation,onPointerDown:f,onDoubleClick:m})]})}):null}),tU=0;var tL=((a=tL||{}).START="start",a.MIDDLE="middle",a.END="end",a);let ArrowShapeUtil=class ArrowShapeUtil extends e8.E{static type="arrow";static props=S.si;static migrations=S.Vm;canEdit=()=>!0;canBind=()=>!1;canSnap=()=>!1;hideResizeHandles=()=>!0;hideRotateHandle=()=>!0;hideSelectionBoundsBg=()=>!0;hideSelectionBoundsFg=()=>!0;getDefaultProps(){return{dash:"draw",size:"m",fill:"none",color:"black",labelColor:"black",bend:0,start:{type:"point",x:0,y:0},end:{type:"point",x:2,y:0},arrowheadStart:"none",arrowheadEnd:"arrow",text:"",labelPosition:.5,font:"draw"}}getGeometry(e){let t;let n=this.editor.getArrowInfo(e),r=[],i=n.isStraight?new ta.W({start:et.B.From(n.start.point),end:et.B.From(n.end.point)}):new Arc2d({center:et.B.Cast(n.handleArc.center),radius:n.handleArc.radius,start:et.B.Cast(n.start.point),end:et.B.Cast(n.end.point),sweepFlag:n.bodyArc.sweepFlag,largeArcFlag:n.bodyArc.largeArcFlag});if(e.props.text.trim()){let n=getArrowLabelPosition(this.editor,e);r.push(...n.debugGeom),t=new e4.z({x:n.box.x,y:n.box.y,width:n.box.w,height:n.box.h,isFilled:!0,isLabel:!0})}return new es.m({children:[...t?[i,t]:[i],...r]})}getLength(e){let t=this.editor.getArrowInfo(e);return t.isStraight?et.B.Dist(t.start.handle,t.end.handle):Math.abs(t.handleArc.length)}getHandles(e){let t=this.editor.getArrowInfo(e);return[{id:"start",type:"vertex",index:"a0",x:t.start.handle.x,y:t.start.handle.y,canBind:!0},{id:"middle",type:"virtual",index:"a2",x:t.middle.x,y:t.middle.y,canBind:!1},{id:"end",type:"vertex",index:"a3",x:t.end.handle.x,y:t.end.handle.y,canBind:!0}].filter(Boolean)}onHandleDrag=(e,{handle:t,isPrecise:n})=>{let r=t.id;if("middle"===r){let{start:n,end:r}=(0,e9.Qs)(this.editor,e),i=et.B.Sub(r,n),o=et.B.Per(i),a=et.B.Med(r,n),l=et.B.Sub(a,o),c=et.B.Add(a,o),u=et.B.NearestPointOnLineSegment(l,c,t,!1),d=et.B.Dist(u,a);return et.B.Clockwise(u,r,a)&&(d*=-1),{id:e.id,type:e.type,props:{bend:d}}}let i=(0,v.p$)(e);if(this.editor.inputs.ctrlKey)return i.props[r]={type:"point",x:t.x,y:t.y},i;let o=this.editor.getShapePageTransform(e.id).applyToPoint(t),a=this.editor.getShapeAtPoint(o,{hitInside:!0,hitFrameInside:!0,margin:0,filter:e=>!e.isLocked&&this.editor.getShapeUtil(e).canBind(e)});if(!a)return i.props[r]={type:"point",x:t.x,y:t.y},i;let l=this.editor.getShapeGeometry(a),c=eo.xu.ZeroFix(l.bounds),u=this.editor.getShapePageTransform(i.id),d=u.applyToPoint(t),p=this.editor.getPointInShapeSpace(a,d),h=n;if(!h){let e=i.props[r];("point"===e.type||"binding"===e.type&&a.id!==e.boundShapeId)&&(h=.5>this.editor.inputs.pointerVelocity.len())}if(!n){l.isClosed||(h=!0);let e=i.props["start"===r?"end":"start"];"binding"===e.type&&a.id===e.boundShapeId&&e.isPrecise&&(h=!0)}let g={x:(p.x-c.minX)/c.width,y:(p.y-c.minY)/c.height};return h&&et.B.Dist(p,c.center)<Math.max(4,Math.min(.15*Math.min(c.width,c.height),16))/this.editor.getZoomLevel()&&(g.x=.5,g.y=.5),i.props[r]={type:"binding",boundShapeId:a.id,normalizedAnchor:g,isPrecise:h,isExact:this.editor.inputs.altKey},"binding"===i.props.start.type&&"binding"===i.props.end.type&&i.props.start.boundShapeId===i.props.end.boundShapeId&&et.B.Equals(i.props.start.normalizedAnchor,i.props.end.normalizedAnchor)&&(i.props.end.normalizedAnchor.x+=.05),i};onTranslateStart=e=>{let t="binding"===e.props.start.type?e.props.start.boundShapeId:null,n="binding"===e.props.end.type?e.props.end.boundShapeId:null,r=(0,e9.Qs)(this.editor,e),i=this.editor.getShapePageTransform(e.id),o=this.editor.getSelectedShapeIds();if(t&&(o.includes(t)||this.editor.isAncestorSelected(t))||n&&(o.includes(n)||this.editor.isAncestorSelected(n)))return;let a=e;for(let t of(tR.set(e,{pagePosition:i.applyToPoint(e),terminalBindings:(0,v.Fm)(r,(t,n)=>{let r=e.props[t];return"binding"!==r.type?null:{binding:r,shapePosition:n,pagePosition:i.applyToPoint(n)}})}),["start","end"])){let n=e.props[t];"binding"===n.type&&(a={...e,props:{...e.props,[t]:{...n,isPrecise:!0}}})}return a};onTranslate=(e,t)=>{let n=tR.get(e);if(!n)return;let r=this.editor.getShapePageTransform(t.id),i=et.B.Sub(r.applyToPoint(t),n.pagePosition),o=t;for(let[e,t]of(0,v.EP)(n.terminalBindings)){if(!t)continue;let n=et.B.Add(t.pagePosition,et.B.Mul(i,.5)),r=this.editor.getShapeAtPoint(n,{hitInside:!0,hitFrameInside:!0,margin:0,filter:e=>!e.isLocked&&this.editor.getShapeUtil(e).canBind(e)});if(r?.id===t.binding.boundShapeId){let i=eo.xu.ZeroFix(this.editor.getShapeGeometry(r).bounds),a=this.editor.getPointInShapeSpace(r,n),l={x:(a.x-i.minX)/i.width,y:(a.y-i.minY)/i.height};o={...o,props:{...o.props,[e]:{...t.binding,isPrecise:!0,normalizedAnchor:l}}}}else o={...o,props:{...o.props,[e]:{type:"point",x:t.shapePosition.x,y:t.shapePosition.y}}}}return o};onResize=(e,t)=>{let{scaleX:n,scaleY:r}=t,i=(0,e9.Qs)(this.editor,e),{start:o,end:a}=(0,v.p$)(e.props),{bend:l}=e.props;"point"===o.type&&(o.x=i.start.x*n,o.y=i.start.y*r),"point"===a.type&&(a.x=i.end.x*n,a.y=i.end.y*r);let c=Math.abs(n),u=Math.abs(r);n<0&&r>=0?(0!==l&&(l*=-1*Math.max(c,u)),"binding"===o.type&&(o.normalizedAnchor.x=1-o.normalizedAnchor.x),"binding"===a.type&&(a.normalizedAnchor.x=1-a.normalizedAnchor.x)):n>=0&&r<0?(0!==l&&(l*=-1*Math.max(c,u)),"binding"===o.type&&(o.normalizedAnchor.y=1-o.normalizedAnchor.y),"binding"===a.type&&(a.normalizedAnchor.y=1-a.normalizedAnchor.y)):n>=0&&r>=0?0!==l&&(l*=Math.max(c,u)):n<0&&r<0&&(0!==l&&(l*=Math.max(c,u)),"binding"===o.type&&(o.normalizedAnchor.x=1-o.normalizedAnchor.x,o.normalizedAnchor.y=1-o.normalizedAnchor.y),"binding"===a.type&&(a.normalizedAnchor.x=1-a.normalizedAnchor.x,a.normalizedAnchor.y=1-a.normalizedAnchor.y));let d={props:{start:o,end:a,bend:l}};return d};onDoubleClickHandle=(e,t)=>{switch(t.id){case"start":return{id:e.id,type:e.type,props:{...e.props,arrowheadStart:"none"===e.props.arrowheadStart?"arrow":"none"}};case"end":return{id:e.id,type:e.type,props:{...e.props,arrowheadEnd:"none"===e.props.arrowheadEnd?"arrow":"none"}}}};component(e){let t=useDefaultColorTheme(),n=this.editor.getOnlySelectedShape(),r=this.editor.isInAny("select.idle","select.pointing_handle","select.dragging_handle","select.translating","arrow.dragging")&&!this.editor.getInstanceState().isReadonly,i=this.editor.getArrowInfo(e),o=eo.xu.ZeroFix(this.editor.getShapeGeometry(e).bounds),a=P.useMemo(()=>this.editor.environment.isSafari?tU+=1:0,[e]);if(!i?.isValid)return null;let l=tS[e.props.size],c=i.start.arrowhead&&getArrowheadPathForType(i,"start",l),u=i.end.arrowhead&&getArrowheadPathForType(i,"end",l),d=i.isStraight?getSolidStraightArrowPath(i):getSolidCurvedArrowPath(i),p=null;if(n===e&&r){let{strokeDasharray:t,strokeDashoffset:n}=getPerfectDashProps(this.getLength(e),2,{end:"skip",start:"skip",lengthRatio:2.5});p="binding"===e.props.start.type||"binding"===e.props.end.type?(0,T.jsx)("path",{className:"tl-arrow-hint",d:i.isStraight?getStraightArrowHandlePath(i):getCurvedArrowHandlePath(i),strokeDasharray:t,strokeDashoffset:n,strokeWidth:2,markerStart:"binding"===e.props.start.type?e.props.start.isExact?"":e.props.start.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",markerEnd:"binding"===e.props.end.type?e.props.end.isExact?"":e.props.end.isPrecise?"url(#arrowhead-cross)":"url(#arrowhead-dot)":"",opacity:.16}):null}let{strokeDasharray:h,strokeDashoffset:g}=getPerfectDashProps(i.isStraight?i.length:Math.abs(i.bodyArc.length),l,{style:e.props.dash}),f=getArrowLabelPosition(this.editor,e),m=!("none"===i.start.arrowhead||"arrow"===i.start.arrowhead),y=!("none"===i.end.arrowhead||"arrow"===i.end.arrowhead),b=(e.id+"_clip_"+a).replace(":","_");return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(e3.g,{id:e.id,style:{minWidth:50,minHeight:50},children:[(0,T.jsx)("defs",{children:(0,T.jsxs)("mask",{id:b,children:[(0,T.jsx)("rect",{x:(0,E.$Z)(-100+o.minX),y:(0,E.$Z)(-100+o.minY),width:(0,E.$Z)(o.width+200),height:(0,E.$Z)(o.height+200),fill:"white"}),e.props.text.trim()&&(0,T.jsx)("rect",{x:f.box.x,y:f.box.y,width:f.box.w,height:f.box.h,fill:"black",rx:4,ry:4}),c&&m&&(0,T.jsx)("path",{d:c,fill:"arrow"===i.start.arrowhead?"none":"black",stroke:"none"}),u&&y&&(0,T.jsx)("path",{d:u,fill:"arrow"===i.end.arrowhead?"none":"black",stroke:"none"})]})}),(0,T.jsxs)("g",{fill:"none",stroke:t[e.props.color].solid,strokeWidth:l,strokeLinejoin:"round",strokeLinecap:"round",pointerEvents:"none",children:[p,(0,T.jsxs)("g",{mask:`url(#${b})`,children:[(0,T.jsx)("rect",{x:(0,E.$Z)(o.minX-100),y:(0,E.$Z)(o.minY-100),width:(0,E.$Z)(o.width+200),height:(0,E.$Z)(o.height+200),opacity:0}),(0,T.jsx)("path",{d:d,strokeDasharray:h,strokeDashoffset:g})]}),c&&m&&"none"!==e.props.fill&&(0,T.jsx)(tO,{theme:t,d:c,color:e.props.color,fill:e.props.fill}),u&&y&&"none"!==e.props.fill&&(0,T.jsx)(tO,{theme:t,d:u,color:e.props.color,fill:e.props.fill}),c&&(0,T.jsx)("path",{d:c}),u&&(0,T.jsx)("path",{d:u})]})]}),(0,T.jsx)(tF,{id:e.id,text:e.props.text,font:e.props.font,size:e.props.size,position:f.box.center,width:f.box.w,labelColor:t[e.props.labelColor].solid})]})}indicator(e){let{start:t,end:n}=(0,e9.Qs)(this.editor,e),r=this.editor.getArrowInfo(e),i=this.editor.getShapeGeometry(e),o=i.bounds,a=e.props.text.trim()?i.children[1]:null,l=useIsEditing(e.id);if(!r||et.B.Equals(t,n))return null;let c=tS[e.props.size],u=r.start.arrowhead&&getArrowheadPathForType(r,"start",c),d=r.end.arrowhead&&getArrowheadPathForType(r,"end",c),p=r.isStraight?getSolidStraightArrowPath(r):getSolidCurvedArrowPath(r),h=u&&"arrow"!==r.start.arrowhead||d&&"arrow"!==r.end.arrowhead||!!a,g=(e.id+"_clip").replace(":","_");return l&&a?(0,T.jsx)("rect",{x:(0,E.$Z)(a.x),y:(0,E.$Z)(a.y),width:a.w,height:a.h,rx:3.5,ry:3.5}):(0,T.jsxs)("g",{children:[h&&(0,T.jsx)("defs",{children:(0,T.jsxs)("mask",{id:g,children:[(0,T.jsx)("rect",{x:o.minX-100,y:o.minY-100,width:o.w+200,height:o.h+200,fill:"white"}),a&&(0,T.jsx)("rect",{x:(0,E.$Z)(a.x),y:(0,E.$Z)(a.y),width:a.w,height:a.h,fill:"black",rx:3.5,ry:3.5}),u&&(0,T.jsx)("path",{d:u,fill:"arrow"===r.start.arrowhead?"none":"black",stroke:"none"}),d&&(0,T.jsx)("path",{d:d,fill:"arrow"===r.end.arrowhead?"none":"black",stroke:"none"})]})}),(0,T.jsxs)("g",{...h?{mask:`url(#${g})`}:void 0,children:[h&&(0,T.jsx)("rect",{x:o.minX-100,y:o.minY-100,width:o.width+200,height:o.height+200,opacity:0}),(0,T.jsx)("path",{d:p})]}),u&&(0,T.jsx)("path",{d:u}),d&&(0,T.jsx)("path",{d:d}),a&&(0,T.jsx)("rect",{x:(0,E.$Z)(a.x),y:(0,E.$Z)(a.y),width:a.w,height:a.h,rx:3.5,ry:3.5})]})}onEditEnd=e=>{let{id:t,type:n,props:{text:r}}=e;r.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])};toSvg(e,t){let n=(0,S.y6)({isDarkMode:t.isDarkMode});t.addExportDef(getFillDefForExport(e.props.fill,n));let r=n[e.props.color].solid,i=this.editor.getArrowInfo(e),o=tS[e.props.size],a=document.createElementNS("http://www.w3.org/2000/svg","g");if(!i)return a;let l=i.start.arrowhead&&getArrowheadPathForType(i,"start",o),c=i.end.arrowhead&&getArrowheadPathForType(i,"end",o),u=this.editor.getShapeGeometry(e),d=u.bounds,p=e.props.text.trim()?u.children[1]:null,h=(e.id+"_clip").replace(":","_");if(l||c||p){let e=document.createElementNS("http://www.w3.org/2000/svg","defs"),t=document.createElementNS("http://www.w3.org/2000/svg","mask");t.id=h;let n=document.createElementNS("http://www.w3.org/2000/svg","rect");if(n.setAttribute("x",d.minX-100+""),n.setAttribute("y",d.minY-100+""),n.setAttribute("width",d.width+200+""),n.setAttribute("height",d.height+200+""),n.setAttribute("fill","white"),t.appendChild(n),l&&t.appendChild(getArrowheadSvgMask(l,i.start.arrowhead)),c&&t.appendChild(getArrowheadSvgMask(c,i.end.arrowhead)),p){let e=document.createElementNS("http://www.w3.org/2000/svg","rect");e.setAttribute("x",p.x+""),e.setAttribute("y",p.y+""),e.setAttribute("width",p.w+""),e.setAttribute("height",p.h+""),e.setAttribute("fill","black"),t.appendChild(e)}e.appendChild(t),a.appendChild(e)}let g=document.createElementNS("http://www.w3.org/2000/svg","g");g.setAttribute("mask",`url(#${h})`),a.appendChild(g);let f=document.createElementNS("http://www.w3.org/2000/svg","rect");f.setAttribute("x","-100"),f.setAttribute("y","-100"),f.setAttribute("width",d.width+200+""),f.setAttribute("height",d.height+200+""),f.setAttribute("fill","transparent"),f.setAttribute("stroke","none"),g.appendChild(f);let m=getArrowSvgPath(i.isStraight?getSolidStraightArrowPath(i):getSolidCurvedArrowPath(i),r,o),{strokeDasharray:y,strokeDashoffset:b}=getPerfectDashProps(i.isStraight?i.length:Math.abs(i.bodyArc.length),o,{style:e.props.dash});if(m.setAttribute("stroke-dasharray",y),m.setAttribute("stroke-dashoffset",b),g.appendChild(m),l&&a.appendChild(getArrowheadSvgPath(l,e.props.color,o,"arrow"===e.props.arrowheadStart?"none":e.props.fill,n)),c&&a.appendChild(getArrowheadSvgPath(c,e.props.color,o,"arrow"===e.props.arrowheadEnd?"none":e.props.fill,n)),p){t.addExportDef(getFontDefForExport(e.props.font));let r={fontSize:tT[e.props.size],lineHeight:tw.lineHeight,fontFamily:S.p6[e.props.font],padding:0,textAlign:"middle",width:p.w-8,verticalTextAlign:"middle",height:p.h,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},i=createTextSvgElementFromSpans(this.editor,this.editor.textMeasure.measureTextSpans(e.props.text,r),r);i.setAttribute("fill",n[e.props.labelColor].solid);let o=Array.from(i.children);o.forEach(e=>{let t=parseFloat(e.getAttribute("x")||"0"),n=parseFloat(e.getAttribute("y")||"0");e.setAttribute("x",t+4+p.x+"px"),e.setAttribute("y",n+p.y+"px")});let l=i.cloneNode(!0);l.setAttribute("stroke-width","2"),l.setAttribute("fill",n.background),l.setAttribute("stroke",n.background),a.appendChild(l),a.appendChild(i)}return a}getCanvasSvgDefs(){return[getFillDefForCanvas()]}};function getArrowheadSvgMask(e,t){let n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d",e),n.setAttribute("fill","arrow"===t?"none":"black"),n.setAttribute("stroke","none"),n}function getArrowSvgPath(e,t,n){let r=document.createElementNS("http://www.w3.org/2000/svg","path");return r.setAttribute("d",e),r.setAttribute("fill","none"),r.setAttribute("stroke",t),r.setAttribute("stroke-width",n+""),r}function getArrowheadSvgPath(e,t,n,r,i){let o=document.createElementNS("http://www.w3.org/2000/svg","path");o.setAttribute("d",e),o.setAttribute("fill","none"),o.setAttribute("stroke",i[t].solid),o.setAttribute("stroke-width",n+"");let a=getShapeFillSvg({d:e,fill:r,color:t,theme:i});if(!a)return o;{let e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.appendChild(a),e.appendChild(o),e}}let tR=new WeakMap,tz="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='30' height='30' fill='none'%3E%3Cpath stroke='%23000' stroke-linecap='round' stroke-linejoin='round' stroke-width='2' d='M13 5H7a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6M19 5h6m0 0v6m0-6L13 17'/%3E%3C/svg%3E";function HyperlinkButton({url:e,zoomLevel:t}){return(0,T.jsx)("a",{className:C("tl-hyperlink-button",{"tl-hyperlink-button__hidden":t<.32}),href:e,target:"_blank",rel:"noopener noreferrer",onPointerDown:stopEventPropagation,onPointerUp:stopEventPropagation,title:e,draggable:!1,children:(0,T.jsx)("div",{className:"tl-hyperlink-button__icon",style:{mask:`url("${tz}") center 100% / 100% no-repeat`,WebkitMask:`url("${tz}") center 100% / 100% no-repeat`}})})}let tN=[{offsetX:0,offsetY:2,blur:4,spread:0,color:"#00000029"},{offsetX:0,offsetY:3,blur:6,spread:0,color:"#0000001f"}];function getRotatedBoxShadow(e){let t=tN.map(t=>{let{offsetX:n,offsetY:r,blur:i,spread:o,color:a}=t,l=new et.B(n,r),{x:c,y:u}=l.rot(-e);return`${c}px ${u}px ${i}px ${o}px ${a}`});return t.join(", ")}let BookmarkShapeUtil=class BookmarkShapeUtil extends BaseBoxShapeUtil{static type="bookmark";static props=S.qU;static migrations=S.h9;canResize=()=>!1;hideSelectionBoundsFg=()=>!0;getDefaultProps(){return{url:"",w:300,h:320,assetId:null}}component(e){let t=e.props.assetId?this.editor.getAsset(e.props.assetId):null,n=this.editor.getShapePageTransform(e).rotation(),r=getHumanReadableAddress(e);return(0,T.jsx)(HTMLContainer,{children:(0,T.jsxs)("div",{className:"tl-bookmark__container",style:{boxShadow:getRotatedBoxShadow(n)},children:[(0,T.jsxs)("div",{className:"tl-bookmark__image_container",children:[t?.props.image?(0,T.jsx)("img",{className:"tl-bookmark__image",draggable:!1,src:t?.props.image,alt:t?.props.title||""}):(0,T.jsx)("div",{className:"tl-bookmark__placeholder"}),(0,T.jsx)(HyperlinkButton,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]}),(0,T.jsxs)("div",{className:"tl-bookmark__copy_container",children:[t?.props.title&&(0,T.jsx)("h2",{className:"tl-bookmark__heading",children:truncateStringWithEllipsis(t?.props.title||"",54)}),t?.props.description&&(0,T.jsx)("p",{className:"tl-bookmark__description",children:truncateStringWithEllipsis(t?.props.description||"",128)}),(0,T.jsx)("a",{className:"tl-bookmark__link",href:e.props.url||"",target:"_blank",rel:"noopener noreferrer",onPointerDown:stopEventPropagation,onPointerUp:stopEventPropagation,onClick:stopEventPropagation,children:truncateStringWithEllipsis(r,45)})]})]})})}indicator(e){return(0,T.jsx)("rect",{width:(0,E.$Z)(e.props.w),height:(0,E.$Z)(e.props.h),rx:"6",ry:"6"})}onBeforeCreate=e=>{updateBookmarkAssetOnUrlChange(this.editor,e)};onBeforeUpdate=(e,t)=>{if(e.props.url!==t.props.url){if(!x.T.linkUrl.isValid(t.props.url))return{...t,props:{...t.props,url:e.props.url}};updateBookmarkAssetOnUrlChange(this.editor,t)}}};let getHumanReadableAddress=e=>{try{let t=new URL(e.props.url),n=t.pathname.replace(/\/*$/,"");return`${t.hostname}${n}`}catch(t){return e.props.url}};function updateBookmarkAssetOnUrlChange(e,t){let{url:n}=t.props,r=S.Yk.createId((0,v.jK)(n));e.getAsset(r)?t.props.assetId!==r&&e.updateShapes([{id:t.id,type:t.type,props:{assetId:r}}]):(e.updateShapes([{id:t.id,type:t.type,props:{assetId:null}}]),tV(e,t))}let tV=(0,v.Ds)(async(e,t)=>{let{url:n}=t.props,r=await e.getAssetForExternalContent({type:"url",url:n});r&&e.batch(()=>{e.createAssets([r]),e.updateShapes([{id:t.id,type:t.type,props:{assetId:r.id}}])})},500);function getSvgPathFromStrokePoints(e,t=!1){let n=e.length;if(n<2)return"";let r=e[0].point,i=e[1].point;if(2===n)return`M${(0,E.Yk)(r)}L${(0,E.Yk)(i)}`;let o="";for(let t=2,a=n-1;t<a;t++)r=e[t].point,i=e[t+1].point,o+=(0,E.Y8)(r,i);return t?`M${(0,E.Y8)(e[0].point,e[1].point)}Q${(0,E.Yk)(e[1].point)}${(0,E.Y8)(e[1].point,e[2].point)}T${o}${(0,E.Y8)(e[n-1].point,e[0].point)}${(0,E.Y8)(e[0].point,e[1].point)}Z`:`M${(0,E.Yk)(e[0].point)}Q${(0,E.Yk)(e[1].point)}${(0,E.Y8)(e[1].point,e[2].point)}${e.length>3?"T":""}${o}L${(0,E.Yk)(e[n-1].point)}`}function svgInk(e,t={}){let{start:n={},end:r={}}=t,{cap:i=!0}=n,{cap:o=!0}=r;(0,v.hu)(!n.taper&&!r.taper,"cap taper not supported here"),(0,v.hu)(!n.easing&&!r.easing,"cap easing not supported here"),(0,v.hu)(i&&o,"cap must be true");let a=getStrokePoints(e,t);setStrokePointRadii(a,t);let l=partitionAtElbows(a),c="";for(let e of l)c+=renderPartition(e,t);return c}function partitionAtElbows(e){if(e.length<=2)return[e];let t=[],n=[e[0]];for(let r=1;r<e.length-1;r++){let i=e[r-1],o=e[r],a=e[r+1],l=et.B.Angle(i.point,o.point),c=et.B.Angle(o.point,a.point),u=Math.abs((0,E.Z7)(l,c))/Math.PI;if(u>.8){let e={...o,point:o.input};n.push(e),t.push(cleanUpPartition(n)),n=[e];continue}if(n.push(o),u<.25)continue;let d=(i.radius+o.radius+a.radius)/3,p=et.B.Dist(i.point,o.point)/d,h=et.B.Dist(o.point,a.point)/d,g=p+h;if(g<1.5){n.push(o),t.push(cleanUpPartition(n)),n=[o];continue}}return n.push(e[e.length-1]),t.push(cleanUpPartition(n)),t}function cleanUpPartition(e){let t=e[0];for(;e.length>2;){let n=e[1],r=et.B.Dist(t.point,n.point),i=(t.radius+n.radius)/2;if(r<.5*i)e.splice(1,1);else break}let n=e[e.length-1];for(;e.length>2;){let t=e[e.length-2],r=et.B.Dist(n.point,t.point),i=(n.radius+t.radius)/2;if(r<.5*i)e.splice(e.length-2,1);else break}return e.length>1&&(e[0]={...e[0],vector:et.B.FromAngle(et.B.Angle(e[1].point,e[0].point))},e[e.length-1]={...e[e.length-1],vector:et.B.FromAngle(et.B.Angle(e[e.length-1].point,e[e.length-2].point))}),e}function circlePath(e,t,n){return"M "+e+" "+t+" m -"+n+", 0 a "+n+","+n+" 0 1,1 "+2*n+",0 a "+n+","+n+" 0 1,1 -"+2*n+",0"}function renderPartition(e,t={}){if(0===e.length)return"";if(1===e.length)return circlePath(e[0].point.x,e[0].point.y,e[0].radius);let{left:n,right:r}=getStrokeOutlineTracks(e,t);r.reverse();let i=`M${(0,E.Yk)(n[0])}T`;for(let e=1;e<n.length;e++)i+=(0,E.Y8)(n[e-1],n[e]);{let t=e[e.length-1],n=t.radius,r=t.vector.clone().per().neg(),o=et.B.Add(t.point,et.B.Mul(r,n)),a=et.B.Add(t.point,et.B.Mul(r,-n));i+=`${(0,E.Yk)(o)}A${(0,E.$Z)(n)},${(0,E.$Z)(n)} 0 0 1 ${(0,E.Yk)(a)}T`}for(let e=1;e<r.length;e++)i+=(0,E.Y8)(r[e-1],r[e]);{let t=e[0],n=t.radius,r=t.vector.clone().per(),o=et.B.Add(t.point,et.B.Mul(r,n)),a=et.B.Add(t.point,et.B.Mul(r,-n));i+=`${(0,E.Yk)(o)}A${(0,E.$Z)(n)},${(0,E.$Z)(n)} 0 0 1 ${(0,E.Yk)(a)}Z`}return i}function useForceSolid(){let e=(0,I.j)();return(0,b.Hg)("zoom",()=>.35>e.getZoomLevel(),[e])}let PEN_EASING=e=>.65*e+.35*(0,E.dv)(e*E.PI/2),simulatePressureSettings=e=>({size:1+e,thinning:.5,streamline:.62+(1+e)/8*.06,smoothing:.62,easing:tn.L.easeOutSine,simulatePressure:!0}),realPressureSettings=e=>({size:1+1.2*e,thinning:.62,streamline:.62,smoothing:.62,simulatePressure:!1,easing:PEN_EASING}),solidSettings=e=>({size:1+e,thinning:0,streamline:.62+(1+e)/8*.06,smoothing:.62,simulatePressure:!1,easing:tn.L.linear});function getHighlightFreehandSettings({strokeWidth:e,showAsComplete:t}){return{size:1+e,thinning:0,streamline:.5,smoothing:.5,simulatePressure:!1,easing:tn.L.easeOutSine,last:t}}function getFreehandOptions(e,t,n,r){return{...r?solidSettings(t):"draw"===e.dash?e.isPen?realPressureSettings(t):simulatePressureSettings(t):solidSettings(t),last:e.isComplete||n}}function getPointsFromSegments(e){let t=[];for(let n of e)if("free"===n.type||n.points.length<2)t.push(...n.points.map(et.B.Cast));else{let e=Math.max(4,Math.floor(et.B.Dist(n.points[0],n.points[1])/16));t.push(...et.B.PointsBetween(n.points[0],n.points[1],e))}return t}function getDrawShapeStrokeDashArray(e,t){return({draw:"none",solid:"none",dotted:`0.1 ${2*t}`,dashed:`${2*t} ${2*t}`})[e.props.dash]}let DrawShapeUtil=class DrawShapeUtil extends e8.E{static type="draw";static props=S.wu;static migrations=S._l;hideResizeHandles=e=>getIsDot(e);hideRotateHandle=e=>getIsDot(e);hideSelectionBoundsFg=e=>getIsDot(e);getDefaultProps(){return{segments:[],color:"black",fill:"none",dash:"draw",size:"m",isComplete:!1,isClosed:!1,isPen:!1}}getGeometry(e){let t=getPointsFromSegments(e.props.segments),n=tS[e.props.size];if(1===e.props.segments.length){let e=eo.xu.FromPoints(t);if(e.width<2*n&&e.height<2*n)return new Circle2d({x:-n,y:-n,radius:n,isFilled:!0})}let r=getStrokePoints(t,getFreehandOptions(e.props,n,!0,!0)).map(e=>e.point);return e.props.isClosed?new ts.w({points:r,isFilled:"none"!==e.props.fill}):new to.q({points:r})}component(e){let t=useDefaultColorTheme(),n=useForceSolid(),r=tS[e.props.size],i=getPointsFromSegments(e.props.segments),o=e.props.isComplete||v.Z$(e.props.segments)?.type==="straight",a=r;n||e.props.isPen||"draw"!==e.props.dash||1!==i.length||(a+=(0,v.Vk)(e.id)()*(r/6));let l=getFreehandOptions(e.props,a,o,n);if(!n&&"draw"===e.props.dash)return(0,T.jsxs)(e3.g,{id:e.id,children:[e.props.isClosed&&e.props.fill&&i.length>1?(0,T.jsx)(tO,{theme:t,fill:e.props.isClosed?e.props.fill:"none",color:e.props.color,d:getSvgPathFromStrokePoints(getStrokePoints(i,l),e.props.isClosed)}):null,(0,T.jsx)("path",{d:svgInk(i,l),strokeLinecap:"round",fill:t[e.props.color].solid})]});let c=getStrokePoints(i,l),u=c.length<2,d=u?getDot(i[0],0):getSvgPathFromStrokePoints(c,e.props.isClosed);return(0,T.jsxs)(e3.g,{id:e.id,children:[(0,T.jsx)(tO,{theme:t,color:e.props.color,fill:u||e.props.isClosed?e.props.fill:"none",d:d}),(0,T.jsx)("path",{d:d,strokeLinecap:"round",fill:u?t[e.props.color].solid:"none",stroke:t[e.props.color].solid,strokeWidth:r,strokeDasharray:u?"none":getDrawShapeStrokeDashArray(e,r),strokeDashoffset:"0"})]})}indicator(e){let t=useForceSolid(),n=tS[e.props.size],r=getPointsFromSegments(e.props.segments),i=n;t||e.props.isPen||"draw"!==e.props.dash||1!==r.length||(i+=(0,v.Vk)(e.id)()*(n/6));let o=e.props.isComplete||v.Z$(e.props.segments)?.type==="straight",a=getFreehandOptions(e.props,i,o,!0),l=getStrokePoints(r,a),c=l.length>1?getSvgPathFromStrokePoints(l,e.props.isClosed):getDot(r[0],i);return(0,T.jsx)("path",{d:c})}toSvg(e,t){let n;let r=(0,S.y6)({isDarkMode:t.isDarkMode});t.addExportDef(getFillDefForExport(e.props.fill,r));let{color:i}=e.props,o=tS[e.props.size],a=getPointsFromSegments(e.props.segments),l=e.props.isComplete||v.Z$(e.props.segments)?.type==="straight",c=o;e.props.isPen||"draw"!==e.props.dash||1!==a.length||(c+=(0,v.Vk)(e.id)()*(o/6));let u=getFreehandOptions(e.props,c,l,!1),d=getStrokePoints(a,u),p=d.length>1?getSvgPathFromStrokePoints(d,e.props.isClosed):getDot(a[0],c);if("draw"===e.props.dash||d.length<2){setStrokePointRadii(d,u);let e=getStrokeOutlinePoints_getStrokeOutlinePoints(d,u),t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",getSvgPathFromPoints_getSvgPathFromPoints(e,!0)),t.setAttribute("fill",r[i].solid),t.setAttribute("stroke-linecap","round"),n=t}else{let t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("d",p),t.setAttribute("stroke",r[i].solid),t.setAttribute("fill","none"),t.setAttribute("stroke-linecap","round"),t.setAttribute("stroke-width",o.toString()),t.setAttribute("stroke-dasharray",getDrawShapeStrokeDashArray(e,o)),t.setAttribute("stroke-dashoffset","0"),n=t}let h=getShapeFillSvg({fill:e.props.isClosed?e.props.fill:"none",d:p,color:e.props.color,theme:r});if(h){let e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.appendChild(h),e.appendChild(n),e}return n}getCanvasSvgDefs(){return[getFillDefForCanvas()]}onResize=(e,t)=>{let{scaleX:n,scaleY:r}=t,i=[];for(let t of e.props.segments)i.push({...t,points:t.points.map(({x:e,y:t,z:i})=>({x:(0,E.FH)(n*e),y:(0,E.FH)(r*t),z:i}))});return{props:{segments:i}}};expandSelectionOutlinePx(e){let t="draw"===e.props.dash?1.6:1;return tS[e.props.size]*t/2}};function getDot(e,t){let n=(t+1)*.5;return`M ${e.x} ${e.y} m -${n}, 0 a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 -${2*n},0`}function getIsDot(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}function resizeBox_resizeBox(e,t,n={}){let{newPoint:r,handle:i,scaleX:o,scaleY:a}=t,{minWidth:l=1,maxWidth:c=1/0,minHeight:u=1,maxHeight:d=1/0}=n,p=e.props.w*o,h=e.props.h*a,g=new et.B(0,0);if(p>0){if(p<l){switch(i){case"top_left":case"left":case"bottom_left":g.x=p-l;break;case"top":case"bottom":g.x=(p-l)/2;break;default:g.x=0}p=l}}else if(g.x=p,(p=-p)<l){switch(i){case"top_left":case"left":case"bottom_left":g.x=-p;break;default:g.x=-l}p=l}if(h>0){if(h<u){switch(i){case"top_left":case"top":case"top_right":g.y=h-u;break;case"right":case"left":g.y=(h-u)/2;break;default:g.y=0}h=u}}else if(g.y=h,(h=-h)<u){switch(i){case"top_left":case"top":case"top_right":g.y=-h;break;default:g.y=-u}h=u}let{x:f,y:m}=g.rot(e.rotation).add(r);return{x:f,y:m,props:{w:Math.min(c,p),h:Math.min(d,h)}}}let getSandboxPermissions=e=>Object.entries(e).filter(([e,t])=>t).map(([e])=>e).join(" ");let EmbedShapeUtil=class EmbedShapeUtil extends BaseBoxShapeUtil{static type="embed";static props=S.DW;static migrations=S.BF;hideSelectionBoundsFg=e=>!this.canResize(e);canEdit=()=>!0;canUnmount=e=>!!getEmbedInfo(e.props.url)?.definition?.canUnmount;canResize=e=>!!getEmbedInfo(e.props.url)?.definition?.doesResize;canEditInReadOnly=()=>!0;getDefaultProps(){return{w:300,h:300,url:""}}isAspectRatioLocked=e=>{let t=getEmbedInfo(e.props.url);return t?.definition.isAspectRatioLocked??!1};onResize=(e,t)=>{let n=this.isAspectRatioLocked(e),r=getEmbedInfo(e.props.url),i=r?.definition.minWidth??200,o=r?.definition.minHeight??200;if(n){let t=e.props.w/e.props.h;t>1?i*=t:o/=t}return resizeBox_resizeBox(e,t,{minWidth:i,minHeight:o})};component(e){let{w:t,h:n,url:r}=e.props,i=useIsEditing(e.id),o=(0,P.useMemo)(()=>getEmbedInfoUnsafely(r),[r]),a=(0,b.Hg)("is hovering",()=>{let{editingShapeId:e,hoveredShapeId:t}=this.editor.getCurrentPageState();if(e&&t!==e){let t=this.editor.getShape(e);if(t&&this.editor.isShapeOfType(t,"embed"))return!0}return!1},[]),l=this.editor.getShapePageTransform(e).rotation(),c=i||a;if(o?.definition.type==="github_gist"){let r=o.url.split("/").pop();if(!r)throw Error("No gist id!");return(0,T.jsx)(HTMLContainer,{className:"tl-embed-container",id:e.id,children:(0,T.jsx)(Gist,{id:r,width:(0,E.$Z)(t),height:(0,E.$Z)(n),isInteractive:c,pageRotation:l})})}let u=getSandboxPermissions({...S.gB,...o?.definition.overridePermissions??{}});return(0,T.jsx)(HTMLContainer,{className:"tl-embed-container",id:e.id,children:o?.definition?(0,T.jsx)("iframe",{className:"tl-embed",sandbox:u,src:o.embedUrl,width:(0,E.$Z)(t),height:(0,E.$Z)(n),draggable:!1,frameBorder:"0",referrerPolicy:"no-referrer-when-downgrade",style:{border:0,pointerEvents:c?"auto":"none",zIndex:c?"":"-1",boxShadow:getRotatedBoxShadow(l),borderRadius:o?.definition.overrideOutlineRadius??8,background:o?.definition.backgroundColor}}):null})}indicator(e){let t=(0,P.useMemo)(()=>getEmbedInfo(e.props.url),[e.props.url]);return(0,T.jsx)("rect",{width:(0,E.$Z)(e.props.w),height:(0,E.$Z)(e.props.h),rx:t?.definition.overrideOutlineRadius??8,ry:t?.definition.overrideOutlineRadius??8})}};function Gist({id:e,file:t,isInteractive:n,width:r,height:i,style:o,pageRotation:a}){return(0,T.jsx)("iframe",{className:"tl-embed",draggable:!1,width:(0,E.$Z)(r),height:(0,E.$Z)(i),frameBorder:"0",scrolling:"no",seamless:!0,referrerPolicy:"no-referrer-when-downgrade",style:{...o,pointerEvents:n?"all":"none",zIndex:n?"":"-1",boxShadow:getRotatedBoxShadow(a)},srcDoc:`
			<html>
				<head>
					<base target="_blank">
				</head>
				<body>
					<script src=https://gist.github.com/${e}.js${t?`?file=${t}`:""}></script>
					<style type="text/css">
						* { margin: 0px; }
						table { height: 100%; background-color: red; }
						.gist { background-color: none; height: 100%;  }
						.gist .gist-file { height: calc(100vh - 2px); padding: 0px; display: grid; grid-template-rows: 1fr auto; }
					</style>
				</body>
			</html>`})}let tH=(0,P.forwardRef)(({id:e,name:t,isEditing:n},r)=>{let i=(0,I.j)(),o=(0,P.useCallback)(e=>{"Enter"!==e.key||e.nativeEvent.isComposing||(stopEventPropagation(e),e.currentTarget.blur(),i.setEditingShape(null))},[i]),a=(0,P.useCallback)(t=>{let n=i.getShape(e);if(!n)return;let r=n.props.name,o=t.currentTarget.value.trim();r!==o&&i.updateShapes([{id:e,type:"frame",props:{name:o}}],{squashing:!0})},[e,i]),l=(0,P.useCallback)(t=>{let n=i.getShape(e);if(!n)return;let r=n.props.name,o=t.currentTarget.value;r!==o&&i.updateShapes([{id:e,type:"frame",props:{name:o}}],{squashing:!0})},[e,i]);return(0,T.jsxs)("div",{className:`tl-frame-label ${n?"tl-frame-label__editing":""}`,children:[(0,T.jsx)("input",{className:"tl-frame-name-input",ref:r,style:{display:n?void 0:"none"},value:t,autoFocus:!0,onKeyDown:o,onBlur:a,onChange:l}),defaultEmptyAs(t,"Frame")+String.fromCharCode(8203)]})}),FrameHeading=function({id:e,name:t,width:n,height:r}){let i;let o=(0,I.j)(),a=(0,b.Hg)("shape rotation",()=>(0,E.f5)(o.getShapePageTransform(e).rotation()),[o,e]),l=useIsEditing(e),c=(0,P.useRef)(null),u=(0,P.useCallback)(t=>{let n=getPointerInfo(t);o.getEditingShapeId()!==e&&(o.dispatch({type:"pointer",name:"pointer_down",target:"shape",shape:o.getShape(e),...n}),t.preventDefault())},[o,e]);(0,P.useEffect)(()=>{let e=c.current;e&&l&&(e.focus(),e.select(),requestAnimationFrame(()=>{document.activeElement!==e&&(e.focus(),e.select())}))},[c,l]);let d=["top","left","bottom","right"][Math.floor(((a+Math.PI/4)*(2/Math.PI)+4)%4)];switch(d){case"top":i="";break;case"right":i=`translate(${(0,E.$Z)(n)}px, 0px) rotate(90deg)`;break;case"bottom":i=`translate(${(0,E.$Z)(n)}px, ${(0,E.$Z)(r)}px) rotate(180deg)`;break;case"left":i=`translate(0px, ${(0,E.$Z)(r)}px) rotate(270deg)`}return(0,T.jsx)("div",{className:"tl-frame-heading",style:{overflow:l?"visible":"hidden",maxWidth:`calc(var(--tl-zoom) * ${"top"===d||"bottom"===d?Math.ceil(n):Math.ceil(r)}px + var(--space-5))`,bottom:"100%",transform:`${i} scale(var(--tl-scale)) translateX(calc(-1 * var(--space-3))`},onPointerDown:u,children:(0,T.jsx)("div",{className:"tl-frame-heading-hit-area",children:(0,T.jsx)(tH,{ref:c,id:e,name:t,isEditing:l})})})};function defaultEmptyAs(e,t){return e.match(/^\s*$/)?t:e}let FrameShapeUtil=class FrameShapeUtil extends BaseBoxShapeUtil{static type="frame";static props=S.k7;static migrations=S.gR;canBind=()=>!0;canEdit=()=>!0;getDefaultProps(){return{w:320,h:180,name:""}}getGeometry(e){return new e4.z({width:e.props.w,height:e.props.h,isFilled:!1})}component(e){let t=this.editor.getShapeGeometry(e).bounds,n=useDefaultColorTheme(),r=(0,b.Hg)("is creating this shape",()=>{let t=this.editor.getStateDescendant("select.resizing");if(!t||!t.getIsActive())return!1;let n=t?.info;return!!n&&n.isCreating&&this.editor.getOnlySelectedShape()?.id===e.id},[e.id]);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(e3.g,{children:(0,T.jsx)("rect",{className:C("tl-frame__body",{"tl-frame__creating":r}),width:t.width,height:t.height,fill:n.solid,stroke:n.text})}),r?null:(0,T.jsx)(FrameHeading,{id:e.id,name:e.props.name,width:t.width,height:t.height})]})}toSvg(e,t){let n;let r=(0,S.y6)({isDarkMode:t.isDarkMode}),i=document.createElementNS("http://www.w3.org/2000/svg","g"),o=document.createElementNS("http://www.w3.org/2000/svg","rect");o.setAttribute("width",e.props.w.toString()),o.setAttribute("height",e.props.h.toString()),o.setAttribute("fill",r.solid),o.setAttribute("stroke",r.black.solid),o.setAttribute("stroke-width","1"),o.setAttribute("rx","1"),o.setAttribute("ry","1"),i.appendChild(o);let a=(0,E.f5)(this.editor.getShapePageTransform(e.id).rotation()),l=["top","left","bottom","right"][Math.floor(((a+Math.PI/4)*(2/Math.PI)+4)%4)];switch(l){case"top":default:n="";break;case"right":n=`translate(${(0,E.$Z)(e.props.w)}px, 0px) rotate(90deg)`;break;case"bottom":n=`translate(${(0,E.$Z)(e.props.w)}px, ${(0,E.$Z)(e.props.h)}px) rotate(180deg)`;break;case"left":n=`translate(0px, ${(0,E.$Z)(e.props.h)}px) rotate(270deg)`}let c={fontSize:12,fontFamily:"Inter, sans-serif",textAlign:"start",width:e.props.w,height:32,padding:0,lineHeight:1,fontStyle:"normal",fontWeight:"normal",overflow:"truncate-ellipsis",verticalTextAlign:"middle"},u=this.editor.textMeasure.measureTextSpans(defaultEmptyAs(e.props.name,"Frame")+String.fromCharCode(8203),c),d=u[0],p=(0,v.Z$)(u),h=p.box.w+p.box.x-d.box.x,g=createTextSvgElementFromSpans(this.editor,u,{offsetY:-c.height-2,...c});g.style.setProperty("transform",n);let f=document.createElementNS("http://www.w3.org/2000/svg","rect");return f.setAttribute("x","-8px"),f.setAttribute("y",-c.height-4+"px"),f.setAttribute("width",h+16+"px"),f.setAttribute("height",`${c.height}px`),f.setAttribute("rx","4px"),f.setAttribute("ry","4px"),f.setAttribute("fill",r.background),i.appendChild(f),i.appendChild(g),i}indicator(e){let t=this.editor.getShapeGeometry(e).bounds;return(0,T.jsx)("rect",{width:(0,E.$Z)(t.width),height:(0,E.$Z)(t.height),className:"tl-frame-indicator"})}canReceiveNewChildrenOfType=(e,t)=>!e.isLocked;providesBackgroundForChildren(){return!0}canDropShapes=(e,t)=>!e.isLocked;onDragShapesOver=(e,t)=>t.every(t=>t.parentId===e.id)?{shouldHint:!1}:(this.editor.reparentShapes(t.map(e=>e.id),e.id),{shouldHint:!0});onDragShapesOut=(e,t)=>{let n=this.editor.getShape(e.parentId),r=n&&this.editor.isShapeOfType(n,"group");r?this.editor.reparentShapes(t,n.id):this.editor.reparentShapes(t,this.editor.getCurrentPageId())};onResizeEnd=e=>{let t=this.editor.getShapePageBounds(e),n=this.editor.getSortedChildIdsForParent(e.id),r=[];for(let e of n){let n=this.editor.getShapePageBounds(e);t.includes(n)||r.push(e)}r.length>0&&this.editor.reparentShapes(r,this.editor.getCurrentPageId())};onResize=(e,t)=>resizeBox(e,t)};function getLegacyOffsetX(e,t,n,r){if(("start-legacy"===e||"end-legacy"===e)&&0!==n.length){let i=eo.xu.From(n[0].box);for(let{box:e}of n)i.union(e);if("start-legacy"===e)return(r-2*t-i.width)/2;if("end-legacy"===e)return-(r-2*t-i.width)/2}}function isLegacyAlign(e){return"start-legacy"===e||"middle-legacy"===e||"end-legacy"===e}let tG=P.memo(function({id:e,type:t,text:n,size:r,labelColor:i,font:o,align:a,verticalAlign:l,wrap:c,bounds:u}){let{rInput:d,isEmpty:p,isEditing:h,handleFocus:g,handleChange:f,handleKeyDown:m,handleBlur:y,handleInputPointerDown:b,handleDoubleClick:w}=useEditableText(e,t,n),S=TextHelpers.normalizeTextForDom(n),v=S.length>0,x=isLegacyAlign(a),P=useDefaultColorTheme();return h||v?(0,T.jsx)("div",{className:"tl-text-label","data-font":o,"data-align":a,"data-hastext":!p,"data-isediting":h,"data-textwrap":!!c,style:{justifyContent:"middle"===a||x?"center":a,alignItems:"middle"===l?"center":l,...u?{top:u.minY,left:u.minX,width:u.width,height:u.height,position:"absolute"}:{}},children:(0,T.jsxs)("div",{className:"tl-text-label__inner",style:{fontSize:tx[r],lineHeight:tx[r]*tw.lineHeight+"px",minHeight:tw.lineHeight+32,minWidth:0,color:P[i].solid},children:[(0,T.jsx)("div",{className:"tl-text tl-text-content",dir:"ltr",children:S}),h&&(0,T.jsx)("textarea",{ref:d,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:n,onFocus:g,onChange:f,onKeyDown:m,onBlur:y,onTouchEnd:stopEventPropagation,onContextMenu:stopEventPropagation,onPointerDown:b,onDoubleClick:w})]})}):null});function getTextLabelSvgElement({bounds:e,editor:t,font:n,shape:r}){let i={fontSize:tx[r.props.size],fontFamily:n,textAlign:r.props.align,verticalTextAlign:r.props.verticalAlign,width:Math.ceil(e.width),height:Math.ceil(e.height),padding:16,lineHeight:tw.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap",offsetX:0},o=t.textMeasure.measureTextSpans(r.props.text,i),a=getLegacyOffsetX(r.props.align,16,o,e.width);a&&(i.offsetX=a);let l=createTextSvgElementFromSpans(t,o,i);return l}function precise(e){return`${(0,E.$Z)(e.x)},${(0,E.$Z)(e.y)} `}function rng(e=""){let t=0,n=0,r=0,i=0;function next(){let e=t^t<<11;return t=n,n=r,r=i,(i^=(i>>>19^e^e>>>8)>>>0)/4294967296*2}for(let n=0;n<e.length+64;n++)t^=0|e.charCodeAt(n),next();return next}function getRoundedInkyPolygonPath(e){let t,n,r,i="M",o=e.length;for(let a=0;a<o;a+=3)t=e[a],n=e[a+1],r=e[a+2],i+=`${precise(t)}L${precise(n)}Q${precise(r)}`;return i+`${precise(e[0])}`}function getRoundedPolygonPoints(e,t,n,r,i){let o;let a=[],l=rng(e),c=t[0],u=t.length;for(let e=0,d=u*i;e<d;e++){o=et.B.AddXY(t[(e+1)%u],l()*n,l()*n);let i=et.B.Sub(o,c),d=et.B.Len(i),p=et.B.Div(i,d).mul(Math.min(d/4,r));a.push(et.B.Add(c,p),et.B.Add(o,p.neg()),o),c=o}return a}function getDrawLinePathData(e,t,n){let r,i,o=`M ${precise(t[0])}L`,a=`M ${precise(t[0])}L`,l=n/3,c=2*n,u=rng(e),d=t[0],p=t[0],h=t.length;for(let e=0,n=h-1;e<n;e++){r=t[e+1],i=et.B.AddXY(t[e+1],u()*l,u()*l);let h=et.B.Sub(r,d),g=et.B.Len(h),f=et.B.Div(h,g).mul(Math.min(g/4,c)),m=et.B.Add(d,f),y=et.B.Add(r,f.neg()),b=et.B.Sub(i,p),w=et.B.Len(b),S=et.B.Div(b,w).mul(Math.min(w/4,c)),v=et.B.Add(p,S),x=et.B.Add(i,S.neg());e===n-1?(o+=`${precise(m)}L ${precise(r)}`,a+=`${precise(v)}L ${precise(i)}`):(o+=`${precise(m)}L ${precise(y)}Q ${precise(r)}`,a+=`${precise(v)}L ${precise(x)}Q ${precise(i)}`,d=r,p=i)}return[o,o+a]}function getPillCircumference(e,t){let n=Math.min(e,t)/2;return Math.PI*(2*n)+2*(Math.max(e,t)-2*n)}function getPillPoints(e,t,n){let r=Math.min(e,t)/2,i=Math.max(e,t)-2*r,o=Math.PI*(2*r)+2*i,a=o/n,l=e>t?[{type:"straight",start:new et.B(r,0),delta:new et.B(1,0)},{type:"arc",center:new et.B(e-r,r),startAngle:-E.PI/2},{type:"straight",start:new et.B(e-r,t),delta:new et.B(-1,0)},{type:"arc",center:new et.B(r,r),startAngle:E.PI/2}]:[{type:"straight",start:new et.B(e,r),delta:new et.B(0,1)},{type:"arc",center:new et.B(r,t-r),startAngle:0},{type:"straight",start:new et.B(0,t-r),delta:new et.B(0,-1)},{type:"arc",center:new et.B(r,r),startAngle:E.PI}],c=0,u=[];for(let e=0;e<n;e++){let e=l[0];"straight"===e.type?u.push(et.B.Add(e.start,et.B.Mul(e.delta,c))):u.push((0,E.XD)(e.center,r,e.startAngle+c/r)),c+=a;let t="straight"===e.type?i:E.PI*r;for(;c>t;)c-=t,l.push(l.shift()),t="straight"===l[0].type?i:E.PI*r}return u}let switchSize=(e,t,n,r,i)=>{switch(e){case"s":return t;case"m":return n;case"l":return r;case"xl":return i}};function getCloudArcs(e,t,n,r){let i=(0,v.Vk)(n),o=getPillCircumference(e,t),a=Math.max(Math.ceil(o/switchSize(r,50,70,100,130)),6,Math.ceil(o/Math.min(e,t))),l=o/a*.2,c=Math.max(e-2*l,1),u=Math.max(t-2*l,1),d=(e-c)/2,p=(t-u)/2,h=getPillCircumference(c,u)/a,g=getPillPoints(c,u,a).map(e=>e.addXY(d,p)),f=e<20?0:.3*l,m=t<20?0:.3*l,y=g.slice(0);for(let e=0;e<Math.floor(a/2);e++)y[e]=et.B.AddXY(y[e],i()*f,i()*m),y[a-e-1]=et.B.AddXY(y[a-e-1],i()*f,i()*m);let b=[];for(let n=0;n<y.length;n++){let r=n===y.length-1?0:n+1,i=y[n],o=y[r],a=g[n],l=g[r],c=et.B.Average([a,l]),u=et.B.Angle(a,l)-Math.PI/2,f=et.B.Dist(a,l),m=h-f,w=et.B.Dist(i,o),S=w/f,v=(Math.max(d,p)+m)*S,x=et.B.Add(c,et.B.FromAngle(u,v));x.x<0?x.x=0:x.x>e&&(x.x=e),x.y<0?x.y=0:x.y>t&&(x.y=t);let T=getCenterOfCircleGivenThreePoints(i,o,x),P=et.B.Dist(T||et.B.Average([i,o]),i);b.push({leftPoint:i,rightPoint:o,arcPoint:x,center:T,radius:P})}return b}function getCenterOfCircleGivenThreePoints(e,t,n){let r=e.x*(t.y-n.y)-e.y*(t.x-n.x)+t.x*n.y-n.x*t.y,i=(e.x*e.x+e.y*e.y)*(n.y-t.y)+(t.x*t.x+t.y*t.y)*(e.y-n.y)+(n.x*n.x+n.y*n.y)*(t.y-e.y),o=(e.x*e.x+e.y*e.y)*(t.x-n.x)+(t.x*t.x+t.y*t.y)*(n.x-e.x)+(n.x*n.x+n.y*n.y)*(e.x-t.x),a=-i/(2*r),l=-o/(2*r);return Number.isFinite(a)&&Number.isFinite(l)?new et.B(a,l):null}function cloudOutline(e,t,n,r){let i=[],o=getCloudArcs(e,t,n,r);for(let{center:e,radius:t,leftPoint:n,rightPoint:r}of o)i.push(...pointsOnArc(n,r,e,t,10));return i}function cloudSvgPath(e,t,n,r){let i=getCloudArcs(e,t,n,r),o=`M${(0,E.$Z)(i[0].leftPoint.x)},${(0,E.$Z)(i[0].leftPoint.y)}`;for(let{leftPoint:e,rightPoint:t,radius:n,center:r}of i){if(null===r){o+=` L${(0,E.$Z)(t.x)},${(0,E.$Z)(t.y)}`;continue}let i=isLeft(e,t,r)?"0":"1";o+=` A${(0,E.$Z)(n)},${(0,E.$Z)(n)} 0 ${i},1 ${(0,E.$Z)(t.x)},${(0,E.$Z)(t.y)}`}return o+" Z"}function inkyCloudSvgPath(e,t,n,r){let i=(0,v.Vk)(n),o="s"===r?.5:"m"===r?.7:"l"===r?.9:1.6,mut=e=>e+i()*o*2,a=getCloudArcs(e,t,n,r),l=a.reduce((e,t)=>e+et.B.Dist(t.leftPoint,t.rightPoint),0)/a.length,c=l>15*o?e=>new et.B(mut(e.x),mut(e.y)):e=>e,u=`M${(0,E.$Z)(a[0].leftPoint.x)},${(0,E.$Z)(a[0].leftPoint.y)}`,d=c(a[0].leftPoint),p=`M${(0,E.$Z)(d.x)},${(0,E.$Z)(d.y)}`;for(let{leftPoint:e,center:t,rightPoint:n,radius:r,arcPoint:i}of a){if(null===t){u+=` L${(0,E.$Z)(n.x)},${(0,E.$Z)(n.y)}`;let e=c(n);p+=` L${(0,E.$Z)(e.x)},${(0,E.$Z)(e.y)}`,d=e;continue}let o=isLeft(e,n,t)?"0":"1";u+=` A${(0,E.$Z)(r)},${(0,E.$Z)(r)} 0 ${o},1 ${(0,E.$Z)(n.x)},${(0,E.$Z)(n.y)}`;let a=c(n),l=c(i),h=getCenterOfCircleGivenThreePoints(d,a,l);if(!h){p+=` L${(0,E.$Z)(a.x)},${(0,E.$Z)(a.y)}`,d=a;continue}let g=Math.abs(et.B.Dist(h,d));p+=` A${(0,E.$Z)(g)},${(0,E.$Z)(g)} 0 ${o},1 ${(0,E.$Z)(a.x)},${(0,E.$Z)(a.y)}`,d=a}return u+p+" Z"}function pointsOnArc(e,t,n,r,i){if(null===n)return[et.B.From(e),et.B.From(t)];let o=[],a=et.B.Angle(n,e),l=et.B.Angle(n,t),c=(0,E.VK)(a,l);for(let e=0;e<i;e++){let t=e/(i-1),l=a+c*t,u=(0,E.XD)(n,r,l);o.push(u)}return o}function isLeft(e,t,n){return(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)>0}let tW=P.memo(function({dash:e,fill:t,color:n,strokeWidth:r,w:i,h:o,id:a,size:l}){let c=useDefaultColorTheme(),u=cloudSvgPath(i,o,a,l),d=getCloudArcs(i,o,a,l);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(tO,{theme:c,d:u,fill:t,color:n}),(0,T.jsx)("g",{strokeWidth:r,stroke:c[n].solid,fill:"none",pointerEvents:"all",children:d.map(({leftPoint:t,rightPoint:n,center:i,radius:o},a)=>{let l=i?o*(0,E.f5)((0,E.f5)(et.B.Angle(i,n))-(0,E.f5)(et.B.Angle(i,t))):et.B.Dist(t,n),{strokeDasharray:c,strokeDashoffset:u}=getPerfectDashProps(l,r,{style:e,start:"outset",end:"outset"});return(0,T.jsx)("path",{d:i?`M${t.x},${t.y}A${o},${o},0,0,1,${n.x},${n.y}`:`M${t.x},${t.y}L${n.x},${n.y}`,strokeDasharray:c,strokeDashoffset:u},a)})})]})});function DashStyleCloudSvg({dash:e,fill:t,color:n,theme:r,strokeWidth:i,w:o,h:a,id:l,size:c}){let u=cloudSvgPath(o,a,l,c),d=getCloudArcs(o,a,l,c),p=document.createElementNS("http://www.w3.org/2000/svg","g");for(let{leftPoint:t,rightPoint:o,center:a,radius:l}of(p.setAttribute("stroke-width",i.toString()),p.setAttribute("stroke",r[n].solid),p.setAttribute("fill","none"),d)){let n=a?l*(0,E.f5)((0,E.f5)(et.B.Angle(a,o))-(0,E.f5)(et.B.Angle(a,t))):et.B.Dist(t,o),{strokeDasharray:r,strokeDashoffset:c}=getPerfectDashProps(n,i,{style:e,start:"outset",end:"outset"}),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",a?`M${t.x},${t.y}A${l},${l},0,0,1,${o.x},${o.y}`:`M${t.x},${t.y}L${o.x},${o.y}`),u.setAttribute("stroke-dasharray",r.toString()),u.setAttribute("stroke-dashoffset",c.toString()),p.appendChild(u)}let h=getShapeFillSvg({d:u,fill:t,color:n,theme:r});return getSvgWithShapeFill(p,h)}let tZ=P.memo(function({w:e,h:t,strokeWidth:n,dash:r,color:i,fill:o}){let a=useDefaultColorTheme(),l=e/2,c=t/2,u=Math.max(0,l),d=Math.max(0,c),p=(0,E.Rp)(u,d),{strokeDasharray:h,strokeDashoffset:g}=getPerfectDashProps(p<64?2*p:p,n,{style:r,snap:4,closed:!0}),f=`M${l-u},${c}a${u},${d},0,1,1,${2*u},0a${u},${d},0,1,1,-${2*u},0`;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(tO,{theme:a,d:f,color:i,fill:o}),(0,T.jsx)("path",{d:f,strokeWidth:n,width:(0,E.$Z)(e),height:(0,E.$Z)(t),fill:"none",stroke:a[i].solid,strokeDasharray:h,strokeDashoffset:g,pointerEvents:"all"})]})});function DashStyleEllipseSvg({w:e,h:t,strokeWidth:n,dash:r,color:i,theme:o,fill:a}){let l=e/2,c=t/2,u=Math.max(0,l-n/2),d=Math.max(0,c-n/2),p=(0,E.Rp)(u,d),{strokeDasharray:h,strokeDashoffset:g}=getPerfectDashProps(p<64?2*p:p,n,{style:r,snap:4,closed:!0}),f=`M${l-u},${c}a${u},${d},0,1,1,${2*u},0a${u},${d},0,1,1,-${2*u},0`,m=document.createElementNS("http://www.w3.org/2000/svg","path");m.setAttribute("d",f),m.setAttribute("stroke-width",n.toString()),m.setAttribute("width",e.toString()),m.setAttribute("height",t.toString()),m.setAttribute("fill","none"),m.setAttribute("stroke",o[i].solid),m.setAttribute("stroke-dasharray",h),m.setAttribute("stroke-dashoffset",g);let y=getShapeFillSvg({d:f,fill:a,color:i,theme:o});return getSvgWithShapeFill(m,y)}function getOvalSolidPath(e,t){if(t>e){let n=e/2;return`
    M0,${n}
    a${n},${n},0,1,1,${2*n},0
    L${e},${t-n}
    a${n},${n},0,1,1,-${2*n},0
    Z`}let n=t/2;return`
    M${n},0
    L${e-n},0
    a${n},${n},0,1,1,0,${2*n}
    L${n},${t}
    a${n},${n},0,1,1,0,${-(2*n)}
    Z`}function getOvalPerimeter(e,t){if(e>t){let n=t/2;return(0,E.Rp)(n,n)+(e-2*n)*2}let n=e/2;return(0,E.Rp)(n,n)+(t-2*n)*2}let tK=P.memo(function({w:e,h:t,strokeWidth:n,dash:r,color:i,fill:o}){let a=useDefaultColorTheme(),l=getOvalSolidPath(e,t),c=getOvalPerimeter(e,t),{strokeDasharray:u,strokeDashoffset:d}=getPerfectDashProps(c<64?2*c:c,n,{style:r,snap:4,start:"outset",end:"outset",closed:!0});return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(tO,{theme:a,d:l,color:i,fill:o}),(0,T.jsx)("path",{d:l,strokeWidth:n,width:(0,E.$Z)(e),height:(0,E.$Z)(t),fill:"none",stroke:a[i].solid,strokeDasharray:u,strokeDashoffset:d,pointerEvents:"all"})]})});function DashStyleOvalSvg({w:e,h:t,strokeWidth:n,dash:r,color:i,theme:o,fill:a}){let l=getOvalSolidPath(e,t),c=getOvalPerimeter(e,t),{strokeDasharray:u,strokeDashoffset:d}=getPerfectDashProps(c<64?2*c:c,n,{style:r,snap:4,closed:!0}),p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",l),p.setAttribute("stroke-width",n.toString()),p.setAttribute("width",e.toString()),p.setAttribute("height",t.toString()),p.setAttribute("fill","none"),p.setAttribute("stroke",o[i].solid),p.setAttribute("stroke-dasharray",u),p.setAttribute("stroke-dashoffset",d);let h=getShapeFillSvg({d:l,fill:a,color:i,theme:o});return getSvgWithShapeFill(p,h)}let tY=P.memo(function({dash:e,fill:t,color:n,strokeWidth:r,outline:i,lines:o}){let a=useDefaultColorTheme(),l="M"+i[0]+"L"+i.slice(1)+"Z";return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(tO,{theme:a,d:l,fill:t,color:n}),(0,T.jsxs)("g",{strokeWidth:r,stroke:a[n].solid,fill:"none",pointerEvents:"all",children:[Array.from(Array(i.length)).map((t,n)=>{let o=i[n],a=i[(n+1)%i.length],l=et.B.Dist(o,a),{strokeDasharray:c,strokeDashoffset:u}=getPerfectDashProps(l,r,{style:e,start:"outset",end:"outset"});return(0,T.jsx)("line",{x1:o.x,y1:o.y,x2:a.x,y2:a.y,strokeDasharray:c,strokeDashoffset:u},n)}),o&&o.map(([t,i],o)=>{let l=et.B.Dist(t,i),{strokeDasharray:c,strokeDashoffset:u}=getPerfectDashProps(l,r,{style:e,start:"skip",end:"outset",snap:"dotted"===e?4:void 0});return(0,T.jsx)("path",{d:`M${t.x},${t.y}L${i.x},${i.y}`,stroke:a[n].solid,strokeWidth:r,fill:"none",strokeDasharray:c,strokeDashoffset:u},`line_fg_${o}`)})]})]})});function DashStylePolygonSvg({dash:e,fill:t,color:n,theme:r,strokeWidth:i,outline:o,lines:a}){let l=document.createElementNS("http://www.w3.org/2000/svg","g");if(l.setAttribute("stroke-width",i.toString()),l.setAttribute("stroke",r[n].solid),l.setAttribute("fill","none"),Array.from(Array(o.length)).forEach((t,n)=>{let r=o[n],a=o[(n+1)%o.length],c=et.B.Dist(r,a),{strokeDasharray:u,strokeDashoffset:d}=getPerfectDashProps(c,i,{style:e}),p=document.createElementNS("http://www.w3.org/2000/svg","line");p.setAttribute("x1",r.x.toString()),p.setAttribute("y1",r.y.toString()),p.setAttribute("x2",a.x.toString()),p.setAttribute("y2",a.y.toString()),p.setAttribute("stroke-dasharray",u.toString()),p.setAttribute("stroke-dashoffset",d.toString()),l.appendChild(p)}),a)for(let[t,n]of a){let r=et.B.Dist(t,n),{strokeDasharray:o,strokeDashoffset:a}=getPerfectDashProps(r,i,{style:e,start:"skip",end:"skip",snap:"dotted"===e?4:2}),c=document.createElementNS("http://www.w3.org/2000/svg","line");c.setAttribute("x1",t.x.toString()),c.setAttribute("y1",t.y.toString()),c.setAttribute("x2",n.x.toString()),c.setAttribute("y2",n.y.toString()),c.setAttribute("stroke-dasharray",o.toString()),c.setAttribute("stroke-dashoffset",a.toString()),l.appendChild(c)}let c=getShapeFillSvg({d:"M"+o[0]+"L"+o.slice(1)+"Z",fill:t,color:n,theme:r});return getSvgWithShapeFill(l,c)}let tq=P.memo(function({fill:e,color:t,strokeWidth:n,w:r,h:i,id:o,size:a}){let l=useDefaultColorTheme(),c=inkyCloudSvgPath(r,i,o,a);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(tO,{theme:l,d:c,fill:e,color:t}),(0,T.jsx)("path",{d:c,stroke:l[t].solid,strokeWidth:n,fill:"none"})]})});function DrawStyleCloudSvg({fill:e,color:t,strokeWidth:n,theme:r,w:i,h:o,id:a,size:l}){let c=inkyCloudSvgPath(i,o,a,l),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",c),u.setAttribute("stroke-width",n.toString()),u.setAttribute("stroke",r[t].solid),u.setAttribute("fill","none");let d=getShapeFillSvg({d:c,fill:e,color:t,theme:r});return getSvgWithShapeFill(u,d)}function DrawStyleEllipseSvg({id:e,w:t,h:n,strokeWidth:r,fill:i,color:o,theme:a}){let l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",getEllipsePath(e,t,n,r)),l.setAttribute("fill",a[o].solid);let c=getShapeFillSvg({d:getSvgPathFromStrokePoints(getEllipseStrokePoints(e,t,n,r)),fill:i,color:o,theme:a});return getSvgWithShapeFill(l,c)}function getEllipseStrokeOptions(e){return{size:1+e,thinning:.25,end:{taper:e},start:{taper:e},streamline:0,smoothing:1,simulatePressure:!1}}function getEllipseStrokePoints(e,t,n,r){let i=(0,v.Vk)(e),o=t/2,a=n/2,l=(0,E.Rp)(o,a),c=[],u=E.yo*i(),d=E.yo+E.pj/2+Math.abs(i())*E.pj,p=Math.max(16,l/10);for(let e=0;e<p;e++){let r=e/(p-1),l=u+r*d,h=Math.cos(l),g=Math.sin(l);c.push(new et.B(o*h+.5*t+.05*i(),a*g+n/2+.05*i(),Math.min(1,.5+Math.abs(.5-(i()>0?tn.L.easeInOutSine(r):tn.L.easeInExpo(r)))/2)))}return getStrokePoints(c,getEllipseStrokeOptions(r))}function getEllipsePath(e,t,n,r){let i=getEllipseStrokeOptions(r);return getSvgPathFromPoints_getSvgPathFromPoints(getStrokeOutlinePoints_getStrokeOutlinePoints(setStrokePointRadii(getEllipseStrokePoints(e,t,n,r),i),i))}P.memo(function({id:e,w:t,h:n,strokeWidth:r,fill:i,color:o}){let a=useDefaultColorTheme(),l=getSvgPathFromStrokePoints(getEllipseStrokePoints(e,t,n,r)),c=getEllipsePath(e,t,n,r);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(tO,{theme:a,d:l,color:o,fill:i}),(0,T.jsx)("path",{d:c,fill:a[o].solid,strokeWidth:0,pointerEvents:"all"})]})});let tX=P.memo(function({id:e,outline:t,lines:n,fill:r,color:i,strokeWidth:o}){let a=useDefaultColorTheme(),l=getRoundedPolygonPoints(e,t,o/3,2*o,2),c=getRoundedInkyPolygonPath(l);if(n)for(let[e,t]of n)c+=`M${e.x},${e.y}L${t.x},${t.y}`;let u=getRoundedPolygonPoints(e,t,0,2*o,1),d=getRoundedInkyPolygonPath(u);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(tO,{d:d,fill:r,color:i,theme:a}),(0,T.jsx)("path",{d:c,stroke:a[i].solid,strokeWidth:o,fill:"none"})]})});function DrawStylePolygonSvg({id:e,outline:t,lines:n,fill:r,color:i,theme:o,strokeWidth:a}){let l=getRoundedPolygonPoints(e,t,a/3,2*a,2),c=getRoundedInkyPolygonPath(l);if(n)for(let[e,t]of n)c+=`M${e.x},${e.y}L${t.x},${t.y}`;let u=getRoundedPolygonPoints(e,t,0,2*a,1),d=getRoundedInkyPolygonPath(u),p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",c),p.setAttribute("fill","none"),p.setAttribute("stroke",o[i].solid),p.setAttribute("stroke-width",a.toString());let h=getShapeFillSvg({d:d,fill:r,color:i,theme:o});return getSvgWithShapeFill(p,h)}let tJ=P.memo(function({fill:e,color:t,strokeWidth:n,w:r,h:i,id:o,size:a}){let l=useDefaultColorTheme(),c=cloudSvgPath(r,i,o,a);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(tO,{theme:l,d:c,fill:e,color:t}),(0,T.jsx)("path",{d:c,stroke:l[t].solid,strokeWidth:n,fill:"none"})]})});function SolidStyleCloudSvg({fill:e,color:t,strokeWidth:n,theme:r,w:i,h:o,id:a,size:l}){let c=cloudSvgPath(i,o,a,l),u=document.createElementNS("http://www.w3.org/2000/svg","path");u.setAttribute("d",c),u.setAttribute("stroke-width",n.toString()),u.setAttribute("stroke",r[t].solid),u.setAttribute("fill","none");let d=getShapeFillSvg({d:c,fill:e,color:t,theme:r});return getSvgWithShapeFill(u,d)}let tQ=P.memo(function({w:e,h:t,strokeWidth:n,fill:r,color:i}){let o=useDefaultColorTheme(),a=e/2,l=t/2,c=Math.max(0,a),u=Math.max(0,l),d=`M${a-c},${l}a${c},${u},0,1,1,${2*c},0a${c},${u},0,1,1,-${2*c},0`;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(tO,{d,color:i,fill:r,theme:o}),(0,T.jsx)("path",{d,stroke:o[i].solid,strokeWidth:n,fill:"none"})]})});function SolidStyleEllipseSvg({w:e,h:t,strokeWidth:n,fill:r,color:i,theme:o}){let a=e/2,l=t/2,c=Math.max(0,a),u=Math.max(0,l),d=`M${a-c},${l}a${c},${u},0,1,1,${2*c},0a${c},${u},0,1,1,-${2*c},0`,p=document.createElementNS("http://www.w3.org/2000/svg","path");p.setAttribute("d",d),p.setAttribute("stroke-width",n.toString()),p.setAttribute("width",e.toString()),p.setAttribute("height",t.toString()),p.setAttribute("fill","none"),p.setAttribute("stroke",o[i].solid);let h=getShapeFillSvg({d,fill:r,color:i,theme:o});return getSvgWithShapeFill(p,h)}let t0=P.memo(function({w:e,h:t,strokeWidth:n,fill:r,color:i}){let o=useDefaultColorTheme(),a=getOvalIndicatorPath(e,t);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(tO,{d:a,color:i,fill:r,theme:o}),(0,T.jsx)("path",{d:a,stroke:o[i].solid,strokeWidth:n,fill:"none"})]})});function SolidStyleOvalSvg({w:e,h:t,strokeWidth:n,fill:r,color:i,theme:o}){let a=getOvalIndicatorPath(e,t),l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",a),l.setAttribute("stroke-width",n.toString()),l.setAttribute("width",e.toString()),l.setAttribute("height",t.toString()),l.setAttribute("fill","none"),l.setAttribute("stroke",o[i].solid);let c=getShapeFillSvg({d:a,fill:r,color:i,theme:o});return getSvgWithShapeFill(l,c)}function getOvalIndicatorPath(e,t){let n;if(t>e){let r=e/2;n=`
    M0,${r}
    a${r},${r},0,1,1,${2*r},0
    L${e},${t-r}
    a${r},${r},0,1,1,-${2*r},0
    Z`}else{let r=t/2;n=`
    M${r},0
    L${e-r},0
    a${r},${r},0,1,1,0,${2*r}
    L${r},${t}
    a${r},${r},0,1,1,0,${-(2*r)}
    Z`}return n}let t1=P.memo(function({outline:e,lines:t,fill:n,color:r,strokeWidth:i}){let o=useDefaultColorTheme(),a="M"+e[0]+"L"+e.slice(1)+"Z";if(t)for(let[e,n]of t)a+=`M${e.x},${e.y}L${n.x},${n.y}`;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(tO,{d:a,fill:n,color:r,theme:o}),(0,T.jsx)("path",{d:a,stroke:o[r].solid,strokeWidth:i,fill:"none"})]})});function SolidStylePolygonSvg({outline:e,lines:t,fill:n,color:r,strokeWidth:i,theme:o}){let a="M"+e[0]+"L"+e.slice(1)+"Z",l=a;if(t)for(let[e,n]of t)l+=`M${e.x},${e.y}L${n.x},${n.y}`;let c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("d",l),c.setAttribute("stroke-width",i.toString()),c.setAttribute("stroke",o[r].solid),c.setAttribute("fill","none");let u=getShapeFillSvg({d:a,fill:n,color:r,theme:o});return getSvgWithShapeFill(c,u)}let GeoShapeUtil=class GeoShapeUtil extends BaseBoxShapeUtil{static type="geo";static props=S.eG;static migrations=S.P3;canEdit=()=>!0;getDefaultProps(){return{w:100,h:100,geo:"rectangle",color:"black",labelColor:"black",fill:"none",dash:"draw",size:"m",font:"draw",text:"",align:"middle",verticalAlign:"middle",growY:0,url:""}}getGeometry(e){let t;let n=Math.max(1,e.props.w),r=Math.max(1,e.props.h+e.props.growY),i=n/2,o=r/2,a=tS[e.props.size],l="none"!==e.props.fill;switch(e.props.geo){case"cloud":t=new ts.w({points:cloudOutline(n,r,e.id,e.props.size),isFilled:l});break;case"triangle":t=new ts.w({points:[new et.B(i,0),new et.B(n,r),new et.B(0,r)],isFilled:l});break;case"diamond":t=new ts.w({points:[new et.B(i,0),new et.B(n,o),new et.B(i,r),new et.B(0,o)],isFilled:l});break;case"pentagon":t=new ts.w({points:(0,E.Oe)(n,r,5),isFilled:l});break;case"hexagon":t=new ts.w({points:(0,E.Oe)(n,r,6),isFilled:l});break;case"octagon":t=new ts.w({points:(0,E.Oe)(n,r,8),isFilled:l});break;case"ellipse":t=new Ellipse2d({width:n,height:r,isFilled:l});break;case"oval":t=new Stadium2d({width:n,height:r,isFilled:l});break;case"star":{let e=E.yo/5/2,i=2*Math.floor(5/4),o=Math.cos(-E.pj+i*e)*n/2,a=Math.cos(-E.pj+(10-i)*e)*n/2,c=Math.sin(-E.pj+0*e)*r/2,u=Math.sin(-E.pj+2*Math.floor(2.5)*e)*r/2,d=n-Math.abs(o-a),p=r-Math.abs(u-c),h=n/2+a-(n/2-o),g=r/2+c-(r/2-u),f=(n-h)/2,m=(r-g)/2,y=(n+d)/2,b=(r+p)/2,w=1*y/2,S=1*b/2;t=new ts.w({points:Array.from(Array(10)).map((t,n)=>{let r=-E.pj+n*e;return new et.B(f+(n%2?w:y)*Math.cos(r),m+(n%2?S:b)*Math.sin(r))}),isFilled:l});break}case"rhombus":{let e=Math.min(.38*n,.38*r);t=new ts.w({points:[new et.B(e,0),new et.B(n,0),new et.B(n-e,r),new et.B(0,r)],isFilled:l});break}case"rhombus-2":{let e=Math.min(.38*n,.38*r);t=new ts.w({points:[new et.B(0,0),new et.B(n-e,0),new et.B(n,r),new et.B(e,r)],isFilled:l});break}case"trapezoid":{let e=Math.min(.38*n,.38*r);t=new ts.w({points:[new et.B(e,0),new et.B(n-e,0),new et.B(n,r),new et.B(0,r)],isFilled:l});break}case"arrow-right":{let e=.38*Math.min(n,r),i=.16*r;t=new ts.w({points:[new et.B(0,i),new et.B(n-e,i),new et.B(n-e,0),new et.B(n,r/2),new et.B(n-e,r),new et.B(n-e,r-i),new et.B(0,r-i)],isFilled:l});break}case"arrow-left":{let e=.38*Math.min(n,r),i=.16*r;t=new ts.w({points:[new et.B(e,0),new et.B(e,i),new et.B(n,i),new et.B(n,r-i),new et.B(e,r-i),new et.B(e,r),new et.B(0,r/2)],isFilled:l});break}case"arrow-up":{let e=.16*n,i=.38*Math.min(n,r);t=new ts.w({points:[new et.B(n/2,0),new et.B(n,i),new et.B(n-e,i),new et.B(n-e,r),new et.B(e,r),new et.B(e,i),new et.B(0,i)],isFilled:l});break}case"arrow-down":{let e=.16*n,i=.38*Math.min(n,r);t=new ts.w({points:[new et.B(e,0),new et.B(n-e,0),new et.B(n-e,r-i),new et.B(n,r-i),new et.B(n/2,r),new et.B(0,r-i),new et.B(e,r-i)],isFilled:l});break}case"check-box":case"x-box":case"rectangle":t=new e4.z({width:n,height:r,isFilled:l})}let c=getLabelSize(this.editor,e),u=Math.min(n,Math.max(c.w,Math.min(32,Math.max(1,n-8)))),d=Math.min(r,Math.max(c.h,Math.min(32,Math.max(1,n-8)))),p=getLines(e.props,a),h=p?p.map(e=>new to.q({points:e})):[];return new es.m({children:[t,new e4.z({x:"start"===e.props.align?0:"end"===e.props.align?n-u:(n-u)/2,y:"start"===e.props.verticalAlign?0:"end"===e.props.verticalAlign?r-d:(r-d)/2,width:u,height:d,isFilled:!0,isLabel:!0}),...h]})}getHandleSnapGeometry(e){let t=this.getGeometry(e),n=t.children[0];switch(e.props.geo){case"arrow-down":case"arrow-left":case"arrow-right":case"arrow-up":case"check-box":case"diamond":case"hexagon":case"octagon":case"pentagon":case"rectangle":case"rhombus":case"rhombus-2":case"star":case"trapezoid":case"triangle":case"x-box":return{outline:n,points:[...n.getVertices(),t.bounds.center]};case"cloud":case"ellipse":case"oval":return{outline:n,points:[t.bounds.center]};default:(0,v.iP)(e.props.geo)}}onEditEnd=e=>{let{id:t,type:n,props:{text:r}}=e;r.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])};component(e){let{id:t,type:n,props:r}=e,i=tS[r.size],{w:o,color:a,labelColor:l,fill:c,dash:u,growY:d,font:p,align:h,verticalAlign:g,size:f,text:m}=r;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(e3.g,{id:t,children:(()=>{let n=r.h+d;switch(r.geo){case"cloud":if("solid"===u)return(0,T.jsx)(tJ,{color:a,fill:c,strokeWidth:i,w:o,h:n,id:t,size:f});if("dashed"===u||"dotted"===u)return(0,T.jsx)(tW,{color:a,fill:c,strokeWidth:i,w:o,h:n,id:t,size:f,dash:u});if("draw"===u)return(0,T.jsx)(tq,{color:a,fill:c,strokeWidth:i,w:o,h:n,id:t,size:f});break;case"ellipse":if("solid"===u)return(0,T.jsx)(tQ,{strokeWidth:i,w:o,h:n,color:a,fill:c});if("dashed"===u||"dotted"===u)return(0,T.jsx)(tZ,{id:t,strokeWidth:i,w:o,h:n,dash:u,color:a,fill:c});if("draw"===u)return(0,T.jsx)(tQ,{strokeWidth:i,w:o,h:n,color:a,fill:c});break;case"oval":if("solid"===u)return(0,T.jsx)(t0,{strokeWidth:i,w:o,h:n,color:a,fill:c});if("dashed"===u||"dotted"===u)return(0,T.jsx)(tK,{id:t,strokeWidth:i,w:o,h:n,dash:u,color:a,fill:c});if("draw"===u)return(0,T.jsx)(t0,{strokeWidth:i,w:o,h:n,color:a,fill:c});break;default:{let n=this.editor.getShapeGeometry(e),r=n instanceof es.m?n.children[0].vertices:n.vertices,o=getLines(e.props,i);if("solid"===u)return(0,T.jsx)(t1,{fill:c,color:a,strokeWidth:i,outline:r,lines:o});if("dashed"===u||"dotted"===u)return(0,T.jsx)(tY,{dash:u,fill:c,color:a,strokeWidth:i,outline:r,lines:o});if("draw"===u)return(0,T.jsx)(tX,{id:t,fill:c,color:a,strokeWidth:i,outline:r,lines:o})}}})()}),(0,T.jsxs)(HTMLContainer,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h+r.growY},children:[(0,T.jsx)(tG,{id:t,type:n,font:p,fill:c,size:f,align:h,verticalAlign:g,text:m,labelColor:l,wrap:!0,bounds:"cloud"===r.geo?this.getGeometry(e).bounds:void 0}),e.props.url&&(0,T.jsx)(HyperlinkButton,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})]})}indicator(e){let{id:t,props:n}=e,{w:r,size:i}=n,o=n.h+n.growY,a=tS[i];switch(n.geo){case"ellipse":if("draw"===n.dash)return(0,T.jsx)("path",{d:getSvgPathFromStrokePoints(getEllipseStrokePoints(t,r,o,a))});return(0,T.jsx)("ellipse",{cx:r/2,cy:o/2,rx:r/2,ry:o/2});case"oval":return(0,T.jsx)("path",{d:getOvalIndicatorPath(r,o)});case"cloud":return(0,T.jsx)("path",{d:cloudSvgPath(r,o,t,i)});default:{let r;let i=this.editor.getShapeGeometry(e),o=i instanceof es.m?i.children[0].vertices:i.vertices;if("draw"===n.dash){let e=getRoundedPolygonPoints(t,o,0,2*a,1);r=getRoundedInkyPolygonPath(e)}else r="M"+o[0]+"L"+o.slice(1)+"Z";let l=getLines(e.props,a);if(l)for(let[e,t]of l)r+=`M${e.x},${e.y}L${t.x},${t.y}`;return(0,T.jsx)("path",{d:r})}}}toSvg(e,t){let n;let{id:r,props:i}=e,o=tS[i.size],a=(0,S.y6)({isDarkMode:t.isDarkMode});switch(t.addExportDef(getFillDefForExport(e.props.fill,a)),i.geo){case"ellipse":switch(i.dash){case"draw":n=DrawStyleEllipseSvg({id:r,w:i.w,h:i.h,color:i.color,fill:i.fill,strokeWidth:o,theme:a});break;case"solid":n=SolidStyleEllipseSvg({strokeWidth:o,w:i.w,h:i.h,color:i.color,fill:i.fill,theme:a});break;default:n=DashStyleEllipseSvg({id:r,strokeWidth:o,w:i.w,h:i.h,dash:i.dash,color:i.color,fill:i.fill,theme:a})}break;case"oval":switch(i.dash){case"draw":default:n=DashStyleOvalSvg({id:r,strokeWidth:o,w:i.w,h:i.h,dash:i.dash,color:i.color,fill:i.fill,theme:a});break;case"solid":n=SolidStyleOvalSvg({strokeWidth:o,w:i.w,h:i.h,color:i.color,fill:i.fill,theme:a})}break;case"cloud":switch(i.dash){case"draw":n=DrawStyleCloudSvg({id:r,strokeWidth:o,w:i.w,h:i.h,color:i.color,fill:i.fill,size:i.size,theme:a});break;case"solid":n=SolidStyleCloudSvg({strokeWidth:o,w:i.w,h:i.h,color:i.color,fill:i.fill,size:i.size,id:r,theme:a});break;default:n=DashStyleCloudSvg({id:r,strokeWidth:o,w:i.w,h:i.h,dash:i.dash,color:i.color,fill:i.fill,theme:a,size:i.size})}break;default:{let t=this.editor.getShapeGeometry(e),l=t instanceof es.m?t.children[0].vertices:t.vertices,c=getLines(e.props,o);switch(i.dash){case"draw":n=DrawStylePolygonSvg({id:r,fill:i.fill,color:i.color,strokeWidth:o,outline:l,lines:c,theme:a});break;case"solid":n=SolidStylePolygonSvg({fill:i.fill,color:i.color,strokeWidth:o,outline:l,lines:c,theme:a});break;default:n=DashStylePolygonSvg({dash:i.dash,fill:i.fill,color:i.color,strokeWidth:o,outline:l,lines:c,theme:a})}}}if(i.text){let r=this.editor.getShapeGeometry(e).bounds;t.addExportDef(getFontDefForExport(e.props.font));let i=getTextLabelSvgElement({editor:this.editor,shape:e,font:S.p6[e.props.font],bounds:r}),o=i.cloneNode(!0);o.setAttribute("fill",a[e.props.labelColor].solid),o.setAttribute("stroke","none");let l=i.cloneNode(!0);l.setAttribute("stroke-width","2"),l.setAttribute("fill",a.background),l.setAttribute("stroke",a.background);let c=document.createElementNS("http://www.w3.org/2000/svg","g");if(c.append(l),c.append(o),"g"===n.nodeName)n.appendChild(c);else{let e=document.createElementNS("http://www.w3.org/2000/svg","g");return e.appendChild(n),e.appendChild(c),e}}return n}getCanvasSvgDefs(){return[getFillDefForCanvas()]}onResize=(e,{handle:t,newPoint:n,scaleX:r,scaleY:i,initialShape:o})=>{let a=o.props.w*r,l=(o.props.h+o.props.growY)*i,c=0,u=0;if(e.props.text.trim()){let t=Math.max(Math.abs(a),51),n=Math.max(Math.abs(l),51);t<51&&51===n&&(t=51),51===t&&n<51&&(n=51);let r=getLabelSize(this.editor,{...e,props:{...e.props,w:t,h:n}}),i=Math.max(Math.abs(a),r.w)*Math.sign(a),o=Math.max(Math.abs(l),r.h)*Math.sign(l);c=Math.abs(i)-Math.abs(a),u=Math.abs(o)-Math.abs(l),a=i,l=o}let d=new et.B(0,0);r<0&&(d.x+=a),("left"===t||"top_left"===t||"bottom_left"===t)&&(d.x+=r<0?c:-c),i<0&&(d.y+=l),("top"===t||"top_left"===t||"top_right"===t)&&(d.y+=i<0?u:-u);let{x:p,y:h}=d.rot(e.rotation).add(n);return{x:p,y:h,props:{w:Math.max(Math.abs(a),1),h:Math.max(Math.abs(l),1),growY:0}}};onBeforeCreate=e=>{if(!e.props.text)return e.props.growY?{...e,props:{...e.props,growY:0}}:void 0;let t=e.props.h,n=getLabelSize(this.editor,e).h,r=null;if(n>t?r=n-t:e.props.growY&&(r=0),null!==r)return{...e,props:{...e.props,growY:r}}};onBeforeUpdate=(e,t)=>{let n=e.props.text,r=t.props.text;if(n===r&&e.props.font===t.props.font&&e.props.size===t.props.size)return;if(n&&!r)return{...t,props:{...t.props,growY:0}};let i=e.props.w,o=e.props.h,a=getLabelSize(this.editor,t),l=a.w,c=a.h;if(!n&&r&&1===r.length){let n=Math.max(i,l),r=Math.max(o,c);return e.props.w<51&&e.props.h<51&&(r=Math.max(n=Math.max(n=Math.max(n,51),r=Math.max(r,51)),r)),{...t,props:{...t.props,w:n,h:r,growY:0}}}let u=null;return(c>o?u=c-o:e.props.growY&&(u=0),null!==u)?{...t,props:{...t.props,growY:u,w:Math.max(t.props.w,l)}}:l>e.props.w?{...t,props:{...t.props,w:l}}:void 0};onDoubleClick=e=>{if(this.editor.inputs.altKey)switch(e.props.geo){case"rectangle":return{...e,props:{geo:"check-box"}};case"check-box":return{...e,props:{geo:"rectangle"}}}}};function getLabelSize(e,t){let n=t.props.text;if(!n)return{w:0,h:0};let r=e.textMeasure.measureText("w",{...tw,fontFamily:tP[t.props.font],fontSize:tx[t.props.size],maxWidth:100}),i=e.textMeasure.measureText(n,{...tw,fontFamily:tP[t.props.font],fontSize:tx[t.props.size],minWidth:r.w+"px",maxWidth:Math.max(0,Math.ceil(r.w+({s:2,m:3.5,l:5,xl:10})[t.props.size]),Math.ceil(t.props.w-32))});return{w:i.w+32,h:i.h+32}}function getLines(e,t){switch(e.geo){case"x-box":return getXBoxLines(e.w,e.h,t,e.dash);case"check-box":return getCheckBoxLines(e.w,e.h);default:return}}function getXBoxLines(e,t,n,r){let i="draw"===r?.62:0;if("dashed"===r)return[[new et.B(0,0),new et.B(e/2,t/2)],[new et.B(e,t),new et.B(e/2,t/2)],[new et.B(0,t),new et.B(e/2,t/2)],[new et.B(e,0),new et.B(e/2,t/2)]];let clampX=t=>Math.max(0,Math.min(e,t)),clampY=e=>Math.max(0,Math.min(t,e));return[[new et.B(clampX(n*i),clampY(n*i)),new et.B(clampX(e-n*i),clampY(t-n*i))],[new et.B(clampX(n*i),clampY(t-n*i)),new et.B(clampX(e-n*i),clampY(n*i))]]}function getCheckBoxLines(e,t){let n=.82*Math.min(e,t),r=(e-n)/2,i=(t-n)/2,clampX=t=>Math.max(0,Math.min(e,t)),clampY=e=>Math.max(0,Math.min(t,e));return[[new et.B(clampX(r+.25*n),clampY(i+.52*n)),new et.B(clampX(r+.45*n),clampY(i+.82*n))],[new et.B(clampX(r+.45*n),clampY(i+.82*n)),new et.B(clampX(r+.82*n),clampY(i+.22*n))]]}function useColorSpace(){let[e,t]=(0,P.useState)(!1);(0,P.useEffect)(()=>{let e=CSS.supports("color","color(display-p3 1 1 1)"),n=matchMedia("(color-gamut: p3)");t(e&&n.matches);let onChange=()=>t(e&&n.matches);return n.addEventListener("change",onChange),()=>n.removeEventListener("change",onChange)},[]);let n=(0,b.Hg)($.forceSrgb);return n||!e?"srgb":"p3"}let HighlightShapeUtil=class HighlightShapeUtil extends e8.E{static type="highlight";static props=S.VW;static migrations=S.J1;hideResizeHandles=e=>HighlightShapeUtil_getIsDot(e);hideRotateHandle=e=>HighlightShapeUtil_getIsDot(e);hideSelectionBoundsFg=e=>HighlightShapeUtil_getIsDot(e);getDefaultProps(){return{segments:[],color:"black",size:"m",isComplete:!1,isPen:!1}}getGeometry(e){let t=getStrokeWidth(e);if(HighlightShapeUtil_getIsDot(e))return new Circle2d({x:-t/2,y:-t/2,radius:t/2,isFilled:!0});let{strokePoints:n,sw:r}=getHighlightStrokePoints(e,t,!0),i=getHighlightFreehandSettings({strokeWidth:r,showAsComplete:!0});return setStrokePointRadii(n,i),new ts.w({points:getStrokeOutlinePoints_getStrokeOutlinePoints(n,i),isFilled:!0})}component(e){return(0,T.jsx)(HighlightRenderer,{strokeWidth:getStrokeWidth(e),shape:e,opacity:.35})}backgroundComponent(e){return(0,T.jsx)(HighlightRenderer,{strokeWidth:getStrokeWidth(e),shape:e,opacity:.82})}indicator(e){let t;let n=useForceSolid(),r=getStrokeWidth(e),i=getPointsFromSegments(e.props.segments),o=r;n||e.props.isPen||1!==i.length||(o+=(0,v.Vk)(e.id)()*(r/6));let a=e.props.isComplete||v.Z$(e.props.segments)?.type==="straight",l=getHighlightFreehandSettings({strokeWidth:r,showAsComplete:a}),c=getStrokePoints(i,l);return t=c.length<2?getIndicatorDot(i[0],o):getSvgPathFromStrokePoints(c,!1),(0,T.jsx)("path",{d:t})}toSvg(e,t){let n=(0,S.y6)({isDarkMode:t.isDarkMode});return highlighterToSvg(getStrokeWidth(e),e,.35,n)}toBackgroundSvg(e){let t=(0,S.y6)({isDarkMode:this.editor.user.getIsDarkMode()});return highlighterToSvg(getStrokeWidth(e),e,.82,t)}onResize=(e,t)=>{let{scaleX:n,scaleY:r}=t,i=[];for(let t of e.props.segments)i.push({...t,points:t.points.map(({x:e,y:t,z:i})=>({x:n*e,y:r*t,z:i}))});return{props:{segments:i}}}};function getShapeDot(e){return`M ${e.x} ${e.y} m -0.1, 0 a 0.1,0.1 0 1,0 0.2,0 a 0.1,0.1 0 1,0 -0.2,0`}function getIndicatorDot(e,t){let n=t/2;return`M ${e.x} ${e.y} m -${n}, 0 a ${n},${n} 0 1,0 ${2*n},0 a ${n},${n} 0 1,0 -${2*n},0`}function getHighlightStrokePoints(e,t,n){let r=getPointsFromSegments(e.props.segments),i=e.props.isComplete||v.Z$(e.props.segments)?.type==="straight",o=t;n||e.props.isPen||1!==r.length||(o+=(0,v.Vk)(e.id)()*(t/6));let a=getHighlightFreehandSettings({strokeWidth:o,showAsComplete:i}),l=getStrokePoints(r,a);return{strokePoints:l,sw:o}}function getHighlightSvgPath(e,t,n){let{strokePoints:r,sw:i}=getHighlightStrokePoints(e,t,n),o=r.length>1?getSvgPathFromStrokePoints(r,!1):getShapeDot(e.props.segments[0].points[0]);return{solidStrokePath:o,sw:i}}function HighlightRenderer({strokeWidth:e,shape:t,opacity:n}){let r=useDefaultColorTheme(),i=useForceSolid(),{solidStrokePath:o,sw:a}=getHighlightSvgPath(t,e,i),l=useColorSpace(),c=r[t.props.color].highlight[l];return(0,T.jsx)(e3.g,{id:t.id,style:{opacity:n},children:(0,T.jsx)("path",{d:o,strokeLinecap:"round",fill:"none",pointerEvents:"all",stroke:c,strokeWidth:a})})}function highlighterToSvg(e,t,n,r){let{solidStrokePath:i,sw:o}=getHighlightSvgPath(t,e,!1),a=document.createElementNS("http://www.w3.org/2000/svg","path");return a.setAttribute("d",i),a.setAttribute("fill","none"),a.setAttribute("stroke",r[t.props.color].highlight.srgb),a.setAttribute("stroke-width",`${o}`),a.setAttribute("opacity",`${n}`),a}function getStrokeWidth(e){return 1.12*tv[e.props.size]}function HighlightShapeUtil_getIsDot(e){return 1===e.props.segments.length&&e.props.segments[0].points.length<2}function usePrefersReducedMotion(){let[e,t]=(0,P.useState)(!1);return(0,P.useEffect)(()=>{let e=window.matchMedia("(prefers-reduced-motion: reduce)"),handler=()=>{t(e.matches)};return handler(),e.addEventListener("change",handler),()=>e.removeEventListener("change",handler)},[]),e}let loadImage=async e=>new Promise((t,n)=>{let r=new Image;r.onload=()=>t(r),r.onerror=()=>n(Error("Failed to load image")),r.crossOrigin="anonymous",r.src=e}),getStateFrame=async e=>{let t=await loadImage(e),n=document.createElement("canvas");n.width=t.width,n.height=t.height;let r=n.getContext("2d");if(r)return r.drawImage(t,0,0),n.toDataURL()};async function getDataURIFromURL(e){let t=await fetch(e),n=await t.blob();return new Promise((e,t)=>{let r=new FileReader;r.onloadend=()=>e(r.result),r.onerror=t,r.readAsDataURL(n)})}let ImageShapeUtil=class ImageShapeUtil extends BaseBoxShapeUtil{static type="image";static props=S.Fc;static migrations=S.y5;isAspectRatioLocked=()=>!0;canCrop=()=>!0;getDefaultProps(){return{w:100,h:100,assetId:null,playing:!0,url:"",crop:null}}component(e){let t=getContainerStyle(e),n=useIsCropping(e.id),r=usePrefersReducedMotion(),[i,o]=(0,P.useState)(""),a=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;if(a?.type==="bookmark")throw Error("Bookmark assets can't be rendered as images");let l=(0,b.Hg)("onlySelectedShape",()=>e.id===this.editor.getOnlySelectedShape()?.id,[this.editor]),c=l&&n&&this.editor.isInAny("select.crop","select.cropping","select.pointing_crop_handle"),u=r&&(a?.props.mimeType?.includes("video")||a?.props.mimeType?.includes("gif"));return(0,P.useEffect)(()=>{if(a?.props.src&&"mimeType"in a.props&&a?.props.mimeType==="image/gif"){let e=!1,run=async()=>{let t=await getStateFrame(a.props.src);!e&&t&&o(t)};return run(),()=>{e=!0}}},[r,a?.props]),(0,T.jsxs)(T.Fragment,{children:[a?.props.src&&c&&(0,T.jsx)("div",{style:t,children:(0,T.jsx)("div",{className:"tl-image",style:{opacity:.1,backgroundImage:`url(${!e.props.playing||u?i:a.props.src})`},draggable:!1})}),(0,T.jsxs)(HTMLContainer,{id:e.id,style:{overflow:"hidden",width:e.props.w,height:e.props.h},children:[(0,T.jsxs)("div",{className:"tl-image-container",style:t,children:[a?.props.src?(0,T.jsx)("div",{className:"tl-image",style:{backgroundImage:`url(${!e.props.playing||u?i:a.props.src})`},draggable:!1}):null,a?.props.isAnimated&&!e.props.playing&&(0,T.jsx)("div",{className:"tl-image__tg",children:"GIF"})]}),"url"in e.props&&e.props.url&&(0,T.jsx)(HyperlinkButton,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})]})}indicator(e){let t=useIsCropping(e.id);return t?null:(0,T.jsx)("rect",{width:(0,E.$Z)(e.props.w),height:(0,E.$Z)(e.props.h)})}shouldGetDataURI(e){return e&&(e.startsWith("http")||e.startsWith("/")||e.startsWith("./"))}async toSvg(e){let t=document.createElementNS("http://www.w3.org/2000/svg","g"),n=e.props.assetId?this.editor.getAsset(e.props.assetId):null,r=n?.props.src||"";this.shouldGetDataURI(r)&&(r=await getDataURIFromURL(r)||"");let i=document.createElementNS("http://www.w3.org/2000/svg","image");i.setAttributeNS("http://www.w3.org/1999/xlink","href",r);let o=getContainerStyle(e),a=e.props.crop;if(o.transform&&a){let{transform:e,width:n,height:r}=o,l=(a.bottomRight.x-a.topLeft.x)*n,c=(a.bottomRight.y-a.topLeft.y)*r,u=[new et.B(0,0),new et.B(l,0),new et.B(l,c),new et.B(0,c)],d=document.createElementNS("http://www.w3.org/2000/svg","polygon");d.setAttribute("points",u.map(e=>`${e.x},${e.y}`).join(" "));let p=document.createElementNS("http://www.w3.org/2000/svg","clipPath");p.setAttribute("id","cropClipPath"),p.appendChild(d);let h=document.createElementNS("http://www.w3.org/2000/svg","defs");h.appendChild(p),t.appendChild(h);let g=document.createElementNS("http://www.w3.org/2000/svg","g");g.setAttribute("clip-path","url(#cropClipPath)"),i.setAttribute("width",n.toString()),i.setAttribute("height",r.toString()),i.style.transform=e,g.appendChild(i),t.appendChild(g)}else i.setAttribute("width",e.props.w.toString()),i.setAttribute("height",e.props.h.toString()),t.appendChild(i);return t}onDoubleClick=e=>{let t=e.props.assetId?this.editor.getAsset(e.props.assetId):void 0;if(!t)return;let n=t.props.src&&"mimeType"in t.props&&"image/gif"===t.props.mimeType;n&&this.editor.updateShapes([{type:"image",id:e.id,props:{playing:!e.props.playing}}])};onDoubleClickEdge=e=>{let t=e.props;if(!t||this.editor.getCroppingShapeId()!==e.id)return;let n=(0,v.p$)(t.crop)||{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},r=1/(n.bottomRight.x-n.topLeft.x)*e.props.w,i=1/(n.bottomRight.y-n.topLeft.y)*e.props.h,o=new et.B(n.topLeft.x*r,n.topLeft.y*i).rot(e.rotation),a={id:e.id,type:e.type,x:e.x-o.x,y:e.y-o.y,props:{crop:{topLeft:{x:0,y:0},bottomRight:{x:1,y:1}},w:r,h:i}};this.editor.updateShapes([a])}};function getContainerStyle(e){let t=e.props.crop,n=t?.topLeft;if(!n)return{width:e.props.w,height:e.props.h};let r=1/(t.bottomRight.x-t.topLeft.x)*e.props.w,i=1/(t.bottomRight.y-t.topLeft.y)*e.props.h,o=-n.x*r,a=-n.y*i;return{transform:`translate(${o}px, ${a}px)`,width:r,height:i}}function getSvgPathForEdge(e,t){let{start:n,end:r}=e;return t?`M${(0,E.$Z)(n.x)},${(0,E.$Z)(n.y)} L${(0,E.$Z)(r.x)},${(0,E.$Z)(r.y)} `:`${(0,E.$Z)(r.x)},${(0,E.$Z)(r.y)} `}function getSvgPathForBezierCurve(e,t){let{a:n,b:r,c:i,d:o}=e;return et.B.Equals(n,o)?"":`${t?`M${(0,E.$Z)(n.x)},${(0,E.$Z)(n.y)}`:""}C${(0,E.$Z)(r.x)},${(0,E.$Z)(r.y)} ${(0,E.$Z)(i.x)},${(0,E.$Z)(i.y)} ${(0,E.$Z)(o.x)},${(0,E.$Z)(o.y)}`}function getSvgPathForCubicSpline(e,t){let n=e.segments.reduce((e,t,n)=>e+getSvgPathForBezierCurve(t,0===n),"");return t&&(n+="Z"),n}function getSvgPathForPolylineSpline(e,t){let n=e.segments.reduce((e,t,n)=>e+getSvgPathForEdge(t,0===n),"");return t&&(n+="Z"),n}function getSvgPathForLineGeometry(e,t=!1){return e instanceof to.q?getSvgPathForPolylineSpline(e,t):getSvgPathForCubicSpline(e,t)}function getLineDrawFreehandOptions(e){return{size:e,thinning:.4,streamline:0,smoothing:.5,simulatePressure:!0,last:!0}}function getLineStrokePoints(e,t,n){let r=t.vertices,i=getLineDrawFreehandOptions(n);return getStrokePoints(r,i)}function getLineDrawStrokeOutlinePoints(e,t,n){let r=getLineDrawFreehandOptions(n);return getStrokeOutlinePoints_getStrokeOutlinePoints(setStrokePointRadii(getLineStrokePoints(e,t,n),r),r)}function getLineDrawPath(e,t,n){let r=getLineDrawStrokeOutlinePoints(e,t,n);return getSvgPathFromPoints_getSvgPathFromPoints(r)}function getLineIndicatorPath(e,t,n){if("draw"===e.props.dash){let r=getLineStrokePoints(e,t,n);return getSvgPathFromStrokePoints(r)}return getSvgPathForLineGeometry(t)}let t2=new tc._;let LineShapeUtil=class LineShapeUtil extends e8.E{static type="line";static props=S.BG;static migrations=S.FH;hideResizeHandles=()=>!0;hideRotateHandle=()=>!0;hideSelectionBoundsFg=()=>!0;hideSelectionBoundsBg=()=>!0;getDefaultProps(){let[e,t]=(0,v.H$)(2);return{dash:"draw",size:"m",color:"black",spline:"line",points:{[e]:{id:e,index:e,x:0,y:0},[t]:{id:t,index:t,x:.1,y:.1}}}}getGeometry(e){return getGeometryForLineShape(e)}getHandles(e){return t2.get(e.props,()=>{let t=getGeometryForLineShape(e),n=linePointsToArray(e),r=n.map(e=>({...e,id:e.index,type:"vertex",canSnap:!0}));for(let e=0;e<n.length-1;e++){let i=(0,v.eI)(n[e].index,n[e+1].index),o=t.segments[e],a=o.midPoint();r.push({id:i,type:"create",index:i,x:a.x,y:a.y,canSnap:!0})}return r.sort(v.hl)})}onResize=(e,t)=>{let{scaleX:n,scaleY:r}=t;return{props:{points:(0,v.Fm)(e.props.points,(e,{id:t,index:i,x:o,y:a})=>({id:t,index:i,x:o*n,y:a*r}))}}};onHandleDrag=(e,{handle:t})=>{if("vertex"===t.type)return{...e,props:{...e.props,points:{...e.props.points,[t.id]:{id:t.id,index:t.index,x:t.x,y:t.y}}}}};component(e){let t=useDefaultColorTheme(),n=getGeometryForLineShape(e),r=tS[e.props.size],{dash:i,color:o}=e.props;if("line"===e.props.spline){if("solid"===i){let i=n.points,a="M"+i[0]+"L"+i.slice(1);return(0,T.jsxs)(e3.g,{id:e.id,children:[(0,T.jsx)(tO,{d:a,fill:"none",color:o,theme:t}),(0,T.jsx)("path",{d:a,stroke:t[o].solid,strokeWidth:r,fill:"none"})]})}if("dashed"===i||"dotted"===i){let a=n.points,l="M"+a[0]+"L"+a.slice(1);return(0,T.jsxs)(e3.g,{id:e.id,children:[(0,T.jsx)(tO,{d:l,fill:"none",color:o,theme:t}),(0,T.jsx)("g",{stroke:t[o].solid,strokeWidth:r,children:n.segments.map((e,t)=>{let{strokeDasharray:o,strokeDashoffset:a}=getPerfectDashProps(e.length,r,{style:i,start:t>0?"outset":"none",end:t<n.segments.length-1?"outset":"none"});return(0,T.jsx)("path",{strokeDasharray:o,strokeDashoffset:a,d:getSvgPathForEdge(e,!0),fill:"none"},t)})})]})}if("draw"===i){let i=n.points,[a,l]=getDrawLinePathData(e.id,i,r);return(0,T.jsxs)(e3.g,{id:e.id,children:[(0,T.jsx)(tO,{d:a,fill:"none",color:o,theme:t}),(0,T.jsx)("path",{d:l,stroke:t[o].solid,strokeWidth:r,fill:"none"})]})}}if("cubic"===e.props.spline){let a=getSvgPathForLineGeometry(n);if("solid"===i)return(0,T.jsxs)(e3.g,{id:e.id,children:[(0,T.jsx)(tO,{d:a,fill:"none",color:o,theme:t}),(0,T.jsx)("path",{strokeWidth:r,stroke:t[o].solid,fill:"none",d:a})]});if("dashed"===i||"dotted"===i)return(0,T.jsxs)(e3.g,{id:e.id,children:[(0,T.jsx)(tO,{d:a,fill:"none",color:o,theme:t}),(0,T.jsx)("g",{stroke:t[o].solid,strokeWidth:r,children:n.segments.map((e,t)=>{let{strokeDasharray:o,strokeDashoffset:a}=getPerfectDashProps(e.length,r,{style:i,start:t>0?"outset":"none",end:t<n.segments.length-1?"outset":"none"});return(0,T.jsx)("path",{strokeDasharray:o,strokeDashoffset:a,d:getSvgPathForBezierCurve(e,!0),fill:"none"},t)})})]});if("draw"===i)return(0,T.jsxs)(e3.g,{id:e.id,children:[(0,T.jsx)(tO,{d:a,fill:"none",color:o,theme:t}),(0,T.jsx)("path",{d:getLineDrawPath(e,n,r),strokeWidth:1,stroke:t[o].solid,fill:t[o].solid})]})}}indicator(e){let t;let n=tS[e.props.size],r=getGeometryForLineShape(e),{dash:i}=e.props;if("line"===e.props.spline){let o=r.points;if("solid"===i||"dotted"===i||"dashed"===i)t="M"+o[0]+"L"+o.slice(1);else{let[r]=getDrawLinePathData(e.id,o,n);t=r}}else t=getLineIndicatorPath(e,r,n);return(0,T.jsx)("path",{d:t})}toSvg(e,t){let n=(0,S.y6)({isDarkMode:t.isDarkMode}),r=n[e.props.color].solid,i=getGeometryForLineShape(e),o=tS[e.props.size];switch(e.props.dash){case"draw":{let t;if(i instanceof CubicSpline2d)t=getLineDrawPath(e,i,o);else{let[n,r]=getDrawLinePathData(e.id,i.points,o);t=r}let n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("stroke-width",o+"px"),n.setAttribute("stroke",r),n.setAttribute("fill","none"),n.setAttribute("d",t),n}case"solid":{let e;if(i instanceof CubicSpline2d)e=getSvgPathForCubicSpline(i,!1);else{let t=i.points;e="M"+t[0]+"L"+t.slice(1)}let t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("stroke-width",o+"px"),t.setAttribute("stroke",r),t.setAttribute("fill","none"),t.setAttribute("d",e),t}default:{let{segments:t}=i,n=document.createElementNS("http://www.w3.org/2000/svg","g");n.setAttribute("stroke",r),n.setAttribute("stroke-width",o.toString());let a=i instanceof CubicSpline2d?getSvgPathForBezierCurve:getSvgPathForEdge;return t.forEach((r,i)=>{let l=document.createElementNS("http://www.w3.org/2000/svg","path"),{strokeDasharray:c,strokeDashoffset:u}=getPerfectDashProps(r.length,o,{style:e.props.dash,start:i>0?"outset":"none",end:i<t.length-1?"outset":"none"});l.setAttribute("stroke-dasharray",c.toString()),l.setAttribute("stroke-dashoffset",u.toString()),l.setAttribute("d",a(r,!0)),l.setAttribute("fill","none"),n.appendChild(l)}),n}}}getHandleSnapGeometry(e){let t=linePointsToArray(e);return{points:t,getSelfSnapPoints:n=>{let r=this.getHandles(e).filter(e=>"vertex"===e.type).findIndex(e=>e.id===n.id);return t.filter((e,t)=>Math.abs(t-r)>1).map(et.B.From)},getSelfSnapOutline:t=>{let n=this.getHandles(e).filter(e=>"vertex"===e.type).findIndex(e=>e.id===t.id),r=getGeometryForLineShape(e).segments.filter((e,t)=>t!==n-1&&t!==n);return r.length?new es.m({children:r}):null}}}};function linePointsToArray(e){return Object.values(e.props.points).sort(v.hl)}function getGeometryForLineShape(e){let t=linePointsToArray(e).map(et.B.From);switch(e.props.spline){case"cubic":return new CubicSpline2d({points:t});case"line":return new to.q({points:t})}}let NoteShapeUtil=class NoteShapeUtil extends e8.E{static type="note";static props=S.m0;static migrations=S.C_;canEdit=()=>!0;hideResizeHandles=()=>!0;hideSelectionBoundsFg=()=>!0;getDefaultProps(){return{color:"black",size:"m",text:"",font:"draw",align:"middle",verticalAlign:"middle",growY:0,url:""}}getHeight(e){return 200+e.props.growY}getGeometry(e){let t=this.getHeight(e);return new e4.z({width:200,height:t,isFilled:!0})}component(e){let{id:t,type:n,props:{color:r,font:i,size:o,align:a,text:l,verticalAlign:c}}=e,u=useDefaultColorTheme(),d="black"===r?"yellow":r;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)("div",{style:{position:"absolute",width:200,height:this.getHeight(e)},children:(0,T.jsxs)("div",{className:"tl-note__container",style:{color:u[d].solid,backgroundColor:u[d].solid},children:[(0,T.jsx)("div",{className:"tl-note__scrim"}),(0,T.jsx)(tG,{id:t,type:n,font:i,size:o,align:a,verticalAlign:c,text:l,labelColor:"black",wrap:!0})]})}),"url"in e.props&&e.props.url&&(0,T.jsx)(HyperlinkButton,{url:e.props.url,zoomLevel:this.editor.getZoomLevel()})]})}indicator(e){return(0,T.jsx)("rect",{rx:"6",width:(0,E.$Z)(200),height:(0,E.$Z)(this.getHeight(e))})}toSvg(e,t){t.addExportDef(getFontDefForExport(e.props.font));let n=(0,S.y6)({isDarkMode:t.isDarkMode}),r=this.editor.getShapeGeometry(e).bounds,i=document.createElementNS("http://www.w3.org/2000/svg","g"),o="black"===e.props.color?"yellow":e.props.color,a=document.createElementNS("http://www.w3.org/2000/svg","rect");a.setAttribute("rx","10"),a.setAttribute("width","200"),a.setAttribute("height",r.height.toString()),a.setAttribute("fill",n[o].solid),a.setAttribute("stroke",n[o].solid),a.setAttribute("stroke-width","1"),i.appendChild(a);let l=document.createElementNS("http://www.w3.org/2000/svg","rect");l.setAttribute("rx","10"),l.setAttribute("width","200"),l.setAttribute("height",r.height.toString()),l.setAttribute("fill",n.background),l.setAttribute("opacity",".28"),i.appendChild(l);let c=getTextLabelSvgElement({editor:this.editor,shape:e,font:S.p6[e.props.font],bounds:r});return c.setAttribute("fill",n.text),c.setAttribute("stroke","none"),i.appendChild(c),i}onBeforeCreate=e=>getGrowY(this.editor,e,e.props.growY);onBeforeUpdate=(e,t)=>{if(e.props.text!==t.props.text||e.props.font!==t.props.font||e.props.size!==t.props.size)return getGrowY(this.editor,t,e.props.growY)};onEditEnd=e=>{let{id:t,type:n,props:{text:r}}=e;r.trimEnd()!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])}};function getGrowY(e,t,n=0){let r=e.textMeasure.measureText(t.props.text,{...tw,fontFamily:tP[t.props.font],fontSize:tx[t.props.size],maxWidth:166}),i=r.h+34,o=null;if(i>200?o=i-200:n&&(o=0),null!==o)return{...t,props:{...t.props,growY:o}}}function resizeScaled(e,{initialBounds:t,scaleX:n,scaleY:r,newPoint:i}){let o=Math.max(.01,Math.min(Math.abs(n),Math.abs(r))),a=new et.B(0,0);n<0&&(a.x=-(t.width*o)),r<0&&(a.y=-(t.height*o));let{x:l,y:c}=et.B.Add(i,a.rot(e.rotation));return{x:l,y:c,props:{scale:o*e.props.scale}}}let t3=new tc._;let TextShapeUtil=class TextShapeUtil extends e8.E{static type="text";static props=S.XB;static migrations=S.pL;getDefaultProps(){return{color:"black",size:"m",w:8,text:"",font:"draw",align:"middle",autoSize:!0,scale:1}}getMinDimensions(e){return t3.get(e.props,e=>getTextSize(this.editor,e))}getGeometry(e){let{scale:t}=e.props,{width:n,height:r}=this.getMinDimensions(e);return new e4.z({width:n*t,height:r*t,isFilled:!0})}canEdit=()=>!0;isAspectRatioLocked=()=>!0;component(e){let{id:t,type:n,props:{text:r,color:i}}=e,o=(0,S.y6)({isDarkMode:this.editor.user.getIsDarkMode()}),{width:a,height:l}=this.getMinDimensions(e),{rInput:c,isEmpty:u,isEditing:d,handleFocus:p,handleChange:h,handleKeyDown:g,handleBlur:f,handleInputPointerDown:m,handleDoubleClick:y}=useEditableText(t,n,r);return(0,T.jsx)(HTMLContainer,{id:e.id,children:(0,T.jsxs)("div",{className:"tl-text-shape__wrapper tl-text-shadow","data-font":e.props.font,"data-align":e.props.align,"data-hastext":!u,"data-isediting":d,"data-textwrap":!0,style:{fontSize:tv[e.props.size],lineHeight:tv[e.props.size]*tw.lineHeight+"px",transform:`scale(${e.props.scale})`,transformOrigin:"top left",width:Math.max(1,a),height:Math.max(tv[e.props.size]*tw.lineHeight,l),color:o[i].solid},children:[(0,T.jsx)("div",{className:"tl-text tl-text-content",dir:"ltr",children:r}),d?(0,T.jsx)("textarea",{ref:c,className:"tl-text tl-text-input",name:"text",tabIndex:-1,autoComplete:"false",autoCapitalize:"false",autoCorrect:"false",autoSave:"false",autoFocus:!0,placeholder:"",spellCheck:"true",wrap:"off",dir:"auto",datatype:"wysiwyg",defaultValue:r,onFocus:p,onChange:h,onKeyDown:g,onBlur:f,onTouchEnd:stopEventPropagation,onContextMenu:stopEventPropagation,onPointerDown:m,onDoubleClick:y}):null]})})}indicator(e){let t=this.editor.getShapeGeometry(e).bounds,n=(0,I.j)();return e.props.autoSize&&n.getEditingShapeId()===e.id?null:(0,T.jsx)("rect",{width:(0,E.$Z)(t.width),height:(0,E.$Z)(t.height)})}toSvg(e,t){t.addExportDef(getFontDefForExport(e.props.font));let n=(0,S.y6)({isDarkMode:t.isDarkMode}),r=this.editor.getShapeGeometry(e).bounds,i=e.props.text,o=r.width/(e.props.scale??1),a=r.height/(e.props.scale??1),l={fontSize:tv[e.props.size],fontFamily:S.p6[e.props.font],textAlign:e.props.align,verticalTextAlign:"middle",width:o,height:a,padding:0,lineHeight:tw.lineHeight,fontStyle:"normal",fontWeight:"normal",overflow:"wrap"},c=n[e.props.color].solid,u=document.createElementNS("http://www.w3.org/2000/svg","g"),d=createTextSvgElementFromSpans(this.editor,this.editor.textMeasure.measureTextSpans(i,l),{...l,stroke:n.background,strokeWidth:2,fill:n.background,padding:0}),p=d.cloneNode(!0);return p.setAttribute("fill",c),p.setAttribute("stroke","none"),u.append(d),u.append(p),u}onResize=(e,t)=>{let{initialBounds:n,initialShape:r,scaleX:i,handle:o}=t;if("scale_shape"===t.mode||"right"!==o&&"left"!==o)return{id:e.id,type:e.type,...resizeScaled(e,t)};{let t=n.width,a=t*i,l=new et.B(0,0);a=Math.max(1,Math.abs(a)),"left"===o?(l.x=t-a,i<0&&(l.x+=a)):i<0&&(l.x-=a);let{x:c,y:u}=l.rot(e.rotation).add(r);return{id:e.id,type:e.type,x:c,y:u,props:{w:a/r.props.scale,autoSize:!1}}}};onBeforeCreate=e=>{if(!e.props.autoSize||e.props.text.trim())return;let t=this.getMinDimensions(e);return{...e,x:e.x-t.width/2,y:e.y-t.height/2}};onEditEnd=e=>{let{id:t,type:n,props:{text:r}}=e,i=e.props.text.trimEnd();0===i.length?this.editor.deleteShapes([e.id]):i!==e.props.text&&this.editor.updateShapes([{id:t,type:n,props:{text:r.trimEnd()}}])};onBeforeUpdate=(e,t)=>{let n;if(!t.props.autoSize)return;let r=e.props.size!==t.props.size||e.props.align!==t.props.align||e.props.font!==t.props.font||1!==e.props.scale&&1===t.props.scale,i=e.props.text!==t.props.text;if(!r&&!i)return;let o=this.getMinDimensions(e),a=getTextSize(this.editor,t.props),l=o.width*e.props.scale,c=o.height*e.props.scale,u=a.width*t.props.scale,d=a.height*t.props.scale;switch(t.props.align){case"middle":n=new et.B((u-l)/2,i?0:(d-c)/2);break;case"end":n=new et.B(u-l,i?0:(d-c)/2);break;default:if(i)break;n=new et.B(0,(d-c)/2)}if(!n)return{...t,props:{...t.props,w:u}};{n.rot(t.rotation);let{x:e,y:r}=t;return{...t,x:e-n.x,y:r-n.y,props:{...t.props,w:u}}}};onDoubleClickEdge=e=>e.props.autoSize?1!==e.props.scale?{id:e.id,type:e.type,props:{scale:1}}:void 0:{id:e.id,type:e.type,props:{autoSize:!0}}};function getTextSize(e,t){let{font:n,text:r,autoSize:i,size:o,w:a}=t,l=i?16:Math.max(16,a),c=tv[o],u=e.textMeasure.measureText(r,{...tw,fontFamily:tP[n],fontSize:c,maxWidth:i?null:Math.floor(Math.max(l,a))});return i&&(u.w+=1),{width:Math.max(l,u.w),height:Math.max(c,u.h)}}let VideoShapeUtil=class VideoShapeUtil extends BaseBoxShapeUtil{static type="video";static props=S.p$;static migrations=S.lY;canEdit=()=>!0;isAspectRatioLocked=()=>!0;getDefaultProps(){return{w:100,h:100,assetId:null,time:0,playing:!0,url:""}}component(e){return(0,T.jsx)(t5,{shape:e,videoUtil:this})}indicator(e){return(0,T.jsx)("rect",{width:(0,E.$Z)(e.props.w),height:(0,E.$Z)(e.props.h)})}toSvg(e){let t=document.createElementNS("http://www.w3.org/2000/svg","g"),n=document.createElementNS("http://www.w3.org/2000/svg","image");return n.setAttributeNS("http://www.w3.org/1999/xlink","href",serializeVideo(e.id)),n.setAttribute("width",e.props.w.toString()),n.setAttribute("height",e.props.h.toString()),t.appendChild(n),t}};function serializeVideo(e){let t=e.split(":")[1],n=document.querySelector(`.tl-video-shape-${t}`);if(n){let e=document.createElement("canvas");return e.width=n.videoWidth,e.height=n.videoHeight,e.getContext("2d").drawImage(n,0,0),e.toDataURL("image/png")}throw Error("Video with not found when attempting serialization.")}let t5=(0,b.j)(function(e){let{shape:t,videoUtil:n}=e,r=n.editor.getShapeGeometry(t).bounds.w*n.editor.getZoomLevel()>=110,i=t.props.assetId?n.editor.getAsset(t.props.assetId):null,{time:o,playing:a}=t.props,l=useIsEditing(t.id),c=usePrefersReducedMotion(),u=P.useRef(null),d=P.useCallback(e=>{let r=e.currentTarget;n.editor.updateShapes([{type:"video",id:t.id,props:{playing:!0,time:r.currentTime}}])},[t.id,n.editor]),p=P.useCallback(e=>{let r=e.currentTarget;n.editor.updateShapes([{type:"video",id:t.id,props:{playing:!1,time:r.currentTime}}])},[t.id,n.editor]),h=P.useCallback(e=>{let r=e.currentTarget;l&&n.editor.updateShapes([{type:"video",id:t.id,props:{time:r.currentTime}}])},[l,t.id,n.editor]),[g,f]=P.useState(!1),m=P.useCallback(e=>{let t=e.currentTarget;o!==t.currentTime&&(t.currentTime=o),a||t.pause(),f(!0)},[a,o]);return P.useEffect(()=>{let e=u.current;e&&(g&&!l&&o!==e.currentTime&&(e.currentTime=o),l&&document.activeElement!==e&&e.focus())},[l,g,o]),P.useEffect(()=>{if(c){let e=u.current;e.pause(),e.currentTime=0}},[u,c]),(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(HTMLContainer,{id:t.id,children:(0,T.jsx)("div",{className:"tl-counter-scaled",children:i?.props.src?(0,T.jsx)("video",{ref:u,style:l?{pointerEvents:"all"}:void 0,className:`tl-video tl-video-shape-${t.id.split(":")[1]}`,width:"100%",height:"100%",draggable:!1,playsInline:!0,autoPlay:!0,muted:!0,loop:!0,disableRemotePlayback:!0,disablePictureInPicture:!0,controls:l&&r,onPlay:d,onPause:p,onTimeUpdate:h,onLoadedData:m,hidden:!g,children:(0,T.jsx)("source",{src:i.props.src})}):null})}),"url"in t.props&&t.props.url&&(0,T.jsx)(HyperlinkButton,{url:t.props.url,zoomLevel:n.editor.getZoomLevel()})]})}),t6=[TextShapeUtil,BookmarkShapeUtil,DrawShapeUtil,GeoShapeUtil,NoteShapeUtil,LineShapeUtil,FrameShapeUtil,ArrowShapeUtil,HighlightShapeUtil,EmbedShapeUtil,ImageShapeUtil,VideoShapeUtil];function registerDefaultSideEffects(e){return[e.sideEffects.registerAfterChangeHandler("instance",(t,n)=>{t.isFocused!==n.isFocused&&(n.isFocused?e.getContainer().focus():(e.complete(),e.getContainer().blur()))}),e.sideEffects.registerAfterChangeHandler("instance_page_state",(t,n)=>{if(t.croppingShapeId!==n.croppingShapeId){let r=e.isInAny("select.crop","select.pointing_crop_handle","select.cropping");!t.croppingShapeId&&n.croppingShapeId?r||e.setCurrentTool("select.crop.idle"):t.croppingShapeId&&!n.croppingShapeId&&r&&e.setCurrentTool("select.idle")}t.editingShapeId!==n.editingShapeId&&(!t.editingShapeId&&n.editingShapeId?e.isIn("select.editing_shape")||e.setCurrentTool("select.editing_shape"):t.editingShapeId&&!n.editingShapeId&&e.isIn("select.editing_shape")&&e.setCurrentTool("select.idle"))})]}let Erasing=class Erasing extends te.n{static id="erasing";info={};scribbleId="id";markId="";excludedShapeIds=new Set;onEnter=e=>{this.markId="erase scribble begin",this.editor.mark(this.markId),this.info=e;let{originPagePoint:t}=this.editor.inputs;this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(e=>{if(this.editor.isShapeOrAncestorLocked(e))return!0;if(this.editor.isShapeOfType(e,"group")||this.editor.isShapeOfType(e,"frame")){let n=this.editor.getPointInShapeSpace(e,t),r=this.editor.getShapeGeometry(e);return r.bounds.containsPoint(n)}return!1}).map(e=>e.id));let n=this.editor.scribbles.addScribble({color:"muted-1",size:12});this.scribbleId=n.id,this.update()};pushPointToScribble=()=>{let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};update(){let e=this.editor.getErasingShapeIds(),t=this.editor.getZoomLevel(),n=this.editor.getCurrentPageShapes(),{inputs:{currentPagePoint:r,previousPagePoint:i}}=this.editor,{excludedShapeIds:o}=this;this.pushPointToScribble();let a=new Set(e);for(let e of n){if(this.editor.isShapeOfType(e,"group"))continue;let n=this.editor.getShapeMask(e.id);if(n&&!(0,E.Of)(r,n))continue;let o=this.editor.getShapeGeometry(e),l=this.editor.getPointInShapeSpace(e,i),c=this.editor.getPointInShapeSpace(e,r);o.hitTestLineSegment(l,c,_.wM/t)&&a.add(this.editor.getOutermostSelectableShape(e).id)}this.editor.setErasingShapes([...a].filter(e=>!o.has(e)))}complete(){this.editor.deleteShapes(this.editor.getCurrentPageState().erasingShapeIds),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.editor.bailToMark(this.markId),this.parent.transition("idle",this.info)}};let childStates_Idle_Idle=class childStates_Idle_Idle extends te.n{static id="idle";onPointerDown=e=>{this.parent.transition("pointing",e)};onCancel=()=>{this.editor.setCurrentTool("select")}};let childStates_Pointing_Pointing=class childStates_Pointing_Pointing extends te.n{static id="pointing";onEnter=()=>{let e=this.editor.getZoomLevel(),t=this.editor.getCurrentPageShapesSorted(),{inputs:{currentPagePoint:n}}=this.editor,r=new Set,i=r.size;for(let o=t.length,a=o-1;a>=0;a--){let o=t[a];if(!(this.editor.isShapeOrAncestorLocked(o)||this.editor.isShapeOfType(o,"group"))&&this.editor.isPointInShape(o,n,{hitInside:!1,margin:_.wM/e})){let e=this.editor.getOutermostSelectableShape(o);if(this.editor.isShapeOfType(e,"frame")&&r.size>i)break;r.add(e.id)}}this.editor.setErasingShapes([...r])};onPointerMove=e=>{this.editor.inputs.isDragging&&this.parent.transition("erasing",e)};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.cancel()};complete(){let e=this.editor.getErasingShapeIds();e.length&&(this.editor.mark("erase end"),this.editor.deleteShapes(e)),this.editor.setErasingShapes([]),this.parent.transition("idle")}cancel(){this.editor.setErasingShapes([]),this.parent.transition("idle")}};let EraserTool=class EraserTool extends te.n{static id="eraser";static initial="idle";static children=()=>[childStates_Idle_Idle,childStates_Pointing_Pointing,Erasing];onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})}};let Dragging=class Dragging extends te.n{static id="dragging";onEnter=()=>{this.update()};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.complete()};onComplete=()=>{this.complete()};update(){let{currentScreenPoint:e,previousScreenPoint:t}=this.editor.inputs,n=et.B.Sub(e,t);(Math.abs(n.x)>0||Math.abs(n.y)>0)&&this.editor.pan(n)}complete(){this.editor.slideCamera({speed:Math.min(2,this.editor.inputs.pointerVelocity.len()),direction:this.editor.inputs.pointerVelocity,friction:_.$G}),this.parent.transition("idle")}};let HandTool_childStates_Idle_Idle=class HandTool_childStates_Idle_Idle extends te.n{static id="idle";onEnter=()=>{this.editor.setCursor({type:"grab",rotation:0})};onPointerDown=e=>{this.parent.transition("pointing",e)};onCancel=()=>{this.editor.setCurrentTool("select")}};let HandTool_childStates_Pointing_Pointing=class HandTool_childStates_Pointing_Pointing extends te.n{static id="pointing";onEnter=()=>{this.editor.stopCameraAnimation(),this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})};onPointerMove=e=>{this.editor.inputs.isDragging&&this.parent.transition("dragging",e)};onPointerUp=()=>{this.complete()};onCancel=()=>{this.complete()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.complete()};complete(){this.parent.transition("idle")}};let HandTool=class HandTool extends te.n{static id="hand";static initial="idle";static children=()=>[HandTool_childStates_Idle_Idle,HandTool_childStates_Pointing_Pointing,Dragging];onDoubleClick=e=>{if("settle"===e.phase){let{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomIn(e,{duration:220,easing:tn.L.easeOutQuint})}};onTripleClick=e=>{if("settle"===e.phase){let{currentScreenPoint:e}=this.editor.inputs;this.editor.zoomOut(e,{duration:320,easing:tn.L.easeOutQuint})}};onQuadrupleClick=e=>{if("settle"===e.phase){let e=this.editor.getZoomLevel(),{inputs:{currentScreenPoint:t}}=this.editor;1===e?this.editor.zoomToFit({duration:400,easing:tn.L.easeOutQuint}):this.editor.resetZoom(t,{duration:320,easing:tn.L.easeOutQuint})}}};let LaserTool_childStates_Idle_Idle=class LaserTool_childStates_Idle_Idle extends te.n{static id="idle";onPointerDown=e=>{this.parent.transition("lasering",e)}};let Lasering=class Lasering extends te.n{static id="lasering";scribbleId="id";onEnter=()=>{let e=this.editor.scribbles.addScribble({color:"laser",opacity:.7,size:4,delay:1200,shrink:.05,taper:!0});this.scribbleId=e.id,this.pushPointToScribble()};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.pushPointToScribble()};onPointerUp=()=>{this.complete()};pushPointToScribble=()=>{let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};complete(){this.parent.transition("idle")}cancel(){this.parent.transition("idle")}};let LaserTool=class LaserTool extends te.n{static id="laser";static initial="idle";static children=()=>[LaserTool_childStates_Idle_Idle,Lasering];onEnter=()=>{this.editor.setCursor({type:"cross",rotation:0})}};let Brushing=class Brushing extends te.n{static id="brushing";info={};brush=new eo.xu;initialSelectedShapeIds=[];excludedShapeIds=new Set;isWrapMode=!1;initialStartShape=null;onEnter=e=>{let{altKey:t,currentPagePoint:n}=this.editor.inputs;if(this.isWrapMode=this.editor.user.getIsWrapMode(),t){this.parent.transition("scribble_brushing",e);return}this.excludedShapeIds=new Set(this.editor.getCurrentPageShapes().filter(e=>this.editor.isShapeOfType(e,"group")||this.editor.isShapeOrAncestorLocked(e)).map(e=>e.id)),this.info=e,this.initialSelectedShapeIds=this.editor.getSelectedShapeIds().slice(),this.initialStartShape=this.editor.getShapesAtPoint(n)[0],this.onPointerMove()};onExit=()=>{this.initialSelectedShapeIds=[],this.editor.updateInstanceState({brush:null})};onTick=()=>{moveCameraWhenCloseToEdge(this.editor)};onPointerMove=()=>{this.hitTestShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=e=>{this.editor.setSelectedShapes(this.initialSelectedShapeIds,{squashing:!0}),this.parent.transition("idle",e)};onKeyDown=e=>{this.editor.inputs.altKey?this.parent.transition("scribble_brushing",e):this.hitTestShapes()};onKeyUp=()=>{this.hitTestShapes()};complete(){this.parent.transition("idle")}hitTestShapes(){let e,t,n,r,i,o;let a=this.editor.getZoomLevel(),l=this.editor.getCurrentPageShapes(),c=this.editor.getCurrentPageId(),{inputs:{originPagePoint:u,currentPagePoint:d,shiftKey:p,ctrlKey:h}}=this.editor;this.brush.setTo(eo.xu.FromPoints([u,d]));let g=new Set(p?this.initialSelectedShapeIds:[]),{corners:f}=this.brush,{excludedShapeIds:m,isWrapMode:y}=this,b=y?!h:h;for(let u=0,p=l.length;u<p;u++)if(n=l[u],!(m.has(n.id)||g.has(n.id))&&(r=this.editor.getShapePageBounds(n))){if(this.brush.contains(r)){this.handleHit(n,d,c,g,f);continue}if(!(b||this.editor.isShapeOfType(n,"frame"))&&this.brush.collides(r)){let r=this.editor.getShapeGeometry(n);if(!(i=this.editor.getShapePageTransform(n)))continue;o=i.clone().invert().applyToPoints(f);for(let i=0;i<o.length;i++)if(e=o[i],t=o[(i+1)%o.length],r.hitTestLineSegment(e,t,_.wM/a)){this.handleHit(n,d,c,g,f);break}}}this.editor.updateInstanceState({brush:{...this.brush.toJson()}}),this.editor.setSelectedShapes(Array.from(g),{squashing:!0})}onInterrupt=()=>{this.editor.updateInstanceState({brush:null})};handleHit(e,t,n,r,i){if(e.parentId===n){r.add(e.id);return}let o=this.editor.getOutermostSelectableShape(e),a=this.editor.getShapeMask(o.id);(!a||(0,tr.UQ)(a,i)||(0,E.Of)(t,a))&&r.add(o.id)}};function getHitShapeOnCanvasPointerDown(e){let t=e.getZoomLevel(),{inputs:{currentPagePoint:n}}=e;return e.getShapeAtPoint(n,{hitInside:!1,hitLabels:!1,margin:_.wM/t,renderingOnly:!0})??e.getSelectedShapeAtPoint(n)}function getTranslateCroppedImageChange(e,t,n){if(!t)throw Error("Needs to translate a cropped shape!");let{crop:r}=t.props;if(!r)return;let i=e.inputs.shiftKey?Math.abs(n.x)<Math.abs(n.y)?"x":"y":null;"x"===i?n.x=0:"y"===i&&(n.y=0),n.rot(-t.rotation);let o=1/(r.bottomRight.x-r.topLeft.x)*t.props.w,a=1/(r.bottomRight.y-r.topLeft.y)*t.props.h,l=r.bottomRight.y-r.topLeft.y,c=r.bottomRight.x-r.topLeft.x,u=(0,v.p$)(r);u.topLeft.x=Math.min(1-c,Math.max(0,u.topLeft.x-n.x/o)),u.topLeft.y=Math.min(1-l,Math.max(0,u.topLeft.y-n.y/a)),u.bottomRight.x=u.topLeft.x+c,u.bottomRight.y=u.topLeft.y+l;let d={id:t.id,type:t.type,props:{crop:u}};return d}let children_Idle_Idle=class children_Idle_Idle extends te.n{static id="idle";onEnter=()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0});let e=this.editor.getOnlySelectedShape();this.editor.on("change-history",this.cleanupCroppingState),e&&(this.editor.mark("crop"),this.editor.setCroppingShape(e.id))};onExit=()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.off("change-history",this.cleanupCroppingState)};onCancel=()=>{this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})};onPointerDown=e=>{if(!this.editor.getIsMenuOpen()){if(e.ctrlKey){this.cancel(),this.editor.root.handleEvent(e);return}switch(e.target){case"canvas":{let t=getHitShapeOnCanvasPointerDown(this.editor);if(t&&!this.editor.isShapeOfType(t,"group")){this.onPointerDown({...e,shape:t,target:"shape"});return}this.cancel(),this.editor.root.handleEvent(e);break}case"shape":if(e.shape.id===this.editor.getCroppingShapeId()){this.editor.setCurrentTool("select.crop.pointing_crop",e);return}this.editor.getShapeUtil(e.shape)?.canCrop(e.shape)?(this.editor.setCroppingShape(e.shape.id),this.editor.setSelectedShapes([e.shape.id]),this.editor.setCurrentTool("select.crop.pointing_crop",e)):(this.cancel(),this.editor.root.handleEvent(e));break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.editor.setCurrentTool("select.pointing_rotate_handle",{...e,onInteractionEnd:"select.crop"});break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":this.editor.setCurrentTool("select.pointing_crop_handle",{...e,onInteractionEnd:"select.crop"});break;default:this.cancel()}}}};onDoubleClick=e=>{if(this.editor.inputs.shiftKey||"up"!==e.phase)return;let t=this.editor.getCroppingShapeId();if(!t)return;let n=this.editor.getShape(t);if(!n)return;let r=this.editor.getShapeUtil(n);r&&"selection"===e.target&&r.onDoubleClickEdge?.(n)};onKeyDown=()=>{this.nudgeCroppingImage(!1)};onKeyRepeat=()=>{this.nudgeCroppingImage(!0)};onKeyUp=e=>{"Enter"===e.code&&(this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{}))};cancel(){this.editor.setCroppingShape(null),this.editor.setCurrentTool("select.idle",{})}cleanupCroppingState=()=>{this.editor.getCroppingShapeId()||this.editor.setCurrentTool("select.idle",{})};nudgeCroppingImage(e=!1){let{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),r=new et.B(0,0);if(t.has("ArrowLeft")&&(r.x+=1),t.has("ArrowRight")&&(r.x-=1),t.has("ArrowUp")&&(r.y+=1),t.has("ArrowDown")&&(r.y-=1),r.equals(new et.B(0,0)))return;n&&r.mul(10);let i=this.editor.getShape(this.editor.getCroppingShapeId());if(!i)return;let o=getTranslateCroppedImageChange(this.editor,i,r);o&&(e||this.editor.mark("translate crop"),this.editor.updateShapes([o]))}};let PointingCrop=class PointingCrop extends te.n{static id="pointing_crop";onCancel=()=>{this.editor.setCurrentTool("select.crop.idle",{})};onPointerMove=e=>{this.editor.inputs.isDragging&&this.editor.setCurrentTool("select.crop.translating_crop",e)};onPointerUp=e=>{this.editor.setCurrentTool("select.crop.idle",e)}};let TranslatingCrop=class TranslatingCrop extends te.n{static id="translating_crop";info={};markId="translating crop";snapshot={};onEnter=e=>{this.info=e,this.snapshot=this.createSnapshot(),this.editor.mark(this.markId),this.editor.setCursor({type:"move",rotation:0}),this.updateShapes()};onExit=()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};onPointerMove=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};onKeyDown=e=>{switch(e.key){case"Alt":case"Shift":this.updateShapes();return}};onKeyUp=e=>{switch(e.key){case"Enter":this.complete();return;case"Alt":case"Shift":this.updateShapes()}};complete(){this.updateShapes(),this.editor.setCurrentTool("select.crop.idle",this.info)}cancel(){this.editor.bailToMark(this.markId),this.editor.setCurrentTool("select.crop.idle",this.info)}createSnapshot(){let e=this.editor.getOnlySelectedShape();return{shape:e}}updateShapes(){let e=this.snapshot.shape;if(!e)return;let{originPagePoint:t,currentPagePoint:n}=this.editor.inputs,r=n.clone().sub(t),i=getTranslateCroppedImageChange(this.editor,e,r);i&&this.editor.updateShapes([i],{squashing:!0})}};let Crop=class Crop extends te.n{static id="crop";static initial="idle";static children=()=>[children_Idle_Idle,TranslatingCrop,PointingCrop]};let t4={bottom:"ns-resize",top:"ns-resize",left:"ew-resize",right:"ew-resize",bottom_left:"nesw-resize",bottom_right:"nwse-resize",top_left:"nwse-resize",top_right:"nesw-resize",bottom_left_rotate:"swne-rotate",bottom_right_rotate:"senw-rotate",top_left_rotate:"nwse-rotate",top_right_rotate:"nesw-rotate",mobile_rotate:"grabbing"};let PointingResizeHandle=class PointingResizeHandle extends te.n{static id="pointing_resize_handle";info={};updateCursor(){let e=this.editor.getSelectedShapes(),t=t4[this.info.handle];this.editor.updateInstanceState({cursor:{type:t,rotation:1===e.length?e[0].rotation:0}})}onEnter=e=>{this.info=e,this.updateCursor()};onPointerMove=()=>{let e=this.editor.inputs.isDragging;e&&this.parent.transition("resizing",this.info)};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}};let Cropping=class Cropping extends te.n{static id="cropping";info={};markId="";snapshot={};onEnter=e=>{this.info=e,this.markId="cropping",this.editor.mark(this.markId),this.snapshot=this.createSnapshot(),this.updateShapes()};onPointerMove=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};updateCursor(){let e=this.editor.getSelectedShapes()[0];if(!e)return;let t=t4[this.info.handle];this.editor.updateInstanceState({cursor:{type:t,rotation:e.rotation}})}getDefaultCrop=()=>({topLeft:{x:0,y:0},bottomRight:{x:1,y:1}});updateShapes(){let{shape:e,cursorHandleOffset:t}=this.snapshot;if(!e)return;let n=this.editor.getShapeUtil("image");if(!n)return;let r=e.props,i=this.editor.inputs.currentPagePoint.clone().sub(t),o=this.editor.inputs.originPagePoint.clone().sub(t),a=i.clone().sub(o).rot(-e.rotation),l=r.crop??this.getDefaultCrop(),c=(0,v.p$)(l),u=new et.B(e.x,e.y),d=new et.B(0,0),p=1/(l.bottomRight.x-l.topLeft.x)*r.w,h=1/(l.bottomRight.y-l.topLeft.y)*r.h,g=!1;switch(this.info.handle){case"top":case"top_left":case"top_right":{if(h<8)break;g=!0,c.topLeft.y=c.topLeft.y+a.y/h;let e=h*(c.bottomRight.y-c.topLeft.y);e<8?(c.topLeft.y=c.bottomRight.y-8/h,d.y=(c.topLeft.y-l.topLeft.y)*h):c.topLeft.y<=0?(c.topLeft.y=0,d.y=(c.topLeft.y-l.topLeft.y)*h):d.y=a.y;break}case"bottom":case"bottom_left":case"bottom_right":{if(h<8)break;g=!0,c.bottomRight.y=Math.min(1,c.bottomRight.y+a.y/h);let e=h*(c.bottomRight.y-c.topLeft.y);e<8&&(c.bottomRight.y=c.topLeft.y+8/h)}}switch(this.info.handle){case"left":case"top_left":case"bottom_left":{if(p<8)break;g=!0,c.topLeft.x=c.topLeft.x+a.x/p;let e=p*(c.bottomRight.x-c.topLeft.x);e<8?(c.topLeft.x=c.bottomRight.x-8/p,d.x=(c.topLeft.x-l.topLeft.x)*p):c.topLeft.x<=0?(c.topLeft.x=0,d.x=(c.topLeft.x-l.topLeft.x)*p):d.x=a.x;break}case"right":case"top_right":case"bottom_right":{if(p<8)break;g=!0,c.bottomRight.x=Math.min(1,c.bottomRight.x+a.x/p);let e=p*(c.bottomRight.x-c.topLeft.x);e<8&&(c.bottomRight.x=c.topLeft.x+8/p)}}if(!g)return;u.add(d.rot(e.rotation));let f={id:e.id,type:e.type,x:u.x,y:u.y,props:{crop:c,w:(c.bottomRight.x-c.topLeft.x)*p,h:(c.bottomRight.y-c.topLeft.y)*h}};this.editor.updateShapes([f],{squashing:!0}),this.updateCursor()}complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}createSnapshot(){let e=this.editor.getSelectionRotation(),{inputs:{originPagePoint:t}}=this.editor,n=this.editor.getOnlySelectedShape(),r=this.editor.getSelectionRotatedPageBounds(),i=et.B.RotWith(r.getHandlePoint(this.info.handle),r.point,e),o=et.B.Sub(t,i);return{shape:n,cursorHandleOffset:o}}};let DraggingHandle=class DraggingHandle extends te.n{static id="dragging_handle";shapeId="";initialHandle={};initialAdjacentHandle=null;initialPagePoint={};markId="";initialPageTransform;initialPageRotation;info={};isPrecise=!1;isPreciseId=null;pointingId=null;onEnter=e=>{let{shape:t,isCreating:n,handle:r}=e;if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.shapeId=t.id,this.markId=n?`creating:${t.id}`:"dragging handle",n||this.editor.mark(this.markId),this.initialHandle=(0,v.v4)(r),this.editor.isShapeOfType(t,"line")&&"create"===this.initialHandle.type){this.editor.updateShape({...t,props:{points:{...t.props.points,[r.index]:{id:r.index,index:r.index,x:r.x,y:r.y}}}});let e=this.editor.getShapeHandles(t),n=e.find(e=>e.index===r.index);this.initialHandle=(0,v.v4)(n)}this.initialPageTransform=this.editor.getShapePageTransform(t),this.initialPageRotation=this.initialPageTransform.rotation(),this.initialPagePoint=this.editor.inputs.originPagePoint.clone(),this.editor.updateInstanceState({cursor:{type:n?"cross":"grabbing",rotation:0}},{ephemeral:!0});let i=this.editor.getShapeHandles(t).sort(v.hl),o=i.findIndex(t=>t.id===e.handle.id);this.initialAdjacentHandle=null;for(let t=o+1;t<i.length;t++){let n=i[t];if("vertex"===n.type&&"middle"!==n.id&&n.id!==e.handle.id){this.initialAdjacentHandle=n;break}}if(!this.initialAdjacentHandle)for(let t=i.length-1;t>=0;t--){let n=i[t];if("vertex"===n.type&&"middle"!==n.id&&n.id!==e.handle.id){this.initialAdjacentHandle=n;break}}if(this.editor.isShapeOfType(t,"arrow")){let n=t.props[e.handle.id];this.isPrecise=!1,n?.type==="binding"?(this.editor.setHintingShapes([n.boundShapeId]),this.isPrecise=n.isPrecise,this.isPrecise?this.isPreciseId=n.boundShapeId:this.resetExactTimeout()):this.editor.setHintingShapes([])}this.update(),this.editor.select(this.shapeId)};exactTimeout=-1;resetExactTimeout(){-1!==this.exactTimeout&&this.clearExactTimeout(),this.exactTimeout=setTimeout(()=>{this.getIsActive()&&!this.isPrecise&&(this.isPrecise=!0,this.isPreciseId=this.pointingId,this.update()),this.exactTimeout=-1},750)}clearExactTimeout(){-1!==this.exactTimeout&&(clearTimeout(this.exactTimeout),this.exactTimeout=-1)}onPointerMove=()=>{this.update()};onKeyDown=()=>{this.update()};onKeyUp=()=>{this.update()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.setHintingShapes([]),this.editor.snaps.clearIndicators(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};complete(){this.editor.snaps.clearIndicators();let{onInteractionEnd:e}=this.info;if(this.editor.getInstanceState().isToolLocked&&e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.editor.snaps.clearIndicators();let{onInteractionEnd:e}=this.info;if(e){this.editor.setCurrentTool(e,{shapeId:this.shapeId});return}this.parent.transition("idle")}update(){let{editor:e,shapeId:t,initialPagePoint:n}=this,{initialHandle:r,initialPageRotation:i,initialAdjacentHandle:o}=this,a=this.editor.getHintingShapeIds(),l=this.editor.user.getIsSnapMode(),{snaps:c,inputs:{currentPagePoint:u,shiftKey:d,ctrlKey:p,altKey:h,pointerVelocity:g}}=e,f=this.info.shape,m=e.getShape(t);if(!m)return;let y=e.getShapeUtil(m),b=u.clone().sub(n).rot(-i).add(r);if(d&&o&&"middle"!==r.id){let e=et.B.Angle(o,b),t=(0,E.nD)(e,24),n=t-e;b=et.B.RotWith(b,o,n)}e.snaps.clearIndicators();let w={...r,x:b.x,y:b.y};if(r.canSnap&&(l?!p:p)){let n=e.getShapePageTransform(m.id);if(!n)throw Error("Expected a page transform");let i=c.handles.snapHandle({currentShapeId:t,handle:w});i&&(i.nudge.rot(-e.getShapeParentTransform(m).rotation()),b.add(i.nudge),w={...r,x:b.x,y:b.y})}let S=y.onHandleDrag?.(m,{handle:w,isPrecise:this.isPrecise||h,initial:f}),v={...m,...S};if(r.canBind){let t=v.props[r.id];t?.type==="binding"?a[0]!==t.boundShapeId&&(e.setHintingShapes([t.boundShapeId]),this.pointingId=t.boundShapeId,this.isPrecise=.5>g.len()||h,this.isPreciseId=this.isPrecise?t.boundShapeId:null,this.resetExactTimeout()):a.length>0&&(e.setHintingShapes([]),this.pointingId=null,this.isPrecise=!1,this.isPreciseId=null,this.resetExactTimeout())}S&&e.updateShapes([v],{squashing:!0})}};let EditingShape=class EditingShape extends te.n{static id="editing_shape";onEnter=()=>{let e=this.editor.getEditingShape();if(!e)throw Error("Entered editing state without an editing shape");updateHoveredId(this.editor),this.editor.select(e)};onExit=()=>{let{editingShapeId:e}=this.editor.getCurrentPageState();if(!e)return;this.editor.setEditingShape(null);let t=this.editor.getShape(e),n=this.editor.getShapeUtil(t);n.onEditEnd?.(t)};onPointerMove=e=>{switch(e.target){case"shape":case"canvas":updateHoveredId(this.editor);return}};onPointerDown=e=>{switch(e.target){case"canvas":{let t=getHitShapeOnCanvasPointerDown(this.editor);if(t){this.onPointerDown({...e,shape:t,target:"shape"});return}break}case"shape":{let{shape:t}=e,n=this.editor.getEditingShape();if(!n)throw Error("Expected an editing shape!");if(t.type===n.type){if(this.editor.isShapeOfType(t,"geo")||this.editor.isShapeOfType(t,"arrow")){let r=this.editor.getShapeUtil(t).getGeometry(t),i=r.children[1];if(i){let r=this.editor.getPointInShapeSpace(t,this.editor.inputs.currentPagePoint);if(i.bounds.containsPoint(r)){if(t.id===n.id)return;this.parent.transition("pointing_shape",e);return}}}else{t.id===n.id?this.editor.isShapeOfType(t,"frame")&&this.editor.setEditingShape(null):this.parent.transition("pointing_shape",e);return}}}}this.parent.transition("idle",e),this.editor.root.handleEvent(e)};onComplete=e=>{this.parent.transition("idle",e)};onCancel=e=>{this.parent.transition("idle",e)}};function getShouldEnterCropMode(e){let t=e.getOnlySelectedShape();return!!(t&&!e.isShapeOrAncestorLocked(t)&&e.getShapeUtil(t).canCrop(t))}function selectOnCanvasPointerUp(e){let t=e.getSelectedShapeIds(),{shiftKey:n,altKey:r,currentPagePoint:i}=e.inputs,o=e.getShapeAtPoint(i,{hitInside:!1,margin:_.wM/e.getZoomLevel(),hitLabels:!0,renderingOnly:!0,filter:e=>!e.isLocked});if(o){let i=e.getOutermostSelectableShape(o);if(n&&!r)e.cancelDoubleClick(),t.includes(i.id)?(e.mark("deselecting shape"),e.deselect(i)):(e.mark("shift selecting shape"),e.setSelectedShapes([...t,i.id]));else{let n;(n=i===o?o:i.id===e.getFocusedGroupId()||t.includes(i.id)?o:i)&&!t.includes(n.id)&&(e.mark("selecting shape"),e.select(n.id))}}else{if(n)return;{t.length>0&&(e.mark("selecting none"),e.selectNone());let n=e.getFocusedGroupId();if((0,S.YT)(n)){let t=e.getShape(n);e.isPointInShape(t,i,{margin:0,hitInside:!0})||e.setFocusedGroup(null)}}}}let SelectTool_childStates_Idle_Idle=class SelectTool_childStates_Idle_Idle extends te.n{static id="idle";onEnter=()=>{this.parent.setCurrentToolIdMask(void 0),updateHoveredId(this.editor),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};onPointerMove=()=>{updateHoveredId(this.editor)};onPointerDown=e=>{if(this.editor.getIsMenuOpen())return;let t=e.ctrlKey&&getShouldEnterCropMode(this.editor);if(e.ctrlKey&&!t){if("shape"===e.target&&this.isDarwin&&this.editor.inputs.keys.has("ControlLeft")&&!this.editor.isShapeOrAncestorLocked(e.shape)){this.parent.transition("pointing_shape",e);return}this.parent.transition("brushing",e);return}switch(e.target){case"canvas":{let t=getHitShapeOnCanvasPointerDown(this.editor);if(t&&!t.isLocked){this.onPointerDown({...e,shape:t,target:"shape"});return}let n=this.editor.getSelectedShapeIds(),r=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:i}}=this.editor;if((n.length>1||r&&!this.editor.getShapeUtil(r).hideSelectionBoundsBg(r))&&isPointInRotatedSelectionBounds(this.editor,i)){this.onPointerDown({...e,target:"selection"});return}this.parent.transition("pointing_canvas",e);break}case"shape":{let{shape:t}=e;if(this.isOverArrowLabelTest(t)){this.parent.transition("pointing_arrow_label",e);break}if(this.editor.isShapeOrAncestorLocked(t)){this.parent.transition("pointing_canvas",e);break}this.parent.transition("pointing_shape",e);break}case"handle":if(this.editor.getInstanceState().isReadonly)break;this.editor.inputs.altKey?this.parent.transition("pointing_shape",e):this.parent.transition("pointing_handle",e);break;case"selection":switch(e.handle){case"mobile_rotate":case"top_left_rotate":case"top_right_rotate":case"bottom_left_rotate":case"bottom_right_rotate":this.parent.transition("pointing_rotate_handle",e);break;case"top":case"right":case"bottom":case"left":case"top_left":case"top_right":case"bottom_left":case"bottom_right":t?this.parent.transition("pointing_crop_handle",e):this.parent.transition("pointing_resize_handle",e);break;default:{let t=this.editor.getHoveredShape();if(t&&!this.editor.getSelectedShapeIds().includes(t.id)&&!t.isLocked){this.onPointerDown({...e,shape:t,target:"shape"});return}this.parent.transition("pointing_selection",e)}}}};onDoubleClick=e=>{if(!this.editor.inputs.shiftKey&&"up"===e.phase)switch(e.target){case"canvas":{let t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getSelectedShapeAtPoint(this.editor.inputs.currentPagePoint)??this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:_.wM/this.editor.getZoomLevel(),hitInside:!1}),r=this.editor.getFocusedGroupId();if(n){if(this.editor.isShapeOfType(n,"group")){selectOnCanvasPointerUp(this.editor);return}{let e=this.editor.getShape(n.parentId);if(e&&this.editor.isShapeOfType(e,"group")){if(r&&e.id===r);else{selectOnCanvasPointerUp(this.editor);return}}}this.onDoubleClick({...e,shape:n,target:"shape"});return}this.editor.inputs.shiftKey||this.handleDoubleClickOnCanvas(e);break}case"selection":{if(this.editor.getInstanceState().isReadonly)break;let t=this.editor.getOnlySelectedShape();if(t){let n=this.editor.getShapeUtil(t);if(!this.canInteractWithShapeInReadOnly(t))return;if("right"===e.handle||"left"===e.handle||"top"===e.handle||"bottom"===e.handle){let e=n.onDoubleClickEdge?.(t);if(e){this.editor.mark("double click edge"),this.editor.updateShapes([e]);return}}if(n.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t)){this.parent.transition("crop",e);return}this.shouldStartEditingShape(t)&&this.startEditingShape(t,e)}break}case"shape":{let{shape:t}=e,n=this.editor.getShapeUtil(t);if("video"!==t.type&&"embed"!==t.type&&this.editor.getInstanceState().isReadonly)break;if(n.onDoubleClick){let r=n.onDoubleClick?.(t);if(r){this.editor.updateShapes([r]);return}if(n.canCrop(t)&&!this.editor.isShapeOrAncestorLocked(t)){this.editor.mark("select and crop"),this.editor.select(e.shape?.id),this.parent.transition("crop",e);return}}this.shouldStartEditingShape(t)?this.startEditingShape(t,e):this.handleDoubleClickOnCanvas(e);break}case"handle":{if(this.editor.getInstanceState().isReadonly)break;let{shape:t,handle:n}=e,r=this.editor.getShapeUtil(t),i=r.onDoubleClickHandle?.(t,n);i?this.editor.updateShapes([i]):this.shouldStartEditingShape(t)&&this.startEditingShape(t,e)}}};onRightClick=e=>{switch(e.target){case"canvas":{let t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{margin:_.wM/this.editor.getZoomLevel(),hitInside:!1,hitLabels:!0,hitFrameInside:!1,renderingOnly:!0});if(n){this.onRightClick({...e,shape:n,target:"shape"});return}let r=this.editor.getSelectedShapeIds(),i=this.editor.getOnlySelectedShape(),{inputs:{currentPagePoint:o}}=this.editor;if((r.length>1||i&&!this.editor.getShapeUtil(i).hideSelectionBoundsBg(i))&&isPointInRotatedSelectionBounds(this.editor,o)){this.onRightClick({...e,target:"selection"});return}this.editor.selectNone();break}case"shape":{let{selectedShapeIds:t}=this.editor.getCurrentPageState(),{shape:n}=e,r=this.editor.getOutermostSelectableShape(n,e=>!t.includes(e.id));t.includes(r.id)||(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([r.id]))}}};onCancel=()=>{this.editor.getFocusedGroupId()!==this.editor.getCurrentPageId()&&this.editor.getSelectedShapeIds().length>0?this.editor.popFocusedGroupId():(this.editor.mark("clearing selection"),this.editor.selectNone())};onKeyDown=e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.nudgeSelectedShapes(!1)}};onKeyRepeat=e=>{switch(e.code){case"ArrowLeft":case"ArrowRight":case"ArrowUp":case"ArrowDown":this.nudgeSelectedShapes(!0)}};onKeyUp=e=>{if("Enter"===e.code){let t=this.editor.getSelectedShapes();if(t.every(e=>this.editor.isShapeOfType(e,"group"))){this.editor.setSelectedShapes(t.flatMap(e=>this.editor.getSortedChildIdsForParent(e.id)));return}let n=this.editor.getOnlySelectedShape();if(n&&this.shouldStartEditingShape(n)){this.startEditingShape(n,{...e,target:"shape",shape:n});return}getShouldEnterCropMode(this.editor)&&this.parent.transition("crop",e)}};shouldStartEditingShape(e=this.editor.getOnlySelectedShape()){return!(!e||this.editor.isShapeOrAncestorLocked(e)&&"embed"!==e.type)&&!!this.canInteractWithShapeInReadOnly(e)&&this.editor.getShapeUtil(e).canEdit(e)}startEditingShape(e,t){this.editor.isShapeOrAncestorLocked(e)&&"embed"!==e.type||(this.editor.mark("editing shape"),this.editor.setEditingShape(e.id),this.parent.transition("editing_shape",t))}isDarwin=window.navigator.userAgent.toLowerCase().indexOf("mac")>-1;isOverArrowLabelTest(e){if(!e)return!1;let t=this.editor.getPointInShapeSpace(e,this.editor.inputs.currentPagePoint);if(this.editor.isShapeOfType(e,"arrow")){let n=this.editor.getShapeGeometry(e).children[1];if(n&&(0,E.Of)(t,n.vertices))return!0}return!1}handleDoubleClickOnCanvas(e){if(this.editor.getInstanceState().isReadonly)return;this.editor.mark("creating text shape");let t=(0,S.F1)(),{x:n,y:r}=this.editor.inputs.currentPagePoint;this.editor.createShapes([{id:t,type:"text",x:n,y:r,props:{text:"",autoSize:!0}}]);let i=this.editor.getShape(t);if(!i)return;let o=this.editor.getShapeUtil(i);(!this.editor.getInstanceState().isReadonly||o.canEditInReadOnly(i))&&(this.editor.setEditingShape(t),this.editor.select(t),this.parent.transition("editing_shape",e))}nudgeSelectedShapes(e=!1){let{editor:{inputs:{keys:t}}}=this,n=t.has("ShiftLeft"),r=new et.B(0,0);if(t.has("ArrowLeft")&&(r.x-=1),t.has("ArrowRight")&&(r.x+=1),t.has("ArrowUp")&&(r.y-=1),t.has("ArrowDown")&&(r.y+=1),r.equals(new et.B(0,0)))return;e||this.editor.mark("nudge shapes");let{gridSize:i}=this.editor.getDocumentSettings(),o=this.editor.getInstanceState().isGridMode?n?i*t9:i:n?t8:t7;this.editor.nudgeShapes(this.editor.getSelectedShapeIds(),r.mul(o))}canInteractWithShapeInReadOnly(e){if(!this.editor.getInstanceState().isReadonly)return!0;let t=this.editor.getShapeUtil(e);return!!t.canEditInReadOnly(e)}};let t8=10,t7=1,t9=5;function isPointInRotatedSelectionBounds(e,t){let n=e.getSelectionRotatedPageBounds();if(!n)return!1;let r=e.getSelectionRotation();return r?(0,E.Of)(t,n.corners.map(e=>et.B.RotWith(e,n.point,r))):n.containsPoint(t)}let PointingArrowLabel=class PointingArrowLabel extends te.n{static id="pointing_arrow_label";shapeId="";markId="";info={};updateCursor(){this.editor.setCursor({type:"grabbing",rotation:0})}onEnter=e=>{let{shape:t}=e;this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.shapeId=t.id,this.updateCursor();let n=this.editor.getShapeGeometry(t),r=n.children[1];if(!r)throw Error(`Expected to find an arrow label geometry for shape: ${t.id}`);let{currentPagePoint:i}=this.editor.inputs,o=this.editor.getPointInShapeSpace(t,i);this._labelDragOffset=et.B.Sub(r.center,o),this.markId="label-drag start",this.editor.mark(this.markId),this.editor.setSelectedShapes([this.shapeId])};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};_labelDragOffset=new et.B(0,0);onPointerMove=()=>{let e;let{isDragging:t}=this.editor.inputs;if(!t)return;let n=this.editor.getShape(this.shapeId);if(!n)return;let r=this.editor.getArrowInfo(n),i=this.editor.getShapeGeometry(n),o=i.children[0],a=this.editor.getPointInShapeSpace(n,this.editor.inputs.currentPagePoint),l=o.nearestPoint(et.B.Add(a,this._labelDragOffset));if(r.isStraight){let t=et.B.Dist(r.start.point,r.end.point),n=et.B.Dist(r.end.point,l);e=1-n/t}else{let{_center:t,measure:n,angleEnd:r,angleStart:o}=i.children[0];e=(0,E.rW)(n,o,r,t.angle(l))}isNaN(e)&&(e=.5),this.editor.updateShape({id:n.id,type:n.type,props:{labelPosition:e}},{squashing:!0})};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}};let PointingCanvas=class PointingCanvas extends te.n{static id="pointing_canvas";onEnter=()=>{let{inputs:e}=this.editor;!e.shiftKey&&this.editor.getSelectedShapeIds().length>0&&(this.editor.mark("selecting none"),this.editor.selectNone())};onPointerMove=e=>{this.editor.inputs.isDragging&&this.parent.transition("brushing",e)};onPointerUp=()=>{selectOnCanvasPointerUp(this.editor),this.complete()};onComplete=()=>{this.complete()};onInterrupt=()=>{this.parent.transition("idle")};complete(){this.parent.transition("idle")}};let PointingCropHandle=class PointingCropHandle extends te.n{static id="pointing_crop_handle";info={};updateCursor(e){let t=t4[this.info.handle];this.editor.updateInstanceState({cursor:{type:t,rotation:e.rotation}})}onEnter=e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd);let t=this.editor.getSelectedShapes()[0];t&&(this.updateCursor(t),this.editor.setCroppingShape(t.id))};onExit=()=>{this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.setCurrentToolIdMask(void 0)};onPointerMove=()=>{let e=this.editor.inputs.isDragging;e&&this.parent.transition("cropping",{...this.info,onInteractionEnd:this.info.onInteractionEnd})};onPointerUp=()=>{this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):(this.editor.setCroppingShape(null),this.parent.transition("idle"))}};let PointingHandle=class PointingHandle extends te.n{static id="pointing_handle";info={};onEnter=e=>{this.info=e;let{shape:t}=e;if(this.editor.isShapeOfType(t,"arrow")){let n=t.props[e.handle.id];n?.type==="binding"&&this.editor.setHintingShapes([n.boundShapeId])}this.editor.updateInstanceState({cursor:{type:"grabbing",rotation:0}},{ephemeral:!0})};onExit=()=>{this.editor.setHintingShapes([]),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};onPointerUp=()=>{this.parent.transition("idle",this.info)};onPointerMove=()=>{this.editor.inputs.isDragging&&this.parent.transition("dragging_handle",this.info)};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle")}};let PointingRotateHandle=class PointingRotateHandle extends te.n{static id="pointing_rotate_handle";info={};updateCursor(){let e=this.editor.getSelectionRotation();this.editor.updateInstanceState({cursor:{type:t4[this.info.handle],rotation:e}})}onEnter=e=>{this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.info=e,this.updateCursor()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0})};onPointerMove=()=>{let{isDragging:e}=this.editor.inputs;e&&this.parent.transition("rotating",this.info)};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};complete(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}cancel(){this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}};let PointingSelection=class PointingSelection extends te.n{static id="pointing_selection";info={};onEnter=e=>{this.info=e};onPointerUp=e=>{selectOnCanvasPointerUp(this.editor),this.parent.transition("idle",e)};onPointerMove=e=>{this.editor.inputs.isDragging&&!this.editor.getInstanceState().isReadonly&&this.parent.transition("translating",e)};onDoubleClick=e=>{let t=this.editor.getHoveredShape(),n=t&&!this.editor.isShapeOfType(t,"group")?t:this.editor.getShapeAtPoint(this.editor.inputs.currentPagePoint,{hitInside:!0,margin:0,renderingOnly:!0});if(n){this.parent.transition("idle"),this.parent.onDoubleClick?.({...e,target:"shape",shape:this.editor.getShape(n)});return}};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle")}};let PointingShape=class PointingShape extends te.n{static id="pointing_shape";hitShape={};hitShapeForPointerUp={};didSelectOnEnter=!1;onEnter=e=>{let t=this.editor.getSelectedShapeIds(),n=this.editor.getSelectionRotatedPageBounds(),r=this.editor.getFocusedGroupId(),{inputs:{currentPagePoint:i,shiftKey:o,altKey:a}}=this.editor;this.hitShape=e.shape;let l=this.editor.getOutermostSelectableShape(e.shape);if(this.editor.getShapeUtil(e.shape).onClick||l.id===r||t.includes(l.id)||this.editor.isAncestorSelected(l.id)||t.length>1&&n?.containsPoint(i)){this.didSelectOnEnter=!1,this.hitShapeForPointerUp=l;return}this.didSelectOnEnter=!0,o&&!a?(this.editor.cancelDoubleClick(),t.includes(l.id)||(this.editor.mark("shift selecting shape"),this.editor.setSelectedShapes([...t,l.id]))):(this.editor.mark("selecting shape"),this.editor.setSelectedShapes([l.id]))};onPointerUp=e=>{let t=this.editor.getSelectedShapeIds(),n=this.editor.getFocusedGroupId(),r=this.editor.getZoomLevel(),{inputs:{currentPagePoint:i,shiftKey:o}}=this.editor,a=this.editor.getShapeAtPoint(i,{margin:_.wM/r,hitInside:!0,renderingOnly:!0})??this.hitShape,l=a?this.editor.getOutermostSelectableShape(a):this.hitShapeForPointerUp;if(l){let r=this.editor.getShapeUtil(l);if(r.onClick){let t=r.onClick?.(l);if(t){this.editor.mark("shape on click"),this.editor.updateShapes([t]),this.parent.transition("idle",e);return}}if(l.id===n){t.length>0?(this.editor.mark("clearing shape ids"),this.editor.setSelectedShapes([])):this.editor.popFocusedGroupId(),this.parent.transition("idle",e);return}}if(!this.didSelectOnEnter){let e=this.editor.getOutermostSelectableShape(a,e=>!t.includes(e.id));if(t.includes(e.id)){if(o)this.editor.mark("deselecting on pointer up"),this.editor.deselect(l);else if(t.includes(l.id)){if(1===t.length&&(this.editor.isShapeOfType(l,"geo")||this.editor.isShapeOfType(l,"arrow"))){let e=this.editor.getShapeGeometry(l),t=e.children[1];if(t){let e=this.editor.getPointInShapeSpace(l,i);if(t.bounds.containsPoint(e,0)&&t.hitTestPoint(e)){this.editor.batch(()=>{this.editor.mark("editing on pointer up"),this.editor.select(l.id);let e=this.editor.getShapeUtil(l);(!this.editor.getInstanceState().isReadonly||e.canEditInReadOnly(l))&&(this.editor.setEditingShape(l.id),this.editor.setCurrentTool("select.editing_shape"))});return}}}this.editor.mark("selecting on pointer up"),this.editor.select(l.id)}else this.editor.mark("selecting on pointer up"),this.editor.select(l)}else if(o){let t=this.editor.getShapeAncestors(e);this.editor.mark("shift deselecting on pointer up"),this.editor.setSelectedShapes([...this.editor.getSelectedShapeIds().filter(e=>!t.find(t=>t.id===e)),e.id])}else this.editor.mark("selecting on pointer up"),this.editor.setSelectedShapes([e.id])}this.parent.transition("idle",e)};onPointerMove=e=>{this.editor.inputs.isDragging&&!this.editor.getInstanceState().isReadonly&&this.parent.transition("translating",e)};onCancel=()=>{this.cancel()};onComplete=()=>{this.cancel()};onInterrupt=()=>{this.cancel()};cancel(){this.parent.transition("idle")}};let Resizing=class Resizing extends te.n{static id="resizing";info={};markId="";didHoldCommand=!1;creationCursorOffset={x:0,y:0};snapshot={};onEnter=e=>{let{isCreating:t=!1,creationCursorOffset:n={x:0,y:0}}=e;this.info=e,this.didHoldCommand=!1,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.creationCursorOffset=n,this.snapshot=this._createSnapshot(),t?(this.markId=`creating:${this.editor.getOnlySelectedShape().id}`,this.editor.updateInstanceState({cursor:{type:"cross",rotation:0}},{ephemeral:!0})):(this.markId="starting resizing",this.editor.mark(this.markId)),this.handleResizeStart(),this.updateShapes()};onTick=()=>{moveCameraWhenCloseToEdge(this.editor)};onPointerMove=()=>{this.updateShapes()};onKeyDown=()=>{this.updateShapes()};onKeyUp=()=>{this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};cancel(){this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,{}):this.parent.transition("idle")}complete(){if(this.handleResizeEnd(),this.info.isCreating&&this.info.onCreate){this.info.onCreate?.(this.editor.getOnlySelectedShape());return}if(this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd){this.editor.setCurrentTool(this.info.onInteractionEnd,{});return}this.parent.transition("idle")}handleResizeStart(){let{shapeSnapshots:e}=this.snapshot,t=[];e.forEach(({shape:e})=>{let n=this.editor.getShapeUtil(e),r=n.onResizeStart?.(e);r&&t.push(r)}),t.length>0&&this.editor.updateShapes(t)}handleResizeEnd(){let{shapeSnapshots:e}=this.snapshot,t=[];e.forEach(({shape:e})=>{let n=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=r.onResizeEnd?.(e,n);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){let{altKey:e,shiftKey:t}=this.editor.inputs,{frames:n,shapeSnapshots:r,selectionBounds:i,cursorHandleOffset:o,selectedShapeIds:a,selectionRotation:l,canShapesDeform:c}=this.snapshot,u=t||!c,{ctrlKey:d}=this.editor.inputs,p=this.editor.inputs.currentPagePoint.clone().sub(o).sub(this.creationCursorOffset),h=this.editor.inputs.originPagePoint.clone().sub(o);if(this.editor.getInstanceState().isGridMode&&!d){let{gridSize:e}=this.editor.getDocumentSettings();p.snapToGrid(e)}let g=this.info.handle,f=rotateSelectionHandle(g,Math.PI);this.editor.snaps.clearIndicators();let m=this.editor.user.getIsSnapMode()?!d:d;if(m&&l%E.pj==0){let{nudge:t}=this.editor.snaps.shapeBounds.snapResizeShapes({dragDelta:et.B.Sub(p,h),initialSelectionPageBounds:this.snapshot.initialSelectionPageBounds,handle:rotateSelectionHandle(g,l),isAspectRatioLocked:u,isResizingFromCenter:e});p.add(t)}let y=et.B.RotWith(e?i.center:i.getHandlePoint(f),i.point,l),b=et.B.Sub(p,y).rot(-l),w=et.B.Sub(h,y).rot(-l),S=et.B.DivV(b,w);Number.isFinite(S.x)||(S.x=1),Number.isFinite(S.y)||(S.y=1);let v="top"===g||"bottom"===g,x="left"===g||"right"===g;for(let e of(u?x?S.y=Math.abs(S.x):v?S.x=Math.abs(S.y):Math.abs(S.x)>Math.abs(S.y)?S.y=Math.abs(S.x)*(S.y<0?-1:1):S.x=Math.abs(S.y)*(S.x<0?-1:1):(v&&(S.x=1),x&&(S.y=1)),this.info.isCreating||this.updateCursor({dragHandle:g,isFlippedX:S.x<0,isFlippedY:S.y<0,rotation:l}),r.keys())){let t=r.get(e);this.editor.resizeShape(e,S,{initialShape:t.shape,initialBounds:t.bounds,initialPageTransform:t.pageTransform,dragHandle:g,mode:1===a.length&&e===a[0]?"resize_bounds":"scale_shape",scaleOrigin:y,scaleAxisRotation:l})}if(this.editor.inputs.ctrlKey)for(let{id:e,children:t}of(this.didHoldCommand=!0,n)){if(!t.length)continue;let n=r.get(e).shape,i=this.editor.getShape(e);if(!(n&&i))continue;let o=i.x-n.x,a=i.y-n.y,l=new et.B(o,a).rot(-n.rotation);if(0!==l.x||0!==l.y)for(let e of t)this.editor.updateShape({id:e.id,type:e.type,x:e.x-l.x,y:e.y-l.y})}else if(this.didHoldCommand){for(let{children:e}of(this.didHoldCommand=!1,n))if(e.length)for(let t of e)this.editor.updateShape({id:t.id,type:t.type,x:t.x,y:t.y})}}updateCursor({dragHandle:e,isFlippedX:t,isFlippedY:n,rotation:r}){let i={...this.editor.getInstanceState().cursor};switch(e){case"top_left":case"bottom_right":i.type="nwse-resize",t!==n&&(i.type="nesw-resize");break;case"top_right":case"bottom_left":i.type="nesw-resize",t!==n&&(i.type="nwse-resize")}i.rotation=r,this.editor.setCursor(i)}onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.editor.snaps.clearIndicators()};_createSnapshot=()=>{let e=this.editor.getSelectedShapeIds(),t=this.editor.getSelectionRotation(),{inputs:{originPagePoint:n}}=this.editor,r=this.editor.getSelectionRotatedPageBounds(),i=et.B.RotWith(r.getHandlePoint(this.info.handle),r.point,t),o=et.B.Sub(n,i),a=new Map,l=[];e.forEach(t=>{let n=this.editor.getShape(t);if(n){if("frame"===n.type&&l.push({id:t,children:(0,v.oA)(this.editor.getSortedChildIdsForParent(n).map(e=>this.editor.getShape(e)))}),a.set(n.id,this._createShapeSnapshot(n)),this.editor.isShapeOfType(n,"frame")&&1===e.length)return;this.editor.visitDescendants(n.id,e=>{let t=this.editor.getShape(e);if(t&&(a.set(t.id,this._createShapeSnapshot(t)),this.editor.isShapeOfType(t,"frame")))return!1})}});let c=![...a.values()].some(e=>!(0,E._G)(e.pageRotation,t)||e.isAspectRatioLocked);return{shapeSnapshots:a,selectionBounds:r,cursorHandleOffset:o,selectionRotation:t,selectedShapeIds:e,canShapesDeform:c,initialSelectionPageBounds:this.editor.getSelectionPageBounds(),frames:l}};_createShapeSnapshot=e=>{let t=this.editor.getShapePageTransform(e),n=this.editor.getShapeUtil(e);return{shape:e,bounds:this.editor.getShapeGeometry(e).bounds,pageTransform:t,pageRotation:ea._.Decompose(t).rotation,isAspectRatioLocked:n.isAspectRatioLocked(e)}}};let ne=["top","top_right","right","bottom_right","bottom","bottom_left","left","top_left"];function rotateSelectionHandle(e,t){t%=E.yo;let n=Math.round(t/(E.PI/4)),r=ne.indexOf(e);return ne[(r+n)%ne.length]}let nt=Math.PI/180;let Rotating=class Rotating extends te.n{static id="rotating";snapshot={};info={};markId="";onEnter=e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.markId="rotate start",this.editor.mark(this.markId);let t=(0,tp.o)({editor:this.editor});if(!t)return this.parent.transition("idle",this.info);this.snapshot=t,this.handleStart()};onExit=()=>{this.editor.setCursor({type:"default",rotation:0}),this.parent.setCurrentToolIdMask(void 0),this.snapshot={}};onPointerMove=()=>{this.update()};onKeyDown=()=>{this.update()};onKeyUp=()=>{this.update()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};update=()=>{let e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});(0,tp.Z)({editor:this.editor,delta:e,snapshot:this.snapshot,stage:"update"}),this.editor.updateInstanceState({cursor:{type:t4[this.info.handle],rotation:e+this.snapshot.initialSelectionRotation}})};cancel=()=>{this.editor.bailToMark(this.markId),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)};complete=()=>{(0,tp.Z)({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!0}),snapshot:this.snapshot,stage:"end"}),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("idle",this.info)};handleStart(){let e=this._getRotationFromPointerPosition({snapToNearestDegree:!1});(0,tp.Z)({editor:this.editor,delta:this._getRotationFromPointerPosition({snapToNearestDegree:!1}),snapshot:this.snapshot,stage:"start"}),this.editor.updateInstanceState({cursor:{type:t4[this.info.handle],rotation:e+this.snapshot.initialSelectionRotation}})}_getRotationFromPointerPosition({snapToNearestDegree:e}){let t=this.editor.getSelectionRotation(),n=this.editor.getSelectionRotatedPageBounds(),{inputs:{shiftKey:r,currentPagePoint:i}}=this.editor,{initialCursorAngle:o,initialSelectionRotation:a}=this.snapshot;if(!n)return a;let l=n.center.clone().rotWith(n.point,t),c=l.angle(i)-o,u=a+c;if(r)u=(0,E.nD)(u,24);else if(e&&(u=Math.round(u/nt)*nt,this.editor.getInstanceState().isCoarsePointer)){let e=(0,E.nD)(u,4),t=(0,E.Z7)(u,e);Math.abs(t)<(0,E.Ht)(5)&&(u=e)}return u-a}};let ScribbleBrushing=class ScribbleBrushing extends te.n{static id="scribble_brushing";hits=new Set;size=0;scribbleId="id";initialSelectedShapeIds=new Set;newlySelectedShapeIds=new Set;onEnter=()=>{this.initialSelectedShapeIds=new Set(this.editor.inputs.shiftKey?this.editor.getSelectedShapeIds():[]),this.newlySelectedShapeIds=new Set,this.size=0,this.hits.clear();let e=this.editor.scribbles.addScribble({color:"selection-stroke",opacity:.32,size:12});this.scribbleId=e.id,this.updateScribbleSelection(!0),requestAnimationFrame(()=>{this.editor.updateInstanceState({brush:null})})};onExit=()=>{this.editor.scribbles.stop(this.scribbleId)};onPointerMove=()=>{this.updateScribbleSelection(!0)};onPointerUp=()=>{this.complete()};onKeyDown=()=>{this.updateScribbleSelection(!1)};onKeyUp=()=>{this.editor.inputs.altKey?this.updateScribbleSelection(!1):this.parent.transition("brushing")};onCancel=()=>{this.cancel()};onComplete=()=>{this.complete()};pushPointToScribble=()=>{let{x:e,y:t}=this.editor.inputs.currentPagePoint;this.editor.scribbles.addPoint(this.scribbleId,e,t)};updateScribbleSelection(e){let t,n,r,i;let o=this.editor.getZoomLevel(),a=this.editor.getCurrentPageShapes(),{inputs:{shiftKey:l,originPagePoint:c,previousPagePoint:u,currentPagePoint:d}}=this.editor,{newlySelectedShapeIds:p,initialSelectedShapeIds:h}=this;e&&this.pushPointToScribble();for(let e=0,l=a.length;e<l;e++)if(t=a[e],n=this.editor.getShapeGeometry(t),!(this.editor.isShapeOfType(t,"group")||p.has(t.id)||this.editor.isShapeOrAncestorLocked(t))){if(this.editor.isShapeOfType(t,"frame")){let e=this.editor.getPointInShapeSpace(t,c);if(n.bounds.containsPoint(e))continue}if(r=this.editor.getPointInShapeSpace(t,u),i=this.editor.getPointInShapeSpace(t,d),n.hitTestLineSegment(r,i,_.wM/o)){let e=this.editor.getOutermostSelectableShape(t),n=this.editor.getShapeMask(e.id);if(n){let e=(0,tr.Gc)(u,d,n);if(null!==e){let e=(0,E.Of)(d,n);if(!e)continue}}p.add(e.id)}}this.editor.setSelectedShapes([...new Set(l?[...p,...h]:[...p])],{squashing:!0})}complete(){this.parent.transition("idle")}cancel(){this.editor.setSelectedShapes([...this.initialSelectedShapeIds],{squashing:!0}),this.parent.transition("idle")}};let DragAndDropManager=class DragAndDropManager{constructor(e){this.editor=e,e.disposables.add(this.dispose)}prevDroppingShapeId=null;droppingNodeTimer=null;first=!0;updateDroppingNode(e,t){this.first&&(this.prevDroppingShapeId=this.editor.getDroppingOverShape(this.editor.inputs.originPagePoint,e)?.id??null,this.first=!1),null===this.droppingNodeTimer?this.setDragTimer(e,1e3,t):this.editor.inputs.pointerVelocity.len()>.5&&(clearInterval(this.droppingNodeTimer),this.setDragTimer(e,100,t))}setDragTimer(e,t,n){this.droppingNodeTimer=setTimeout(()=>{this.editor.batch(()=>{this.handleDrag(this.editor.inputs.currentPagePoint,e,n)}),this.droppingNodeTimer=null},t)}handleDrag(e,t,n){t=(0,v.oA)(t.map(e=>this.editor.getShape(e.id)));let r=this.editor.getDroppingOverShape(e,t)?.id??null;if(r===this.prevDroppingShapeId)return;let{prevDroppingShapeId:i}=this,o=i&&this.editor.getShape(i),a=r&&this.editor.getShape(r);if(o&&this.editor.getShapeUtil(o).onDragShapesOut?.(o,t),a){let e=this.editor.getShapeUtil(a).onDragShapesOver?.(a,t);e&&e.shouldHint&&this.editor.setHintingShapes([a.id])}else this.editor.setHintingShapes([]);n?.(),this.prevDroppingShapeId=r}dropShapes(e){let{prevDroppingShapeId:t}=this;if(this.handleDrag(this.editor.inputs.currentPagePoint,e),t){let n=this.editor.getShape(t);if(!n)return;this.editor.getShapeUtil(n).onDropShapesOver?.(n,e)}}clear(){this.prevDroppingShapeId=null,null!==this.droppingNodeTimer&&clearInterval(this.droppingNodeTimer),this.droppingNodeTimer=null,this.editor.setHintingShapes([]),this.first=!0}dispose=()=>{this.clear()}};let Translating=class Translating extends te.n{static id="translating";info={};selectionSnapshot={};snapshot={};markId="";isCloning=!1;isCreating=!1;onCreate=()=>void 0;dragAndDropManager=new DragAndDropManager(this.editor);onEnter=e=>{let{isCreating:t=!1,onCreate:n=()=>void 0}=e;if(this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.isCreating=t,this.onCreate=n,t?this.markId=`creating:${this.editor.getOnlySelectedShape().id}`:(this.markId="translating",this.editor.mark(this.markId)),this.isCloning=!1,this.info=e,this.editor.setCursor({type:"move",rotation:0}),this.selectionSnapshot=getTranslatingSnapshot(this.editor),!this.isCreating&&this.editor.inputs.altKey){this.startCloning();return}this.snapshot=this.selectionSnapshot,this.handleStart(),this.updateShapes()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.selectionSnapshot={},this.snapshot={},this.editor.snaps.clearIndicators(),this.editor.updateInstanceState({cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.dragAndDropManager.clear()};onTick=()=>{this.dragAndDropManager.updateDroppingNode(this.snapshot.movingShapes,this.updateParentTransforms),moveCameraWhenCloseToEdge(this.editor)};onPointerMove=()=>{this.updateShapes()};onKeyDown=()=>{if(this.editor.inputs.altKey&&!this.isCloning){this.startCloning();return}this.updateShapes()};onKeyUp=()=>{if(!this.editor.inputs.altKey&&this.isCloning){this.stopCloning();return}this.updateShapes()};onPointerUp=()=>{this.complete()};onComplete=()=>{this.complete()};onCancel=()=>{this.cancel()};startCloning(){this.isCreating||(this.isCloning=!0,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.editor.duplicateShapes(Array.from(this.editor.getSelectedShapeIds())),this.snapshot=getTranslatingSnapshot(this.editor),this.handleStart(),this.updateShapes())}stopCloning(){this.isCloning=!1,this.snapshot=this.selectionSnapshot,this.reset(),this.markId="translating",this.editor.mark(this.markId),this.updateShapes()}reset(){this.editor.bailToMark(this.markId)}complete(){this.updateShapes(),this.dragAndDropManager.dropShapes(this.snapshot.movingShapes),this.handleEnd(),this.editor.getInstanceState().isToolLocked&&this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.isCreating?this.onCreate?.(this.editor.getOnlySelectedShape()):this.parent.transition("idle")}cancel(){this.reset(),this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd):this.parent.transition("idle",this.info)}handleStart(){let{movingShapes:e}=this.snapshot,t=[];e.forEach(e=>{let n=this.editor.getShapeUtil(e),r=n.onTranslateStart?.(e);r&&t.push(r)}),t.length>0&&this.editor.updateShapes(t),this.editor.setHoveredShape(null)}handleEnd(){let{movingShapes:e}=this.snapshot;if(this.isCloning){let t=et.B.Average(e.map(e=>this.editor.getShapePageTransform(e.id).point())),n=et.B.Sub(t,this.selectionSnapshot.averagePagePoint);this.editor.updateInstanceState({duplicateProps:{shapeIds:e.map(e=>e.id),offset:{x:n.x,y:n.y}}})}let t=[];e.forEach(e=>{let n=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=r.onTranslateEnd?.(e,n);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}handleChange(){let{movingShapes:e}=this.snapshot,t=[];e.forEach(e=>{let n=this.editor.getShape(e.id),r=this.editor.getShapeUtil(e),i=r.onTranslate?.(e,n);i&&t.push(i)}),t.length>0&&this.editor.updateShapes(t)}updateShapes(){let{snapshot:e}=this;this.dragAndDropManager.updateDroppingNode(e.movingShapes,this.updateParentTransforms),moveShapesToPoint({editor:this.editor,shapeSnapshots:e.shapeSnapshots,averagePagePoint:e.averagePagePoint,initialSelectionPageBounds:e.initialPageBounds,initialSelectionSnapPoints:e.initialSnapPoints}),this.handleChange()}updateParentTransforms=()=>{let{editor:e,snapshot:{shapeSnapshots:t}}=this,n=[];t.forEach(t=>{let r=e.getShape(t.shape.id);if(!r)return null;n.push(r);let i=(0,S.r5)(r.parentId)?null:ea._.Inverse(e.getShapePageTransform(r.parentId));t.parentTransform=i})}};function getTranslatingSnapshot(e){let t=[],n=[],r=(0,v.oA)(e.getSelectedShapeIds().map(r=>{let i=e.getShape(r);if(!i)return null;t.push(i);let o=e.getShapePageTransform(r).point();if(!o)return null;n.push(o);let a=S.ez.isId(i.parentId)?null:ea._.Inverse(e.getShapePageTransform(i.parentId));return{shape:i,pagePoint:o,parentTransform:a}})),i=[];if(1===e.getSelectedShapeIds().length)i=e.snaps.shapeBounds.getSnapPoints(e.getSelectedShapeIds()[0]);else{let t=e.getSelectionPageBounds();t&&(i=t.cornersAndCenter.map((e,t)=>({id:"selection:"+t,x:e.x,y:e.y})))}return{averagePagePoint:et.B.Average(n),movingShapes:t,shapeSnapshots:r,initialPageBounds:e.getSelectionPageBounds(),initialSnapPoints:i}}function moveShapesToPoint({editor:e,shapeSnapshots:t,averagePagePoint:n,initialSelectionPageBounds:r,initialSelectionSnapPoints:i}){let{inputs:o}=e,a=e.getInstanceState().isGridMode,l=e.getDocumentSettings().gridSize,c=et.B.Sub(o.currentPagePoint,o.originPagePoint),u=e.inputs.shiftKey?Math.abs(c.x)<Math.abs(c.y)?"x":"y":null;"x"===u?c.x=0:"y"===u&&(c.y=0),e.snaps.clearIndicators();let d=(e.user.getIsSnapMode()?!o.ctrlKey:o.ctrlKey)&&.5>e.inputs.pointerVelocity.len();if(d){let{nudge:t}=e.snaps.shapeBounds.snapTranslateShapes({dragDelta:c,initialSelectionPageBounds:r,lockedAxis:u,initialSelectionSnapPoints:i});c.add(t)}let p=et.B.Add(n,c);a&&!o.ctrlKey&&p.snapToGrid(l);let h=et.B.Sub(p,n);e.updateShapes((0,v.oA)(t.map(({shape:e,pagePoint:t,parentTransform:n})=>{let r=et.B.Add(t,h),i=n?ea._.applyToPoint(n,r):r;return{id:e.id,type:e.type,x:i.x,y:i.y}})),{squashing:!0})}n(2601);let SelectTool=class SelectTool extends te.n{static id="select";static initial="idle";reactor=void 0;static children=()=>[Crop,Cropping,SelectTool_childStates_Idle_Idle,PointingCanvas,PointingShape,Translating,Brushing,ScribbleBrushing,PointingCropHandle,PointingSelection,PointingResizeHandle,EditingShape,Resizing,Rotating,PointingRotateHandle,PointingArrowLabel,PointingHandle,DraggingHandle];cleanUpDuplicateProps=()=>{let e=this.editor.getSelectedShapeIds(),t=this.editor.getInstanceState();if(!t.duplicateProps)return;let n=new Set(t.duplicateProps.shapeIds);e.length===n.size&&e.every(e=>n.has(e))||this.editor.updateInstanceState({duplicateProps:null})};onEnter=()=>{this.reactor=(0,b.Ym)("clean duplicate props",()=>{try{this.cleanUpDuplicateProps()}catch(e){console.error(e)}})};onExit=()=>{this.reactor?.(),this.editor.getCurrentPageState().editingShapeId&&this.editor.setEditingShape(null)}};let ZoomTool_childStates_Idle_Idle=class ZoomTool_childStates_Idle_Idle extends te.n{static id="idle";info={};onEnter=e=>{this.info=e};onPointerDown=()=>{this.parent.transition("pointing",this.info)}};let ZoomTool_childStates_Pointing_Pointing=class ZoomTool_childStates_Pointing_Pointing extends te.n{static id="pointing";info={};onEnter=e=>{this.info=e};onPointerUp=()=>{this.complete()};onPointerMove=()=>{this.editor.inputs.isDragging&&this.parent.transition("zoom_brushing",this.info)};onCancel=()=>{this.cancel()};complete(){let{currentScreenPoint:e}=this.editor.inputs;this.editor.inputs.altKey?this.editor.zoomOut(e,{duration:220}):this.editor.zoomIn(e,{duration:220}),this.parent.transition("idle",this.info)}cancel(){this.parent.transition("idle",this.info)}};let ZoomBrushing=class ZoomBrushing extends te.n{static id="zoom_brushing";info={};zoomBrush=new eo.xu;onEnter=e=>{this.info=e,this.update()};onExit=()=>{this.editor.updateInstanceState({zoomBrush:null})};onPointerMove=()=>{this.update()};onPointerUp=()=>{this.complete()};onCancel=()=>{this.cancel()};update(){let{inputs:{originPagePoint:e,currentPagePoint:t}}=this.editor;this.zoomBrush.setTo(eo.xu.FromPoints([e,t])),this.editor.updateInstanceState({zoomBrush:this.zoomBrush.toJson()})}cancel(){this.parent.transition("idle",this.info)}complete(){let{zoomBrush:e}=this,t=8/this.editor.getZoomLevel();if(e.width<t&&e.height<t){let e=this.editor.inputs.currentScreenPoint;this.editor.inputs.altKey?this.editor.zoomOut(e,{duration:220}):this.editor.zoomIn(e,{duration:220})}else{let t=this.editor.inputs.altKey?this.editor.getZoomLevel()/2:void 0;this.editor.zoomToBounds(e,{targetZoom:t,duration:220})}this.parent.transition("idle",this.info)}};let ZoomTool=class ZoomTool extends te.n{static id="zoom";static initial="idle";static children=()=>[ZoomTool_childStates_Idle_Idle,ZoomBrushing,ZoomTool_childStates_Pointing_Pointing];info={};onEnter=e=>{this.info=e,this.parent.setCurrentToolIdMask(e.onInteractionEnd),this.updateCursor()};onExit=()=>{this.parent.setCurrentToolIdMask(void 0),this.editor.updateInstanceState({zoomBrush:null,cursor:{type:"default",rotation:0}},{ephemeral:!0}),this.parent.setCurrentToolIdMask(void 0)};onKeyDown=()=>{this.updateCursor()};onKeyUp=e=>{this.updateCursor(),"KeyZ"===e.code&&this.complete()};onInterrupt=()=>{this.complete()};complete(){this.info.onInteractionEnd&&"select"!==this.info.onInteractionEnd?this.editor.setCurrentTool(this.info.onInteractionEnd,this.info):this.parent.transition("select")}updateCursor(){this.editor.inputs.altKey?this.editor.updateInstanceState({cursor:{type:"zoom-out",rotation:0}},{ephemeral:!0}):this.editor.updateInstanceState({cursor:{type:"zoom-in",rotation:0}},{ephemeral:!0})}};let nn=[EraserTool,HandTool,LaserTool,ZoomTool,SelectTool];var nr=n(3428),ni=n(4887),no=n(5744),na=n(2210),ns=n(7733),nl=n(6989),nc=n(9249),nu=n(2730),nd=n(5606),np=n(9790),nh=n(6459),ng=n(3763),nf=n(1030);let nm=(0,P.forwardRef)((e,t)=>(0,P.createElement)(np.WV.span,(0,nr.Z)({},e,{ref:t,style:{position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal",...e.style}}))),ny="ToastProvider",[nb,nw,nS]=(0,ns.B)("Toast"),[nv,nx]=(0,nl.b)("Toast",[nS]),[nT,nP]=nv(ny),$054eb8030ebde76e$export$f5d03d415824e0e=e=>{let{__scopeToast:t,label:n="Notification",duration:r=5e3,swipeDirection:i="right",swipeThreshold:o=50,children:a}=e,[l,c]=(0,P.useState)(null),[u,d]=(0,P.useState)(0),p=(0,P.useRef)(!1),h=(0,P.useRef)(!1);return(0,P.createElement)(nb.Provider,{scope:t},(0,P.createElement)(nT,{scope:t,label:n,duration:r,swipeDirection:i,swipeThreshold:o,toastCount:u,viewport:l,onViewportChange:c,onToastAdd:(0,P.useCallback)(()=>d(e=>e+1),[]),onToastRemove:(0,P.useCallback)(()=>d(e=>e-1),[]),isFocusedToastEscapeKeyDownRef:p,isClosePausedRef:h},a))};$054eb8030ebde76e$export$f5d03d415824e0e.propTypes={label(e){if(e.label&&"string"==typeof e.label&&!e.label.trim()){let e=`Invalid prop \`label\` supplied to \`${ny}\`. Expected non-empty \`string\`.`;return Error(e)}return null}};let nC=["F8"],nk="toast.viewportPause",nI="toast.viewportResume",nE=(0,P.forwardRef)((e,t)=>{let{__scopeToast:n,hotkey:r=nC,label:i="Notifications ({hotkey})",...o}=e,a=nP("ToastViewport",n),l=nw(n),c=(0,P.useRef)(null),u=(0,P.useRef)(null),d=(0,P.useRef)(null),p=(0,P.useRef)(null),h=(0,na.e)(t,p,a.onViewportChange),g=r.join("+").replace(/Key/g,"").replace(/Digit/g,""),f=a.toastCount>0;(0,P.useEffect)(()=>{let handleKeyDown=e=>{var t;let n=r.every(t=>e[t]||e.code===t);n&&(null===(t=p.current)||void 0===t||t.focus())};return document.addEventListener("keydown",handleKeyDown),()=>document.removeEventListener("keydown",handleKeyDown)},[r]),(0,P.useEffect)(()=>{let e=c.current,t=p.current;if(f&&e&&t){let handlePause=()=>{if(!a.isClosePausedRef.current){let e=new CustomEvent(nk);t.dispatchEvent(e),a.isClosePausedRef.current=!0}},handleResume=()=>{if(a.isClosePausedRef.current){let e=new CustomEvent(nI);t.dispatchEvent(e),a.isClosePausedRef.current=!1}},handleFocusOutResume=t=>{let n=!e.contains(t.relatedTarget);n&&handleResume()},handlePointerLeaveResume=()=>{let t=e.contains(document.activeElement);t||handleResume()};return e.addEventListener("focusin",handlePause),e.addEventListener("focusout",handleFocusOutResume),e.addEventListener("pointermove",handlePause),e.addEventListener("pointerleave",handlePointerLeaveResume),window.addEventListener("blur",handlePause),window.addEventListener("focus",handleResume),()=>{e.removeEventListener("focusin",handlePause),e.removeEventListener("focusout",handleFocusOutResume),e.removeEventListener("pointermove",handlePause),e.removeEventListener("pointerleave",handlePointerLeaveResume),window.removeEventListener("blur",handlePause),window.removeEventListener("focus",handleResume)}}},[f,a.isClosePausedRef]);let m=(0,P.useCallback)(({tabbingDirection:e})=>{let t=l(),n=t.map(t=>{let n=t.ref.current,r=[n,...$054eb8030ebde76e$var$getTabbableCandidates(n)];return"forwards"===e?r:r.reverse()});return("forwards"===e?n.reverse():n).flat()},[l]);return(0,P.useEffect)(()=>{let e=p.current;if(e){let handleKeyDown=t=>{let n=t.altKey||t.ctrlKey||t.metaKey,r="Tab"===t.key&&!n;if(r){var i,o,a;let n=document.activeElement,r=t.shiftKey,l=t.target===e;if(l&&r){null===(i=u.current)||void 0===i||i.focus();return}let c=m({tabbingDirection:r?"backwards":"forwards"}),p=c.findIndex(e=>e===n);$054eb8030ebde76e$var$focusFirst(c.slice(p+1))?t.preventDefault():r?null===(o=u.current)||void 0===o||o.focus():null===(a=d.current)||void 0===a||a.focus()}};return e.addEventListener("keydown",handleKeyDown),()=>e.removeEventListener("keydown",handleKeyDown)}},[l,m]),(0,P.createElement)(nc.I0,{ref:c,role:"region","aria-label":i.replace("{hotkey}",g),tabIndex:-1,style:{pointerEvents:f?void 0:"none"}},f&&(0,P.createElement)(n_,{ref:u,onFocusFromOutsideViewport:()=>{let e=m({tabbingDirection:"forwards"});$054eb8030ebde76e$var$focusFirst(e)}}),(0,P.createElement)(nb.Slot,{scope:n},(0,P.createElement)(np.WV.ol,(0,nr.Z)({tabIndex:-1},o,{ref:h}))),f&&(0,P.createElement)(n_,{ref:d,onFocusFromOutsideViewport:()=>{let e=m({tabbingDirection:"backwards"});$054eb8030ebde76e$var$focusFirst(e)}}))}),n_=(0,P.forwardRef)((e,t)=>{let{__scopeToast:n,onFocusFromOutsideViewport:r,...i}=e,o=nP("ToastFocusProxy",n);return(0,P.createElement)(nm,(0,nr.Z)({"aria-hidden":!0,tabIndex:0},i,{ref:t,style:{position:"fixed"},onFocus:e=>{var t;let n=e.relatedTarget,i=!(null!==(t=o.viewport)&&void 0!==t&&t.contains(n));i&&r()}}))}),nM="Toast",nj=(0,P.forwardRef)((e,t)=>{let{forceMount:n,open:r,defaultOpen:i,onOpenChange:o,...a}=e,[l=!0,c]=(0,ng.T)({prop:r,defaultProp:i,onChange:o});return(0,P.createElement)(nd.z,{present:n||l},(0,P.createElement)(nD,(0,nr.Z)({open:l},a,{ref:t,onClose:()=>c(!1),onPause:(0,nh.W)(e.onPause),onResume:(0,nh.W)(e.onResume),onSwipeStart:(0,no.M)(e.onSwipeStart,e=>{e.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:(0,no.M)(e.onSwipeMove,e=>{let{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","move"),e.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${n}px`)}),onSwipeCancel:(0,no.M)(e.onSwipeCancel,e=>{e.currentTarget.setAttribute("data-swipe","cancel"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:(0,no.M)(e.onSwipeEnd,e=>{let{x:t,y:n}=e.detail.delta;e.currentTarget.setAttribute("data-swipe","end"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),e.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),e.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${t}px`),e.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${n}px`),c(!1)})})))}),[nA,n$]=nv(nM,{onClose(){}}),nD=(0,P.forwardRef)((e,t)=>{let{__scopeToast:n,type:r="foreground",duration:i,open:o,onClose:a,onEscapeKeyDown:l,onPause:c,onResume:u,onSwipeStart:d,onSwipeMove:p,onSwipeCancel:h,onSwipeEnd:g,...f}=e,m=nP(nM,n),[y,b]=(0,P.useState)(null),w=(0,na.e)(t,e=>b(e)),S=(0,P.useRef)(null),v=(0,P.useRef)(null),x=i||m.duration,T=(0,P.useRef)(0),C=(0,P.useRef)(x),k=(0,P.useRef)(0),{onToastAdd:I,onToastRemove:E}=m,_=(0,nh.W)(()=>{var e;let t=null==y?void 0:y.contains(document.activeElement);t&&(null===(e=m.viewport)||void 0===e||e.focus()),a()}),M=(0,P.useCallback)(e=>{e&&e!==1/0&&(window.clearTimeout(k.current),T.current=new Date().getTime(),k.current=window.setTimeout(_,e))},[_]);(0,P.useEffect)(()=>{let e=m.viewport;if(e){let handleResume=()=>{M(C.current),null==u||u()},handlePause=()=>{let e=new Date().getTime()-T.current;C.current=C.current-e,window.clearTimeout(k.current),null==c||c()};return e.addEventListener(nk,handlePause),e.addEventListener(nI,handleResume),()=>{e.removeEventListener(nk,handlePause),e.removeEventListener(nI,handleResume)}}},[m.viewport,x,c,u,M]),(0,P.useEffect)(()=>{o&&!m.isClosePausedRef.current&&M(x)},[o,x,m.isClosePausedRef,M]),(0,P.useEffect)(()=>(I(),()=>E()),[I,E]);let j=(0,P.useMemo)(()=>y?$054eb8030ebde76e$var$getAnnounceTextContent(y):null,[y]);return m.viewport?(0,P.createElement)(P.Fragment,null,j&&(0,P.createElement)($054eb8030ebde76e$var$ToastAnnounce,{__scopeToast:n,role:"status","aria-live":"foreground"===r?"assertive":"polite","aria-atomic":!0},j),(0,P.createElement)(nA,{scope:n,onClose:_},(0,ni.createPortal)((0,P.createElement)(nb.ItemSlot,{scope:n},(0,P.createElement)(nc.fC,{asChild:!0,onEscapeKeyDown:(0,no.M)(l,()=>{m.isFocusedToastEscapeKeyDownRef.current||_(),m.isFocusedToastEscapeKeyDownRef.current=!1})},(0,P.createElement)(np.WV.li,(0,nr.Z)({role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":o?"open":"closed","data-swipe-direction":m.swipeDirection},f,{ref:w,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:(0,no.M)(e.onKeyDown,e=>{"Escape"!==e.key||(null==l||l(e.nativeEvent),e.nativeEvent.defaultPrevented||(m.isFocusedToastEscapeKeyDownRef.current=!0,_()))}),onPointerDown:(0,no.M)(e.onPointerDown,e=>{0===e.button&&(S.current={x:e.clientX,y:e.clientY})}),onPointerMove:(0,no.M)(e.onPointerMove,e=>{if(!S.current)return;let t=e.clientX-S.current.x,n=e.clientY-S.current.y,r=!!v.current,i=["left","right"].includes(m.swipeDirection),o=["left","up"].includes(m.swipeDirection)?Math.min:Math.max,a=i?o(0,t):0,l=i?0:o(0,n),c="touch"===e.pointerType?10:2,u={x:a,y:l},h={originalEvent:e,delta:u};r?(v.current=u,$054eb8030ebde76e$var$handleAndDispatchCustomEvent("toast.swipeMove",p,h,{discrete:!1})):$054eb8030ebde76e$var$isDeltaInDirection(u,m.swipeDirection,c)?(v.current=u,$054eb8030ebde76e$var$handleAndDispatchCustomEvent("toast.swipeStart",d,h,{discrete:!1}),e.target.setPointerCapture(e.pointerId)):(Math.abs(t)>c||Math.abs(n)>c)&&(S.current=null)}),onPointerUp:(0,no.M)(e.onPointerUp,e=>{let t=v.current,n=e.target;if(n.hasPointerCapture(e.pointerId)&&n.releasePointerCapture(e.pointerId),v.current=null,S.current=null,t){let n=e.currentTarget,r={originalEvent:e,delta:t};$054eb8030ebde76e$var$isDeltaInDirection(t,m.swipeDirection,m.swipeThreshold)?$054eb8030ebde76e$var$handleAndDispatchCustomEvent("toast.swipeEnd",g,r,{discrete:!0}):$054eb8030ebde76e$var$handleAndDispatchCustomEvent("toast.swipeCancel",h,r,{discrete:!0}),n.addEventListener("click",e=>e.preventDefault(),{once:!0})}})})))),m.viewport))):null});nD.propTypes={type(e){if(e.type&&!["foreground","background"].includes(e.type)){let e=`Invalid prop \`type\` supplied to \`${nM}\`. Expected \`foreground | background\`.`;return Error(e)}return null}};let $054eb8030ebde76e$var$ToastAnnounce=e=>{let{__scopeToast:t,children:n,...r}=e,i=nP(nM,t),[o,a]=(0,P.useState)(!1),[l,c]=(0,P.useState)(!1);return $054eb8030ebde76e$var$useNextFrame(()=>a(!0)),(0,P.useEffect)(()=>{let e=window.setTimeout(()=>c(!0),1e3);return()=>window.clearTimeout(e)},[]),l?null:(0,P.createElement)(nu.h,{asChild:!0},(0,P.createElement)(nm,r,o&&(0,P.createElement)(P.Fragment,null,i.label," ",n)))},nO=(0,P.forwardRef)((e,t)=>{let{__scopeToast:n,...r}=e;return(0,P.createElement)(np.WV.div,(0,nr.Z)({},r,{ref:t}))}),nB=(0,P.forwardRef)((e,t)=>{let{__scopeToast:n,...r}=e;return(0,P.createElement)(np.WV.div,(0,nr.Z)({},r,{ref:t}))}),nF=(0,P.forwardRef)((e,t)=>{let{altText:n,...r}=e;return n?(0,P.createElement)(nL,{altText:n,asChild:!0},(0,P.createElement)(nU,(0,nr.Z)({},r,{ref:t}))):null});nF.propTypes={altText:e=>e.altText?null:Error("Missing prop `altText` expected on `ToastAction`")};let nU=(0,P.forwardRef)((e,t)=>{let{__scopeToast:n,...r}=e,i=n$("ToastClose",n);return(0,P.createElement)(nL,{asChild:!0},(0,P.createElement)(np.WV.button,(0,nr.Z)({type:"button"},r,{ref:t,onClick:(0,no.M)(e.onClick,i.onClose)})))}),nL=(0,P.forwardRef)((e,t)=>{let{__scopeToast:n,altText:r,...i}=e;return(0,P.createElement)(np.WV.div,(0,nr.Z)({"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":r||void 0},i,{ref:t}))});function $054eb8030ebde76e$var$getAnnounceTextContent(e){let t=[],n=Array.from(e.childNodes);return n.forEach(e=>{if(e.nodeType===e.TEXT_NODE&&e.textContent&&t.push(e.textContent),$054eb8030ebde76e$var$isHTMLElement(e)){let n=e.ariaHidden||e.hidden||"none"===e.style.display,r=""===e.dataset.radixToastAnnounceExclude;if(!n){if(r){let n=e.dataset.radixToastAnnounceAlt;n&&t.push(n)}else t.push(...$054eb8030ebde76e$var$getAnnounceTextContent(e))}}}),t}function $054eb8030ebde76e$var$handleAndDispatchCustomEvent(e,t,n,{discrete:r}){let i=n.originalEvent.currentTarget,o=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:n});t&&i.addEventListener(e,t,{once:!0}),r?(0,np.jH)(i,o):i.dispatchEvent(o)}let $054eb8030ebde76e$var$isDeltaInDirection=(e,t,n=0)=>{let r=Math.abs(e.x),i=Math.abs(e.y),o=r>i;return"left"===t||"right"===t?o&&r>n:!o&&i>n};function $054eb8030ebde76e$var$useNextFrame(e=()=>{}){let t=(0,nh.W)(e);(0,nf.b)(()=>{let e=0,n=0;return e=window.requestAnimationFrame(()=>n=window.requestAnimationFrame(t)),()=>{window.cancelAnimationFrame(e),window.cancelAnimationFrame(n)}},[t])}function $054eb8030ebde76e$var$isHTMLElement(e){return e.nodeType===e.ELEMENT_NODE}function $054eb8030ebde76e$var$getTabbableCandidates(e){let t=[],n=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:e=>{let t="INPUT"===e.tagName&&"hidden"===e.type;return e.disabled||e.hidden||t?NodeFilter.FILTER_SKIP:e.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;n.nextNode();)t.push(n.currentNode);return t}function $054eb8030ebde76e$var$focusFirst(e){let t=document.activeElement;return e.some(e=>e===t||(e.focus(),document.activeElement!==t))}let nR=[0,390,428,468,580,640,840,1023];var nz=((l=nz||{})[l.ZERO=0]="ZERO",l[l.MOBILE_XXS=1]="MOBILE_XXS",l[l.MOBILE_XS=2]="MOBILE_XS",l[l.MOBILE_SM=3]="MOBILE_SM",l[l.MOBILE=4]="MOBILE",l[l.TABLET_SM=5]="TABLET_SM",l[l.TABLET=6]="TABLET",l[l.DESKTOP=7]="DESKTOP",l);let nN=P.createContext(0);function BreakPointProvider({forceMobile:e=!1,children:t}){let n=(0,I.j)(),r=(0,b.Hg)("breakpoint",()=>{let{width:t}=n.getViewportScreenBounds(),r=e?nz.MOBILE_SM:nR.length-1;for(let e=0;e<r;e++)if(t>nR[e]&&t<=nR[e+1])return e;return r},[n]);return(0,T.jsx)(nN.Provider,{value:r,children:t})}function useBreakpoint(){return(0,P.useContext)(nN)}let nV=(0,P.createContext)(null);function AssetUrlsProvider({assetUrls:e,children:t}){return(0,T.jsx)(nV.Provider,{value:e,children:t})}function useAssetUrls(){let e=(0,P.useContext)(nV);if(!e)throw Error("useAssetUrls must be used within an AssetUrlsProvider");return e}let nH={"action.convert-to-bookmark":"Convert to Bookmark","action.convert-to-embed":"Convert to Embed","action.open-embed-link":"Open link","action.align-bottom":"Align bottom","action.align-center-horizontal":"Align horizontally","action.align-center-vertical":"Align vertically","action.align-center-horizontal.short":"Align H","action.align-center-vertical.short":"Align V","action.align-left":"Align left","action.align-right":"Align right","action.align-top":"Align top","action.back-to-content":"Back to content","action.bring-forward":"Bring forward","action.bring-to-front":"Bring to front","action.copy-as-json.short":"JSON","action.copy-as-json":"Copy as JSON","action.copy-as-png.short":"PNG","action.copy-as-png":"Copy as PNG","action.copy-as-svg.short":"SVG","action.copy-as-svg":"Copy as SVG","action.copy":"Copy","action.cut":"Cut","action.delete":"Delete","action.unlock-all":"Unlock all","action.distribute-horizontal":"Distribute horizontally","action.distribute-vertical":"Distribute vertically","action.distribute-horizontal.short":"Distribute H","action.distribute-vertical.short":"Distribute V","action.duplicate":"Duplicate","action.edit-link":"Edit link","action.exit-pen-mode":"Exit pen mode","action.export-as-json.short":"JSON","action.export-as-json":"Export as JSON","action.export-as-png.short":"PNG","action.export-as-png":"Export as PNG","action.export-as-svg.short":"SVG","action.export-as-svg":"Export as SVG","action.export-all-as-json.short":"JSON","action.export-all-as-json":"Export all as JSON","action.export-all-as-png.short":"PNG","action.export-all-as-png":"Export all as PNG","action.export-all-as-svg.short":"SVG","action.export-all-as-svg":"Export all as SVG","action.fit-frame-to-content":"Fit to content","action.flip-horizontal":"Flip horizontally","action.flip-vertical":"Flip vertically","action.flip-horizontal.short":"Flip H","action.flip-vertical.short":"Flip V","action.fork-project":"Fork this project","action.group":"Group","action.insert-embed":"Insert embed","action.insert-media":"Upload media","action.leave-shared-project":"Leave shared project","action.new-project":"New project","action.new-shared-project":"New shared project","action.open-cursor-chat":"Cursor chat","action.open-file":"Open file","action.pack":"Pack","action.paste":"Paste","action.print":"Print","action.redo":"Redo","action.remove-frame":"Remove frame","action.rename":"Rename","action.rotate-ccw":"Rotate counterclockwise","action.rotate-cw":"Rotate clockwise","action.save-copy":"Save a copy","action.select-all":"Select all","action.select-none":"Select none","action.send-backward":"Send backward","action.send-to-back":"Send to back","action.share-project":"Share this project","action.stack-horizontal":"Stack horizontally","action.stack-vertical":"Stack vertically","action.stack-horizontal.short":"Stack H","action.stack-vertical.short":"Stack V","action.stop-following":"Stop following","action.stretch-horizontal":"Stretch horizontally","action.stretch-vertical":"Stretch vertically","action.stretch-horizontal.short":"Stretch H","action.stretch-vertical.short":"Stretch V","action.toggle-auto-size":"Toggle auto size","action.toggle-dark-mode.menu":"Dark mode","action.toggle-dark-mode":"Toggle dark mode","action.toggle-wrap-mode.menu":"Select on wrap","action.toggle-wrap-mode":"Toggle Select on wrap","action.toggle-reduce-motion.menu":"Reduce motion","action.toggle-reduce-motion":"Toggle reduce motion","action.toggle-edge-scrolling.menu":"Edge scrolling","action.toggle-edge-scrolling":"Toggle edge scrolling","action.toggle-debug-mode.menu":"Debug mode","action.toggle-debug-mode":"Toggle debug mode","action.toggle-focus-mode.menu":"Focus mode","action.toggle-focus-mode":"Toggle focus mode","action.toggle-grid.menu":"Show grid","action.toggle-grid":"Toggle grid","action.toggle-lock":"Toggle locked","action.toggle-snap-mode.menu":"Always snap","action.toggle-snap-mode":"Toggle always snap","action.toggle-tool-lock.menu":"Tool lock","action.toggle-tool-lock":"Toggle tool lock","action.toggle-transparent.context-menu":"Transparent","action.toggle-transparent.menu":"Transparent","action.toggle-transparent":"Toggle transparent background","action.undo":"Undo","action.ungroup":"Ungroup","action.zoom-in":"Zoom in","action.zoom-out":"Zoom out","action.zoom-to-100":"Zoom to 100%","action.zoom-to-fit":"Zoom to fit","action.zoom-to-selection":"Zoom to selection","assets.files.upload-failed":"Upload failed","assets.url.failed":"Couldn't load URL preview","color-style.black":"Black","color-style.blue":"Blue","color-style.green":"Green","color-style.grey":"Grey","color-style.light-blue":"Light blue","color-style.light-green":"Light green","color-style.light-red":"Light red","color-style.light-violet":"Light violet","color-style.orange":"Orange","color-style.red":"Red","color-style.violet":"Violet","color-style.yellow":"Yellow","fill-style.none":"None","document.default-name":"Untitled","fill-style.semi":"Semi","fill-style.solid":"Solid","fill-style.pattern":"Pattern","dash-style.dashed":"Dashed","dash-style.dotted":"Dotted","dash-style.draw":"Draw","dash-style.solid":"Solid","size-style.s":"Small","size-style.m":"Medium","size-style.l":"Large","size-style.xl":"Extra large","opacity-style.0.1":"10%","opacity-style.0.25":"25%","opacity-style.0.5":"50%","opacity-style.0.75":"75%","opacity-style.1":"100%","font-style.draw":"Draw","font-style.sans":"Sans","font-style.serif":"Serif","font-style.mono":"Mono","align-style.start":"Start","align-style.middle":"Middle","align-style.end":"End","align-style.justify":"Justify","verticalAlign-style.start":"Top","verticalAlign-style.middle":"Middle","verticalAlign-style.end":"Bottom","geo-style.arrow-down":"Arrow down","geo-style.arrow-left":"Arrow left","geo-style.arrow-right":"Arrow right","geo-style.arrow-up":"Arrow up","geo-style.diamond":"Diamond","geo-style.ellipse":"Ellipse","geo-style.hexagon":"Hexagon","geo-style.octagon":"Octagon","geo-style.oval":"Oval","geo-style.cloud":"Cloud","geo-style.pentagon":"Pentagon","geo-style.rectangle":"Rectangle","geo-style.rhombus-2":"Rhombus 2","geo-style.rhombus":"Rhombus","geo-style.star":"Star","geo-style.trapezoid":"Trapezoid","geo-style.triangle":"Triangle","geo-style.x-box":"X box","geo-style.check-box":"Check box","arrowheadStart-style.none":"None","arrowheadStart-style.arrow":"Arrow","arrowheadStart-style.bar":"Bar","arrowheadStart-style.diamond":"Diamond","arrowheadStart-style.dot":"Dot","arrowheadStart-style.inverted":"Inverted","arrowheadStart-style.pipe":"Pipe","arrowheadStart-style.square":"Square","arrowheadStart-style.triangle":"Triangle","arrowheadEnd-style.none":"None","arrowheadEnd-style.arrow":"Arrow","arrowheadEnd-style.bar":"Bar","arrowheadEnd-style.diamond":"Diamond","arrowheadEnd-style.dot":"Dot","arrowheadEnd-style.inverted":"Inverted","arrowheadEnd-style.pipe":"Pipe","arrowheadEnd-style.square":"Square","arrowheadEnd-style.triangle":"Triangle","spline-style.line":"Line","spline-style.cubic":"Cubic","tool.select":"Select","tool.hand":"Hand","tool.draw":"Draw","tool.eraser":"Eraser","tool.arrow-down":"Arrow down","tool.arrow-left":"Arrow left","tool.arrow-right":"Arrow right","tool.arrow-up":"Arrow up","tool.arrow":"Arrow","tool.cloud":"Cloud","tool.diamond":"Diamond","tool.ellipse":"Ellipse","tool.hexagon":"Hexagon","tool.highlight":"Highlight","tool.line":"Line","tool.octagon":"Octagon","tool.oval":"Oval","tool.pentagon":"Pentagon","tool.rectangle":"Rectangle","tool.rhombus":"Rhombus","tool.star":"Star","tool.trapezoid":"Trapezoid","tool.triangle":"Triangle","tool.x-box":"X box","tool.check-box":"Check box","tool.asset":"Asset","tool.frame":"Frame","tool.note":"Note","tool.laser":"Laser","tool.embed":"Embed","tool.text":"Text","menu.title":"Menu","menu.copy-as":"Copy as","menu.edit":"Edit","menu.shape":"Shape","menu.export-as":"Export as","menu.file":"File","menu.language":"Language","menu.preferences":"Preferences","menu.view":"View","context-menu.arrange":"Arrange","context-menu.copy-as":"Copy as","context-menu.export-as":"Export as","context-menu.export-all-as":"Export all as","context-menu.move-to-page":"Move to page","context-menu.reorder":"Reorder","page-menu.title":"Pages","page-menu.create-new-page":"Create new page","page-menu.max-page-count-reached":"Max pages reached","page-menu.new-page-initial-name":"Page 1","page-menu.edit-start":"Edit","page-menu.edit-done":"Done","page-menu.go-to-page":"Go to page","page-menu.submenu.rename":"Rename","page-menu.submenu.duplicate-page":"Duplicate","page-menu.submenu.title":"Menu","page-menu.submenu.move-down":"Move down","page-menu.submenu.move-up":"Move up","page-menu.submenu.delete":"Delete","share-menu.title":"Share","share-menu.save-note":"Download this project to your computer as a .tldr file.","share-menu.fork-note":"Create a new shared project based on this snapshot.","share-menu.share-project":"Share this project","share-menu.default-project-name":"Shared Project","share-menu.copy-link":"Copy share link","share-menu.readonly-link":"Read-only","share-menu.create-snapshot-link":"Copy snapshot link","share-menu.snapshot-link-note":"Capture and share this project as a read-only snapshot link.","share-menu.copy-readonly-link":"Copy read-only link","share-menu.offline-note":"Create a new shared project based on your current project.","share-menu.copy-link-note":"Anyone with the link will be able to view and edit this project.","share-menu.copy-readonly-link-note":"Anyone with the link will be able to view (but not edit) this project.","share-menu.project-too-large":"Sorry, this project can't be shared because it's too large. We're working on it!","share-menu.upload-failed":"Sorry, we couldn't upload your project at the moment. Please try again or let us know if the problem persists.","status.offline":"Offline","status.online":"Online","people-menu.title":"People","people-menu.change-name":"Change name","people-menu.change-color":"Change color","people-menu.follow":"Following","people-menu.following":"Following","people-menu.leading":"Following You","people-menu.user":"(You)","people-menu.invite":"Invite others","help-menu.title":"Help and resources","help-menu.about":"About","help-menu.discord":"Discord","help-menu.github":"GitHub","help-menu.keyboard-shortcuts":"Keyboard shortcuts","help-menu.twitter":"Twitter","actions-menu.title":"Actions","edit-link-dialog.title":"Edit link","edit-link-dialog.invalid-url":"A link must be a valid URL.","edit-link-dialog.detail":"Links will open in a new tab.","edit-link-dialog.url":"URL","edit-link-dialog.clear":"Clear","edit-link-dialog.save":"Continue","edit-link-dialog.cancel":"Cancel","embed-dialog.title":"Insert embed","embed-dialog.back":"Back","embed-dialog.create":"Create","embed-dialog.cancel":"Cancel","embed-dialog.url":"URL","embed-dialog.instruction":"Paste in the site's URL to create the embed.","embed-dialog.invalid-url":"We could not create an embed from that URL.","edit-pages-dialog.move-down":"Move down","edit-pages-dialog.move-up":"Move up","shortcuts-dialog.title":"Keyboard shortcuts","shortcuts-dialog.edit":"Edit","shortcuts-dialog.file":"File","shortcuts-dialog.preferences":"Preferences","shortcuts-dialog.tools":"Tools","shortcuts-dialog.transform":"Transform","shortcuts-dialog.view":"View","shortcuts-dialog.collaboration":"Collaboration","home-project-dialog.title":"Home project","home-project-dialog.description":"This is your local home project. It's just for you!","rename-project-dialog.title":"Rename project","rename-project-dialog.cancel":"Cancel","rename-project-dialog.rename":"Rename","home-project-dialog.ok":"Ok","style-panel.title":"Styles","style-panel.align":"Align","style-panel.vertical-align":"Vertical align","style-panel.position":"Position","style-panel.arrowheads":"Arrows","style-panel.arrowhead-start":"Start","style-panel.arrowhead-end":"End","style-panel.color":"Color","style-panel.dash":"Dash","style-panel.fill":"Fill","style-panel.font":"Font","style-panel.geo":"Shape","style-panel.mixed":"Mixed","style-panel.opacity":"Opacity","style-panel.size":"Size","style-panel.spline":"Spline","tool-panel.drawing":"Drawing","tool-panel.shapes":"Shapes","tool-panel.more":"More","debug-panel.more":"More","navigation-zone.toggle-minimap":"Toggle minimap","navigation-zone.zoom":"Zoom","focus-mode.toggle-focus-mode":"Toggle focus mode","toast.close":"Close","file-system.file-open-error.title":"Could not open file","file-system.file-open-error.not-a-tldraw-file":"The file you tried to open doesn't look like a tldraw file.","file-system.file-open-error.file-format-version-too-new":"The file you tried to open is from a newer version of tldraw. Please reload the page and try again.","file-system.file-open-error.generic-corrupted-file":"The file you tried to open is corrupted.","file-system.confirm-open.title":"Overwrite current project?","file-system.confirm-open.description":"Opening a file will replace your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-open.cancel":"Cancel","file-system.confirm-open.open":"Open file","file-system.confirm-open.dont-show-again":"Don't ask again","file-system.confirm-clear.title":"Clear current project?","file-system.confirm-clear.description":"Creating a new project will clear your current project and any unsaved changes will be lost. Are you sure you want to continue?","file-system.confirm-clear.cancel":"Cancel","file-system.confirm-clear.continue":"Continue","file-system.confirm-clear.dont-show-again":"Don't ask again","file-system.shared-document-file-open-error.title":"Could not open file","file-system.shared-document-file-open-error.description":"Opening files from shared projects is not supported.","sharing.confirm-leave.title":"Leave current project?","sharing.confirm-leave.description":"Are you sure you want to leave this shared project? You can return to it by navigating to its URL.","sharing.confirm-leave.cancel":"Cancel","sharing.confirm-leave.leave":"Leave","sharing.confirm-leave.dont-show-again":"Don't ask again","toast.error.export-fail.title":"Failed export","toast.error.export-fail.desc":"Failed to export image","toast.error.copy-fail.title":"Failed copy","toast.error.copy-fail.desc":"Failed to copy image","context.pages.new-page":"New page","vscode.file-open.desc":"We've updated this document to work with the current version of tldraw. If you'd like to keep the original version (which will work on old.tldraw.com), click below to create a backup.","vscode.file-open.open":"Continue","vscode.file-open.backup":"Backup","vscode.file-open.backup-saved":"Backup saved","vscode.file-open.backup-failed":"Backup failed: this is not a .tldr file.","vscode.file-open.dont-show-again":"Don't ask again","cursor-chat.type-to-chat":"Type to chat..."},nG={locale:"en",label:"English",messages:nH};async function fetchTranslation(e,t){let n=await fetch(t.translations.en);if(!n.ok)return console.warn("No main translations found."),nG;if("en"===e)return nG;let r=S.a2.find(t=>t.locale===e);if(!r)return console.warn(`No translation found for locale ${e}`),nG;let i=await fetch(t.translations[r.locale]),o=await i.json();if(!o)return console.warn(`No messages found for locale ${e}`),nG;let a=[];for(let e in nG.messages)o[e]||a.push(e);return a.length,{locale:e,label:r.label,messages:{...nG.messages,...o}}}let nW=P.createContext({}),useCurrentTranslation=()=>P.useContext(nW),nZ=(0,b.j)(function({overrides:e,children:t}){let n=(0,I.j)(),r=n.user.getLocale(),i=useAssetUrls(),[o,a]=P.useState(()=>e&&e.en?{locale:"en",label:"English",messages:{...nH,...e.en}}:{locale:"en",label:"English",messages:nH});return P.useEffect(()=>{let t=!1;return async function(){let n=await fetchTranslation(r,i);n&&!t&&(e&&e[r]?a({...n,messages:{...n.messages,...e[r]}}):a(n))}(),()=>{t=!0}},[i,r,e]),(0,T.jsx)(nW.Provider,{value:o,children:t})});function useTranslation(){let e=useCurrentTranslation();return P.useCallback(function(t){return e.messages[t]??t},[e])}let nK=P.forwardRef(function({children:e,disabled:t,type:n,...r},i){let o=(0,I.j)(),a=i?.current;return t&&a===document.activeElement&&o.getContainer().focus(),(0,T.jsx)("button",{ref:i,type:"button",draggable:!1,disabled:t,...r,className:C("tlui-button",`tlui-button__${n}`,r.className),children:e})}),nY=(0,P.memo)(function({small:e,invertIcon:t,icon:n,color:r,className:i,...o}){let a=useAssetUrls(),l=a.icons[n]??a.icons["question-mark-circle"],c=(0,P.useRef)(null);return(0,P.useLayoutEffect)(()=>{l||console.error(`Icon not found: ${n}. Add it to the assetUrls.icons object.`),c?.current&&(c.current.style.webkitMask=`url(${l}) center 100% / 100% no-repeat`)},[c,l,n]),(0,T.jsx)("div",{...o,ref:c,className:C("tlui-icon",{"tlui-icon__small":e},i),style:{color:r,mask:`url(${l}) center 100% / 100% no-repeat`,transform:t?"scale(-1, 1)":void 0}})});function TldrawUiButtonIcon({icon:e,small:t,invertIcon:n}){return(0,T.jsx)(nY,{className:"tlui-button__icon",icon:e,small:t,invertIcon:n})}var nq=n(1244),nX=n(2759),nJ=n(966),nQ=n(2300),n0=n(7256),n1=n(1779),n2=n(3386);let n3="Popover",[n5,n6]=(0,nl.b)(n3,[nQ.D7]),n4=(0,nQ.D7)(),[n8,n7]=n5(n3),n9=(0,P.forwardRef)((e,t)=>{let{__scopePopover:n,...r}=e,i=n7("PopoverTrigger",n),o=n4(n),a=(0,na.e)(t,i.triggerRef),l=(0,P.createElement)(np.WV.button,(0,nr.Z)({type:"button","aria-haspopup":"dialog","aria-expanded":i.open,"aria-controls":i.contentId,"data-state":$cb5cc270b50c6fcd$var$getState(i.open)},r,{ref:a,onClick:(0,no.M)(e.onClick,i.onOpenToggle)}));return i.hasCustomAnchor?l:(0,P.createElement)(nQ.ee,(0,nr.Z)({asChild:!0},o),l)}),re="PopoverPortal",[rt,rn]=n5(re,{forceMount:void 0}),rr="PopoverContent",ri=(0,P.forwardRef)((e,t)=>{let n=rn(rr,e.__scopePopover),{forceMount:r=n.forceMount,...i}=e,o=n7(rr,e.__scopePopover);return(0,P.createElement)(nd.z,{present:r||o.open},o.modal?(0,P.createElement)(ro,(0,nr.Z)({},i,{ref:t})):(0,P.createElement)(ra,(0,nr.Z)({},i,{ref:t})))}),ro=(0,P.forwardRef)((e,t)=>{let n=n7(rr,e.__scopePopover),r=(0,P.useRef)(null),i=(0,na.e)(t,r),o=(0,P.useRef)(!1);return(0,P.useEffect)(()=>{let e=r.current;if(e)return(0,n1.hideOthers)(e)},[]),(0,P.createElement)(n2.Z,{as:n0.g7,allowPinchZoom:!0},(0,P.createElement)(rs,(0,nr.Z)({},e,{ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,no.M)(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),o.current||null===(t=n.triggerRef.current)||void 0===t||t.focus()}),onPointerDownOutside:(0,no.M)(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;o.current=r},{checkForDefaultPrevented:!1}),onFocusOutside:(0,no.M)(e.onFocusOutside,e=>e.preventDefault(),{checkForDefaultPrevented:!1})})))}),ra=(0,P.forwardRef)((e,t)=>{let n=n7(rr,e.__scopePopover),r=(0,P.useRef)(!1),i=(0,P.useRef)(!1);return(0,P.createElement)(rs,(0,nr.Z)({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var o,a;null===(o=e.onCloseAutoFocus)||void 0===o||o.call(e,t),t.defaultPrevented||(r.current||null===(a=n.triggerRef.current)||void 0===a||a.focus(),t.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:t=>{var o,a;null===(o=e.onInteractOutside)||void 0===o||o.call(e,t),t.defaultPrevented||(r.current=!0,"pointerdown"!==t.detail.originalEvent.type||(i.current=!0));let l=t.target,c=null===(a=n.triggerRef.current)||void 0===a?void 0:a.contains(l);c&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&i.current&&t.preventDefault()}}))}),rs=(0,P.forwardRef)((e,t)=>{let{__scopePopover:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,disableOutsidePointerEvents:a,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:u,onInteractOutside:d,...p}=e,h=n7(rr,n),g=n4(n);return(0,nq.EW)(),(0,P.createElement)(nX.M,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o},(0,P.createElement)(nc.XB,{asChild:!0,disableOutsidePointerEvents:a,onInteractOutside:d,onEscapeKeyDown:l,onPointerDownOutside:c,onFocusOutside:u,onDismiss:()=>h.onOpenChange(!1)},(0,P.createElement)(nQ.VY,(0,nr.Z)({"data-state":$cb5cc270b50c6fcd$var$getState(h.open),role:"dialog",id:h.contentId},g,p,{ref:t,style:{...p.style,"--radix-popover-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-popover-content-available-width":"var(--radix-popper-available-width)","--radix-popover-content-available-height":"var(--radix-popper-available-height)","--radix-popover-trigger-width":"var(--radix-popper-anchor-width)","--radix-popover-trigger-height":"var(--radix-popper-anchor-height)"}}))))});function $cb5cc270b50c6fcd$var$getState(e){return e?"open":"closed"}let $cb5cc270b50c6fcd$export$be92b6f5f03c0fe9=e=>{let{__scopePopover:t,children:n,open:r,defaultOpen:i,onOpenChange:o,modal:a=!1}=e,l=n4(t),c=(0,P.useRef)(null),[u,d]=(0,P.useState)(!1),[p=!1,h]=(0,ng.T)({prop:r,defaultProp:i,onChange:o});return(0,P.createElement)(nQ.fC,l,(0,P.createElement)(n8,{scope:t,contentId:(0,nJ.M)(),triggerRef:c,open:p,onOpenChange:h,onOpenToggle:(0,P.useCallback)(()=>h(e=>!e),[h]),hasCustomAnchor:u,onCustomAnchorAdd:(0,P.useCallback)(()=>d(!0),[]),onCustomAnchorRemove:(0,P.useCallback)(()=>d(!1),[]),modal:a},n))},$cb5cc270b50c6fcd$export$602eac185826482c=e=>{let{__scopePopover:t,forceMount:n,children:r,container:i}=e,o=n7(re,t);return(0,P.createElement)(rt,{scope:t,forceMount:n},(0,P.createElement)(nd.z,{present:n||o.open},(0,P.createElement)(nu.h,{asChild:!0,container:i},r)))},defaultEventHandler=()=>void 0,rl=P.createContext({});function UiEventsProvider({onEvent:e,children:t}){return(0,T.jsx)(rl.Provider,{value:e??defaultEventHandler,children:t})}function useUiEvents(){let e=P.useContext(rl);return e??defaultEventHandler}function useMenuIsOpen(e,t){let n=(0,I.j)(),r=(0,P.useRef)(!1),i=useUiEvents(),o=(0,P.useCallback)(i=>{r.current=i,n.batch(()=>{i?(n.complete(),n.addOpenMenu(e)):n.updateInstanceState({openMenus:n.getOpenMenus().filter(t=>!t.startsWith(e))}),t?.(i)})},[n,e,t]),a=(0,b.Hg)("is menu open",()=>n.getOpenMenus().includes(e),[n,e]);return(0,P.useEffect)(()=>(r.current&&(i("open-menu",{source:"unknown",id:e}),n.addOpenMenu(e)),()=>{r.current&&(n.deleteOpenMenu(e),n.getOpenMenus().forEach(t=>{t.startsWith(e)&&(i("close-menu",{source:"unknown",id:e}),n.deleteOpenMenu(t))}),r.current=!1)}),[n,e,i]),[a,o]}function TldrawUiPopover({id:e,children:t,onOpenChange:n,open:r}){let[i,o]=useMenuIsOpen(e,n);return(0,T.jsx)($cb5cc270b50c6fcd$export$be92b6f5f03c0fe9,{onOpenChange:o,open:r||i,children:(0,T.jsx)("div",{className:"tlui-popover",children:t})})}function TldrawUiPopoverTrigger({children:e}){return(0,T.jsx)(n9,{asChild:!0,dir:"ltr",children:e})}function TldrawUiPopoverContent({side:e,children:t,align:n="center",sideOffset:r=8,alignOffset:i=0}){let o=useContainer();return(0,T.jsx)($cb5cc270b50c6fcd$export$602eac185826482c,{container:o,children:(0,T.jsx)(ri,{className:"tlui-popover__content",side:e,sideOffset:r,align:n,alignOffset:i,dir:"ltr",children:t})})}let rc=(0,P.createContext)({type:"menu",sourceId:"main-menu"});function useTldrawUiMenuContext(){return(0,P.useContext)(rc)}function TldrawUiMenuContextProvider({type:e,sourceId:t,children:n}){return(0,T.jsx)(rc.Provider,{value:{type:e,sourceId:t},children:n})}function removeFrame(e,t){let n=(0,v.oA)(t.map(t=>e.getShape(t)).filter(t=>t&&e.isShapeOfType(t,"frame")));if(!n.length)return;let r=[];e.batch(()=>{n.map(t=>{let n=e.getSortedChildIdsForParent(t.id);n.length&&(e.reparentShapes(n,t.parentId,t.index),r.push(...n))}),e.setSelectedShapes(r),e.deleteShapes(t)})}function fitFrameToContent(e,t,n={}){let r=e.getShape(t);if(!r)return;let i=e.getSortedChildIdsForParent(r.id),o=(0,v.oA)(i.map(t=>e.getShape(t)));if(!o.length)return;let a=eo.xu.FromPoints(o.flatMap(t=>{let n=e.getShapeGeometry(t.id);return e.getShapeLocalTransform(t).applyToPoints(n.vertices)})),{padding:l=50}=n,c=a.w+2*l,u=a.h+2*l,d=l-a.minX,p=l-a.minY;if(0===d&&0===p&&r.props.w===c&&r.props.h===u)return;let h=new et.B(d,p).rot(r.rotation);e.batch(()=>{let t=i.map(t=>{let n=e.getShape(t);return{id:n.id,type:n.type,x:n.x+d,y:n.y+p}});t.push({id:r.id,type:r.type,x:r.x-h.x,y:r.y-h.y,props:{w:c,h:u}}),e.updateShapes(t)})}function TldrawUiButtonLabel({children:e}){return(0,T.jsx)("span",{className:"tlui-button__label",children:e})}let ru="Dialog",[rd,rp]=(0,nl.b)(ru),[rh,rg]=rd(ru),rf="DialogPortal",[rm,ry]=rd(rf,{forceMount:void 0}),rb="DialogOverlay",rw=(0,P.forwardRef)((e,t)=>{let n=ry(rb,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=rg(rb,e.__scopeDialog);return o.modal?(0,P.createElement)(nd.z,{present:r||o.open},(0,P.createElement)(rS,(0,nr.Z)({},i,{ref:t}))):null}),rS=(0,P.forwardRef)((e,t)=>{let{__scopeDialog:n,...r}=e,i=rg(rb,n);return(0,P.createElement)(n2.Z,{as:n0.g7,allowPinchZoom:!0,shards:[i.contentRef]},(0,P.createElement)(np.WV.div,(0,nr.Z)({"data-state":$5d3850c4d0b4e6c7$var$getState(i.open)},r,{ref:t,style:{pointerEvents:"auto",...r.style}})))}),rv="DialogContent",rx=(0,P.forwardRef)((e,t)=>{let n=ry(rv,e.__scopeDialog),{forceMount:r=n.forceMount,...i}=e,o=rg(rv,e.__scopeDialog);return(0,P.createElement)(nd.z,{present:r||o.open},o.modal?(0,P.createElement)(rT,(0,nr.Z)({},i,{ref:t})):(0,P.createElement)(rP,(0,nr.Z)({},i,{ref:t})))}),rT=(0,P.forwardRef)((e,t)=>{let n=rg(rv,e.__scopeDialog),r=(0,P.useRef)(null),i=(0,na.e)(t,n.contentRef,r);return(0,P.useEffect)(()=>{let e=r.current;if(e)return(0,n1.hideOthers)(e)},[]),(0,P.createElement)(rC,(0,nr.Z)({},e,{ref:i,trapFocus:n.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:(0,no.M)(e.onCloseAutoFocus,e=>{var t;e.preventDefault(),null===(t=n.triggerRef.current)||void 0===t||t.focus()}),onPointerDownOutside:(0,no.M)(e.onPointerDownOutside,e=>{let t=e.detail.originalEvent,n=0===t.button&&!0===t.ctrlKey,r=2===t.button||n;r&&e.preventDefault()}),onFocusOutside:(0,no.M)(e.onFocusOutside,e=>e.preventDefault())}))}),rP=(0,P.forwardRef)((e,t)=>{let n=rg(rv,e.__scopeDialog),r=(0,P.useRef)(!1),i=(0,P.useRef)(!1);return(0,P.createElement)(rC,(0,nr.Z)({},e,{ref:t,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:t=>{var o,a;null===(o=e.onCloseAutoFocus)||void 0===o||o.call(e,t),t.defaultPrevented||(r.current||null===(a=n.triggerRef.current)||void 0===a||a.focus(),t.preventDefault()),r.current=!1,i.current=!1},onInteractOutside:t=>{var o,a;null===(o=e.onInteractOutside)||void 0===o||o.call(e,t),t.defaultPrevented||(r.current=!0,"pointerdown"!==t.detail.originalEvent.type||(i.current=!0));let l=t.target,c=null===(a=n.triggerRef.current)||void 0===a?void 0:a.contains(l);c&&t.preventDefault(),"focusin"===t.detail.originalEvent.type&&i.current&&t.preventDefault()}}))}),rC=(0,P.forwardRef)((e,t)=>{let{__scopeDialog:n,trapFocus:r,onOpenAutoFocus:i,onCloseAutoFocus:o,...a}=e,l=rg(rv,n),c=(0,P.useRef)(null),u=(0,na.e)(t,c);return(0,nq.EW)(),(0,P.createElement)(P.Fragment,null,(0,P.createElement)(nX.M,{asChild:!0,loop:!0,trapped:r,onMountAutoFocus:i,onUnmountAutoFocus:o},(0,P.createElement)(nc.XB,(0,nr.Z)({role:"dialog",id:l.contentId,"aria-describedby":l.descriptionId,"aria-labelledby":l.titleId,"data-state":$5d3850c4d0b4e6c7$var$getState(l.open)},a,{ref:u,onDismiss:()=>l.onOpenChange(!1)}))),!1)}),rk="DialogTitle",rI=(0,P.forwardRef)((e,t)=>{let{__scopeDialog:n,...r}=e,i=rg(rk,n);return(0,P.createElement)(np.WV.h2,(0,nr.Z)({id:i.titleId},r,{ref:t}))}),rE=(0,P.forwardRef)((e,t)=>{let{__scopeDialog:n,...r}=e,i=rg("DialogClose",n);return(0,P.createElement)(np.WV.button,(0,nr.Z)({type:"button"},r,{ref:t,onClick:(0,no.M)(e.onClick,()=>i.onOpenChange(!1))}))});function $5d3850c4d0b4e6c7$var$getState(e){return e?"open":"closed"}let[r_,rM]=(0,nl.k)("DialogTitleWarning",{contentName:rv,titleName:rk,docsSlug:"dialog"}),$5d3850c4d0b4e6c7$export$be92b6f5f03c0fe9=e=>{let{__scopeDialog:t,children:n,open:r,defaultOpen:i,onOpenChange:o,modal:a=!0}=e,l=(0,P.useRef)(null),c=(0,P.useRef)(null),[u=!1,d]=(0,ng.T)({prop:r,defaultProp:i,onChange:o});return(0,P.createElement)(rh,{scope:t,triggerRef:l,contentRef:c,contentId:(0,nJ.M)(),titleId:(0,nJ.M)(),descriptionId:(0,nJ.M)(),open:u,onOpenChange:d,onOpenToggle:(0,P.useCallback)(()=>d(e=>!e),[d]),modal:a},n)},$5d3850c4d0b4e6c7$export$602eac185826482c=e=>{let{__scopeDialog:t,forceMount:n,children:r,container:i}=e,o=rg(rf,t);return(0,P.createElement)(rm,{scope:t,forceMount:n},P.Children.map(r,e=>(0,P.createElement)(nd.z,{present:n||o.open},(0,P.createElement)(nu.h,{asChild:!0,container:i},e))))};function TldrawUiDialogHeader({className:e,children:t}){return(0,T.jsx)("div",{className:C("tlui-dialog__header",e),children:t})}function TldrawUiDialogTitle({className:e,children:t}){return(0,T.jsx)(rI,{dir:"ltr",className:C("tlui-dialog__header__title",e),children:t})}function TldrawUiDialogCloseButton(){return(0,T.jsx)("div",{className:"tlui-dialog__header__close",children:(0,T.jsx)(rE,{"data-testid":"dialog.close",dir:"ltr",asChild:!0,children:(0,T.jsx)(nK,{type:"icon","aria-label":"Close",onTouchEnd:e=>e.target.click(),children:(0,T.jsx)(TldrawUiButtonIcon,{small:!0,icon:"cross-2"})})})})}function TldrawUiDialogBody({className:e,children:t,style:n}){return(0,T.jsx)("div",{className:C("tlui-dialog__body",e),style:n,children:t})}function TldrawUiDialogFooter({className:e,children:t}){return(0,T.jsx)("div",{className:C("tlui-dialog__footer",e),children:t})}let rj=P.forwardRef(function({className:e,label:t,icon:n,iconLeft:r,autoselect:i=!1,autofocus:o=!1,defaultValue:a,placeholder:l,onComplete:c,onValueChange:u,onCancel:d,onBlur:p,shouldManuallyMaintainScrollPositionWhenFocused:h=!1,children:g,value:f},m){let y=(0,I.j)(),b=P.useRef(null);P.useImperativeHandle(m,()=>b.current);let w=useTranslation(),S=P.useRef(a??""),v=P.useRef(a??""),[x,k]=P.useState(!1),E=P.useCallback(e=>{k(!0);let t=e.currentTarget;v.current=t.value,requestAnimationFrame(()=>{i&&t.select()})},[i]),_=P.useCallback(e=>{let t=e.currentTarget.value;v.current=t,u?.(t)},[u]),M=P.useCallback(e=>{switch(e.key){case"Enter":e.currentTarget.blur(),stopEventPropagation(e),c?.(e.currentTarget.value);break;case"Escape":e.currentTarget.value=S.current,e.currentTarget.blur(),stopEventPropagation(e),d?.(e.currentTarget.value)}},[c,d]),j=P.useCallback(e=>{k(!1);let t=e.currentTarget.value;p?.(t)},[p]);return P.useEffect(()=>{if(!y.environment.isIos)return;let e=window.visualViewport;if(x&&h&&e){let onViewportChange=()=>{b.current?.scrollIntoView({block:"center"})};return e.addEventListener("resize",onViewportChange),e.addEventListener("scroll",onViewportChange),requestAnimationFrame(()=>{b.current?.scrollIntoView({block:"center"})}),()=>{e.removeEventListener("resize",onViewportChange),e.removeEventListener("scroll",onViewportChange)}}},[y,x,h]),(0,T.jsxs)("div",{draggable:!1,className:"tlui-input__wrapper",children:[g,t&&(0,T.jsx)("label",{children:w(t)}),r&&(0,T.jsx)(nY,{icon:r,className:"tlui-icon-left",small:!0}),(0,T.jsx)("input",{ref:b,className:C("tlui-input",e),type:"text",defaultValue:a,onKeyUp:M,onChange:_,onFocus:E,onBlur:j,autoFocus:o,placeholder:l,value:f}),n&&(0,T.jsx)(nY,{icon:n,small:!!t})]})});function validateUrl(e){return x.T.linkUrl.isValid(e)?{isValid:!0,hasProtocol:!0}:x.T.linkUrl.isValid("https://"+e)?{isValid:!0,hasProtocol:!1}:{isValid:!1,hasProtocol:!1}}let rA=(0,b.j)(function({onClose:e}){let t=(0,I.j)(),n=t.getOnlySelectedShape();return n&&"url"in n.props&&"string"==typeof n.props.url?(0,T.jsx)(r$,{onClose:e,selectedShape:n}):null}),r$=(0,b.j)(function({onClose:e,selectedShape:t}){let n=(0,I.j)(),r=useTranslation(),i=(0,P.useRef)(null);(0,P.useEffect)(()=>{requestAnimationFrame(()=>i.current?.focus())},[]);let o=(0,P.useRef)(t.props.url),[a,l]=(0,P.useState)(()=>{let e=validateUrl(t.props.url),n=!0===e.isValid?e.hasProtocol?t.props.url:"https://"+t.props.url:"https://";return{actual:n,safe:n,valid:!0}}),c=(0,P.useCallback)(e=>{let t=e.replace(/https?:\/\/(https?:\/\/)/,(e,t)=>t),n=validateUrl(t),r=!0===n.isValid?n.hasProtocol?t:"https://"+t:"https://";l({actual:t,safe:r,valid:n.isValid})},[]),u=(0,P.useCallback)(()=>{let t=n.getOnlySelectedShape();t&&(n.updateShapes([{id:t.id,type:t.type,props:{url:""}}]),e())},[n,e]),d=(0,P.useCallback)(()=>{let t=n.getOnlySelectedShape();t&&(t&&"url"in t.props&&t.props.url!==a.safe&&n.updateShapes([{id:t.id,type:t.type,props:{url:a.safe}}]),e())},[n,e,a]),p=(0,P.useCallback)(()=>{e()},[e]);if(!t)return e(),null;let h=o.current&&!a.valid;return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(TldrawUiDialogHeader,{children:[(0,T.jsx)(TldrawUiDialogTitle,{children:r("edit-link-dialog.title")}),(0,T.jsx)(TldrawUiDialogCloseButton,{})]}),(0,T.jsx)(TldrawUiDialogBody,{children:(0,T.jsxs)("div",{className:"tlui-edit-link-dialog",children:[(0,T.jsx)(rj,{ref:i,className:"tlui-edit-link-dialog__input",label:"edit-link-dialog.url",autofocus:!0,value:a.actual,onValueChange:c,onComplete:d,onCancel:p}),(0,T.jsx)("div",{children:r(a.valid?"edit-link-dialog.detail":"edit-link-dialog.invalid-url")})]})}),(0,T.jsxs)(TldrawUiDialogFooter,{className:"tlui-dialog__footer__actions",children:[(0,T.jsx)(nK,{type:"normal",onClick:p,onTouchEnd:p,children:(0,T.jsx)(TldrawUiButtonLabel,{children:r("edit-link-dialog.cancel")})}),h?(0,T.jsx)(nK,{type:"danger",onTouchEnd:u,onClick:u,children:(0,T.jsx)(TldrawUiButtonLabel,{children:r("edit-link-dialog.clear")})}):(0,T.jsx)(nK,{type:"primary",disabled:!a.valid,onTouchEnd:d,onClick:d,children:(0,T.jsx)(TldrawUiButtonLabel,{children:r("edit-link-dialog.save")})})]})]})}),rD=(0,b.j)(function({onClose:e}){let t=(0,I.j)(),n=useTranslation(),r=useAssetUrls(),[i,o]=(0,P.useState)(null),[a,l]=(0,P.useState)(""),[c,u]=(0,P.useState)(null),[d,p]=(0,P.useState)(!1),h=(0,P.useRef)(-1);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(TldrawUiDialogHeader,{children:[(0,T.jsx)(TldrawUiDialogTitle,{children:i?`${n("embed-dialog.title")} \u2014 ${i.title}`:n("embed-dialog.title")}),(0,T.jsx)(TldrawUiDialogCloseButton,{})]}),i?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(TldrawUiDialogBody,{className:"tlui-embed-dialog__enter",children:[(0,T.jsx)(rj,{className:"tlui-embed-dialog__input",label:"embed-url",placeholder:"http://example.com",autofocus:!0,onValueChange:e=>{l(e);let t=getEmbedInfo(e);u(t&&t.definition.type===i.type?t:null),p(!1),clearTimeout(h.current),h.current=setTimeout(()=>p(!t),320)}}),""===a?(0,T.jsxs)("div",{className:"tlui-embed-dialog__instruction",children:[(0,T.jsx)("span",{children:n("embed-dialog.instruction")})," ",i.instructionLink&&(0,T.jsxs)("a",{target:"_blank",rel:"noopener noreferrer",href:i.instructionLink,className:"tlui-embed-dialog__instruction__link",children:["Learn more.",(0,T.jsx)(nY,{icon:"external-link",small:!0})]})]}):(0,T.jsx)("div",{className:"tlui-embed-dialog__warning",children:d?n("embed-dialog.invalid-url"):"\xa0"})]}),(0,T.jsxs)(TldrawUiDialogFooter,{className:"tlui-dialog__footer__actions",children:[(0,T.jsx)(nK,{type:"normal",onClick:()=>{o(null),u(null),l("")},children:(0,T.jsx)(TldrawUiButtonLabel,{children:n("embed-dialog.back")})}),(0,T.jsx)("div",{className:"tlui-embed__spacer"}),(0,T.jsx)(nK,{type:"normal",onClick:e,children:(0,T.jsx)(TldrawUiButtonLabel,{children:n("embed-dialog.cancel")})}),(0,T.jsx)(nK,{type:"primary",disabled:!c,onClick:()=>{c&&(t.putExternalContent({type:"embed",url:a,point:t.getViewportPageCenter(),embed:c.definition}),e())},children:(0,T.jsx)(TldrawUiButtonLabel,{children:n("embed-dialog.create")})})]})]}):(0,T.jsx)(T.Fragment,{children:(0,T.jsx)(TldrawUiDialogBody,{className:"tlui-embed-dialog__list",children:S.Lu.map(e=>(0,T.jsxs)(nK,{type:"menu",onClick:()=>o(e),children:[(0,T.jsx)(TldrawUiButtonLabel,{children:e.title}),(0,T.jsx)("div",{className:"tlui-embed-dialog__item__image",style:{backgroundImage:`url(${r.embedIcons[e.type]})`}})]},e.type))})})]})});var rO=n(352);async function pasteExcalidrawContent(e,t,n){let{elements:r,files:i}=t,o={shapes:[],rootShapeIds:[],assets:[],schema:e.store.schema.serialize()},a=new Map,l=new Map,c=e.getCurrentPageId(),u=new Map,d=[],p=new Set;r.forEach(e=>{if(u.set(e.id,(0,S.F1)()),null!==e.boundElements)for(let t of e.boundElements)"text"===t.type&&p.add(t.id)});let h=v.R4;for(let e of r){if(p.has(e.id))continue;let t=u.get(e.id),n={id:t,typeName:"shape",parentId:c,index:h,x:e.x,y:e.y,rotation:0,isLocked:e.locked,opacity:getOpacity(e.opacity),meta:{}};switch(0!==e.angle&&l.set(t,e.angle),e.groupIds&&e.groupIds.length>0?a.has(e.groupIds[0])?a.get(e.groupIds[0])?.push(t):a.set(e.groupIds[0],[t]):d.push(t),e.type){case"rectangle":case"ellipse":case"diamond":{let t="",i="middle";if(null!==e.boundElements){for(let n of e.boundElements)if("text"===n.type){let e=r.find(e=>e.id===n.id);e&&(t=e.text,i=rN[e.textAlign])}}let a="transparent"===e.backgroundColor?e.strokeColor:e.backgroundColor;o.shapes.push({...n,type:"geo",props:{geo:e.type,url:e.link??"",w:e.width,h:e.height,size:rB[e.strokeWidth]??"draw",color:rL[a]??"black",text:t,align:i,dash:getDash(e),fill:getFill(e)}});break}case"freedraw":o.shapes.push({...n,type:"draw",props:{dash:getDash(e),size:rB[e.strokeWidth],color:rL[e.strokeColor]??"black",segments:[{type:"free",points:e.points.map(([e,t,n=.5])=>({x:e,y:t,z:n}))}]}});break;case"line":{let t=e.points[0],r=e.points[e.points.length-1],i=(0,v.H$)(e.points.length);o.shapes.push({...n,type:"line",props:{dash:getDash(e),size:rB[e.strokeWidth],color:rL[e.strokeColor]??"black",spline:e.roundness?"cubic":"line",handles:{start:{id:"start",type:"vertex",index:i[0],x:t[0],y:t[1]},end:{id:"end",type:"vertex",index:i[i.length-1],x:r[0],y:r[1]},...Object.fromEntries(e.points.slice(1,-1).map(([e,t],n)=>{let r=(0,eM.E)();return[r,{id:r,type:"vertex",index:i[n+1],x:e,y:t}]}))}}});break}case"arrow":{let t="";if(null!==e.boundElements){for(let n of e.boundElements)if("text"===n.type){let e=r.find(e=>e.id===n.id);e&&(t=e.text)}}let i=e.points[0],a=e.points[e.points.length-1],l=u.get(e.startBinding?.elementId),c=u.get(e.endBinding?.elementId);o.shapes.push({...n,type:"arrow",props:{text:t,bend:getBend(e,i,a),dash:getDash(e),size:rB[e.strokeWidth]??"m",color:rL[e.strokeColor]??"black",start:l?{type:"binding",boundShapeId:l,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:i[0],y:i[1]},end:c?{type:"binding",boundShapeId:c,normalizedAnchor:{x:.5,y:.5},isPrecise:!1,isExact:!1}:{type:"point",x:a[0],y:a[1]},arrowheadEnd:rV[e.endArrowhead]??"none",arrowheadStart:rV[e.startArrowhead]??"none"}});break}case"text":{let{size:t,scale:r}=getFontSizeAndScale(e.fontSize);o.shapes.push({...n,type:"text",props:{size:t,scale:r,font:rU[e.fontFamily]??"draw",color:rL[e.strokeColor]??"black",text:e.text,align:rN[e.textAlign]}});break}case"image":{let t=i[e.fileId];if(!t)break;let r=S.Yk.createId();o.assets.push({id:r,typeName:"asset",type:"image",props:{w:e.width,h:e.height,name:e.id??"Untitled",isAnimated:!1,mimeType:t.mimeType,src:t.dataURL},meta:{}}),o.shapes.push({...n,type:"image",props:{w:e.width,h:e.height,assetId:r}})}}h=(0,v._L)(h)}let g=n??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0);for(let t of(e.mark("paste"),e.putContentOntoCurrentPage(o,{point:g,select:!1,preserveIds:!0}),a.values()))if(t.length>1){e.groupShapes(t);let n=e.getShape(t[0]);n?.parentId&&(0,S.YT)(n.parentId)&&d.push(n.parentId)}for(let[t,n]of l)e.select(t),e.rotateShapesBy([t],n);let f=(0,v.oA)(d.map(t=>e.getShape(t))),m=eo.xu.Common(f.map(t=>e.getShapePageBounds(t))),y=e.getViewportPageBounds().center;e.updateShapes(f.map(e=>{let t={x:(e.x??0)-(m.x+m.w/2),y:(e.y??0)-(m.y+m.h/2)};return{id:e.id,type:e.type,x:y.x+t.x,y:y.y+t.y}})),e.setSelectedShapes(d)}let getOpacity=e=>{let t=e/100;return t<.2?.1:t<.4?.25:t<.6?.5:t<.8?.75:1},rB={1:"s",2:"m",3:"l",4:"xl"},rF={16:"s",20:"m",28:"l",36:"xl"};function getFontSizeAndScale(e){let t=rF[e];return t?{size:t,scale:1}:e<16?{size:"s",scale:e/16}:e>36?{size:"xl",scale:e/36}:{size:"m",scale:1}}let rU={1:"draw",2:"sans",3:"mono"},rL={"#ffffff":"grey","#000000":"black","#343a40":"black","#495057":"grey","#c92a2a":"red","#a61e4d":"light-red","#862e9c":"violet","#5f3dc4":"light-violet","#364fc7":"blue","#1864ab":"light-blue","#0b7285":"light-green","#087f5b":"light-green","#2b8a3e":"green","#5c940d":"light-green","#e67700":"yellow","#d9480f":"orange","#ced4da":"grey","#868e96":"grey","#fa5252":"light-red","#e64980":"red","#be4bdb":"light-violet","#7950f2":"violet","#4c6ef5":"blue","#228be6":"light-blue","#15aabf":"light-green","#12b886":"green","#40c057":"green","#82c91e":"light-green","#fab005":"yellow","#fd7e14":"orange","#212529":"grey"},rR={solid:"draw",dashed:"dashed",dotted:"dotted"},rz={"cross-hatch":"pattern",hachure:"pattern",solid:"solid"},rN={left:"start",center:"middle",right:"end"},rV={arrow:"arrow",dot:"dot",triangle:"triangle",bar:"pipe"};function getBend(e,t,n){let r=0;if(e.points.length>2){let i=new et.B(t[0],t[1]),o=new et.B(n[0],n[1]),a=new et.B(e.points[1][0],e.points[1][1]),l=et.B.Sub(o,i),c=et.B.Per(l),u=et.B.Med(o,i),d=et.B.Sub(u,c),p=et.B.Add(u,c),h=et.B.NearestPointOnLineSegment(d,p,a,!1);r=et.B.Dist(h,u),et.B.Clockwise(h,o,u)&&(r*=-1)}return r}let getDash=e=>{let t=rR[e.strokeStyle]??"draw";return"draw"===t&&0===e.roughness&&(t="solid"),t},getFill=e=>"transparent"===e.backgroundColor?"none":rz[e.fillStyle]??"solid";async function pasteFiles(e,t,n,r){let i=await Promise.all(t.map(async e=>await (await fetch(e)).blob())),o=i.map(e=>new File([e],"tldrawFile",{type:e.type}));e.mark("paste"),await e.putExternalContent({type:"files",files:o,point:n,ignoreParent:!1,sources:r}),t.forEach(e=>URL.revokeObjectURL(e))}function pasteTldrawContent(e,t,n){let r=n??(e.inputs.shiftKey?e.inputs.currentPagePoint:void 0),i=e.getSelectionPageBounds();e.mark("paste"),e.putContentOntoCurrentPage(t,{point:r,select:!0});let o=e.getSelectionPageBounds();i&&o&&i?.collides(o)&&(e.updateInstanceState({isChangingStyle:!0},{ephemeral:!0}),setTimeout(()=>{e.updateInstanceState({isChangingStyle:!1},{ephemeral:!0})},150))}async function pasteUrl(e,t,n,r){try{if(new URL(t).pathname.match(/\.(png|jpe?g|gif|svg|webp)$/i)){let n=await fetch(t,{method:"HEAD"});if(n.headers.get("content-type")?.match(/^image\//)){e.mark("paste"),pasteFiles(e,[t]);return}}}catch(e){"Failed to fetch"!==e.message&&console.error(e)}return e.mark("paste"),await e.putExternalContent({type:"url",point:n,url:t,sources:r})}function stripHtml(e){let t=document.implementation.createHTMLDocument("");return t.documentElement.innerHTML=e.trim(),t.body.textContent||t.body.innerText||""}let isValidHttpURL=e=>{try{let t=new URL(e);return"http:"===t.protocol||"https:"===t.protocol}catch(e){return!1}},getValidHttpURLList=e=>{let t=e.split(/[\n\s]/);for(let e of t)try{let t=new URL(e);if(!("http:"===t.protocol||"https:"===t.protocol))return}catch(e){return}return ec(t)},isSvgText=e=>/^<svg/.test(e),rH=["input","select","textarea"];function disallowClipboardEvents(e){let{activeElement:t}=document;return e.getIsMenuOpen()||t&&(t.getAttribute("contenteditable")||rH.indexOf(t.tagName.toLowerCase())>-1)}async function blobAsString(e){return new Promise((t,n)=>{let r=new FileReader;r.addEventListener("loadend",()=>{let e=r.result;t(e)}),r.addEventListener("error",()=>{n(r.error)}),r.readAsText(e)})}let isFile=e=>e.types.find(e=>e.match(/^image\//)),handleText=(e,t,n,r)=>{let i=getValidHttpURLList(t);if(i)for(let t of i)pasteUrl(e,t,n);else isValidHttpURL(t)?pasteUrl(e,t,n):isSvgText(t)?(e.mark("paste"),e.putExternalContent({type:"svg-text",text:t,point:n,sources:r})):(e.mark("paste"),e.putExternalContent({type:"text",text:t,point:n,sources:r}))},handlePasteFromEventClipboardData=async(e,t,n)=>{if(null!==e.getEditingShapeId())return;if(!t)throw Error("No clipboard data");let r=[];for(let e of Object.values(t.items))switch(e.kind){case"file":r.push({type:"file",source:new Promise(t=>t(e.getAsFile()))});break;case"string":"text/html"===e.type?r.push({type:"html",source:new Promise(t=>e.getAsString(t))}):"text/plain"===e.type?r.push({type:"text",source:new Promise(t=>e.getAsString(t))}):r.push({type:e.type,source:new Promise(t=>e.getAsString(t))})}handleClipboardThings(e,r,n)},handlePasteFromClipboardApi=async(e,t,n)=>{let r=[];for(let e of t){if(isFile(e))for(let t of e.types)t.match(/^image\//)&&r.push({type:"blob",source:e.getType(t)});e.types.includes("text/html")&&r.push({type:"html",source:new Promise(t=>e.getType("text/html").then(e=>blobAsString(e).then(t)))}),e.types.includes("text/uri-list")&&r.push({type:"url",source:new Promise(t=>e.getType("text/uri-list").then(e=>blobAsString(e).then(t)))}),e.types.includes("text/plain")&&r.push({type:"text",source:new Promise(t=>e.getType("text/plain").then(e=>blobAsString(e).then(t)))})}return await handleClipboardThings(e,r,n)};async function handleClipboardThings(e,t,n){let r=t.filter(e=>("file"===e.type||"blob"===e.type)&&null!==e.source);if(r.length){let t=await Promise.all(r.map(e=>e.source)),i=t.filter(Boolean).map(e=>URL.createObjectURL(e));return await pasteFiles(e,i,n)}let i=await Promise.all(t.filter(e=>"file"!==e.type).map(e=>new Promise(t=>{if("file"===e.type){t({type:"error",data:null,reason:"unexpected file"});return}e.source.then(n=>{let r=n.match(/<tldraw[^>]*>(.*)<\/tldraw>/)?.[1];if(r)try{let e=(0,rO.decompressFromBase64)(r);if(null===e){t({type:"error",data:e,reason:"found tldraw data comment but could not parse base64"});return}{let n=JSON.parse(e);if("application/tldraw"!==n.type&&t({type:"error",data:n,reason:`found tldraw data comment but JSON was of a different type: ${n.type}`}),"string"==typeof n.data){t({type:"error",data:n,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}t({type:"tldraw",data:n.data});return}}catch(e){t({type:"error",data:r,reason:"found tldraw json but data was a string instead of a TLClipboardModel object"});return}else{if("html"===e.type){t({type:"text",data:n,subtype:"html"});return}if("url"===e.type){t({type:"text",data:n,subtype:"url"});return}try{let e=JSON.parse(n);if("excalidraw/clipboard"===e.type){t({type:"excalidraw",data:e});return}t({type:"text",data:n,subtype:"json"});return}catch(e){t({type:"text",data:n,subtype:"text"});return}}t({type:"error",data:n,reason:"unhandled case"})})})));for(let t of i)if("tldraw"===t.type){pasteTldrawContent(e,t.data,n);return}for(let t of i)if("excalidraw"===t.type){pasteExcalidrawContent(e,t.data,n);return}for(let t of i)if("text"===t.type&&"html"===t.subtype){let r=new DOMParser().parseFromString(t.data,"text/html"),o=r.querySelector("body"),a=o&&1===Array.from(o.children).filter(e=>1===e.nodeType).length&&o.firstElementChild&&"A"===o.firstElementChild.tagName&&o.firstElementChild.hasAttribute("href")&&""!==o.firstElementChild.getAttribute("href");if(a){let t=o.firstElementChild.getAttribute("href");handleText(e,t,n,i);return}if(!i.some(e=>"text"===e.type&&"html"!==e.subtype)&&t.data.trim()){handleText(e,stripHtml(t.data),n,i);return}}for(let t of i)if("text"===t.type&&"url"===t.subtype){pasteUrl(e,t.data,n,i);return}for(let t of i)if("text"===t.type&&"text"===t.subtype&&t.data.trim()){handleText(e,t.data,n,i);return}}let handleNativeOrMenuCopy=e=>{let t=e.getContentFromCurrentPage(e.getSelectedShapeIds());if(!t){navigator&&navigator.clipboard&&navigator.clipboard.writeText("");return}let n=(0,rO.compressToBase64)(JSON.stringify({type:"application/tldraw",kind:"content",data:t}));if("undefined"!=typeof navigator){let r=t.shapes.map(t=>e.isShapeOfType(t,"text")||e.isShapeOfType(t,"geo")||e.isShapeOfType(t,"arrow")?t.props.text:e.isShapeOfType(t,"bookmark")||e.isShapeOfType(t,"embed")?t.props.url:null).filter(v.GT);if(navigator.clipboard?.write){let e=new Blob([`<tldraw>${n}</tldraw>`],{type:"text/html"}),t=r.join(" ");""===t&&(t=" "),navigator.clipboard.write([new ClipboardItem({"text/html":e,"text/plain":new Blob([t],{type:"text/plain"})})])}else navigator.clipboard.writeText&&navigator.clipboard.writeText(`<tldraw>${n}</tldraw>`)}};function useMenuClipboardEvents(){let e=(0,I.j)(),t=useUiEvents(),n=(0,P.useCallback)(function(n){0!==e.getSelectedShapeIds().length&&(handleNativeOrMenuCopy(e),t("copy",{source:n}))},[e,t]),r=(0,P.useCallback)(function(n){0!==e.getSelectedShapeIds().length&&(handleNativeOrMenuCopy(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:n}))},[e,t]),i=(0,P.useCallback)(async function(n,r,o){null!==e.getEditingShapeId()||disallowClipboardEvents(e)||(Array.isArray(n)&&n[0]instanceof ClipboardItem?(handlePasteFromClipboardApi(e,n,o),t("paste",{source:"menu"})):navigator.clipboard.read().then(e=>{i(e,r,o)}))},[e,t]);return{copy:n,cut:r,paste:i}}function useNativeClipboardEvents(){let e=(0,I.j)(),t=useUiEvents(),n=(0,b.Hg)("editor.isFocused",()=>e.getInstanceState().isFocused,[e]);(0,P.useEffect)(()=>{if(!n)return;let copy=()=>{0===e.getSelectedShapeIds().length||null!==e.getEditingShapeId()||disallowClipboardEvents(e)||(handleNativeOrMenuCopy(e),t("copy",{source:"kbd"}))};function cut(){0===e.getSelectedShapeIds().length||null!==e.getEditingShapeId()||disallowClipboardEvents(e)||(handleNativeOrMenuCopy(e),e.deleteShapes(e.getSelectedShapeIds()),t("cut",{source:"kbd"}))}let r=!1,pointerUpHandler=e=>{1===e.button&&(r=!0,requestAnimationFrame(()=>{r=!1}))},paste=n=>{if(r){n.stopPropagation();return}null!==e.getEditingShapeId()||disallowClipboardEvents(e)||(n.clipboardData&&!e.inputs.shiftKey?handlePasteFromEventClipboardData(e,n.clipboardData):navigator.clipboard.read().then(t=>{Array.isArray(t)&&t[0]instanceof ClipboardItem&&handlePasteFromClipboardApi(e,t,e.inputs.currentPagePoint)}),t("paste",{source:"kbd"}))};return document.addEventListener("copy",copy),document.addEventListener("cut",cut),document.addEventListener("paste",paste),document.addEventListener("pointerup",pointerUpHandler),()=>{document.removeEventListener("copy",copy),document.removeEventListener("cut",cut),document.removeEventListener("paste",paste),document.removeEventListener("pointerup",pointerUpHandler)}},[e,t,n])}async function getSvgAsImage(e,t,n){let{type:r,quality:i,scale:o}=n,a=+e.getAttribute("width"),l=+e.getAttribute("height"),[c,u]=await clampToBrowserMaxCanvasSize(a*o,l*o);c=Math.floor(c),u=Math.floor(u);let d=c/a,p=await getSvgAsString(e),h=URL.createObjectURL(new Blob([p],{type:"image/svg+xml"})),g=await new Promise(e=>{let n=new Image;n.crossOrigin="anonymous",n.onload=async()=>{t&&await new Promise(e=>setTimeout(e,250));let r=document.createElement("canvas"),i=r.getContext("2d");r.width=c,r.height=u,i.imageSmoothingEnabled=!0,i.imageSmoothingQuality="high",i.drawImage(n,0,0,c,u),URL.revokeObjectURL(h),e(r)},n.onerror=()=>{e(null)},n.src=h});if(!g)return null;let f=await new Promise(e=>g.toBlob(t=>{(!t||$.throwToBlob.get())&&e(null),e(t)},"image/"+r,i));if(!f)return null;if("png"!==r)return f;{let e=new DataView(await f.arrayBuffer());return v.bM.setPhysChunk(e,d,{type:"image/"+r})}}async function getSvgAsString(e){let t=e.cloneNode(!0);e.setAttribute("width",+e.getAttribute("width")+""),e.setAttribute("height",+e.getAttribute("height")+"");let n=new FileReader,r=Array.from(t.querySelectorAll("image"));for(let e of r){let t=e.getAttribute("xlink:href");if(t&&!t.startsWith("data:")){let r=await (await fetch(t)).blob(),i=await new Promise((e,t)=>{n.onload=()=>e(n.result),n.onerror=()=>t(n.error),n.readAsDataURL(r)});e.setAttribute("xlink:href",i)}}let i=new XMLSerializer().serializeToString(t).replaceAll("&#10;      ","").replaceAll(/((\s|")[0-9]*\.[0-9]{2})([0-9]*)(\b|"|\))/g,"$1");return i}async function getSvg(e,t,n){let r=await e.getSvg(t?.length?t:[...e.getCurrentPageShapeIds()],{scale:1,background:e.getInstanceState().exportBackground,...n});if(!r)throw Error("Could not construct SVG.");return r}async function exportToString(e,t,n,r={}){switch(n){case"svg":return getSvgAsString(await getSvg(e,t,r));case"json":{let n=e.getContentFromCurrentPage(t);return JSON.stringify(n)}default:(0,v.iP)(n)}}async function exportToBlob({editor:e,ids:t,format:n,opts:r={}}){switch(n){case"svg":return new Blob([await exportToString(e,t,"svg",r)],{type:"text/plain"});case"json":return new Blob([await exportToString(e,t,"json",r)],{type:"text/plain"});case"jpeg":case"png":case"webp":{let i=await getSvgAsImage(await getSvg(e,t,r),e.environment.isSafari,{type:n,quality:1,scale:2});if(!i)throw Error("Could not construct image.");return i}default:(0,v.iP)(n)}}let rG={jpeg:"image/jpeg",png:"image/png",webp:"image/webp",json:"text/plain",svg:"text/plain"};function exportToBlobPromise(e,t,n,r={}){return{blobPromise:exportToBlob({editor:e,ids:t,format:n,opts:r}),mimeType:rG[n]}}function copyAs(e,t,n="svg",r={}){if(!window.navigator.clipboard)return Promise.reject(Error("Copy not supported"));if(window.navigator.clipboard.write){let{blobPromise:i,mimeType:o}=exportToBlobPromise(e,t,n,r);return window.navigator.clipboard.write([new ClipboardItem({[o]:i})]).catch(e=>(console.error(e),i.then(e=>window.navigator.clipboard.write([new ClipboardItem({[o]:e})]))))}switch(n){case"json":case"svg":return fallbackWriteTextAsync(async()=>exportToString(e,t,n,r));case"jpeg":case"png":throw Error("Copy not supported");default:(0,v.iP)(n)}}async function fallbackWriteTextAsync(e){await navigator.clipboard?.writeText?.(await e())}let rW=(0,P.createContext)({});function ToastsProvider({children:e}){let[t,n]=(0,P.useState)([]),r=(0,P.useCallback)(e=>{let t=e.id??(0,eM.E)();return n(n=>[...n.filter(t=>t.id!==e.id),{...e,id:t}]),t},[]),i=(0,P.useCallback)(e=>(n(t=>t.filter(t=>t.id!==e)),e),[]),o=(0,P.useCallback)(()=>{n(()=>[])},[]);return(0,T.jsx)(rW.Provider,{value:{toasts:t,addToast:r,removeToast:i,clearToasts:o},children:e})}function useToasts(){let e=(0,P.useContext)(rW);if(!e)throw Error("useToasts must be used within a ToastsProvider");return e}function useCopyAs(){let e=(0,I.j)(),{addToast:t}=useToasts(),n=useTranslation();return(0,P.useCallback)((r,i="svg")=>{copyAs(e,r,i).catch(()=>{t({id:"copy-fail",icon:"warning-triangle",title:n("toast.error.copy-fail.title"),description:n("toast.error.copy-fail.desc")})})},[e,t,n])}async function exportAs(e,t,n="png",r,i={}){if(!r&&(r=`shapes at ${getTimestamp()}`,1===t.length)){let n=e.getShape(t[0]);r=e.isShapeOfType(n,"frame")?n.props.name??"frame":`${n.id.replace(/:/,"_")} at ${getTimestamp()}`}r+=`.${n}`;let o=await exportToBlob({editor:e,ids:t,format:n,opts:i}),a=new File([o],r,{type:o.type});downloadFile(a)}function getTimestamp(){let e=new Date,t=String(e.getFullYear()).slice(2),n=String(e.getMonth()+1).padStart(2,"0"),r=String(e.getDate()).padStart(2,"0"),i=String(e.getHours()).padStart(2,"0"),o=String(e.getMinutes()).padStart(2,"0"),a=String(e.getSeconds()).padStart(2,"0");return`${t}-${n}-${r} ${i}.${o}.${a}`}function downloadFile(e){let t=document.createElement("a"),n=URL.createObjectURL(e);t.href=n,t.download=e.name,t.click(),URL.revokeObjectURL(n)}function useExportAs(){let e=(0,I.j)(),{addToast:t}=useToasts(),n=useTranslation();return(0,P.useCallback)((r,i="png",o)=>{exportAs(e,r,i,o,{scale:1,background:e.getInstanceState().exportBackground}).catch(e=>{console.error(e.message),t({id:"export-fail",title:n("toast.error.export-fail.title"),description:n("toast.error.export-fail.desc")})})},[e,t,n])}function useInsertMedia(){let e=(0,I.j)(),t=(0,P.useRef)();return(0,P.useEffect)(()=>{let n=window.document.createElement("input");async function onchange(t){let r=t.target.files;r&&0!==r.length&&(await e.putExternalContent({type:"files",files:Array.from(r),point:e.getViewportPageBounds().center,ignoreParent:!1}),n.value="")}return n.type="file",n.accept="image/jpeg,image/png,image/gif,image/svg+xml,video/mp4,video/quicktime",n.multiple=!0,t.current=n,n.addEventListener("change",onchange),()=>{t.current=void 0,n.removeEventListener("change",onchange)}},[e]),(0,P.useCallback)(()=>{t.current?.click()},[t])}function usePrint(){let e=(0,I.j)(),t=(0,P.useRef)(null),n=(0,P.useRef)(null);return(0,P.useCallback)(async function(){let r=document.createElement("div"),i=document.createElement("style"),clearElements=(e,t)=>{e&&(e.innerHTML=""),t&&document.head.contains(t)&&document.head.removeChild(t),e&&document.body.contains(e)&&document.body.removeChild(e)};clearElements(t.current,n.current),t.current=r,n.current=i;let o=`tl-print-surface-${(0,eM.E)()}`;r.className=o,i.innerHTML=`
			.${o} {
				display: none;
			}

			.${o} svg {
				max-width: 100%;
				height: 100%;
				display: block;
			}

			@media print {				  
				html, body {
					min-height: 100%;
					height: 100%;
					margin: 0;
				}

				body {
					position: relative;
				}

				body > * {
					display: none;
				}

				.tldraw__editor {
					display: none;
				}

				.${o} {
					display: block !important;
					background: white;
					min-height: 100%;
					height: 100%;
					max-width: 100%;
				}

				.${o}__item {
					padding: 10mm;
					display: flex;
					min-height: 100%;
					flex-direction: column;
					page-break-after: always;
					position: relative;
					overflow: hidden;
					height: 100%;
				}

				.${o}__item__main {
					flex: 1;
					display: flex;
					align-items: center;
					justify-content: center;
					max-height: 100%;
				}

				.${o}__item__header {
					display: none;
				}

				.${o}__item__footer {
					display: none;
					text-align: right;
				}

				.${o}__item__footer__hide {
					display: none;
				}

				
			}

		`;let beforePrintHandler=()=>{document.head.appendChild(i),document.body.appendChild(r)},afterPrintHandler=()=>{e.once("change-history",()=>{clearElements(r,i)})};function addPageToPrint(e,t,n){try{r.innerHTML+=`<div class="${o}__item">
        <div class="${o}__item__header">
          ${e.replace(/</g,"&lt;").replace(/>/g,"&gt;")}
        </div>
        <div class="${o}__item__main">
          ${n.outerHTML}
        </div>
        <div class="${o}__item__footer ${o}__item__footer__${t?"":"hide"}">
          ${t??""}
        </div>
      </div>`}catch(e){console.error(e)}}function triggerPrint(){e.environment.isChromeForIos?(beforePrintHandler(),window.print()):e.environment.isSafari?(beforePrintHandler(),document.execCommand("print",!1)):window.print()}window.addEventListener("beforeprint",beforePrintHandler),window.addEventListener("afterprint",afterPrintHandler);let a=e.getSelectedShapeIds(),l=e.getCurrentPageId(),c=e.getPages(),u={scale:1,background:!1,darkMode:!1,preserveAspectRatio:"xMidYMid meet"};if(e.getSelectedShapeIds().length>0){let t=await e.getSvg(a,u);if(t){let e=c.find(e=>e.id===l);addPageToPrint(`tldraw \u2014 ${e?.name}`,null,t),triggerPrint()}}else{let t=e.getCurrentPage(),n=await e.getSvg(e.getSortedChildIdsForParent(t.id),u);n&&(addPageToPrint(`tldraw \u2014 ${t.name}`,null,n),triggerPrint())}window.removeEventListener("beforeprint",beforePrintHandler),window.removeEventListener("afterprint",afterPrintHandler)},[e])}let rZ=(0,P.createContext)({});function DialogsProvider({children:e}){let t=(0,I.j)(),n=useUiEvents(),[r,i]=(0,P.useState)([]),o=(0,P.useCallback)(e=>{let r=e.id??(0,eM.E)();return i(t=>[...t.filter(t=>t.id!==e.id),{...e,id:r}]),n("open-menu",{source:"dialog",id:r}),t.addOpenMenu(r),r},[t,n]),a=(0,P.useCallback)((e,r)=>(i(t=>t.map(t=>t.id===e?{...t,...r}:t)),n("open-menu",{source:"dialog",id:e}),t.addOpenMenu(e),e),[t,n]),l=(0,P.useCallback)(e=>(i(t=>t.filter(t=>t.id!==e||(t.onClose?.(),!1))),n("close-menu",{source:"dialog",id:e}),t.deleteOpenMenu(e),e),[t,n]),c=(0,P.useCallback)(()=>{i(e=>(e.forEach(e=>{e.onClose?.(),n("close-menu",{source:"dialog",id:e.id}),t.deleteOpenMenu(e.id)}),[]))},[t,n]);return(0,T.jsx)(rZ.Provider,{value:{dialogs:r,addDialog:o,removeDialog:l,clearDialogs:c,updateDialog:a},children:e})}function useDialogs(){let e=(0,P.useContext)(rZ);if(!e)throw Error("useDialogs must be used within a DialogsProvider");return e}let rK=P.createContext({});function makeActions(e){return Object.fromEntries(e.map(e=>[e.id,e]))}function getExportName(e,t){let n=e.getSelectedShapes();if(0===n.length)return e.getDocumentSettings().name||t}function ActionsProvider({overrides:e,children:t}){let n=(0,I.j)(),{addDialog:r,clearDialogs:i}=useDialogs(),{clearToasts:o}=useToasts(),a=useTranslation(),l=useInsertMedia(),c=usePrint(),{cut:u,copy:d,paste:p}=useMenuClipboardEvents(),h=useCopyAs(),g=useExportAs(),f=a("document.default-name"),m=useUiEvents(),y=P.useMemo(()=>{function mustGoBackToSelectToolFirst(){return n.isIn("select")||(n.complete(),n.setCurrentTool("select")),!1}function canApplySelectionAction(){return n.isIn("select")&&n.getSelectedShapeIds().length>0}let t=[{id:"edit-link",label:"action.edit-link",icon:"link",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("edit-link",{source:e}),n.mark("edit-link"),r({component:rA})))}},{id:"insert-embed",label:"action.insert-embed",kbd:"$i",onSelect(e){m("insert-embed",{source:e}),r({component:rD})}},{id:"insert-media",label:"action.insert-media",kbd:"$u",onSelect(e){m("insert-media",{source:e}),l()}},{id:"undo",label:"action.undo",icon:"undo",kbd:"$z",onSelect(e){m("undo",{source:e}),n.undo()}},{id:"redo",label:"action.redo",icon:"redo",kbd:"$!z",onSelect(e){m("redo",{source:e}),n.redo()}},{id:"export-as-svg",label:{default:"action.export-as-svg",menu:"action.export-as-svg.short","context-menu":"action.export-as-svg.short"},readonlyOk:!0,onSelect(e){m("export-as",{format:"svg",source:e}),g(n.getSelectedShapeIds(),"svg",getExportName(n,f))}},{id:"export-as-png",label:{default:"action.export-as-png",menu:"action.export-as-png.short","context-menu":"action.export-as-png.short"},readonlyOk:!0,onSelect(e){m("export-as",{format:"png",source:e}),g(n.getSelectedShapeIds(),"png",getExportName(n,f))}},{id:"export-as-json",label:{default:"action.export-as-json",menu:"action.export-as-json.short","context-menu":"action.export-as-json.short"},readonlyOk:!0,onSelect(e){m("export-as",{format:"json",source:e}),g(n.getSelectedShapeIds(),"json",getExportName(n,f))}},{id:"export-all-as-svg",label:{default:"action.export-all-as-svg",menu:"action.export-all-as-svg.short","context-menu":"action.export-all-as-svg.short"},readonlyOk:!0,onSelect(e){m("export-all-as",{format:"svg",source:e}),g(Array.from(n.getCurrentPageShapeIds()),"svg",getExportName(n,f))}},{id:"export-all-as-png",label:{default:"action.export-all-as-png",menu:"action.export-all-as-png.short","context-menu":"action.export-all-as-png.short"},readonlyOk:!0,onSelect(e){m("export-all-as",{format:"png",source:e}),g(Array.from(n.getCurrentPageShapeIds()),"png",getExportName(n,f))}},{id:"export-all-as-json",label:{default:"action.export-all-as-json",menu:"action.export-all-as-json.short","context-menu":"action.export-all-as-json.short"},readonlyOk:!0,onSelect(e){m("export-all-as",{format:"json",source:e}),g(Array.from(n.getCurrentPageShapeIds()),"json",getExportName(n,f))}},{id:"copy-as-svg",label:{default:"action.copy-as-svg",menu:"action.copy-as-svg.short","context-menu":"action.copy-as-svg.short"},kbd:"$!c",readonlyOk:!0,onSelect(e){m("copy-as",{format:"svg",source:e}),h(n.getSelectedShapeIds(),"svg")}},{id:"copy-as-png",label:{default:"action.copy-as-png",menu:"action.copy-as-png.short","context-menu":"action.copy-as-png.short"},readonlyOk:!0,onSelect(e){m("copy-as",{format:"png",source:e}),h(n.getSelectedShapeIds(),"png")}},{id:"copy-as-json",label:{default:"action.copy-as-json",menu:"action.copy-as-json.short","context-menu":"action.copy-as-json.short"},readonlyOk:!0,onSelect(e){m("copy-as",{format:"json",source:e}),h(n.getSelectedShapeIds(),"json")}},{id:"toggle-auto-size",label:"action.toggle-auto-size",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("toggle-auto-size",{source:e}),n.mark("toggling auto size"),n.updateShapes(n.getSelectedShapes().filter(e=>n.isShapeOfType(e,"text")&&!1===e.props.autoSize).map(e=>({id:e.id,type:e.type,props:{...e.props,w:8,autoSize:!0}})))))}},{id:"open-embed-link",label:"action.open-embed-link",readonlyOk:!0,onSelect(e){m("open-embed-link",{source:e});let t=n.getSelectedShapeIds(),r="No embed shapes selected";if(1!==t.length){console.error(r);return}let i=n.getShape(t[0]);if(!i||!n.isShapeOfType(i,"embed")){console.error(r);return}openWindow(i.props.url,"_blank")}},{id:"select-zoom-tool",readonlyOk:!0,kbd:"z",onSelect(e){if(n.root.getCurrent()?.id!=="zoom"&&(m("zoom-tool",{source:e}),!(n.inputs.shiftKey||n.inputs.ctrlKey))){let e=n.root.getCurrent();e&&e.getCurrent()?.id==="idle"&&n.setCurrentTool("zoom",{onInteractionEnd:e.id,maskAs:"zoom"})}}},{id:"convert-to-bookmark",label:"action.convert-to-bookmark",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||n.batch(()=>{m("convert-to-bookmark",{source:e});let t=n.getSelectedShapes(),r=[],i=[];for(let e of t){if(!e||!n.isShapeOfType(e,"embed")||!e.props.url)continue;let t=new et.B(e.x,e.y);t.rot(-e.rotation),t.add(new et.B(e.props.w/2-150,e.props.h/2-160)),t.rot(e.rotation);let o={id:(0,S.F1)(),type:"bookmark",rotation:e.rotation,x:t.x,y:t.y,opacity:1,props:{url:e.props.url}};r.push(o),i.push(e.id)}n.mark("convert shapes to bookmark"),n.deleteShapes(i),n.createShapes(r)}))}},{id:"convert-to-embed",label:"action.convert-to-embed",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("convert-to-embed",{source:e}),n.batch(()=>{let e=n.getSelectedShapeIds(),t=(0,v.oA)(e.map(e=>n.getShape(e))),r=[],i=[];for(let e of t){if(!n.isShapeOfType(e,"bookmark"))continue;let{url:t}=e.props,o=getEmbedInfo(e.props.url);if(!o||!o.definition)continue;let{width:a,height:l}=o.definition,c=new et.B(e.x,e.y);c.rot(-e.rotation),c.add(new et.B(e.props.w/2-a/2,e.props.h/2-l/2)),c.rot(e.rotation);let u={id:(0,S.F1)(),type:"embed",x:c.x,y:c.y,rotation:e.rotation,props:{url:t,w:a,h:l}};r.push(u),i.push(e.id)}n.mark("convert shapes to embed"),n.deleteShapes(i),n.createShapes(r)})))}},{id:"duplicate",kbd:"$d",label:"action.duplicate",icon:"duplicate",onSelect(e){let t,r;if(!canApplySelectionAction()||mustGoBackToSelectToolFirst())return;m("duplicate-shapes",{source:e});let i=n.getInstanceState();if(i.duplicateProps)t=i.duplicateProps.shapeIds,r=i.duplicateProps.offset;else{t=n.getSelectedShapeIds();let e=eo.xu.Common((0,v.oA)(t.map(e=>n.getShapePageBounds(e))));r=i.canMoveCamera?{x:e.width+10,y:0}:{x:16/n.getZoomLevel(),y:16/n.getZoomLevel()}}n.mark("duplicate shapes"),n.duplicateShapes(t,r),i.duplicateProps&&n.updateInstanceState({duplicateProps:{...i.duplicateProps,shapeIds:n.getSelectedShapeIds()}})}},{id:"ungroup",label:"action.ungroup",kbd:"$!g",icon:"ungroup",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("ungroup-shapes",{source:e}),n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())))}},{id:"group",label:"action.group",kbd:"$g",icon:"group",onSelect(e){if(!canApplySelectionAction()||mustGoBackToSelectToolFirst())return;m("group-shapes",{source:e});let t=n.getOnlySelectedShape();t&&n.isShapeOfType(t,"group")?(n.mark("ungroup"),n.ungroupShapes(n.getSelectedShapeIds())):(n.mark("group"),n.groupShapes(n.getSelectedShapeIds()))}},{id:"remove-frame",label:"action.remove-frame",kbd:"$!f",onSelect(e){if(!canApplySelectionAction())return;m("remove-frame",{source:e});let t=n.getSelectedShapes();t.length>0&&t.every(e=>n.isShapeOfType(e,"frame"))&&(n.mark("remove-frame"),removeFrame(n,t.map(e=>e.id)))}},{id:"fit-frame-to-content",label:"action.fit-frame-to-content",onSelect(e){if(!canApplySelectionAction())return;m("fit-frame-to-content",{source:e});let t=n.getOnlySelectedShape();t&&n.isShapeOfType(t,"frame")&&(n.mark("fit-frame-to-content"),fitFrameToContent(n,t.id))}},{id:"align-left",label:"action.align-left",kbd:"?A",icon:"align-left",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("align-shapes",{operation:"left",source:e}),n.mark("align left"),n.alignShapes(n.getSelectedShapeIds(),"left")))}},{id:"align-center-horizontal",label:{default:"action.align-center-horizontal","context-menu":"action.align-center-horizontal.short"},kbd:"?H",icon:"align-center-horizontal",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("align-shapes",{operation:"center-horizontal",source:e}),n.mark("align center horizontal"),n.alignShapes(n.getSelectedShapeIds(),"center-horizontal")))}},{id:"align-right",label:"action.align-right",kbd:"?D",icon:"align-right",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("align-shapes",{operation:"right",source:e}),n.mark("align right"),n.alignShapes(n.getSelectedShapeIds(),"right")))}},{id:"align-center-vertical",label:{default:"action.align-center-vertical","context-menu":"action.align-center-vertical.short"},kbd:"?V",icon:"align-center-vertical",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("align-shapes",{operation:"center-vertical",source:e}),n.mark("align center vertical"),n.alignShapes(n.getSelectedShapeIds(),"center-vertical")))}},{id:"align-top",label:"action.align-top",icon:"align-top",kbd:"?W",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("align-shapes",{operation:"top",source:e}),n.mark("align top"),n.alignShapes(n.getSelectedShapeIds(),"top")))}},{id:"align-bottom",label:"action.align-bottom",icon:"align-bottom",kbd:"?S",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("align-shapes",{operation:"bottom",source:e}),n.mark("align bottom"),n.alignShapes(n.getSelectedShapeIds(),"bottom")))}},{id:"distribute-horizontal",label:{default:"action.distribute-horizontal","context-menu":"action.distribute-horizontal.short"},icon:"distribute-horizontal",kbd:"?!h",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("distribute-shapes",{operation:"horizontal",source:e}),n.mark("distribute horizontal"),n.distributeShapes(n.getSelectedShapeIds(),"horizontal")))}},{id:"distribute-vertical",label:{default:"action.distribute-vertical","context-menu":"action.distribute-vertical.short"},icon:"distribute-vertical",kbd:"?!V",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("distribute-shapes",{operation:"vertical",source:e}),n.mark("distribute vertical"),n.distributeShapes(n.getSelectedShapeIds(),"vertical")))}},{id:"stretch-horizontal",label:{default:"action.stretch-horizontal","context-menu":"action.stretch-horizontal.short"},icon:"stretch-horizontal",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("stretch-shapes",{operation:"horizontal",source:e}),n.mark("stretch horizontal"),n.stretchShapes(n.getSelectedShapeIds(),"horizontal")))}},{id:"stretch-vertical",label:{default:"action.stretch-vertical","context-menu":"action.stretch-vertical.short"},icon:"stretch-vertical",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("stretch-shapes",{operation:"vertical",source:e}),n.mark("stretch vertical"),n.stretchShapes(n.getSelectedShapeIds(),"vertical")))}},{id:"flip-horizontal",label:{default:"action.flip-horizontal","context-menu":"action.flip-horizontal.short"},kbd:"!h",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("flip-shapes",{operation:"horizontal",source:e}),n.mark("flip horizontal"),n.flipShapes(n.getSelectedShapeIds(),"horizontal")))}},{id:"flip-vertical",label:{default:"action.flip-vertical","context-menu":"action.flip-vertical.short"},kbd:"!v",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("flip-shapes",{operation:"vertical",source:e}),n.mark("flip vertical"),n.flipShapes(n.getSelectedShapeIds(),"vertical")))}},{id:"pack",label:"action.pack",icon:"pack",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("pack-shapes",{source:e}),n.mark("pack"),n.packShapes(n.getSelectedShapeIds(),16)))}},{id:"stack-vertical",label:{default:"action.stack-vertical","context-menu":"action.stack-vertical.short"},icon:"stack-vertical",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("stack-shapes",{operation:"vertical",source:e}),n.mark("stack-vertical"),n.stackShapes(n.getSelectedShapeIds(),"vertical",16)))}},{id:"stack-horizontal",label:{default:"action.stack-horizontal","context-menu":"action.stack-horizontal.short"},icon:"stack-horizontal",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("stack-shapes",{operation:"horizontal",source:e}),n.mark("stack-horizontal"),n.stackShapes(n.getSelectedShapeIds(),"horizontal",16)))}},{id:"bring-to-front",label:"action.bring-to-front",kbd:"]",icon:"bring-to-front",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("reorder-shapes",{operation:"toFront",source:e}),n.mark("bring to front"),n.bringToFront(n.getSelectedShapeIds())))}},{id:"bring-forward",label:"action.bring-forward",icon:"bring-forward",kbd:"?]",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("reorder-shapes",{operation:"forward",source:e}),n.mark("bring forward"),n.bringForward(n.getSelectedShapeIds())))}},{id:"send-backward",label:"action.send-backward",icon:"send-backward",kbd:"?[",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("reorder-shapes",{operation:"backward",source:e}),n.mark("send backward"),n.sendBackward(n.getSelectedShapeIds())))}},{id:"send-to-back",label:"action.send-to-back",icon:"send-to-back",kbd:"[",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("reorder-shapes",{operation:"toBack",source:e}),n.mark("send to back"),n.sendToBack(n.getSelectedShapeIds())))}},{id:"cut",label:"action.cut",kbd:"$x",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(n.mark("cut"),u(e)))}},{id:"copy",label:"action.copy",kbd:"$c",readonlyOk:!0,onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||d(e))}},{id:"paste",label:"action.paste",kbd:"$v",onSelect(e){navigator.clipboard?.read().then(t=>{p(t,e,"context-menu"===e?n.inputs.currentPagePoint:void 0)})}},{id:"select-all",label:"action.select-all",kbd:"$a",readonlyOk:!0,onSelect(e){n.batch(()=>{mustGoBackToSelectToolFirst()||(m("select-all-shapes",{source:e}),n.mark("select all kbd"),n.selectAll())})}},{id:"select-none",label:"action.select-none",readonlyOk:!0,onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("select-none-shapes",{source:e}),n.mark("select none"),n.selectNone()))}},{id:"delete",label:"action.delete",kbd:",del,backspace",icon:"trash",onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("delete-shapes",{source:e}),n.mark("delete"),n.deleteShapes(n.getSelectedShapeIds())))}},{id:"rotate-cw",label:"action.rotate-cw",icon:"rotate-cw",onSelect(e){if(!canApplySelectionAction()||mustGoBackToSelectToolFirst())return;m("rotate-cw",{source:e}),n.mark("rotate-cw");let t=n.getSelectionRotation()%(E.pj/2),r=(0,E.C2)(t,0)||(0,E.C2)(t,E.pj/2);n.rotateShapesBy(n.getSelectedShapeIds(),E.pj/2-(r?0:t))}},{id:"rotate-ccw",label:"action.rotate-ccw",icon:"rotate-ccw",onSelect(e){if(!canApplySelectionAction()||mustGoBackToSelectToolFirst())return;m("rotate-ccw",{source:e}),n.mark("rotate-ccw");let t=n.getSelectionRotation()%(E.pj/2),r=(0,E.C2)(t,0);n.rotateShapesBy(n.getSelectedShapeIds(),r?-(E.pj/2):-t)}},{id:"zoom-in",label:"action.zoom-in",kbd:"$=,=",readonlyOk:!0,onSelect(e){m("zoom-in",{source:e}),n.zoomIn(n.getViewportScreenCenter(),{duration:_.KD})}},{id:"zoom-out",label:"action.zoom-out",kbd:"$-,-",readonlyOk:!0,onSelect(e){m("zoom-out",{source:e}),n.zoomOut(n.getViewportScreenCenter(),{duration:_.KD})}},{id:"zoom-to-100",label:"action.zoom-to-100",icon:"reset-zoom",kbd:"!0",readonlyOk:!0,onSelect(e){m("reset-zoom",{source:e}),n.resetZoom(n.getViewportScreenCenter(),{duration:_.KD})}},{id:"zoom-to-fit",label:"action.zoom-to-fit",kbd:"!1",readonlyOk:!0,onSelect(e){m("zoom-to-fit",{source:e}),n.zoomToFit({duration:_.KD})}},{id:"zoom-to-selection",label:"action.zoom-to-selection",kbd:"!2",readonlyOk:!0,onSelect(e){canApplySelectionAction()&&(mustGoBackToSelectToolFirst()||(m("zoom-to-selection",{source:e}),n.zoomToSelection({duration:_.KD})))}},{id:"toggle-snap-mode",label:{default:"action.toggle-snap-mode",menu:"action.toggle-snap-mode.menu"},onSelect(e){m("toggle-snap-mode",{source:e}),n.user.updateUserPreferences({isSnapMode:!n.user.getIsSnapMode()})},checkbox:!0},{id:"toggle-dark-mode",label:{default:"action.toggle-dark-mode",menu:"action.toggle-dark-mode.menu"},kbd:"$/",readonlyOk:!0,onSelect(e){m("toggle-dark-mode",{source:e}),n.user.updateUserPreferences({isDarkMode:!n.user.getIsDarkMode()})},checkbox:!0},{id:"toggle-wrap-mode",label:{default:"action.toggle-wrap-mode",menu:"action.toggle-wrap-mode.menu"},readonlyOk:!0,onSelect(e){m("toggle-wrap-mode",{source:e}),n.user.updateUserPreferences({isWrapMode:!n.user.getIsWrapMode()})},checkbox:!0},{id:"toggle-reduce-motion",label:{default:"action.toggle-reduce-motion",menu:"action.toggle-reduce-motion.menu"},readonlyOk:!0,onSelect(e){m("toggle-reduce-motion",{source:e}),n.user.updateUserPreferences({animationSpeed:0===n.user.getAnimationSpeed()?1:0})},checkbox:!0},{id:"toggle-edge-scrolling",label:{default:"action.toggle-edge-scrolling",menu:"action.toggle-edge-scrolling.menu"},readonlyOk:!0,onSelect(e){m("toggle-edge-scrolling",{source:e}),n.user.updateUserPreferences({edgeScrollSpeed:0===n.user.getEdgeScrollSpeed()?1:0})},checkbox:!0},{id:"toggle-transparent",label:{default:"action.toggle-transparent",menu:"action.toggle-transparent.menu","context-menu":"action.toggle-transparent.context-menu"},readonlyOk:!0,onSelect(e){m("toggle-transparent",{source:e}),n.updateInstanceState({exportBackground:!n.getInstanceState().exportBackground},{ephemeral:!0})},checkbox:!0},{id:"toggle-tool-lock",label:{default:"action.toggle-tool-lock",menu:"action.toggle-tool-lock.menu"},kbd:"q",onSelect(e){m("toggle-tool-lock",{source:e}),n.updateInstanceState({isToolLocked:!n.getInstanceState().isToolLocked})},checkbox:!0},{id:"unlock-all",label:"action.unlock-all",onSelect(e){m("unlock-all",{source:e});let t=[];for(let e of n.getCurrentPageShapes())e.isLocked&&t.push({id:e.id,type:e.type,isLocked:!1});t.length>0&&n.updateShapes(t)}},{id:"toggle-focus-mode",label:{default:"action.toggle-focus-mode",menu:"action.toggle-focus-mode.menu"},readonlyOk:!0,kbd:"$.",checkbox:!0,onSelect(e){requestAnimationFrame(()=>{n.batch(()=>{m("toggle-focus-mode",{source:e}),i(),o(),n.updateInstanceState({isFocusMode:!n.getInstanceState().isFocusMode})})})}},{id:"toggle-grid",label:{default:"action.toggle-grid",menu:"action.toggle-grid.menu"},readonlyOk:!0,kbd:"$'",onSelect(e){m("toggle-grid-mode",{source:e}),n.updateInstanceState({isGridMode:!n.getInstanceState().isGridMode})},checkbox:!0},{id:"toggle-debug-mode",label:{default:"action.toggle-debug-mode",menu:"action.toggle-debug-mode.menu"},readonlyOk:!0,onSelect(e){m("toggle-debug-mode",{source:e}),n.updateInstanceState({isDebugMode:!n.getInstanceState().isDebugMode})},checkbox:!0},{id:"print",label:"action.print",kbd:"$p",readonlyOk:!0,onSelect(e){m("print",{source:e}),c()}},{id:"exit-pen-mode",label:"action.exit-pen-mode",icon:"cross-2",readonlyOk:!0,onSelect(e){m("exit-pen-mode",{source:e}),n.updateInstanceState({isPenMode:!1})}},{id:"stop-following",label:"action.stop-following",icon:"cross-2",readonlyOk:!0,onSelect(e){m("stop-following",{source:e}),n.stopFollowingUser()}},{id:"back-to-content",label:"action.back-to-content",icon:"arrow-left",readonlyOk:!0,onSelect(e){m("zoom-to-content",{source:e}),n.zoomToContent()}},{id:"toggle-lock",label:"action.toggle-lock",kbd:"!l",onSelect(e){n.mark("locking"),m("toggle-lock",{source:e}),n.toggleLock(n.getSelectedShapeIds())}},{id:"new-page",label:"context.pages.new-page",onSelect(e){let t=S.ez.createId(),r=n.getSelectedShapeIds();n.batch(()=>{n.mark("move_shapes_to_page"),n.createPage({name:a("page-menu.new-page-initial-name"),id:t}),n.moveShapesToPage(r,t)}),m("new-page",{source:e})}}],y=makeActions(t);return e?e(n,y,void 0):y},[n,m,e,r,l,g,h,u,d,p,i,o,c,a,f]);return(0,T.jsx)(rK.Provider,{value:asActions(y),children:t})}function useActions(){let e=P.useContext(rK);if(!e)throw Error("useTools must be used within a ToolProvider");return e}function asActions(e){return e}function unwrapLabel(e,t){return e?"string"==typeof e?e:t?e[t]??e.default:void 0:void 0}var rY=n(7079);let rq="ContextMenu",[rX,rJ]=(0,nl.b)(rq,[rY.Wf]),rQ=(0,rY.Wf)(),[r0,r1]=rX(rq),r2=(0,P.forwardRef)((e,t)=>{let{__scopeContextMenu:n,disabled:r=!1,...i}=e,o=r1("ContextMenuTrigger",n),a=rQ(n),l=(0,P.useRef)({x:0,y:0}),c=(0,P.useRef)({getBoundingClientRect:()=>DOMRect.fromRect({width:0,height:0,...l.current})}),u=(0,P.useRef)(0),d=(0,P.useCallback)(()=>window.clearTimeout(u.current),[]),handleOpen=e=>{l.current={x:e.clientX,y:e.clientY},o.onOpenChange(!0)};return(0,P.useEffect)(()=>d,[d]),(0,P.useEffect)(()=>void(r&&d()),[r,d]),(0,P.createElement)(P.Fragment,null,(0,P.createElement)(rY.ee,(0,nr.Z)({},a,{virtualRef:c})),(0,P.createElement)(np.WV.span,(0,nr.Z)({"data-state":o.open?"open":"closed","data-disabled":r?"":void 0},i,{ref:t,style:{WebkitTouchCallout:"none",...e.style},onContextMenu:r?e.onContextMenu:(0,no.M)(e.onContextMenu,e=>{d(),handleOpen(e),e.preventDefault()}),onPointerDown:r?e.onPointerDown:(0,no.M)(e.onPointerDown,$1b0217ee4a91d156$var$whenTouchOrPen(e=>{d(),u.current=window.setTimeout(()=>handleOpen(e),700)})),onPointerMove:r?e.onPointerMove:(0,no.M)(e.onPointerMove,$1b0217ee4a91d156$var$whenTouchOrPen(d)),onPointerCancel:r?e.onPointerCancel:(0,no.M)(e.onPointerCancel,$1b0217ee4a91d156$var$whenTouchOrPen(d)),onPointerUp:r?e.onPointerUp:(0,no.M)(e.onPointerUp,$1b0217ee4a91d156$var$whenTouchOrPen(d))})))}),$1b0217ee4a91d156$export$14afd0be83e45060=e=>{let{__scopeContextMenu:t,...n}=e,r=rQ(t);return(0,P.createElement)(rY.h_,(0,nr.Z)({},r,n))},r3=(0,P.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=r1("ContextMenuContent",n),o=rQ(n),a=(0,P.useRef)(!1);return(0,P.createElement)(rY.VY,(0,nr.Z)({},o,r,{ref:t,side:"right",sideOffset:2,align:"start",onCloseAutoFocus:t=>{var n;null===(n=e.onCloseAutoFocus)||void 0===n||n.call(e,t),!t.defaultPrevented&&a.current&&t.preventDefault(),a.current=!1},onInteractOutside:t=>{var n;null===(n=e.onInteractOutside)||void 0===n||n.call(e,t),t.defaultPrevented||i.modal||(a.current=!0)},style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))}),r5=(0,P.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=rQ(n);return(0,P.createElement)(rY.ZA,(0,nr.Z)({},i,r,{ref:t}))}),r6=(0,P.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=rQ(n);return(0,P.createElement)(rY.ck,(0,nr.Z)({},i,r,{ref:t}))}),r4=(0,P.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=rQ(n);return(0,P.createElement)(rY.oC,(0,nr.Z)({},i,r,{ref:t}))}),$1b0217ee4a91d156$export$5bc21d1c00c4b201=e=>{let{__scopeContextMenu:t,children:n,onOpenChange:r,open:i,defaultOpen:o}=e,a=rQ(t),[l,c]=(0,ng.T)({prop:i,defaultProp:o,onChange:r});return(0,P.createElement)(rY.Tr,(0,nr.Z)({},a,{open:l,onOpenChange:c}),n)},r8=(0,P.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=rQ(n);return(0,P.createElement)(rY.fF,(0,nr.Z)({},i,r,{ref:t}))}),r7=(0,P.forwardRef)((e,t)=>{let{__scopeContextMenu:n,...r}=e,i=rQ(n);return(0,P.createElement)(rY.tu,(0,nr.Z)({},i,r,{ref:t,style:{...e.style,"--radix-context-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-context-menu-content-available-width":"var(--radix-popper-available-width)","--radix-context-menu-content-available-height":"var(--radix-popper-available-height)","--radix-context-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-context-menu-trigger-height":"var(--radix-popper-anchor-height)"}}))});function $1b0217ee4a91d156$var$whenTouchOrPen(e){return t=>"mouse"!==t.pointerType?e(t):void 0}let $1b0217ee4a91d156$export$be92b6f5f03c0fe9=e=>{let{__scopeContextMenu:t,children:n,onOpenChange:r,dir:i,modal:o=!0}=e,[a,l]=(0,P.useState)(!1),c=rQ(t),u=(0,nh.W)(r),d=(0,P.useCallback)(e=>{l(e),u(e)},[u]);return(0,P.createElement)(r0,{scope:t,open:a,onOpenChange:d,modal:o},(0,P.createElement)(rY.fC,(0,nr.Z)({},c,{dir:i,open:a,onOpenChange:d,modal:o}),n))},r9="undefined"!=typeof window&&window.navigator.userAgent.toLowerCase().indexOf("mac")>-1,ie=r9?"":"Ctrl",it=r9?"":"Alt";function kbd(e){return e.split(",")[0].split("").map(e=>{let t=e.replace(/\$/g,ie).replace(/\?/g,it).replace(/!/g,"");return t[0].toUpperCase()+t.slice(1)})}function kbdStr(e){return" "+kbd(e).join("")}function Spinner(e){return(0,T.jsx)("svg",{width:16,height:16,viewBox:"0 0 16 16",...e,children:(0,T.jsxs)("g",{strokeWidth:2,fill:"none",fillRule:"evenodd",children:[(0,T.jsx)("circle",{strokeOpacity:.25,cx:8,cy:8,r:7,stroke:"currentColor"}),(0,T.jsx)("path",{strokeLinecap:"round",d:"M15 8c0-4.5-4.5-7-7-7",stroke:"currentColor",children:(0,T.jsx)("animateTransform",{attributeName:"transform",type:"rotate",from:"0 8 8",to:"360 8 8",dur:"1s",repeatCount:"indefinite"})})]})})}var ir=n(7544);function TldrawUiDropdownMenuRoot({id:e,children:t,modal:n=!1,debugOpen:r=!1}){let[i,o]=useMenuIsOpen(e);return(0,T.jsx)(ir.fC,{open:r||i,dir:"ltr",modal:n,onOpenChange:o,children:t})}function TldrawUiDropdownMenuTrigger({children:e,...t}){return(0,T.jsx)(ir.xz,{dir:"ltr",asChild:!0,onTouchEnd:e=>preventDefault(e),...t,children:e})}function TldrawUiDropdownMenuContent({side:e="bottom",align:t="start",sideOffset:n=8,alignOffset:r=8,children:i}){let o=useContainer();return(0,T.jsx)(ir.Uv,{container:o,children:(0,T.jsx)(ir.VY,{className:"tlui-menu",side:e,sideOffset:n,align:t,alignOffset:r,collisionPadding:4,children:i})})}function TldrawUiDropdownMenuSub({id:e,children:t}){let[n,r]=useMenuIsOpen(e);return(0,T.jsx)(ir.Tr,{open:n,onOpenChange:r,children:t})}function TldrawUiDropdownMenuSubTrigger({id:e,label:t,title:n,disabled:r}){return(0,T.jsx)(ir.fF,{dir:"ltr",asChild:!0,disabled:r,children:(0,T.jsxs)(nK,{"data-testid":e,type:"menu",className:"tlui-menu__submenu__trigger",disabled:r,title:n,children:[(0,T.jsx)(TldrawUiButtonLabel,{children:t}),(0,T.jsx)(TldrawUiButtonIcon,{icon:"chevron-right",small:!0})]})})}function TldrawUiDropdownMenuSubContent({id:e,alignOffset:t=-1,sideOffset:n=-4,size:r="small",children:i}){let o=useContainer();return(0,T.jsx)(ir.Uv,{container:o,children:(0,T.jsx)(ir.tu,{"data-testid":e,className:"tlui-menu tlui-menu__submenu__content",alignOffset:t,sideOffset:n,collisionPadding:4,"data-size":r,children:i})})}function TldrawUiDropdownMenuGroup({children:e}){return(0,T.jsx)(ir.ZA,{dir:"ltr",className:"tlui-menu__group",children:e})}function TldrawUiDropdownMenuIndicator(){return(0,T.jsx)(ir.wU,{dir:"ltr",asChild:!0,children:(0,T.jsx)(nY,{icon:"check"})})}function TldrawUiDropdownMenuItem({noClose:e,children:t}){return(0,T.jsx)(ir.ck,{dir:"ltr",asChild:!0,onClick:e?preventDefault:void 0,children:t})}function TldrawUiDropdownMenuCheckboxItem({children:e,onSelect:t,...n}){return(0,T.jsxs)(ir.oC,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",onSelect:e=>{t?.(e),preventDefault(e)},...n,children:[(0,T.jsx)("div",{className:"tlui-button__checkbox__indicator",children:(0,T.jsx)(ir.wU,{dir:"ltr",children:(0,T.jsx)(nY,{icon:"check",small:!0})})}),e]})}function TldrawUiKbd({children:e,visibleOnMobileLayout:t=!1}){let n=useBreakpoint();return!t&&n<nz.MOBILE?null:(0,T.jsx)("kbd",{className:"tlui-kbd",children:kbd(e).map((e,t)=>(0,T.jsx)("span",{children:e},t))})}function TldrawUiMenuItem({disabled:e=!1,spinner:t=!1,readonlyOk:n=!1,id:r,kbd:i,label:o,icon:a,onSelect:l,noClose:c}){let{type:u,sourceId:d}=useTldrawUiMenuContext(),p=useTranslation(),[h,g]=(0,P.useState)(!1),f=useReadonly();if(f&&!n)return null;let m=unwrapLabel(o,u),y=i?kbdStr(i):void 0,b=m?p(m):void 0,w=b&&y?`${b} ${y}`:b;switch(u){case"menu":return(0,T.jsx)(TldrawUiDropdownMenuItem,{children:(0,T.jsxs)(nK,{type:"menu","data-testid":`${d}.${r}`,disabled:e,title:w,onClick:e=>{c&&preventDefault(e),h?g(!1):l(d)},children:[(0,T.jsx)(TldrawUiButtonLabel,{children:b}),i&&(0,T.jsx)(TldrawUiKbd,{children:i})]})});case"context-menu":if(e)return null;return(0,T.jsxs)(r6,{dir:"ltr",title:w,draggable:!1,className:"tlui-button tlui-button__menu","data-testid":`${d}.${r}`,onSelect:e=>{c&&preventDefault(e),h?g(!1):l(d)},children:[(0,T.jsx)("span",{className:"tlui-button__label",draggable:!1,children:b}),i&&(0,T.jsx)(TldrawUiKbd,{children:i}),t&&(0,T.jsx)(Spinner,{})]});case"panel":return(0,T.jsxs)(nK,{"data-testid":`${d}.${r}`,type:"menu",title:w,disabled:e,onClick:()=>l(d),children:[(0,T.jsx)(TldrawUiButtonLabel,{children:b}),a&&(0,T.jsx)(TldrawUiButtonIcon,{icon:a})]});case"small-icons":case"icons":return(0,T.jsx)(nK,{"data-testid":`${d}.${r}`,type:"icon",title:w,disabled:e,onClick:()=>l(d),children:(0,T.jsx)(TldrawUiButtonIcon,{icon:a,small:"small-icons"===u})});case"keyboard-shortcuts":if(!i)return console.warn(`Menu item '${o}' isn't shown in the keyboard shortcuts dialog because it doesn't have a keyboard shortcut.`),null;return(0,T.jsxs)("div",{className:"tlui-shortcuts-dialog__key-pair","data-testid":`${d}.${r}`,children:[(0,T.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__key",children:b}),(0,T.jsx)("div",{className:"tlui-shortcuts-dialog__key-pair__value",children:(0,T.jsx)(TldrawUiKbd,{visibleOnMobileLayout:!0,children:i})})]});case"helper-buttons":return(0,T.jsxs)(nK,{type:"low",onClick:()=>l(d),children:[(0,T.jsx)(TldrawUiButtonIcon,{icon:a}),(0,T.jsx)(TldrawUiButtonLabel,{children:b})]});default:return null}}function DefaultActionsMenuContent(){return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(AlignMenuItems,{}),(0,T.jsx)(DistributeMenuItems,{}),(0,T.jsx)(StackMenuItems,{}),(0,T.jsx)(ReorderMenuItems,{}),(0,T.jsx)(ZoomOrRotateMenuItem,{}),(0,T.jsx)(RotateCWMenuItem,{}),(0,T.jsx)(EditLinkMenuItem,{}),(0,T.jsx)(GroupOrUngroupMenuItem,{})]})}function AlignMenuItems(){let e=useActions(),t=useUnlockedSelectedShapesCount(2);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(TldrawUiMenuItem,{...e["align-left"],disabled:!t}),(0,T.jsx)(TldrawUiMenuItem,{...e["align-center-horizontal"],disabled:!t}),(0,T.jsx)(TldrawUiMenuItem,{...e["align-right"],disabled:!t}),(0,T.jsx)(TldrawUiMenuItem,{...e["stretch-horizontal"],disabled:!t}),(0,T.jsx)(TldrawUiMenuItem,{...e["align-top"],disabled:!t}),(0,T.jsx)(TldrawUiMenuItem,{...e["align-center-vertical"],disabled:!t}),(0,T.jsx)(TldrawUiMenuItem,{...e["align-bottom"],disabled:!t}),(0,T.jsx)(TldrawUiMenuItem,{...e["stretch-vertical"],disabled:!t})]})}function DistributeMenuItems(){let e=useActions(),t=useUnlockedSelectedShapesCount(3);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(TldrawUiMenuItem,{...e["distribute-horizontal"],disabled:!t}),(0,T.jsx)(TldrawUiMenuItem,{...e["distribute-vertical"],disabled:!t})]})}function StackMenuItems(){let e=useActions(),t=useThreeStackableItems();return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(TldrawUiMenuItem,{...e["stack-horizontal"],disabled:!t}),(0,T.jsx)(TldrawUiMenuItem,{...e["stack-vertical"],disabled:!t})]})}function ReorderMenuItems(){let e=useActions(),t=useUnlockedSelectedShapesCount(1);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(TldrawUiMenuItem,{...e["send-to-back"],disabled:!t}),(0,T.jsx)(TldrawUiMenuItem,{...e["send-backward"],disabled:!t}),(0,T.jsx)(TldrawUiMenuItem,{...e["bring-forward"],disabled:!t}),(0,T.jsx)(TldrawUiMenuItem,{...e["bring-to-front"],disabled:!t})]})}function ZoomOrRotateMenuItem(){let e=useBreakpoint();return e<nz.TABLET_SM?(0,T.jsx)(ZoomTo100MenuItem,{}):(0,T.jsx)(RotateCCWMenuItem,{})}function ZoomTo100MenuItem(){let e=useActions(),t=(0,I.j)(),n=(0,b.Hg)("zoom is 1",()=>1===t.getZoomLevel(),[t]);return(0,T.jsx)(TldrawUiMenuItem,{...e["zoom-to-100"],disabled:n})}function RotateCCWMenuItem(){let e=useActions(),t=useUnlockedSelectedShapesCount(1);return(0,T.jsx)(TldrawUiMenuItem,{...e["rotate-ccw"],disabled:!t})}function RotateCWMenuItem(){let e=useActions(),t=useUnlockedSelectedShapesCount(1);return(0,T.jsx)(TldrawUiMenuItem,{...e["rotate-cw"],disabled:!t})}function EditLinkMenuItem(){let e=useActions(),t=useHasLinkShapeSelected();return(0,T.jsx)(TldrawUiMenuItem,{...e["edit-link"],disabled:!t})}function GroupOrUngroupMenuItem(){let e=useAllowGroup(),t=useAllowUngroup();return e?(0,T.jsx)(GroupMenuItem,{}):t?(0,T.jsx)(UngroupMenuItem,{}):(0,T.jsx)(GroupMenuItem,{})}function GroupMenuItem(){let e=useActions(),t=useUnlockedSelectedShapesCount(2);return(0,T.jsx)(TldrawUiMenuItem,{...e.group,disabled:!t})}function UngroupMenuItem(){let e=useActions();return(0,T.jsx)(TldrawUiMenuItem,{...e.ungroup})}let ii=(0,P.memo)(function({children:e}){let t=useTranslation(),n=useBreakpoint(),r=useReadonly(),i=(0,I.j)(),o=(0,b.Hg)("should display quick actions when in readonly",()=>i.isInAny("hand","zoom"),[i]),a=e??(0,T.jsx)(DefaultActionsMenuContent,{});if(!r||o)return(0,T.jsxs)(TldrawUiPopover,{id:"actions-menu",children:[(0,T.jsx)(TldrawUiPopoverTrigger,{children:(0,T.jsx)(nK,{type:"icon","data-testid":"actions-menu.button",title:t("actions-menu.title"),children:(0,T.jsx)(TldrawUiButtonIcon,{icon:"dots-vertical",small:!0})})}),(0,T.jsx)(TldrawUiPopoverContent,{side:n>=nz.TABLET?"bottom":"top",sideOffset:6,children:(0,T.jsx)("div",{className:"tlui-actions-menu tlui-buttons__grid","data-testid":"actions-menu.content",children:(0,T.jsx)(TldrawUiMenuContextProvider,{type:"icons",sourceId:"actions-menu",children:a})})})]})});function TldrawUiMenuCheckboxItem({id:e,kbd:t,label:n,readonlyOk:r,onSelect:i,disabled:o=!1,checked:a=!1}){let{type:l,sourceId:c}=useTldrawUiMenuContext(),u=useReadonly(),d=useTranslation();if(u&&!r)return null;let p=unwrapLabel(n,l),h=p?d(p):void 0;switch(l){case"menu":return(0,T.jsxs)(ir.oC,{dir:"ltr",className:"tlui-button tlui-button__menu tlui-button__checkbox",title:h,onSelect:e=>{i?.(c),preventDefault(e)},disabled:o,checked:a,children:[(0,T.jsx)(nY,{small:!0,icon:a?"check":"checkbox-empty"}),h&&(0,T.jsx)("span",{className:"tlui-button__label",draggable:!1,children:h}),t&&(0,T.jsx)(TldrawUiKbd,{children:t})]});case"context-menu":return(0,T.jsxs)(r4,{className:"tlui-button tlui-button__menu tlui-button__checkbox",dir:"ltr",title:h,onSelect:e=>{i(c),preventDefault(e)},disabled:o,checked:a,children:[(0,T.jsx)(nY,{small:!0,icon:a?"check":"checkbox-empty"}),h&&(0,T.jsx)("span",{className:"tlui-button__label",draggable:!1,children:h}),t&&(0,T.jsx)(TldrawUiKbd,{children:t})]},e);default:return null}}function TldrawUiMenuGroup({id:e,label:t,children:n}){let{type:r,sourceId:i}=useTldrawUiMenuContext(),o=useTranslation(),a=unwrapLabel(t,r),l=a?o(a):void 0;switch(r){case"panel":return(0,T.jsx)("div",{className:"tlui-menu__group","data-testid":`${i}-group.${e}`,children:n});case"menu":return(0,T.jsx)(TldrawUiDropdownMenuGroup,{"data-testid":`${i}-group.${e}`,children:n});case"context-menu":return(0,T.jsx)(r5,{dir:"ltr",className:"tlui-menu__group","data-testid":`${i}-group.${e}`,children:n});case"keyboard-shortcuts":return(0,T.jsxs)("div",{className:"tlui-shortcuts-dialog__group","data-testid":`${i}-group.${e}`,children:[(0,T.jsx)("h2",{className:"tlui-shortcuts-dialog__group__title",children:l}),(0,T.jsx)("div",{className:"tlui-shortcuts-dialog__group__content",children:n})]});default:return n}}function TldrawUiMenuSubmenu({id:e,disabled:t=!1,label:n,size:r="small",children:i}){let{type:o,sourceId:a}=useTldrawUiMenuContext(),l=useContainer(),c=useTranslation(),u=n?"string"==typeof n?n:n[o]??n.default:void 0,d=u?c(u):void 0;switch(o){case"menu":return(0,T.jsxs)(TldrawUiDropdownMenuSub,{id:`${a}-sub.${e}`,children:[(0,T.jsx)(TldrawUiDropdownMenuSubTrigger,{id:`${a}-sub.${d?d.toLowerCase()+"-button":""}`,disabled:t,label:d,title:d}),(0,T.jsx)(TldrawUiDropdownMenuSubContent,{id:`${a}-sub.${d?d.toLowerCase()+"-content":""}`,size:r,children:i})]});case"context-menu":if(t)return null;return(0,T.jsxs)(ContextMenuSubWithMenu,{id:`${a}-sub.${e}`,children:[(0,T.jsx)(r8,{dir:"ltr",disabled:t,asChild:!0,children:(0,T.jsxs)(nK,{"data-testid":`${a}-sub-trigger.${e}`,type:"menu",className:"tlui-menu__submenu__trigger",children:[(0,T.jsx)(TldrawUiButtonLabel,{children:d}),(0,T.jsx)(TldrawUiButtonIcon,{icon:"chevron-right",small:!0})]})}),(0,T.jsx)($1b0217ee4a91d156$export$14afd0be83e45060,{container:l,children:(0,T.jsx)(r7,{"data-testid":`${a}-sub-content.${e}`,className:"tlui-menu tlui-menu__submenu__content",alignOffset:-1,sideOffset:-4,collisionPadding:4,"data-size":r,children:i})})]});default:return i}}function ContextMenuSubWithMenu({id:e,children:t}){let[n,r]=useMenuIsOpen(e);return(0,T.jsx)($1b0217ee4a91d156$export$5bc21d1c00c4b201,{open:n,onOpenChange:r,children:t})}function ToggleAutoSizeMenuItem(){let e=useActions(),t=useShowAutoSizeToggle();return(0,T.jsx)(TldrawUiMenuItem,{...e["toggle-auto-size"],disabled:!t})}function menu_items_EditLinkMenuItem(){let e=useActions(),t=useHasLinkShapeSelected();return(0,T.jsx)(TldrawUiMenuItem,{...e["edit-link"],disabled:!t})}function DuplicateMenuItem(){let e=useActions(),t=useUnlockedSelectedShapesCount(1);return(0,T.jsx)(TldrawUiMenuItem,{...e.duplicate,disabled:!t})}function menu_items_GroupMenuItem(){let e=useActions(),t=useAllowGroup();return(0,T.jsx)(TldrawUiMenuItem,{...e.group,disabled:!t})}function menu_items_UngroupMenuItem(){let e=useActions(),t=useAllowUngroup();return(0,T.jsx)(TldrawUiMenuItem,{...e.ungroup,disabled:!t})}function RemoveFrameMenuItem(){let e=(0,I.j)(),t=useActions(),n=(0,b.Hg)("allow unframe",()=>{let t=e.getSelectedShapes();return 0!==t.length&&t.every(t=>e.isShapeOfType(t,"frame"))},[e]);return(0,T.jsx)(TldrawUiMenuItem,{...t["remove-frame"],disabled:!n})}function FitFrameToContentMenuItem(){let e=(0,I.j)(),t=useActions(),n=(0,b.Hg)("allow fit frame to content",()=>{let t=e.getOnlySelectedShape();return!!t&&e.isShapeOfType(t,"frame")&&e.getSortedChildIdsForParent(t).length>0},[e]);return(0,T.jsx)(TldrawUiMenuItem,{...t["fit-frame-to-content"],disabled:!n})}function ToggleLockMenuItem(){let e=(0,I.j)(),t=useActions(),n=(0,b.Hg)("selected shapes",()=>e.getSelectedShapes().length>0,[e]);return(0,T.jsx)(TldrawUiMenuItem,{...t["toggle-lock"],disabled:!n})}function ToggleTransparentBgMenuItem(){let e=useActions(),t=(0,I.j)(),n=(0,b.Hg)("isTransparentBg",()=>!t.getInstanceState().exportBackground,[t]);return(0,T.jsx)(TldrawUiMenuCheckboxItem,{...e["toggle-transparent"],checked:n})}function UnlockAllMenuItem(){let e=(0,I.j)(),t=useActions(),n=(0,b.Hg)("any shapes",()=>e.getCurrentPageShapeIds().size>0,[e]);return(0,T.jsx)(TldrawUiMenuItem,{...t["unlock-all"],disabled:!n})}function menu_items_ZoomTo100MenuItem(){let e=(0,I.j)(),t=(0,b.Hg)("zoomed to 100",()=>1===e.getZoomLevel(),[e]),n=useActions();return(0,T.jsx)(TldrawUiMenuItem,{...n["zoom-to-100"],noClose:!0,disabled:t})}function ZoomToFitMenuItem(){let e=(0,I.j)(),t=(0,b.Hg)("has shapes",()=>e.getCurrentPageShapeIds().size>0,[e]),n=useActions();return(0,T.jsx)(TldrawUiMenuItem,{...n["zoom-to-fit"],disabled:!t,"data-testid":"minimap.zoom-menu.zoom-to-fit",noClose:!0})}function ZoomToSelectionMenuItem(){let e=(0,I.j)(),t=(0,b.Hg)("has shapes",()=>e.getSelectedShapeIds().length>0,[e]),n=useActions();return(0,T.jsx)(TldrawUiMenuItem,{...n["zoom-to-selection"],disabled:!t,"data-testid":"minimap.zoom-menu.zoom-to-selection",noClose:!0})}function ClipboardMenuGroup(){let e=(0,I.j)(),t=useActions(),n=(0,b.Hg)("atLeastOneShapeOnPage",()=>e.getCurrentPageShapeIds().size>0,[]);return(0,T.jsxs)(TldrawUiMenuGroup,{id:"clipboard",children:[(0,T.jsx)(CutMenuItem,{}),(0,T.jsx)(CopyMenuItem,{}),(0,T.jsxs)(TldrawUiMenuSubmenu,{id:"copy-as",label:"context-menu.copy-as",size:"small",disabled:!n,children:[(0,T.jsxs)(TldrawUiMenuGroup,{id:"copy-as-group",children:[(0,T.jsx)(TldrawUiMenuItem,{...t["copy-as-svg"]}),!!window.navigator.clipboard?.write&&(0,T.jsx)(TldrawUiMenuItem,{...t["copy-as-png"]}),(0,T.jsx)(TldrawUiMenuItem,{...t["copy-as-json"]})]}),(0,T.jsx)(TldrawUiMenuGroup,{id:"copy-as-bg",children:(0,T.jsx)(ToggleTransparentBgMenuItem,{})})]}),(0,T.jsx)(DuplicateMenuItem,{}),(0,T.jsx)(PasteMenuItem,{}),(0,T.jsx)(DeleteMenuItem,{})]})}function CutMenuItem(){let e=useActions(),t=useUnlockedSelectedShapesCount(1);return(0,T.jsx)(TldrawUiMenuItem,{...e.cut,disabled:!t})}function CopyMenuItem(){let e=useActions(),t=useAnySelectedShapesCount(1);return(0,T.jsx)(TldrawUiMenuItem,{...e.copy,disabled:!t})}function PasteMenuItem(){let e=useActions();return(0,T.jsx)(TldrawUiMenuItem,{...e.paste,disabled:!th})}function ConversionsMenuGroup(){let e=useActions(),t=useUnlockedSelectedShapesCount(1);return(0,T.jsx)(TldrawUiMenuGroup,{id:"conversions",children:(0,T.jsxs)(TldrawUiMenuSubmenu,{id:"export-as",label:"context-menu.export-as",size:"small",disabled:!t,children:[(0,T.jsxs)(TldrawUiMenuGroup,{id:"export-as-group",children:[(0,T.jsx)(TldrawUiMenuItem,{...e["export-as-svg"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["export-as-png"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["export-as-json"]})]}),(0,T.jsx)(TldrawUiMenuGroup,{id:"export-as-bg",children:(0,T.jsx)(ToggleTransparentBgMenuItem,{})})]})})}function SetSelectionGroup(){let e=useActions(),t=(0,I.j)(),n=(0,b.Hg)("atLeastOneShapeOnPage",()=>t.getCurrentPageShapeIds().size>0,[t]);return(0,T.jsx)(TldrawUiMenuGroup,{id:"set-selection-group",children:(0,T.jsx)(TldrawUiMenuItem,{...e["select-all"],disabled:!n})})}function DeleteMenuItem(){let e=useActions(),t=useUnlockedSelectedShapesCount(1);return(0,T.jsx)(TldrawUiMenuItem,{...e.delete,disabled:!t})}function ArrangeMenuSubmenu(){let e=useUnlockedSelectedShapesCount(2),t=useOnlyFlippableShape(),n=useActions();return e||t?(0,T.jsxs)(TldrawUiMenuSubmenu,{id:"arrange",label:"context-menu.arrange",size:"small",children:[e&&(0,T.jsxs)(TldrawUiMenuGroup,{id:"align",children:[(0,T.jsx)(TldrawUiMenuItem,{...n["align-left"]}),(0,T.jsx)(TldrawUiMenuItem,{...n["align-center-horizontal"]}),(0,T.jsx)(TldrawUiMenuItem,{...n["align-right"]}),(0,T.jsx)(TldrawUiMenuItem,{...n["align-top"]}),(0,T.jsx)(TldrawUiMenuItem,{...n["align-center-vertical"]}),(0,T.jsx)(TldrawUiMenuItem,{...n["align-bottom"]})]}),(0,T.jsx)(DistributeMenuGroup,{}),e&&(0,T.jsxs)(TldrawUiMenuGroup,{id:"stretch",children:[(0,T.jsx)(TldrawUiMenuItem,{...n["stretch-horizontal"]}),(0,T.jsx)(TldrawUiMenuItem,{...n["stretch-vertical"]})]}),t&&(0,T.jsxs)(TldrawUiMenuGroup,{id:"flip",children:[(0,T.jsx)(TldrawUiMenuItem,{...n["flip-horizontal"]}),(0,T.jsx)(TldrawUiMenuItem,{...n["flip-vertical"]})]}),(0,T.jsx)(OrderMenuGroup,{})]}):null}function DistributeMenuGroup(){let e=useActions(),t=useUnlockedSelectedShapesCount(3);return t?(0,T.jsxs)(TldrawUiMenuGroup,{id:"distribute",children:[(0,T.jsx)(TldrawUiMenuItem,{...e["distribute-horizontal"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["distribute-vertical"]})]}):null}function OrderMenuGroup(){let e=useActions(),t=useUnlockedSelectedShapesCount(2),n=useThreeStackableItems();return t?(0,T.jsxs)(TldrawUiMenuGroup,{id:"order",children:[(0,T.jsx)(TldrawUiMenuItem,{...e.pack}),n&&(0,T.jsx)(TldrawUiMenuItem,{...e["stack-horizontal"]}),n&&(0,T.jsx)(TldrawUiMenuItem,{...e["stack-vertical"]})]}):null}function ReorderMenuSubmenu(){let e=useActions(),t=useUnlockedSelectedShapesCount(1);return t?(0,T.jsx)(TldrawUiMenuSubmenu,{id:"reorder",label:"context-menu.reorder",size:"small",children:(0,T.jsxs)(TldrawUiMenuGroup,{id:"reorder",children:[(0,T.jsx)(TldrawUiMenuItem,{...e["bring-to-front"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["bring-forward"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["send-backward"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["send-to-back"]})]})}):null}function MoveToPageMenu(){let e=(0,I.j)(),t=(0,b.Hg)("pages",()=>e.getPages(),[e]),n=(0,b.Hg)("current page id",()=>e.getCurrentPageId(),[e]),{addToast:r}=useToasts(),i=useActions(),o=useUiEvents(),a=useUnlockedSelectedShapesCount(1);return a?(0,T.jsxs)(TldrawUiMenuSubmenu,{id:"move-to-page",label:"context-menu.move-to-page",size:"small",children:[(0,T.jsx)(TldrawUiMenuGroup,{id:"pages",children:t.map(t=>(0,T.jsx)(TldrawUiMenuItem,{id:t.id,disabled:n===t.id,label:t.name,onSelect:()=>{e.mark("move_shapes_to_page"),e.moveShapesToPage(e.getSelectedShapeIds(),t.id);let i=e.getPage(t.id);i&&r({title:"Changed Page",description:`Moved to ${i.name}.`,actions:[{label:"Go Back",type:"primary",onClick:()=>{e.mark("change-page"),e.setCurrentPage(n)}}]}),o("move-to-page",{source:"context-menu"})},title:t.name},t.id))}),(0,T.jsx)(TldrawUiMenuGroup,{id:"new-page",children:(0,T.jsx)(TldrawUiMenuItem,{...i["new-page"]})})]}):null}function EmbedsGroup(){let e=(0,I.j)(),t=useActions(),n=(0,b.Hg)("oneEmbedSelected",()=>{let t=e.getOnlySelectedShape();return!!t&&!!(e.isShapeOfType(t,"embed")&&t.props.url&&!e.isShapeOrAncestorLocked(t))},[e]),r=(0,b.Hg)("oneEmbeddableBookmarkSelected",()=>{let t=e.getOnlySelectedShape();return!!t&&!!(e.isShapeOfType(t,"bookmark")&&t.props.url&&getEmbedInfo(t.props.url)&&!e.isShapeOrAncestorLocked(t))},[e]);return(0,T.jsxs)(TldrawUiMenuGroup,{id:"embeds",children:[(0,T.jsx)(TldrawUiMenuItem,{...t["convert-to-bookmark"],disabled:!n}),(0,T.jsx)(TldrawUiMenuItem,{...t["convert-to-embed"],disabled:!r})]})}function ToggleSnapModeItem(){let e=useActions(),t=(0,I.j)(),n=(0,b.Hg)("isSnapMode",()=>t.user.getIsSnapMode(),[t]);return(0,T.jsx)(TldrawUiMenuCheckboxItem,{...e["toggle-snap-mode"],checked:n})}function ToggleToolLockItem(){let e=useActions(),t=(0,I.j)(),n=(0,b.Hg)("isToolLock",()=>t.getInstanceState().isToolLocked,[t]);return(0,T.jsx)(TldrawUiMenuCheckboxItem,{...e["toggle-tool-lock"],checked:n})}function ToggleGridItem(){let e=useActions(),t=(0,I.j)(),n=(0,b.Hg)("isGridMode",()=>t.getInstanceState().isGridMode,[t]);return(0,T.jsx)(TldrawUiMenuCheckboxItem,{...e["toggle-grid"],checked:n})}function ToggleWrapModeItem(){let e=useActions(),t=(0,I.j)(),n=(0,b.Hg)("isWrapMode",()=>t.user.getIsWrapMode(),[t]);return(0,T.jsx)(TldrawUiMenuCheckboxItem,{...e["toggle-wrap-mode"],checked:n})}function ToggleDarkModeItem(){let e=useActions(),t=(0,I.j)(),n=(0,b.Hg)("isDarkMode",()=>t.user.getIsDarkMode(),[t]);return(0,T.jsx)(TldrawUiMenuCheckboxItem,{...e["toggle-dark-mode"],checked:n})}function ToggleFocusModeItem(){let e=useActions(),t=(0,I.j)(),n=(0,b.Hg)("isFocusMode",()=>t.getInstanceState().isFocusMode,[t]);return(0,T.jsx)(TldrawUiMenuCheckboxItem,{...e["toggle-focus-mode"],checked:n})}function ToggleEdgeScrollingItem(){let e=useActions(),t=(0,I.j)(),n=(0,b.Hg)("edgeScrollSpeed",()=>t.user.getEdgeScrollSpeed(),[t]);return(0,T.jsx)(TldrawUiMenuCheckboxItem,{...e["toggle-edge-scrolling"],checked:1===n})}function ToggleReduceMotionItem(){let e=useActions(),t=(0,I.j)(),n=(0,b.Hg)("animationSpeed",()=>t.user.getAnimationSpeed(),[t]);return(0,T.jsx)(TldrawUiMenuCheckboxItem,{...e["toggle-reduce-motion"],checked:0===n})}function ToggleDebugModeItem(){let e=useActions(),t=(0,I.j)(),n=(0,b.Hg)("isDebugMode",()=>t.getInstanceState().isDebugMode,[t]);return(0,T.jsx)(TldrawUiMenuCheckboxItem,{...e["toggle-debug-mode"],checked:n})}function PrintItem(){let e=(0,I.j)(),t=useActions(),n=(0,b.Hg)("emptyPage",()=>0===e.getCurrentPageShapeIds().size,[e]);return(0,T.jsx)(TldrawUiMenuItem,{...t.print,disabled:n})}function DefaultContextMenuContent(){let e=(0,I.j)(),t=(0,b.Hg)("isSelectToolActive",()=>"select"===e.getCurrentToolId(),[e]);return t?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(TldrawUiMenuGroup,{id:"selection",children:[(0,T.jsx)(ToggleAutoSizeMenuItem,{}),(0,T.jsx)(menu_items_EditLinkMenuItem,{}),(0,T.jsx)(menu_items_GroupMenuItem,{}),(0,T.jsx)(menu_items_UngroupMenuItem,{}),(0,T.jsx)(RemoveFrameMenuItem,{}),(0,T.jsx)(FitFrameToContentMenuItem,{}),(0,T.jsx)(ToggleLockMenuItem,{})]}),(0,T.jsx)(EmbedsGroup,{}),(0,T.jsxs)(TldrawUiMenuGroup,{id:"modify",children:[(0,T.jsx)(ArrangeMenuSubmenu,{}),(0,T.jsx)(ReorderMenuSubmenu,{}),(0,T.jsx)(MoveToPageMenu,{})]}),(0,T.jsx)(ClipboardMenuGroup,{}),(0,T.jsx)(ConversionsMenuGroup,{}),(0,T.jsx)(SetSelectionGroup,{})]}):null}let io=(0,P.memo)(function({children:e}){let t=(0,I.j)(),{Canvas:n}=useEditorComponents(),r=(0,P.useCallback)(e=>{if(e){if(t.getInstanceState().isCoarsePointer){let e=t.getSelectedShapes(),{inputs:{currentPagePoint:n}}=t,r=t.getShapesAtPoint(n);if(!t.getSelectedShapes().length||!r.some(t=>e.includes(t))){let e=r.filter(e=>t.isShapeOrAncestorLocked(e));e.length&&t.select(...e.map(e=>e.id))}}}else{let e=t.getOnlySelectedShape();e&&t.isShapeOrAncestorLocked(e)&&t.setSelectedShapes([])}},[t]),i=useContainer(),[o,a]=useMenuIsOpen("context menu",r),l=e??(0,T.jsx)(DefaultContextMenuContent,{});return(0,T.jsxs)($1b0217ee4a91d156$export$be92b6f5f03c0fe9,{dir:"ltr",onOpenChange:a,modal:!1,children:[(0,T.jsx)(r2,{onContextMenu:void 0,dir:"ltr",children:n?(0,T.jsx)(n,{}):null}),o&&(0,T.jsx)($1b0217ee4a91d156$export$14afd0be83e45060,{container:i,children:(0,T.jsx)(r3,{className:"tlui-menu scrollable","data-testid":"context-menu",alignOffset:-4,collisionPadding:4,onContextMenu:preventDefault,children:(0,T.jsx)(TldrawUiMenuContextProvider,{type:"context-menu",sourceId:"context-menu",children:l})})})]})});function TldrawUiButtonCheck({checked:e}){return(0,T.jsx)(nY,{icon:e?"check":"checkbox-empty",className:"tlui-button__icon",small:!0})}function DefaultDebugMenuContent(){let e=(0,I.j)(),{addToast:t}=useToasts(),{addDialog:n}=useDialogs(),[r,i]=P.useState(!1);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(TldrawUiMenuGroup,{id:"items",children:[(0,T.jsx)(TldrawUiMenuItem,{id:"add-toast",onSelect:()=>{t({id:(0,eM.E)(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0}),t({id:(0,eM.E)(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]}),t({id:(0,eM.E)(),title:"Something happened",description:"Hey, attend to this thing over here. It might be important!",keepOpen:!0,icon:"twitter",actions:[{label:"Primary",type:"primary",onClick:()=>{}},{label:"Normal",type:"normal",onClick:()=>{}},{label:"Danger",type:"danger",onClick:()=>{}}]})},label:"Show toast"}),(0,T.jsx)(TldrawUiMenuItem,{id:"show-dialog",label:"Show dialog",onSelect:()=>{n({component:({onClose:e})=>(0,T.jsx)(ExampleDialog,{displayDontShowAgain:!0,onCancel:()=>e(),onContinue:()=>e()}),onClose:()=>{}})}}),(0,T.jsx)(TldrawUiMenuItem,{id:"create-shapes",label:"Create 100 shapes",onSelect:()=>createNShapes(e,100)}),(0,T.jsx)(TldrawUiMenuItem,{id:"count-nodes",label:"Count shapes / nodes",onSelect:()=>{function countDescendants({children:e}){let t=0;if(!e.length)return 0;for(let n of[...e])t++,t+=countDescendants(n);return t}let t=e.getSelectedShapes(),n=0===t.length?e.getRenderingShapes():t,r=n.map(e=>document.getElementById(e.id).parentElement),i=r.length;for(let e of r)i+=countDescendants(e);window.alert(`Shapes ${n.length}, DOM nodes:${i}`)}}),(()=>{if(r)throw Error("oh no!")})(),(0,T.jsx)(TldrawUiMenuItem,{id:"throw-error",onSelect:()=>i(!0),label:"Throw error"}),(0,T.jsx)(TldrawUiMenuItem,{id:"hard-reset",onSelect:hardResetEditor,label:"Hard reset"})]}),(0,T.jsxs)(TldrawUiMenuGroup,{id:"flags",children:[(0,T.jsx)(DebugFlags,{}),(0,T.jsx)(FeatureFlags,{})]})]})}function DebugFlags(){let e=Object.values($);return e.length?(0,T.jsx)(TldrawUiMenuSubmenu,{id:"debug flags",label:"Debug Flags",children:(0,T.jsx)(TldrawUiMenuGroup,{id:"debug flags",children:e.map(e=>(0,T.jsx)(ia,{flag:e},e.name))})}):null}function FeatureFlags(){let e=Object.values(j);return e.length?(0,T.jsx)(TldrawUiMenuSubmenu,{id:"feature flags",label:"Feature Flags",children:(0,T.jsx)(TldrawUiMenuGroup,{id:"feature flags",children:e.map(e=>(0,T.jsx)(ia,{flag:e},e.name))})}):null}function ExampleDialog({title:e="title",body:t="hello hello hello",cancel:n="Cancel",confirm:r="Continue",displayDontShowAgain:i=!1,onCancel:o,onContinue:a}){let[l,c]=P.useState(!1);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(TldrawUiDialogHeader,{children:[(0,T.jsx)(TldrawUiDialogTitle,{children:e}),(0,T.jsx)(TldrawUiDialogCloseButton,{})]}),(0,T.jsx)(TldrawUiDialogBody,{style:{maxWidth:350},children:t}),(0,T.jsxs)(TldrawUiDialogFooter,{className:"tlui-dialog__footer__actions",children:[i&&(0,T.jsxs)(nK,{type:"normal",onClick:()=>c(!l),style:{marginRight:"auto"},children:[(0,T.jsx)(TldrawUiButtonCheck,{checked:l}),(0,T.jsx)(TldrawUiButtonLabel,{children:"Don't show again"})]}),(0,T.jsx)(nK,{type:"normal",onClick:o,children:(0,T.jsx)(TldrawUiButtonLabel,{children:n})}),(0,T.jsx)(nK,{type:"primary",onClick:async()=>a(),children:(0,T.jsx)(TldrawUiButtonLabel,{children:r})})]})]})}let ia=(0,b.j)(function({flag:e,onChange:t}){let n=e.get();return(0,T.jsx)(TldrawUiMenuCheckboxItem,{id:e.name,title:e.name,label:e.name.replace(/([a-z0-9])([A-Z])/g,e=>`${e[0]} ${e[1].toLowerCase()}`).replace(/^[a-z]/,e=>e.toUpperCase()),checked:n,onSelect:()=>{e.set(!n),t?.(!n)}})}),is=0;function createNShapes(e,t){let n=Array(t),r=Math.floor(Math.sqrt(t));for(let e=0;e<t;e++)is++,n[e]={id:(0,S.F1)("box"+is),type:"geo",x:e%r*132,y:132*Math.floor(e/r)};e.batch(()=>{e.createShapes(n).setSelectedShapes(n.map(e=>e.id))})}function DefaultDebugMenu({children:e}){let t=e??(0,T.jsx)(DefaultDebugMenuContent,{});return(0,T.jsxs)(TldrawUiDropdownMenuRoot,{id:"debug",children:[(0,T.jsx)(TldrawUiDropdownMenuTrigger,{children:(0,T.jsx)(nK,{type:"icon",title:"Debug menu",children:(0,T.jsx)(TldrawUiButtonIcon,{icon:"dots-horizontal"})})}),(0,T.jsx)(TldrawUiDropdownMenuContent,{side:"top",align:"end",alignOffset:0,children:(0,T.jsx)(TldrawUiMenuContextProvider,{type:"menu",sourceId:"debug-panel",children:t})})]})}function useLanguages(){let e=(0,I.j)();return{languages:S.a2,currentLanguage:e.user.getLocale()}}let il=(0,b.j)(function(){let e=(0,I.j)(),t=useUiEvents(),{languages:n,currentLanguage:r}=useLanguages();return(0,T.jsx)(TldrawUiMenuSubmenu,{id:"help menu language",label:"menu.language",children:(0,T.jsx)(TldrawUiMenuGroup,{id:"languages",children:n.map(({locale:n,label:i})=>(0,T.jsx)(TldrawUiMenuCheckboxItem,{id:`language-${n}`,title:n,label:i,checked:n===r,onSelect:()=>{e.user.updateUserPreferences({locale:n}),t("change-language",{source:"menu",locale:n})}},n))})})});function DefaultHelpMenuContent(){return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(il,{}),(0,T.jsx)(KeyboardShortcutsMenuItem,{})]})}function KeyboardShortcutsMenuItem(){let{KeyboardShortcutsDialog:e}=useTldrawUiComponents(),{addDialog:t}=useDialogs();return e?(0,T.jsx)(TldrawUiMenuItem,{id:"keyboard-shortcuts-button",label:"help-menu.keyboard-shortcuts",readonlyOk:!0,onSelect:()=>{t({component:e})}}):null}let ic=(0,P.memo)(function({children:e}){let t=useTranslation(),n=useBreakpoint(),r=e??(0,T.jsx)(DefaultHelpMenuContent,{});return n<nz.MOBILE?null:(0,T.jsx)("div",{className:"tlui-help-menu",children:(0,T.jsxs)(TldrawUiDropdownMenuRoot,{id:"help menu",children:[(0,T.jsx)(TldrawUiDropdownMenuTrigger,{children:(0,T.jsx)(nK,{type:"help",title:t("help-menu.title"),"data-testid":"help-menu.button",children:(0,T.jsx)(TldrawUiButtonIcon,{icon:"question-mark",small:!0})})}),(0,T.jsx)(TldrawUiDropdownMenuContent,{side:"top",align:"end",alignOffset:0,sideOffset:8,children:(0,T.jsx)(TldrawUiMenuContextProvider,{type:"menu",sourceId:"help-menu",children:r})})]})})});function BackToContent(){let e=(0,I.j)(),t=useActions(),[n,r]=(0,P.useState)(!1);return((0,P.useEffect)(()=>{let t=!1,n=setInterval(()=>{let n=e.getRenderingShapes(),i=e.getRenderingBounds(),o=n.filter(e=>e.maskedPageBounds&&i.includes(e.maskedPageBounds)),a=0===o.length&&e.getCurrentPageShapes().length>0;t!==a&&(r(a),t=a)},1e3);return()=>{clearInterval(n)}},[e]),n)?(0,T.jsx)(TldrawUiMenuItem,{...t["back-to-content"],onSelect:()=>{t["back-to-content"].onSelect("helper-buttons"),r(!1)}}):null}function ExitPenMode(){let e=(0,I.j)(),t=useActions(),n=(0,b.Hg)("is pen mode",()=>e.getInstanceState().isPenMode,[e]);return n?(0,T.jsx)(TldrawUiMenuItem,{...t["exit-pen-mode"]}):null}function StopFollowing(){let e=(0,I.j)(),t=useActions(),n=(0,b.Hg)("is following user",()=>!!e.getInstanceState().followingUserId,[e]);return n?(0,T.jsx)(TldrawUiMenuItem,{...t["stop-following"]}):null}function DefaultHelperButtonsContent(){return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(ExitPenMode,{}),(0,T.jsx)(BackToContent,{}),(0,T.jsx)(StopFollowing,{})]})}function DefaultHelperButtons({children:e}){let t=e??(0,T.jsx)(DefaultHelperButtonsContent,{});return(0,T.jsx)("div",{className:"tlui-helper-buttons",children:(0,T.jsx)(TldrawUiMenuContextProvider,{type:"helper-buttons",sourceId:"helper-buttons",children:t})})}let iu=P.createContext({});function ToolsProvider({overrides:e,children:t}){let n=(0,I.j)(),r=useUiEvents(),{addDialog:i}=useDialogs(),o=useInsertMedia(),a=P.useMemo(()=>{let t=[{id:"select",label:"tool.select",icon:"tool-pointer",kbd:"v",readonlyOk:!0,onSelect(e){n.setCurrentTool("select"),r("select-tool",{source:e,id:"select"})}},{id:"hand",label:"tool.hand",icon:"tool-hand",kbd:"h",readonlyOk:!0,onSelect(e){n.setCurrentTool("hand"),r("select-tool",{source:e,id:"hand"})}},{id:"eraser",label:"tool.eraser",icon:"tool-eraser",kbd:"e",onSelect(e){n.setCurrentTool("eraser"),r("select-tool",{source:e,id:"eraser"})}},{id:"draw",label:"tool.draw",icon:"tool-pencil",kbd:"d,b,x",onSelect(e){n.setCurrentTool("draw"),r("select-tool",{source:e,id:"draw"})}},...[...S.Zu.values].map(e=>({id:e,label:`tool.${e}`,meta:{geo:e},kbd:"rectangle"===e?"r":"ellipse"===e?"o":void 0,icon:"geo-"+e,onSelect(t){n.batch(()=>{n.updateInstanceState({stylesForNextShape:{...n.getInstanceState().stylesForNextShape,[S.Zu.id]:e}},{ephemeral:!0}),n.setCurrentTool("geo"),r("select-tool",{source:t,id:`geo-${e}`})})}})),{id:"arrow",label:"tool.arrow",icon:"tool-arrow",kbd:"a",onSelect(e){n.setCurrentTool("arrow"),r("select-tool",{source:e,id:"arrow"})}},{id:"line",label:"tool.line",icon:"tool-line",kbd:"l",onSelect(e){n.setCurrentTool("line"),r("select-tool",{source:e,id:"line"})}},{id:"frame",label:"tool.frame",icon:"tool-frame",kbd:"f",onSelect(e){n.setCurrentTool("frame"),r("select-tool",{source:e,id:"frame"})}},{id:"text",label:"tool.text",icon:"tool-text",kbd:"t",onSelect(e){n.setCurrentTool("text"),r("select-tool",{source:e,id:"text"})}},{id:"asset",label:"tool.asset",icon:"tool-media",kbd:"$u",onSelect(e){o(),r("select-tool",{source:e,id:"media"})}},{id:"note",label:"tool.note",icon:"tool-note",kbd:"n",onSelect(e){n.setCurrentTool("note"),r("select-tool",{source:e,id:"note"})}},{id:"laser",label:"tool.laser",readonlyOk:!0,icon:"tool-laser",kbd:"k",onSelect(e){n.setCurrentTool("laser"),r("select-tool",{source:e,id:"laser"})}},{id:"embed",label:"tool.embed",icon:"tool-embed",onSelect(e){i({component:rD}),r("select-tool",{source:e,id:"embed"})}}];t.push({id:"highlight",label:"tool.highlight",icon:"tool-highlight",kbd:"!d",onSelect(e){n.setCurrentTool("highlight"),r("select-tool",{source:e,id:"highlight"})}});let a=Object.fromEntries(t.map(e=>[e.id,e]));return e?e(n,a,{insertMedia:o}):a},[e,n,r,o,i]);return(0,T.jsx)(iu.Provider,{value:a,children:t})}function useTools(){let e=P.useContext(iu);if(!e)throw Error("useTools must be used within a ToolProvider");return e}function DefaultKeyboardShortcutsDialogContent(){let e=useActions(),t=useTools();return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.tools",id:"tools",children:[(0,T.jsx)(TldrawUiMenuItem,{...e["toggle-tool-lock"]}),(0,T.jsx)(TldrawUiMenuItem,{...t.select}),(0,T.jsx)(TldrawUiMenuItem,{...t.draw}),(0,T.jsx)(TldrawUiMenuItem,{...t.eraser}),(0,T.jsx)(TldrawUiMenuItem,{...t.hand}),(0,T.jsx)(TldrawUiMenuItem,{...t.rectangle}),(0,T.jsx)(TldrawUiMenuItem,{...t.ellipse}),(0,T.jsx)(TldrawUiMenuItem,{...t.arrow}),(0,T.jsx)(TldrawUiMenuItem,{...t.line}),(0,T.jsx)(TldrawUiMenuItem,{...t.text}),(0,T.jsx)(TldrawUiMenuItem,{...t.frame}),(0,T.jsx)(TldrawUiMenuItem,{...t.note}),(0,T.jsx)(TldrawUiMenuItem,{...t.laser})]}),(0,T.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.file",id:"file",children:[(0,T.jsx)(TldrawUiMenuItem,{...e["insert-media"]}),(0,T.jsx)(TldrawUiMenuItem,{...e.print})]}),(0,T.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.preferences",id:"preferences",children:[(0,T.jsx)(TldrawUiMenuItem,{...e["toggle-dark-mode"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["toggle-focus-mode"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["toggle-grid"]})]}),(0,T.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.edit",id:"edit",children:[(0,T.jsx)(TldrawUiMenuItem,{...e.undo}),(0,T.jsx)(TldrawUiMenuItem,{...e.redo}),(0,T.jsx)(TldrawUiMenuItem,{...e.cut}),(0,T.jsx)(TldrawUiMenuItem,{...e.copy}),(0,T.jsx)(TldrawUiMenuItem,{...e.paste}),(0,T.jsx)(TldrawUiMenuItem,{...e["select-all"]}),(0,T.jsx)(TldrawUiMenuItem,{...e.delete}),(0,T.jsx)(TldrawUiMenuItem,{...e.duplicate})]}),(0,T.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.view",id:"view",children:[(0,T.jsx)(TldrawUiMenuItem,{...e["zoom-in"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["zoom-out"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["zoom-to-100"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["zoom-to-fit"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["zoom-to-selection"]})]}),(0,T.jsxs)(TldrawUiMenuGroup,{label:"shortcuts-dialog.transform",id:"transform",children:[(0,T.jsx)(TldrawUiMenuItem,{...e["bring-to-front"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["bring-forward"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["send-backward"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["send-to-back"]}),(0,T.jsx)(TldrawUiMenuItem,{...e.group}),(0,T.jsx)(TldrawUiMenuItem,{...e.ungroup}),(0,T.jsx)(TldrawUiMenuItem,{...e["flip-horizontal"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["flip-vertical"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["align-top"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["align-center-vertical"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["align-bottom"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["align-left"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["align-center-horizontal"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["align-right"]})]})]})}let id=(0,P.memo)(function({children:e}){let t=useTranslation(),n=useBreakpoint(),r=e??(0,T.jsx)(DefaultKeyboardShortcutsDialogContent,{});return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)(TldrawUiDialogHeader,{className:"tlui-shortcuts-dialog__header",children:[(0,T.jsx)(TldrawUiDialogTitle,{children:t("shortcuts-dialog.title")}),(0,T.jsx)(TldrawUiDialogCloseButton,{})]}),(0,T.jsx)(TldrawUiDialogBody,{className:C("tlui-shortcuts-dialog__body",{"tlui-shortcuts-dialog__body__mobile":n<=nz.MOBILE_XS,"tlui-shortcuts-dialog__body__tablet":n<=nz.TABLET}),children:(0,T.jsx)(TldrawUiMenuContextProvider,{type:"keyboard-shortcuts",sourceId:"kbd",children:r})}),(0,T.jsx)("div",{className:"tlui-dialog__scrim"})]})});function DefaultMainMenuContent(){return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(EditSubmenu,{}),(0,T.jsx)(ShapeSubmenu,{}),(0,T.jsx)(ViewSubmenu,{}),(0,T.jsx)(ExtrasGroup,{}),(0,T.jsx)(PreferencesGroup,{})]})}function ExportFileContentSubMenu(){let e=useActions();return(0,T.jsxs)(TldrawUiMenuSubmenu,{id:"export-all-as",label:"context-menu.export-all-as",size:"small",children:[(0,T.jsxs)(TldrawUiMenuGroup,{id:"export-all-as-group",children:[(0,T.jsx)(TldrawUiMenuItem,{...e["export-all-as-svg"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["export-all-as-png"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["export-all-as-json"]})]}),(0,T.jsx)(TldrawUiMenuGroup,{id:"export-all-as-bg",children:(0,T.jsx)(ToggleTransparentBgMenuItem,{})})]})}function EditSubmenu(){let e=(0,I.j)(),t=(0,b.Hg)("isSelectToolActive",()=>"select"===e.getCurrentToolId(),[e]);return(0,T.jsxs)(TldrawUiMenuSubmenu,{id:"edit",label:"menu.edit",disabled:!t,children:[(0,T.jsx)(UndoRedoGroup,{}),(0,T.jsx)(ClipboardMenuGroup,{}),(0,T.jsx)(SetSelectionGroup,{})]})}function ShapeSubmenu(){let e=(0,I.j)(),t=(0,b.Hg)("isSelectToolActive",()=>"select"===e.getCurrentToolId(),[e]);return(0,T.jsxs)(TldrawUiMenuSubmenu,{id:"shape",label:"menu.shape",disabled:!t,children:[(0,T.jsx)(ConversionsMenuGroup,{}),(0,T.jsx)(MultiShapeMenuGroup,{}),(0,T.jsx)(MiscMenuGroup,{}),(0,T.jsx)(EmbedsGroup,{}),(0,T.jsx)(LockGroup,{})]})}function MiscMenuGroup(){return(0,T.jsxs)(TldrawUiMenuGroup,{id:"misc",children:[(0,T.jsx)(ToggleAutoSizeMenuItem,{}),(0,T.jsx)(menu_items_EditLinkMenuItem,{})]})}function LockGroup(){return(0,T.jsxs)(TldrawUiMenuGroup,{id:"lock",children:[(0,T.jsx)(ToggleLockMenuItem,{}),(0,T.jsx)(UnlockAllMenuItem,{})]})}function MultiShapeMenuGroup(){return(0,T.jsxs)(TldrawUiMenuGroup,{id:"multi-shape",children:[(0,T.jsx)(menu_items_GroupMenuItem,{}),(0,T.jsx)(menu_items_UngroupMenuItem,{}),(0,T.jsx)(RemoveFrameMenuItem,{}),(0,T.jsx)(FitFrameToContentMenuItem,{})]})}function UndoRedoGroup(){let e=useActions(),t=useCanUndo(),n=useCanRedo();return(0,T.jsxs)(TldrawUiMenuGroup,{id:"undo-redo",children:[(0,T.jsx)(TldrawUiMenuItem,{...e.undo,disabled:!t}),(0,T.jsx)(TldrawUiMenuItem,{...e.redo,disabled:!n})]})}function ViewSubmenu(){let e=useActions();return(0,T.jsx)(TldrawUiMenuSubmenu,{id:"view",label:"menu.view",children:(0,T.jsxs)(TldrawUiMenuGroup,{id:"view-actions",children:[(0,T.jsx)(TldrawUiMenuItem,{...e["zoom-in"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["zoom-out"]}),(0,T.jsx)(menu_items_ZoomTo100MenuItem,{}),(0,T.jsx)(ZoomToFitMenuItem,{}),(0,T.jsx)(ZoomToSelectionMenuItem,{})]})})}function ExtrasGroup(){let e=useActions();return(0,T.jsxs)(TldrawUiMenuGroup,{id:"extras",children:[(0,T.jsx)(TldrawUiMenuItem,{...e["insert-embed"]}),(0,T.jsx)(TldrawUiMenuItem,{...e["insert-media"]})]})}function PreferencesGroup(){return(0,T.jsx)(TldrawUiMenuGroup,{id:"preferences",children:(0,T.jsxs)(TldrawUiMenuSubmenu,{id:"preferences",label:"menu.preferences",children:[(0,T.jsxs)(TldrawUiMenuGroup,{id:"preferences-actions",children:[(0,T.jsx)(ToggleSnapModeItem,{}),(0,T.jsx)(ToggleToolLockItem,{}),(0,T.jsx)(ToggleGridItem,{}),(0,T.jsx)(ToggleWrapModeItem,{}),(0,T.jsx)(ToggleDarkModeItem,{}),(0,T.jsx)(ToggleFocusModeItem,{}),(0,T.jsx)(ToggleEdgeScrollingItem,{}),(0,T.jsx)(ToggleReduceMotionItem,{}),(0,T.jsx)(ToggleDebugModeItem,{})]}),(0,T.jsx)(TldrawUiMenuGroup,{id:"language",children:(0,T.jsx)(il,{})})]})})}let ip=(0,P.memo)(function({children:e}){let t=useContainer(),[n,r]=useMenuIsOpen("main menu"),i=useTranslation(),o=e??(0,T.jsx)(DefaultMainMenuContent,{});return(0,T.jsxs)(ir.fC,{dir:"ltr",open:n,onOpenChange:r,modal:!1,children:[(0,T.jsx)(ir.xz,{asChild:!0,dir:"ltr",children:(0,T.jsx)(nK,{type:"icon","data-testid":"main-menu.button",title:i("menu.title"),children:(0,T.jsx)(TldrawUiButtonIcon,{icon:"menu",small:!0})})}),(0,T.jsx)(ir.Uv,{container:t,children:(0,T.jsx)(ir.VY,{className:"tlui-menu",side:"bottom",align:"start",collisionPadding:4,alignOffset:0,sideOffset:6,children:(0,T.jsx)(TldrawUiMenuContextProvider,{type:"menu",sourceId:"main-menu",children:o})})})]})}),ih=(0,P.memo)(function(){let e=useBreakpoint(),{MainMenu:t,QuickActions:n,ActionsMenu:r,PageMenu:i}=useTldrawUiComponents();return t||i||!(e<6)?(0,T.jsx)("div",{className:"tlui-menu-zone",children:(0,T.jsxs)("div",{className:"tlui-buttons__horizontal",children:[t&&(0,T.jsx)(t,{}),i&&(0,T.jsx)(i,{}),e<6?null:(0,T.jsxs)(T.Fragment,{children:[n&&(0,T.jsx)(n,{}),r&&(0,T.jsx)(r,{})]})]})}):null});let MinimapManager=class MinimapManager{constructor(e){this.editor=e}dpr=1;colors={shapeFill:"rgba(144, 144, 144, .1)",selectFill:"#2f80ed",viewportFill:"rgba(144, 144, 144, .1)"};id=(0,eM.E)();cvs=null;pageBounds=[];collaborators=[];canvasScreenBounds=new eo.xu;canvasPageBounds=new eo.xu;contentPageBounds=new eo.xu;contentScreenBounds=new eo.xu;originPagePoint=new et.B;originPageCenter=new et.B;isInViewport=!1;debug=!1;setDpr(e){this.dpr=+e.toFixed(2)}updateContentScreenBounds=()=>{let{contentScreenBounds:e,contentPageBounds:t,canvasScreenBounds:n}=this,{x:r,y:i,w:o,h:a}=e;if(t.w>t.h){let e=n.w/(t.w/t.h);e>n.h?(r=(n.w-n.w*(n.h/e))/2,i=0,o=n.w*(n.h/e),a=n.h):(r=0,i=(n.h-e)/2,o=n.w,a=e)}else if(t.w<t.h){let e=n.h/(t.h/t.w);r=(n.w-e)/2,i=0,o=e,a=n.h}else r=n.h/2,i=0,o=n.h,a=n.h;e.set(r,i,o,a)};updateCanvasPageBounds=()=>{let{canvasPageBounds:e,canvasScreenBounds:t,contentPageBounds:n,contentScreenBounds:r}=this;e.set(0,0,n.width/(r.width/t.width),n.height/(r.height/t.height)),e.center=n.center};getScreenPoint=(e,t)=>{let{canvasScreenBounds:n}=this,r=(e-n.minX)*this.dpr,i=(t-n.minY)*this.dpr;return{x:r,y:i}};getPagePoint=(e,t)=>{let{contentPageBounds:n,contentScreenBounds:r,canvasPageBounds:i}=this,{x:o,y:a}=this.getScreenPoint(e,t);return new et.B(i.minX+o*n.width/r.width,i.minY+a*n.height/r.height,1)};minimapScreenPointToPagePoint=(e,t,n=!1,r=!1)=>{let{editor:i}=this,o=i.getViewportPageBounds(),{x:a,y:l}=this.getPagePoint(e,t);if(r){let e=this.editor.getCurrentPageBounds(),t=(e?.minX??0)-o.width/2,n=(e?.maxX??0)+o.width/2,r=(e?.minY??0)-o.height/2,i=(e?.maxY??0)+o.height/2,c=Math.max(0,t+o.width-a),u=Math.max(0,-(n-o.width-a)),d=Math.max(0,r+o.height-l),p=Math.max(0,-(i-o.height-l)),h=Math.max(0,c-u),g=Math.max(0,u-c),f=Math.max(0,d-p),m=Math.max(0,p-d);h&&h>g?a+=h/2:g&&(a-=g/2),f&&f>m?l+=f/2:m&&(l-=m/2),a=(0,E.uZ)(a,t,n),l=(0,E.uZ)(l,r,i)}if(n){let{originPagePoint:e}=this,t=Math.abs(a-e.x),n=Math.abs(l-e.y);t>n?l=e.y:a=e.x}return new et.B(a,l)};updateColors=()=>{let e=getComputedStyle(this.editor.getContainer());this.colors={shapeFill:e.getPropertyValue("--color-text-3").trim(),selectFill:e.getPropertyValue("--color-selected").trim(),viewportFill:e.getPropertyValue("--color-muted-1").trim()}};render=()=>{let e,t;let{cvs:n,pageBounds:r}=this;this.updateCanvasPageBounds();let{editor:i,canvasScreenBounds:o,canvasPageBounds:a,contentPageBounds:l,contentScreenBounds:c}=this,{width:u,height:d}=o,p=i.getSelectedShapeIds(),h=i.getViewportPageBounds();if(!n||!r)return;let g=n.getContext("2d");if(!g)throw Error("Minimap (shapes): Could not get context");g.resetTransform(),g.globalAlpha=1,g.clearRect(0,0,u,d);let f=c.width/l.width,m=c.height/l.height;g.translate((u-c.width)/2,(d-c.height)/2),g.scale(f,m),g.translate(-l.minX,-l.minY);let y=8/f,b=8/f,w=1/f,S=1/f,v=y/4,x=b/4,T=new Path2D,P=new Path2D,{shapeFill:C,selectFill:k,viewportFill:I}=this.colors;for(let t=0,n=r.length;t<n;t++)e=r[t],MinimapManager.roundedRect(p.includes(e.id)?P:T,e.minX,e.minY,e.width,e.height,(0,E.uZ)(y,w,e.width/v),(0,E.uZ)(b,S,e.height/x));if(g.fillStyle=C,g.fill(T),g.fillStyle=k,g.fill(P),this.debug){let e=eo.xu.Common(r),{minX:t,minY:n,width:i,height:o}=e;g.strokeStyle="green",g.lineWidth=2/f,g.strokeRect(t+1/f,n+1/m,i-2/f,o-2/m)}{let{brush:e}=i.getInstanceState();if(e){let{x:t,y:n,w:r,h:i}=e;g.beginPath(),MinimapManager.sharpRect(g,t,n,r,i),g.closePath(),g.fillStyle=I,g.fill()}}{let{minX:e,minY:t,width:n,height:r}=h;g.beginPath();let i=12/f,o=12/f;MinimapManager.roundedRect(g,e,t,n,r,Math.min(n/4,i),Math.min(r/4,o)),g.closePath(),g.fillStyle=I,g.fill(),this.debug&&(g.strokeStyle="orange",g.strokeRect(e+1/f,t+1/m,n-2/f,r-2/m))}let _=2.5/f,M=2.5/m,j=i.getCurrentPageId();for(let e=0;e<this.collaborators.length;e++)(t=this.collaborators[e]).currentPageId===j&&(g.beginPath(),g.ellipse((0,E.uZ)(t.cursor.x,a.minX+_,a.maxX-_),(0,E.uZ)(t.cursor.y,a.minY+M,a.maxY-M),5/f,5/m,0,0,E.yo),g.fillStyle=t.color,g.fill());if(this.debug){g.lineWidth=2/f;{let{minX:e,minY:t,width:n,height:r}=l;g.strokeStyle="red",g.strokeRect(e+1/f,t+1/m,n-2/f,r-2/m)}{let{minX:e,minY:t,width:n,height:r}=a;g.strokeStyle="blue",g.strokeRect(e+1/f,t+1/m,n-2/f,r-2/m)}}};static roundedRect(e,t,n,r,i,o,a){if(o<1&&a<1){e.rect(t,n,r,i);return}e.moveTo(t+o,n),e.lineTo(t+r-o,n),e.quadraticCurveTo(t+r,n,t+r,n+a),e.lineTo(t+r,n+i-a),e.quadraticCurveTo(t+r,n+i,t+r-o,n+i),e.lineTo(t+o,n+i),e.quadraticCurveTo(t,n+i,t,n+i-a),e.lineTo(t,n+a),e.quadraticCurveTo(t,n,t+o,n)}static sharpRect(e,t,n,r,i,o,a){e.rect(t,n,r,i)}};function DefaultMinimap(){let e=(0,I.j)(),t=P.useRef(null),n=P.useRef(!1),r=useIsDarkMode(),i=(0,b.vc)("dpr",()=>e.getInstanceState().devicePixelRatio,[e]),o=P.useMemo(()=>e.store.query.records("instance_presence"),[e]),a=P.useMemo(()=>new MinimapManager(e),[e]);P.useEffect(()=>{let e=requestAnimationFrame(()=>{a.updateColors(),a.render()});return()=>{cancelAnimationFrame(e)}},[e,a,r]);let l=P.useCallback(t=>{if(!e.getCurrentPageShapeIds().size)return;let n=a.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!1),r=a.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!0);a.originPagePoint.setTo(r),a.originPageCenter.setTo(e.getViewportPageBounds().center),e.centerOnPoint(n,{duration:_.KD})},[e,a]),c=P.useCallback(t=>{let r=t.currentTarget;if(setPointerCapture(r,t),!e.getCurrentPageShapeIds().size)return;n.current=!0,a.isInViewport=!1;let i=a.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!1),o=a.minimapScreenPointToPagePoint(t.clientX,t.clientY,!1,!0),l=e.getViewportPageBounds();if(a.isInViewport=l.containsPoint(o),a.isInViewport)a.originPagePoint.setTo(o),a.originPageCenter.setTo(l.center);else{let t=et.B.Sub(l.center,l.point),n=et.B.Add(i,t);a.originPagePoint.setTo(n),a.originPageCenter.setTo(i),e.centerOnPoint(i,{duration:_.KD})}function release(e){r&&releasePointerCapture(r,e),n.current=!1,document.body.removeEventListener("pointerup",release)}document.body.addEventListener("pointerup",release)},[e,a]),u=P.useCallback(t=>{let r=a.minimapScreenPointToPagePoint(t.clientX,t.clientY,t.shiftKey,!0);if(n.current){if(a.isInViewport){let t=a.originPagePoint.clone().sub(a.originPageCenter);e.centerOnPoint(et.B.Sub(r,t));return}e.centerOnPoint(r)}let i=a.getPagePoint(t.clientX,t.clientY),o=e.pageToScreen(i),l={type:"pointer",target:"canvas",name:"pointer_move",...getPointerInfo(t),point:o,isPen:e.getInstanceState().isPenMode};e.dispatch(l)},[e,a]),d=P.useCallback(t=>{let n=normalizeWheel(t);e.dispatch({type:"wheel",name:"wheel",delta:n,point:new et.B(t.clientX,t.clientY),shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey})},[e]);return(0,b.BK)("update when dpr changes",()=>{let e=i.get();a.setDpr(e);let n=t.current,r=n.getBoundingClientRect(),o=r.width*e,l=r.height*e;n.width=o,n.height=l,a.canvasScreenBounds.set(r.x,r.y,o,l),a.cvs=t.current},[i,a]),(0,b.BK)("minimap render when pagebounds or collaborators changes",()=>{let t=e.getCurrentPageShapeIds(),n=e.getCurrentPageBounds(),r=e.getViewportPageBounds();i.get(),a.contentPageBounds=n?eo.xu.Expand(n,r):r,a.updateContentScreenBounds();let l=[];t.forEach(t=>{let n=e.getShapePageBounds(t);if(!n)return;let r=e.getShapeMask(t);if(r){let e=(0,tr.tY)(r,n.corners);if(!e)return;n=eo.xu.FromPoints(e)}n&&(n.id=t,l.push(n))}),a.pageBounds=l,a.collaborators=o.get(),a.render()},[e,a]),(0,T.jsx)("div",{className:"tlui-minimap",children:(0,T.jsx)("canvas",{role:"img","aria-label":"minimap",ref:t,className:"tlui-minimap__canvas",onDoubleClick:l,onPointerMove:u,onPointerDown:c,onWheel:d})})}function useLocalStorageState(e,t){let[n,r]=P.useState(t);P.useLayoutEffect(()=>{let t=localStorage.getItem(e);if(t)try{r(JSON.parse(t))}catch(t){console.error(`Could not restore value ${e} from local storage.`)}},[e]);let i=P.useCallback(t=>{r(n=>{let r="function"==typeof t?t(n):t;return localStorage.setItem(e,JSON.stringify(r)),r})},[e]);return[n,i]}let ig=(0,P.memo)(function(){let e=useActions(),t=useTranslation(),n=useBreakpoint(),[r,i]=useLocalStorageState("minimap",!0),o=(0,P.useCallback)(()=>{i(e=>!e)},[i]),{ZoomMenu:a,Minimap:l}=useTldrawUiComponents();return n<nz.MOBILE?null:(0,T.jsxs)("div",{className:"tlui-navigation-panel",children:[(0,T.jsx)("div",{className:"tlui-buttons__horizontal",children:a&&n<nz.TABLET?(0,T.jsx)(a,{}):r?(0,T.jsxs)(T.Fragment,{children:[a&&(0,T.jsx)(a,{}),l&&(0,T.jsx)(nK,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:o,children:(0,T.jsx)(TldrawUiButtonIcon,{icon:r?"chevrons-ne":"chevrons-sw"})})]}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(nK,{type:"icon","data-testid":"minimap.zoom-out",title:`${t(unwrapLabel(e["zoom-out"].label))} ${kbdStr(e["zoom-out"].kbd)}`,onClick:()=>e["zoom-out"].onSelect("navigation-zone"),children:(0,T.jsx)(TldrawUiButtonIcon,{icon:"minus"})}),a&&(0,T.jsx)(a,{}),(0,T.jsx)(nK,{type:"icon","data-testid":"minimap.zoom-in",title:`${t(unwrapLabel(e["zoom-in"].label))} ${kbdStr(e["zoom-in"].kbd)}`,onClick:()=>e["zoom-in"].onSelect("navigation-zone"),children:(0,T.jsx)(TldrawUiButtonIcon,{icon:"plus"})}),l&&(0,T.jsx)(nK,{type:"icon","data-testid":"minimap.toggle-button",title:t("navigation-zone.toggle-minimap"),className:"tlui-navigation-panel__toggle",onClick:o,children:(0,T.jsx)(TldrawUiButtonIcon,{icon:r?"chevrons-ne":"chevrons-sw"})})]})}),l&&n>=nz.TABLET&&!r&&(0,T.jsx)(l,{})]})}),PageItemInput=function({name:e,id:t,isCurrentPage:n}){let r=(0,I.j)(),i=(0,P.useRef)(null),o=(0,P.useCallback)(e=>{r.renamePage(t,e||"New Page",{ephemeral:!0})},[r,t]),a=(0,P.useCallback)(e=>{r.mark("rename page"),r.renamePage(t,e||"New Page",{ephemeral:!1})},[r,t]);return(0,T.jsx)(rj,{className:"tlui-page-menu__item__input",ref:e=>i.current=e,defaultValue:e,onValueChange:o,onComplete:a,onCancel:a,shouldManuallyMaintainScrollPositionWhenFocused:!0,autofocus:n,autoselect:!0})},onMovePage=(e,t,n,r)=>{let i;let o=e.getPages(),a=n>r?o[r-1]:o[r],l=n>r?o[r]:o[r+1];(i=a&&!l?(0,v._L)(a.index):!a&&l?(0,v.Xg)(o[0].index):(0,v.eI)(a.index,l.index))!==o[n].index&&(e.mark("moving page"),e.updatePage({id:t,index:i}))},im=(0,b.j)(function({index:e,listSize:t,item:n,onRename:r}){let i=(0,I.j)(),o=useTranslation(),a=i.getPages(),l=(0,P.useCallback)(()=>{i.mark("creating page");let e=S.ez.createId();i.duplicatePage(n.id,e)},[i,n]),c=(0,P.useCallback)(()=>{onMovePage(i,n.id,e,e-1)},[i,n,e]),u=(0,P.useCallback)(()=>{onMovePage(i,n.id,e,e+1)},[i,n,e]),d=(0,P.useCallback)(()=>{i.mark("deleting page"),i.deletePage(n.id)},[i,n]);return(0,T.jsxs)(TldrawUiDropdownMenuRoot,{id:`page item submenu ${e}`,children:[(0,T.jsx)(TldrawUiDropdownMenuTrigger,{children:(0,T.jsx)(nK,{type:"icon",title:o("page-menu.submenu.title"),children:(0,T.jsx)(TldrawUiButtonIcon,{icon:"dots-vertical"})})}),(0,T.jsx)(TldrawUiDropdownMenuContent,{alignOffset:0,side:"right",sideOffset:-4,children:(0,T.jsxs)(TldrawUiMenuContextProvider,{type:"menu",sourceId:"page-menu",children:[(0,T.jsxs)(TldrawUiMenuGroup,{id:"modify",children:[r&&(0,T.jsx)(TldrawUiMenuItem,{id:"rename",label:"page-menu.submenu.rename",onSelect:r}),(0,T.jsx)(TldrawUiMenuItem,{id:"duplicate",label:"page-menu.submenu.duplicate-page",onSelect:l,disabled:a.length>=_.Et}),e>0&&(0,T.jsx)(TldrawUiMenuItem,{id:"move-up",onSelect:c,label:"page-menu.submenu.move-up"}),e<t-1&&(0,T.jsx)(TldrawUiMenuItem,{id:"move-down",label:"page-menu.submenu.move-down",onSelect:u})]}),t>1&&(0,T.jsx)(TldrawUiMenuGroup,{id:"delete",children:(0,T.jsx)(TldrawUiMenuItem,{id:"delete",onSelect:d,label:"page-menu.submenu.delete"})})]})})]})}),iy=(0,P.memo)(function(){let e=(0,I.j)(),t=useTranslation(),n=useBreakpoint(),r=(0,P.useCallback)(()=>f(!1),[]),[i,o]=useMenuIsOpen("page-menu",r),a=(0,P.useRef)(null),l=(0,b.Hg)("pages",()=>e.getPages(),[e]),c=(0,b.Hg)("currentPage",()=>e.getCurrentPage(),[e]),u=(0,b.Hg)("currentPageId",()=>e.getCurrentPageId(),[e]),d=useReadonly(),p=(0,b.Hg)("maxPageCountReached",()=>e.getPages().length>=_.Et,[e]),h=(0,b.Hg)("isCoarsePointer",()=>e.getInstanceState().isCoarsePointer,[e]),[g,f]=(0,P.useState)(!1),m=(0,P.useCallback)(()=>{d||f(e=>!e)},[d]),y=(0,P.useRef)({isPointing:!1,status:"idle",pointing:null,startY:0,startIndex:0,dragIndex:0}),[w,v]=(0,P.useState)(Object.fromEntries(l.map((e,t)=>[e.id,{y:36*t,offsetY:0,isSelected:!1}])));(0,P.useLayoutEffect)(()=>{v(Object.fromEntries(l.map((e,t)=>[e.id,{y:36*t,offsetY:0,isSelected:!1}])))},[36,l]),(0,P.useEffect)(()=>{i&&requestAnimationFrame(()=>{let e=document.querySelector(`[data-testid="page-menu-item-${u}"]`);if(e){let t=a.current;if(!t)return;let n=e.offsetTop,r=t.scrollTop;n<r&&t.scrollTo({top:n});let i=n+36,o=t.scrollTop+t.offsetHeight;i>o&&t.scrollTo({top:i-t.offsetHeight})}})},[36,u,i]);let x=(0,P.useCallback)(e=>{let{clientY:t,currentTarget:n}=e,{dataset:{id:r,index:i}}=n;if(!r||!i)return;let o=y.current;setPointerCapture(e.currentTarget,e),o.status="pointing",o.pointing={id:r,index:+i};let a=w[r],c=a.y;o.startY=t,o.startIndex=Math.max(0,Math.min(Math.round(c/36),l.length-1))},[36,l.length,w]),C=(0,P.useCallback)(e=>{let t=y.current;if("pointing"===t.status){let{clientY:n}=e,r=n-t.startY;Math.abs(r)>5&&(t.status="dragging")}if("dragging"===t.status){let{clientY:n}=e,r=n-t.startY,i=w[t.pointing.id],{startIndex:o,pointing:a}=t,c=i.y+r,u=Math.max(0,Math.min(Math.round(c/36),l.length-1)),d={...w};if(d[a.id]={y:i.y,offsetY:r,isSelected:!0},u!==t.dragIndex){t.dragIndex=u;for(let e=0;e<l.length;e++){let n=l[e];if(n.id===t.pointing.id)continue;let{y:r}=d[n.id];u===o?r=36*e:u<o?r=u<=e&&e<o?(e+1)*36:36*e:u>o&&(r=u>=e&&e>o?(e-1)*36:36*e),r!==d[n.id].y&&(d[n.id]={y:r,offsetY:0,isSelected:!0})}}v(d)}},[36,l,w]),k=(0,P.useCallback)(t=>{let n=y.current;if("dragging"===n.status){let{id:t,index:r}=n.pointing;onMovePage(e,t,r,n.dragIndex)}releasePointerCapture(t.currentTarget,t),n.status="idle"},[e]),E=(0,P.useCallback)(e=>{let t=y.current;"Escape"===e.key&&("dragging"===t.status&&v(Object.fromEntries(l.map((e,t)=>[e.id,{y:36*t,offsetY:0,isSelected:!1}]))),t.status="idle")},[36,l]),M=(0,P.useCallback)(()=>{d||e.batch(()=>{e.mark("creating page");let n=S.ez.createId();e.createPage({name:t("page-menu.new-page-initial-name"),id:n}),e.setCurrentPage(n),f(!0)})},[e,t,d]);return(0,T.jsxs)(TldrawUiPopover,{id:"pages",onOpenChange:o,open:i,children:[(0,T.jsx)(TldrawUiPopoverTrigger,{"data-testid":"main.page-menu",children:(0,T.jsxs)(nK,{type:"menu",title:c.name,"data-testid":"page-menu.button",className:"tlui-page-menu__trigger",children:[(0,T.jsx)("div",{className:"tlui-page-menu__name",children:c.name}),(0,T.jsx)(TldrawUiButtonIcon,{icon:"chevron-down",small:!0})]})}),(0,T.jsx)(TldrawUiPopoverContent,{side:"bottom",align:"start",sideOffset:6,children:(0,T.jsxs)("div",{className:"tlui-page-menu__wrapper",children:[(0,T.jsxs)("div",{className:"tlui-page-menu__header",children:[(0,T.jsx)("div",{className:"tlui-page-menu__header__title",children:t("page-menu.title")}),!d&&(0,T.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,T.jsx)(nK,{type:"icon","data-testid":"page-menu.edit",title:t(g?"page-menu.edit-done":"page-menu.edit-start"),onClick:m,children:(0,T.jsx)(TldrawUiButtonIcon,{icon:g?"check":"edit"})}),(0,T.jsx)(nK,{type:"icon","data-testid":"page-menu.create",title:t(p?"page-menu.max-page-count-reached":"page-menu.create-new-page"),disabled:p,onClick:M,children:(0,T.jsx)(TldrawUiButtonIcon,{icon:"plus"})})]})]}),(0,T.jsx)("div",{"data-testid":"page-menu.list",className:"tlui-page-menu__list tlui-menu__group",style:{height:36*l.length+4},ref:a,children:l.map((r,i)=>{let o=w[r.id]??{position:40*i,offsetY:0};return g?(0,T.jsxs)("div",{"data-testid":"page-menu.item",className:"tlui-page_menu__item__sortable",style:{zIndex:r.id===c.id?888:i,transform:`translate(0px, ${o.y+o.offsetY}px)`},children:[(0,T.jsx)(nK,{type:"icon",tabIndex:-1,className:"tlui-page_menu__item__sortable__handle",onPointerDown:x,onPointerUp:k,onPointerMove:C,onKeyDown:E,"data-id":r.id,"data-index":i,children:(0,T.jsx)(TldrawUiButtonIcon,{icon:"drag-handle-dots"})}),n<nz.TABLET_SM&&h?(0,T.jsxs)(nK,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>{let t=window.prompt("Rename page",r.name);t&&t!==r.name&&e.renamePage(r.id,t)},onDoubleClick:m,children:[(0,T.jsx)(TldrawUiButtonCheck,{checked:r.id===c.id}),(0,T.jsx)(TldrawUiButtonLabel,{children:r.name})]}):(0,T.jsx)("div",{className:"tlui-page_menu__item__sortable__title",style:{height:36},children:(0,T.jsx)(PageItemInput,{id:r.id,name:r.name,isCurrentPage:r.id===c.id})}),!d&&(0,T.jsx)("div",{className:"tlui-page_menu__item__submenu","data-isediting":g,children:(0,T.jsx)(im,{index:i,item:r,listSize:l.length})})]},r.id+"_editing"):(0,T.jsxs)("div",{"data-testid":"page-menu.item",className:"tlui-page-menu__item",children:[(0,T.jsxs)(nK,{type:"normal",className:"tlui-page-menu__item__button",onClick:()=>e.setCurrentPage(r.id),onDoubleClick:m,title:t("page-menu.go-to-page"),children:[(0,T.jsx)(TldrawUiButtonCheck,{checked:r.id===c.id}),(0,T.jsx)(TldrawUiButtonLabel,{children:r.name})]}),!d&&(0,T.jsx)("div",{className:"tlui-page_menu__item__submenu",children:(0,T.jsx)(im,{index:i,item:r,listSize:l.length,onRename:()=>{if(e.environment.isIos){let t=window.prompt("Rename page",r.name);t&&t!==r.name&&e.renamePage(r.id,t)}else e.batch(()=>{f(!0),e.setCurrentPage(r.id)})}})})]},r.id)})})]})})]})});function DefaultQuickActionsContent(){let e=useActions(),t=(0,I.j)(),n=useCanUndo(),r=useCanRedo(),i=useUnlockedSelectedShapesCount(1),o=useReadonly(),a=(0,b.Hg)("should display quick actions",()=>t.isInAny("select","hand","zoom"),[t]);if(!o||a)return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(TldrawUiMenuItem,{...e.undo,disabled:!n}),(0,T.jsx)(TldrawUiMenuItem,{...e.redo,disabled:!r}),(0,T.jsx)(TldrawUiMenuItem,{...e.delete,disabled:!i}),(0,T.jsx)(TldrawUiMenuItem,{...e.duplicate,disabled:!i})]})}let ib=(0,P.memo)(function({children:e}){let t=e??(0,T.jsx)(DefaultQuickActionsContent,{});return(0,T.jsx)(TldrawUiMenuContextProvider,{type:"small-icons",sourceId:"quick-actions",children:t})}),iw=Object.freeze([S.R_,S.ci,S.pp,S.ST]);function useRelevantStyles(e=iw){let t=(0,I.j)();return(0,b.Hg)("getRelevantStyles",()=>{let n=new tl.o(t.getSharedStyles()),r=!!t.root.getCurrent()?.shapeType,i=t.isIn("select")&&t.getSelectedShapeIds().length>0;if(0===n.size&&t.isIn("select")&&0===t.getSelectedShapeIds().length)for(let r of e)n.applyValue(r,t.getStyleForNextShape(r));return r||i||n.size>0?n:null},[t])}let iS={color:[{value:"black",icon:"color"},{value:"grey",icon:"color"},{value:"light-violet",icon:"color"},{value:"violet",icon:"color"},{value:"blue",icon:"color"},{value:"light-blue",icon:"color"},{value:"yellow",icon:"color"},{value:"orange",icon:"color"},{value:"green",icon:"color"},{value:"light-green",icon:"color"},{value:"light-red",icon:"color"},{value:"red",icon:"color"}],fill:[{value:"none",icon:"fill-none"},{value:"semi",icon:"fill-semi"},{value:"solid",icon:"fill-solid"},{value:"pattern",icon:"fill-pattern"}],dash:[{value:"draw",icon:"dash-draw"},{value:"dashed",icon:"dash-dashed"},{value:"dotted",icon:"dash-dotted"},{value:"solid",icon:"dash-solid"}],size:[{value:"s",icon:"size-small"},{value:"m",icon:"size-medium"},{value:"l",icon:"size-large"},{value:"xl",icon:"size-extra-large"}],font:[{value:"draw",icon:"font-draw"},{value:"sans",icon:"font-sans"},{value:"serif",icon:"font-serif"},{value:"mono",icon:"font-mono"}],horizontalAlign:[{value:"start",icon:"text-align-left"},{value:"middle",icon:"text-align-center"},{value:"end",icon:"text-align-right"}],verticalAlign:[{value:"start",icon:"vertical-align-start"},{value:"middle",icon:"vertical-align-center"},{value:"end",icon:"vertical-align-end"}],geo:[{value:"rectangle",icon:"geo-rectangle"},{value:"ellipse",icon:"geo-ellipse"},{value:"cloud",icon:"geo-cloud"},{value:"triangle",icon:"geo-triangle"},{value:"diamond",icon:"geo-diamond"},{value:"pentagon",icon:"geo-pentagon"},{value:"hexagon",icon:"geo-hexagon"},{value:"octagon",icon:"geo-octagon"},{value:"star",icon:"geo-star"},{value:"rhombus",icon:"geo-rhombus"},{value:"rhombus-2",icon:"geo-rhombus-2"},{value:"oval",icon:"geo-oval"},{value:"trapezoid",icon:"geo-trapezoid"},{value:"arrow-right",icon:"geo-arrow-right"},{value:"arrow-left",icon:"geo-arrow-left"},{value:"arrow-up",icon:"geo-arrow-up"},{value:"arrow-down",icon:"geo-arrow-down"},{value:"x-box",icon:"geo-x-box"},{value:"check-box",icon:"geo-check-box"}],arrowheadStart:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],arrowheadEnd:[{value:"none",icon:"arrowhead-none"},{value:"arrow",icon:"arrowhead-arrow"},{value:"triangle",icon:"arrowhead-triangle"},{value:"square",icon:"arrowhead-square"},{value:"dot",icon:"arrowhead-dot"},{value:"diamond",icon:"arrowhead-diamond"},{value:"inverted",icon:"arrowhead-triangle-inverted"},{value:"bar",icon:"arrowhead-bar"}],spline:[{value:"line",icon:"spline-line"},{value:"cubic",icon:"spline-cubic"}]};function _TldrawUiButtonPicker(e){let{uiType:t,items:n,title:r,style:i,value:o,onValueChange:a}=e,l=(0,I.j)(),c=useTranslation(),u=(0,P.useRef)(!1),{handleButtonClick:d,handleButtonPointerDown:p,handleButtonPointerEnter:h,handleButtonPointerUp:g}=(0,P.useMemo)(()=>{let handlePointerUp=()=>{u.current=!1,window.removeEventListener("pointerup",handlePointerUp)};return{handleButtonClick:e=>{let{id:t}=e.currentTarget.dataset;("shared"!==o.type||o.value!==t)&&(l.mark("point picker item"),a(i,t,!1))},handleButtonPointerDown:e=>{let{id:t}=e.currentTarget.dataset;l.mark("point picker item"),a(i,t,!0),u.current=!0,window.addEventListener("pointerup",handlePointerUp)},handleButtonPointerEnter:e=>{if(!u.current)return;let{id:t}=e.currentTarget.dataset;a(i,t,!0)},handleButtonPointerUp:e=>{let{id:t}=e.currentTarget.dataset;("shared"!==o.type||o.value!==t)&&a(i,t,!1)}}},[o,l,a,i]),f=(0,b.Hg)("theme",()=>(0,S.y6)({isDarkMode:l.user.getIsDarkMode()}),[l]);return(0,T.jsx)("div",{"data-testid":`style.${t}`,className:C("tlui-buttons__grid"),children:n.map(e=>(0,T.jsx)(nK,{type:"icon","data-id":e.value,"data-testid":`style.${t}.${e.value}`,"aria-label":e.value,"data-state":"shared"===o.type&&o.value===e.value?"hinted":void 0,title:r+"  "+c(`${t}-style.${e.value}`),className:C("tlui-button-grid__button"),style:i===S.R_?{color:f[e.value].solid}:void 0,onPointerEnter:h,onPointerDown:p,onPointerUp:g,onClick:d,children:(0,T.jsx)(TldrawUiButtonIcon,{icon:e.icon})},e.value))})}let iv=(0,P.memo)(_TldrawUiButtonPicker);function $ae6933e535247d3d$export$7d15b64cf5a3a4c4(e,[t,n]){return Math.min(n,Math.max(t,e))}var ix=n(5400);function $010c2913dbd2fe3d$export$5cae361ad82dce8b(e){let t=(0,P.useRef)({value:e,previous:e});return(0,P.useMemo)(()=>(t.current.value!==e&&(t.current.previous=t.current.value,t.current.value=e),t.current.previous),[e])}var iT=n(4977);let iP=["PageUp","PageDown"],iC=["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"],ik={"from-left":["Home","PageDown","ArrowDown","ArrowLeft"],"from-right":["Home","PageDown","ArrowDown","ArrowRight"],"from-bottom":["Home","PageDown","ArrowDown","ArrowLeft"],"from-top":["Home","PageDown","ArrowUp","ArrowLeft"]},iI="Slider",[iE,i_,iM]=(0,ns.B)(iI),[ij,iA]=(0,nl.b)(iI,[iM]),[i$,iD]=ij(iI),iO=(0,P.forwardRef)((e,t)=>{let{name:n,min:r=0,max:i=100,step:o=1,orientation:a="horizontal",disabled:l=!1,minStepsBetweenThumbs:c=0,defaultValue:u=[r],value:d,onValueChange:p=()=>{},onValueCommit:h=()=>{},inverted:g=!1,...f}=e,[m,y]=(0,P.useState)(null),b=(0,na.e)(t,e=>y(e)),w=(0,P.useRef)(new Set),S=(0,P.useRef)(0),v=!m||!!m.closest("form"),x="horizontal"===a?iU:iL,[T=[],C]=(0,ng.T)({prop:d,defaultProp:u,onChange:e=>{var t;let n=[...w.current];null===(t=n[S.current])||void 0===t||t.focus(),p(e)}}),k=(0,P.useRef)(T);function handleSlideStart(e){let t=$faa2e61a3361514f$var$getClosestValueIndex(T,e);updateValues(e,t)}function handleSlideMove(e){updateValues(e,S.current)}function handleSlideEnd(){let e=k.current[S.current],t=T[S.current];t!==e&&h(T)}function updateValues(e,t,{commit:n}={commit:!1}){let a=$faa2e61a3361514f$var$getDecimalCount(o),l=$faa2e61a3361514f$var$roundValue(Math.round((e-r)/o)*o+r,a),u=$ae6933e535247d3d$export$7d15b64cf5a3a4c4(l,[r,i]);C((e=[])=>{let r=$faa2e61a3361514f$var$getNextSortedValues(e,u,t);if(!$faa2e61a3361514f$var$hasMinStepsBetweenValues(r,c*o))return e;{S.current=r.indexOf(u);let t=String(r)!==String(e);return t&&n&&h(r),t?r:e}})}return(0,P.createElement)(i$,{scope:e.__scopeSlider,disabled:l,min:r,max:i,valueIndexToChangeRef:S,thumbs:w.current,values:T,orientation:a},(0,P.createElement)(iE.Provider,{scope:e.__scopeSlider},(0,P.createElement)(iE.Slot,{scope:e.__scopeSlider},(0,P.createElement)(x,(0,nr.Z)({"aria-disabled":l,"data-disabled":l?"":void 0},f,{ref:b,onPointerDown:(0,no.M)(f.onPointerDown,()=>{l||(k.current=T)}),min:r,max:i,inverted:g,onSlideStart:l?void 0:handleSlideStart,onSlideMove:l?void 0:handleSlideMove,onSlideEnd:l?void 0:handleSlideEnd,onHomeKeyDown:()=>!l&&updateValues(r,0,{commit:!0}),onEndKeyDown:()=>!l&&updateValues(i,T.length-1,{commit:!0}),onStepKeyDown:({event:e,direction:t})=>{if(!l){let n=iP.includes(e.key),r=n||e.shiftKey&&iC.includes(e.key),i=S.current,a=T[i],l=o*(r?10:1)*t;updateValues(a+l,i,{commit:!0})}}})))),v&&T.map((e,t)=>(0,P.createElement)($faa2e61a3361514f$var$BubbleInput,{key:t,name:n?n+(T.length>1?"[]":""):void 0,value:e})))}),[iB,iF]=ij(iI,{startEdge:"left",endEdge:"right",size:"width",direction:1}),iU=(0,P.forwardRef)((e,t)=>{let{min:n,max:r,dir:i,inverted:o,onSlideStart:a,onSlideMove:l,onSlideEnd:c,onStepKeyDown:u,...d}=e,[p,h]=(0,P.useState)(null),g=(0,na.e)(t,e=>h(e)),f=(0,P.useRef)(),m=(0,ix.gm)(i),y="ltr"===m,b=y&&!o||!y&&o;function getValueFromPointer(e){let t=f.current||p.getBoundingClientRect(),i=[0,t.width],o=$faa2e61a3361514f$var$linearScale(i,b?[n,r]:[r,n]);return f.current=t,o(e-t.left)}return(0,P.createElement)(iB,{scope:e.__scopeSlider,startEdge:b?"left":"right",endEdge:b?"right":"left",direction:b?1:-1,size:"width"},(0,P.createElement)(iR,(0,nr.Z)({dir:m,"data-orientation":"horizontal"},d,{ref:g,style:{...d.style,"--radix-slider-thumb-transform":"translateX(-50%)"},onSlideStart:e=>{let t=getValueFromPointer(e.clientX);null==a||a(t)},onSlideMove:e=>{let t=getValueFromPointer(e.clientX);null==l||l(t)},onSlideEnd:()=>{f.current=void 0,null==c||c()},onStepKeyDown:e=>{let t=ik[b?"from-left":"from-right"].includes(e.key);null==u||u({event:e,direction:t?-1:1})}})))}),iL=(0,P.forwardRef)((e,t)=>{let{min:n,max:r,inverted:i,onSlideStart:o,onSlideMove:a,onSlideEnd:l,onStepKeyDown:c,...u}=e,d=(0,P.useRef)(null),p=(0,na.e)(t,d),h=(0,P.useRef)(),g=!i;function getValueFromPointer(e){let t=h.current||d.current.getBoundingClientRect(),i=[0,t.height],o=$faa2e61a3361514f$var$linearScale(i,g?[r,n]:[n,r]);return h.current=t,o(e-t.top)}return(0,P.createElement)(iB,{scope:e.__scopeSlider,startEdge:g?"bottom":"top",endEdge:g?"top":"bottom",size:"height",direction:g?1:-1},(0,P.createElement)(iR,(0,nr.Z)({"data-orientation":"vertical"},u,{ref:p,style:{...u.style,"--radix-slider-thumb-transform":"translateY(50%)"},onSlideStart:e=>{let t=getValueFromPointer(e.clientY);null==o||o(t)},onSlideMove:e=>{let t=getValueFromPointer(e.clientY);null==a||a(t)},onSlideEnd:()=>{h.current=void 0,null==l||l()},onStepKeyDown:e=>{let t=ik[g?"from-bottom":"from-top"].includes(e.key);null==c||c({event:e,direction:t?-1:1})}})))}),iR=(0,P.forwardRef)((e,t)=>{let{__scopeSlider:n,onSlideStart:r,onSlideMove:i,onSlideEnd:o,onHomeKeyDown:a,onEndKeyDown:l,onStepKeyDown:c,...u}=e,d=iD(iI,n);return(0,P.createElement)(np.WV.span,(0,nr.Z)({},u,{ref:t,onKeyDown:(0,no.M)(e.onKeyDown,e=>{"Home"===e.key?(a(e),e.preventDefault()):"End"===e.key?(l(e),e.preventDefault()):iP.concat(iC).includes(e.key)&&(c(e),e.preventDefault())}),onPointerDown:(0,no.M)(e.onPointerDown,e=>{let t=e.target;t.setPointerCapture(e.pointerId),e.preventDefault(),d.thumbs.has(t)?t.focus():r(e)}),onPointerMove:(0,no.M)(e.onPointerMove,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&i(e)}),onPointerUp:(0,no.M)(e.onPointerUp,e=>{let t=e.target;t.hasPointerCapture(e.pointerId)&&(t.releasePointerCapture(e.pointerId),o(e))})}))}),iz=(0,P.forwardRef)((e,t)=>{let{__scopeSlider:n,...r}=e,i=iD("SliderTrack",n);return(0,P.createElement)(np.WV.span,(0,nr.Z)({"data-disabled":i.disabled?"":void 0,"data-orientation":i.orientation},r,{ref:t}))}),iN="SliderRange",iV=(0,P.forwardRef)((e,t)=>{let{__scopeSlider:n,...r}=e,i=iD(iN,n),o=iF(iN,n),a=(0,P.useRef)(null),l=(0,na.e)(t,a),c=i.values.length,u=i.values.map(e=>$faa2e61a3361514f$var$convertValueToPercentage(e,i.min,i.max));return(0,P.createElement)(np.WV.span,(0,nr.Z)({"data-orientation":i.orientation,"data-disabled":i.disabled?"":void 0},r,{ref:l,style:{...e.style,[o.startEdge]:(c>1?Math.min(...u):0)+"%",[o.endEdge]:100-Math.max(...u)+"%"}}))}),iH="SliderThumb",iG=(0,P.forwardRef)((e,t)=>{let n=i_(e.__scopeSlider),[r,i]=(0,P.useState)(null),o=(0,na.e)(t,e=>i(e)),a=(0,P.useMemo)(()=>r?n().findIndex(e=>e.ref.current===r):-1,[n,r]);return(0,P.createElement)(iW,(0,nr.Z)({},e,{ref:o,index:a}))}),iW=(0,P.forwardRef)((e,t)=>{let{__scopeSlider:n,index:r,...i}=e,o=iD(iH,n),a=iF(iH,n),[l,c]=(0,P.useState)(null),u=(0,na.e)(t,e=>c(e)),d=(0,iT.t)(l),p=o.values[r],h=void 0===p?0:$faa2e61a3361514f$var$convertValueToPercentage(p,o.min,o.max),g=$faa2e61a3361514f$var$getLabel(r,o.values.length),f=null==d?void 0:d[a.size],m=f?$faa2e61a3361514f$var$getThumbInBoundsOffset(f,h,a.direction):0;return(0,P.useEffect)(()=>{if(l)return o.thumbs.add(l),()=>{o.thumbs.delete(l)}},[l,o.thumbs]),(0,P.createElement)("span",{style:{transform:"var(--radix-slider-thumb-transform)",position:"absolute",[a.startEdge]:`calc(${h}% + ${m}px)`}},(0,P.createElement)(iE.ItemSlot,{scope:e.__scopeSlider},(0,P.createElement)(np.WV.span,(0,nr.Z)({role:"slider","aria-label":e["aria-label"]||g,"aria-valuemin":o.min,"aria-valuenow":p,"aria-valuemax":o.max,"aria-orientation":o.orientation,"data-orientation":o.orientation,"data-disabled":o.disabled?"":void 0,tabIndex:o.disabled?void 0:0},i,{ref:u,style:void 0===p?{display:"none"}:e.style,onFocus:(0,no.M)(e.onFocus,()=>{o.valueIndexToChangeRef.current=r})}))))}),$faa2e61a3361514f$var$BubbleInput=e=>{let{value:t,...n}=e,r=(0,P.useRef)(null),i=$010c2913dbd2fe3d$export$5cae361ad82dce8b(t);return(0,P.useEffect)(()=>{let e=r.current,n=window.HTMLInputElement.prototype,o=Object.getOwnPropertyDescriptor(n,"value"),a=o.set;if(i!==t&&a){let n=new Event("input",{bubbles:!0});a.call(e,t),e.dispatchEvent(n)}},[i,t]),(0,P.createElement)("input",(0,nr.Z)({style:{display:"none"}},n,{ref:r,defaultValue:t}))};function $faa2e61a3361514f$var$getNextSortedValues(e=[],t,n){let r=[...e];return r[n]=t,r.sort((e,t)=>e-t)}function $faa2e61a3361514f$var$convertValueToPercentage(e,t,n){return $ae6933e535247d3d$export$7d15b64cf5a3a4c4(100/(n-t)*(e-t),[0,100])}function $faa2e61a3361514f$var$getLabel(e,t){return t>2?`Value ${e+1} of ${t}`:2===t?["Minimum","Maximum"][e]:void 0}function $faa2e61a3361514f$var$getClosestValueIndex(e,t){if(1===e.length)return 0;let n=e.map(e=>Math.abs(e-t)),r=Math.min(...n);return n.indexOf(r)}function $faa2e61a3361514f$var$getThumbInBoundsOffset(e,t,n){let r=e/2,i=$faa2e61a3361514f$var$linearScale([0,50],[0,r]);return(r-i(t)*n)*n}function $faa2e61a3361514f$var$getStepsBetweenValues(e){return e.slice(0,-1).map((t,n)=>e[n+1]-t)}function $faa2e61a3361514f$var$hasMinStepsBetweenValues(e,t){if(t>0){let n=$faa2e61a3361514f$var$getStepsBetweenValues(e);return Math.min(...n)>=t}return!0}function $faa2e61a3361514f$var$linearScale(e,t){return n=>{if(e[0]===e[1]||t[0]===t[1])return t[0];let r=(t[1]-t[0])/(e[1]-e[0]);return t[0]+r*(n-e[0])}}function $faa2e61a3361514f$var$getDecimalCount(e){return(String(e).split(".")[1]||"").length}function $faa2e61a3361514f$var$roundValue(e,t){let n=Math.pow(10,t);return Math.round(e*n)/n}let iZ=(0,P.memo)(function(e){let{title:t,steps:n,value:r,label:i,onValueChange:o}=e,a=(0,I.j)(),l=useTranslation(),c=(0,P.useCallback)(e=>{o(e[0],!0)},[o]),u=(0,P.useCallback)(()=>{a.mark("click slider")},[a]),d=(0,P.useCallback)(()=>{r&&o(r,!1)},[r,o]);return(0,T.jsx)("div",{className:"tlui-slider__container",children:(0,T.jsxs)(iO,{"data-testid":e["data-testid"],className:"tlui-slider","area-label":"Opacity",dir:"ltr",min:0,max:n,step:1,value:r?[r]:void 0,onPointerDown:u,onValueChange:c,onPointerUp:d,title:t+"  "+l(i),children:[(0,T.jsx)(iz,{className:"tlui-slider__track",dir:"ltr",children:null!==r&&(0,T.jsx)(iV,{className:"tlui-slider__range",dir:"ltr"})}),null!==r&&(0,T.jsx)(iG,{className:"tlui-slider__thumb",dir:"ltr"})]})})});function _DoubleDropdownPicker({label:e,uiTypeA:t,uiTypeB:n,labelA:r,labelB:i,itemsA:o,itemsB:a,styleA:l,styleB:c,valueA:u,valueB:d,onValueChange:p}){let h=useTranslation(),g=P.useMemo(()=>o.find(e=>"shared"===u.type&&u.value===e.value)?.icon??"mixed",[o,u]),f=P.useMemo(()=>a.find(e=>"shared"===d.type&&d.value===e.value)?.icon??"mixed",[a,d]);return void 0===u&&void 0===d?null:(0,T.jsxs)("div",{className:"tlui-style-panel__double-select-picker",children:[(0,T.jsx)("div",{title:h(e),className:"tlui-style-panel__double-select-picker-label",children:h(e)}),(0,T.jsxs)("div",{className:"tlui-buttons__horizontal",children:[(0,T.jsxs)(TldrawUiDropdownMenuRoot,{id:`style panel ${t} A`,children:[(0,T.jsx)(TldrawUiDropdownMenuTrigger,{children:(0,T.jsx)(nK,{type:"icon","data-testid":`style.${t}`,title:h(r)+"  "+(null===u||"mixed"===u.type?h("style-panel.mixed"):h(`${t}-style.${u.value}`)),children:(0,T.jsx)(TldrawUiButtonIcon,{icon:g,small:!0,invertIcon:!0})})}),(0,T.jsx)(TldrawUiDropdownMenuContent,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:(0,T.jsx)("div",{className:"tlui-buttons__grid",children:o.map((e,n)=>(0,T.jsx)(TldrawUiDropdownMenuItem,{"data-testid":`style.${t}.${e.value}`,children:(0,T.jsx)(nK,{type:"icon",onClick:()=>p(l,e.value,!1),title:`${h(r)} \u2014 ${h(`${t}-style.${e.value}`)}`,children:(0,T.jsx)(TldrawUiButtonIcon,{icon:e.icon,invertIcon:!0})},e.value)},n))})})]}),(0,T.jsxs)(TldrawUiDropdownMenuRoot,{id:`style panel ${n}`,children:[(0,T.jsx)(TldrawUiDropdownMenuTrigger,{children:(0,T.jsx)(nK,{type:"icon","data-testid":`style.${n}`,title:h(i)+"  "+(null===d||"mixed"===d.type?h("style-panel.mixed"):h(`${n}-style.${d.value}`)),children:(0,T.jsx)(TldrawUiButtonIcon,{icon:f,small:!0})})}),(0,T.jsx)(TldrawUiDropdownMenuContent,{side:"bottom",align:"end",sideOffset:0,alignOffset:-2,children:(0,T.jsx)("div",{className:"tlui-buttons__grid",children:a.map(e=>(0,T.jsx)(TldrawUiDropdownMenuItem,{children:(0,T.jsx)(nK,{type:"icon",title:`${h(i)} \u2014 ${h(`${n}-style.${e.value}`)}`,"data-testid":`style.${n}.${e.value}`,onClick:()=>p(c,e.value,!1),children:(0,T.jsx)(TldrawUiButtonIcon,{icon:e.icon})})},e.value))})})]})]})]})}let iK=P.memo(_DoubleDropdownPicker);function _DropdownPicker({id:e,label:t,uiType:n,style:r,items:i,type:o,value:a,onValueChange:l}){let c=useTranslation(),u=(0,I.j)(),d=P.useMemo(()=>i.find(e=>"shared"===a.type&&e.value===a.value)?.icon,[i,a]),p="mixed"===a.type?c("style-panel.mixed"):c(`${n}-style.${a.value}`),h=t?c(t):"";return(0,T.jsxs)(TldrawUiDropdownMenuRoot,{id:`style panel ${e}`,children:[(0,T.jsx)(TldrawUiDropdownMenuTrigger,{children:(0,T.jsxs)(nK,{type:o,"data-testid":`style.${n}`,title:p,children:[(0,T.jsx)(TldrawUiButtonLabel,{children:h}),(0,T.jsx)(TldrawUiButtonIcon,{icon:d??"mixed"})]})}),(0,T.jsx)(TldrawUiDropdownMenuContent,{side:"left",align:"center",alignOffset:0,children:(0,T.jsx)("div",{className:"tlui-buttons__grid",children:i.map(e=>(0,T.jsx)(TldrawUiDropdownMenuItem,{children:(0,T.jsx)(nK,{type:"icon","data-testid":`style.${n}.${e.value}`,title:c(`${n}-style.${e.value}`),onClick:()=>{u.mark("select style dropdown item"),l(r,e.value,!1)},children:(0,T.jsx)(TldrawUiButtonIcon,{icon:e.icon})})},e.value))})})]})}let iY=P.memo(_DropdownPicker);function DefaultStylePanelContent({styles:e}){if(!e)return null;let t=e.get(S.Zu),n=e.get(S.ZJ),r=e.get(S.TA),i=e.get(S.t8),o=e.get(S.Y8);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(CommonStylePickerSet,{styles:e}),void 0!==o&&(0,T.jsx)(TextStylePickerSet,{styles:e}),!(void 0===t&&void 0===n&&void 0===r&&void 0===i)&&(0,T.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[(0,T.jsx)(GeoStylePickerSet,{styles:e}),(0,T.jsx)(ArrowheadStylePickerSet,{styles:e}),(0,T.jsx)(SplineStylePickerSet,{styles:e})]})]})}function useStyleChangeCallback(){let e=(0,I.j)(),t=useUiEvents();return P.useMemo(()=>function(n,r,i){e.batch(()=>{e.isIn("select")&&e.setStyleForSelectedShapes(n,r,{squashing:i}),e.setStyleForNextShapes(n,r,{squashing:i}),e.updateInstanceState({isChangingStyle:!0},{ephemeral:!0})}),t("set-style",{source:"style-panel",id:n.id,value:r})},[e,t])}function CommonStylePickerSet({styles:e}){let t=useTranslation(),n=useStyleChangeCallback(),r=e.get(S.R_),i=e.get(S.pp),o=e.get(S.ci),a=e.get(S.ST);return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{tabIndex:-1,className:"tlui-style-panel__section__common","aria-label":"style panel styles","data-testid":"style.panel",children:[void 0===r?null:(0,T.jsx)(iv,{title:t("style-panel.color"),uiType:"color",style:S.R_,items:iS.color,value:r,onValueChange:n}),(0,T.jsx)(OpacitySlider,{})]}),(void 0!==i||void 0!==o||void 0!==a)&&(0,T.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel styles",children:[void 0===i?null:(0,T.jsx)(iv,{title:t("style-panel.fill"),uiType:"fill",style:S.pp,items:iS.fill,value:i,onValueChange:n}),void 0===o?null:(0,T.jsx)(iv,{title:t("style-panel.dash"),uiType:"dash",style:S.ci,items:iS.dash,value:o,onValueChange:n}),void 0===a?null:(0,T.jsx)(iv,{title:t("style-panel.size"),uiType:"size",style:S.ST,items:iS.size,value:a,onValueChange:n})]})]})}function TextStylePickerSet({styles:e}){let t=useTranslation(),n=useStyleChangeCallback(),r=e.get(S.Y8),i=e.get(S.Xo),o=e.get(S.HO);return void 0===r&&void 0===i?null:(0,T.jsxs)("div",{className:"tlui-style-panel__section","aria-label":"style panel text",children:[void 0===r?null:(0,T.jsx)(iv,{title:t("style-panel.font"),uiType:"font",style:S.Y8,items:iS.font,value:r,onValueChange:n}),void 0===i?null:(0,T.jsxs)("div",{className:"tlui-style-panel__row",children:[(0,T.jsx)(iv,{title:t("style-panel.align"),uiType:"align",style:S.Xo,items:iS.horizontalAlign,value:i,onValueChange:n}),(0,T.jsx)("div",{className:"tlui-style-panel__row__extra-button",children:void 0===o?(0,T.jsx)(nK,{type:"icon",title:t("style-panel.vertical-align"),"data-testid":"vertical-align",disabled:!0,children:(0,T.jsx)(TldrawUiButtonIcon,{icon:"vertical-align-center"})}):(0,T.jsx)(iY,{type:"icon",id:"geo-vertical-alignment",uiType:"verticalAlign",style:S.HO,items:iS.verticalAlign,value:o,onValueChange:n})})]})]})}function GeoStylePickerSet({styles:e}){let t=useStyleChangeCallback(),n=e.get(S.Zu);return void 0===n?null:(0,T.jsx)(iY,{id:"geo",type:"menu",label:"style-panel.geo",uiType:"geo",style:S.Zu,items:iS.geo,value:n,onValueChange:t})}function SplineStylePickerSet({styles:e}){let t=useStyleChangeCallback(),n=e.get(S.t8);return void 0===n?null:(0,T.jsx)(iY,{id:"spline",type:"menu",label:"style-panel.spline",uiType:"spline",style:S.t8,items:iS.spline,value:n,onValueChange:t})}function ArrowheadStylePickerSet({styles:e}){let t=useStyleChangeCallback(),n=e.get(S.ZJ),r=e.get(S.TA);return n&&r?(0,T.jsx)(iK,{label:"style-panel.arrowheads",uiTypeA:"arrowheadStart",styleA:S.TA,itemsA:iS.arrowheadStart,valueA:r,uiTypeB:"arrowheadEnd",styleB:S.ZJ,itemsB:iS.arrowheadEnd,valueB:n,onValueChange:t,labelA:"style-panel.arrowhead-start",labelB:"style-panel.arrowhead-end"}):null}let iq=[.1,.25,.5,.75,1];function OpacitySlider(){let e=(0,I.j)(),t=(0,b.Hg)("opacity",()=>e.getSharedOpacity(),[e]),n=useUiEvents(),r=useTranslation(),i=P.useCallback((t,r)=>{let i=iq[t];e.batch(()=>{e.isIn("select")&&e.setOpacityForSelectedShapes(i,{squashing:r}),e.setOpacityForNextShapes(i,{squashing:r}),e.updateInstanceState({isChangingStyle:!0},{ephemeral:!0})}),n("set-style",{source:"style-panel",id:"opacity",value:t})},[e,n]);if(void 0===t)return null;let o="mixed"===t.type?-1:iq.indexOf((0,v.F)(iq,e=>Math.abs(e-t.value)));return(0,T.jsx)(iZ,{"data-testid":"style.opacity",value:o>=0?o:iq.length-1,label:"mixed"===t.type?"style-panel.mixed":`opacity-style.${t.value}`,onValueChange:i,steps:iq.length-1,title:r("style-panel.opacity")})}let iX=(0,P.memo)(function({isMobile:e,children:t}){let n=(0,I.j)(),r=useRelevantStyles(),i=(0,P.useCallback)(()=>{e||n.updateInstanceState({isChangingStyle:!1},{ephemeral:!0})},[n,e]),o=t??(0,T.jsx)(DefaultStylePanelContent,{styles:r});return(0,T.jsx)("div",{className:C("tlui-style-panel",{"tlui-style-panel__wrapper":!e}),"data-ismobile":e,onPointerLeave:i,children:o})});var iJ="undefined"!=typeof navigator&&navigator.userAgent.toLowerCase().indexOf("firefox")>0;function addEvent(e,t,n,r){e.addEventListener?e.addEventListener(t,n,r):e.attachEvent&&e.attachEvent("on".concat(t),function(){n(window.event)})}function getMods(e,t){for(var n=t.slice(0,t.length-1),r=0;r<n.length;r++)n[r]=e[n[r].toLowerCase()];return n}function getKeys(e){"string"!=typeof e&&(e="");for(var t=(e=e.replace(/\s/g,"")).split(","),n=t.lastIndexOf("");n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function compareArray(e,t){for(var n=e.length>=t.length?e:t,r=e.length>=t.length?t:e,i=!0,o=0;o<n.length;o++)-1===r.indexOf(n[o])&&(i=!1);return i}for(var iQ={backspace:8,"":8,tab:9,clear:12,enter:13,"":13,return:13,esc:27,escape:27,space:32,left:37,up:38,right:39,down:40,del:46,delete:46,ins:45,insert:45,home:36,end:35,pageup:33,pagedown:34,capslock:20,num_0:96,num_1:97,num_2:98,num_3:99,num_4:100,num_5:101,num_6:102,num_7:103,num_8:104,num_9:105,num_multiply:106,num_add:107,num_enter:108,num_subtract:109,num_decimal:110,num_divide:111,"":20,",":188,".":190,"/":191,"`":192,"-":iJ?173:189,"=":iJ?61:187,";":iJ?59:186,"'":222,"[":219,"]":221,"\\":220},i0={"":16,shift:16,"":18,alt:18,option:18,"":17,ctrl:17,control:17,"":91,cmd:91,command:91},i1={16:"shiftKey",18:"altKey",17:"ctrlKey",91:"metaKey",shiftKey:16,ctrlKey:17,altKey:18,metaKey:91},i2={16:!1,18:!1,17:!1,91:!1},i3={},i5=1;i5<20;i5++)iQ["f".concat(i5)]=111+i5;var i6=[],i4=!1,i8="all",i7=[],code=function(e){return iQ[e.toLowerCase()]||i0[e.toLowerCase()]||e.toUpperCase().charCodeAt(0)};function setScope(e){i8=e||"all"}function getScope(){return i8||"all"}function deleteScope(e,t){var n,r;for(var i in e||(e=getScope()),i3)if(Object.prototype.hasOwnProperty.call(i3,i))for(r=0,n=i3[i];r<n.length;)n[r].scope===e?n.splice(r,1):r++;getScope()===e&&setScope(t||"all")}function clearModifier(e){var t=e.keyCode||e.which||e.charCode,n=i6.indexOf(t);if(n>=0&&i6.splice(n,1),e.key&&"meta"===e.key.toLowerCase()&&i6.splice(0,i6.length),(93===t||224===t)&&(t=91),t in i2)for(var r in i2[t]=!1,i0)i0[r]===t&&(hotkeys[r]=!1)}var eachUnbind=function(e){var t=e.key,n=e.scope,r=e.method,i=e.splitKey,o=void 0===i?"+":i;getKeys(t).forEach(function(e){var t=e.split(o),i=t.length,a=t[i-1],l="*"===a?"*":code(a);if(i3[l]){n||(n=getScope());var c=i>1?getMods(i0,t):[];i3[l]=i3[l].filter(function(e){return!((!r||e.method===r)&&e.scope===n&&compareArray(e.mods,c))})}})};function eventHandler(e,t,n,r){var i;if(t.element===r&&(t.scope===n||"all"===t.scope)){for(var o in i=t.mods.length>0,i2)Object.prototype.hasOwnProperty.call(i2,o)&&(!i2[o]&&t.mods.indexOf(+o)>-1||i2[o]&&-1===t.mods.indexOf(+o))&&(i=!1);(0!==t.mods.length||i2[16]||i2[18]||i2[17]||i2[91])&&!i&&"*"!==t.shortcut||(t.keys=[],t.keys=t.keys.concat(i6),!1===t.method(e,t)&&(e.preventDefault?e.preventDefault():e.returnValue=!1,e.stopPropagation&&e.stopPropagation(),e.cancelBubble&&(e.cancelBubble=!0)))}}function dispatch(e,t){var n=i3["*"],r=e.keyCode||e.which||e.charCode;if(hotkeys.filter.call(this,e)){if((93===r||224===r)&&(r=91),-1===i6.indexOf(r)&&229!==r&&i6.push(r),["ctrlKey","altKey","shiftKey","metaKey"].forEach(function(t){var n=i1[t];e[t]&&-1===i6.indexOf(n)?i6.push(n):!e[t]&&i6.indexOf(n)>-1?i6.splice(i6.indexOf(n),1):"metaKey"===t&&e[t]&&3===i6.length&&!(e.ctrlKey||e.shiftKey||e.altKey)&&(i6=i6.slice(i6.indexOf(n)))}),r in i2){for(var i in i2[r]=!0,i0)i0[i]===r&&(hotkeys[i]=!0);if(!n)return}for(var o in i2)Object.prototype.hasOwnProperty.call(i2,o)&&(i2[o]=e[i1[o]]);e.getModifierState&&!(e.altKey&&!e.ctrlKey)&&e.getModifierState("AltGraph")&&(-1===i6.indexOf(17)&&i6.push(17),-1===i6.indexOf(18)&&i6.push(18),i2[17]=!0,i2[18]=!0);var a=getScope();if(n)for(var l=0;l<n.length;l++)n[l].scope===a&&("keydown"===e.type&&n[l].keydown||"keyup"===e.type&&n[l].keyup)&&eventHandler(e,n[l],a,t);if(r in i3){for(var c=0;c<i3[r].length;c++)if(("keydown"===e.type&&i3[r][c].keydown||"keyup"===e.type&&i3[r][c].keyup)&&i3[r][c].key){for(var u=i3[r][c],d=u.splitKey,p=u.key.split(d),h=[],g=0;g<p.length;g++)h.push(code(p[g]));h.sort().join("")===i6.sort().join("")&&eventHandler(e,u,a,t)}}}}function isElementBind(e){return i7.indexOf(e)>-1}function hotkeys(e,t,n){i6=[];var r=getKeys(e),i=[],o="all",a=document,l=0,c=!1,u=!0,d="+",p=!1;for(void 0===n&&"function"==typeof t&&(n=t),"[object Object]"===Object.prototype.toString.call(t)&&(t.scope&&(o=t.scope),t.element&&(a=t.element),t.keyup&&(c=t.keyup),void 0!==t.keydown&&(u=t.keydown),void 0!==t.capture&&(p=t.capture),"string"==typeof t.splitKey&&(d=t.splitKey)),"string"==typeof t&&(o=t);l<r.length;l++)e=r[l].split(d),i=[],e.length>1&&(i=getMods(i0,e)),(e="*"===(e=e[e.length-1])?"*":code(e))in i3||(i3[e]=[]),i3[e].push({keyup:c,keydown:u,scope:o,mods:i,shortcut:r[l],method:n,key:r[l],splitKey:d,element:a});void 0!==a&&!isElementBind(a)&&window&&(i7.push(a),addEvent(a,"keydown",function(e){dispatch(e,a)},p),i4||(i4=!0,addEvent(window,"focus",function(){i6=[]},p)),addEvent(a,"keyup",function(e){dispatch(e,a),clearModifier(e)},p))}var i9={getPressedKeyString:function(){return i6.map(function(e){return Object.keys(iQ).find(function(t){return iQ[t]===e})||Object.keys(i0).find(function(t){return i0[t]===e})||String.fromCharCode(e)})},setScope:setScope,getScope:getScope,deleteScope:deleteScope,getPressedKeyCodes:function(){return i6.slice(0)},getAllKeyCodes:function(){var e=[];return Object.keys(i3).forEach(function(t){i3[t].forEach(function(t){var n=t.key,r=t.scope,i=t.mods,o=t.shortcut;e.push({scope:r,shortcut:o,mods:i,keys:n.split("+").map(function(e){return code(e)})})})}),e},isPressed:function(e){return"string"==typeof e&&(e=code(e)),-1!==i6.indexOf(e)},filter:function(e){var t=e.target||e.srcElement,n=t.tagName,r=!0;return(t.isContentEditable||("INPUT"===n||"TEXTAREA"===n||"SELECT"===n)&&!t.readOnly)&&(r=!1),r},trigger:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"all";Object.keys(i3).forEach(function(n){i3[n].filter(function(n){return n.scope===t&&n.shortcut===e}).forEach(function(e){e&&e.method&&e.method()})})},unbind:function(e){if(void 0===e)Object.keys(i3).forEach(function(e){return delete i3[e]});else if(Array.isArray(e))e.forEach(function(e){e.key&&eachUnbind(e)});else if("object"==typeof e)e.key&&eachUnbind(e);else if("string"==typeof e){for(var t=arguments.length,n=Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];var i=n[0],o=n[1];"function"==typeof i&&(o=i,i=""),eachUnbind({key:e,scope:i,method:o,splitKey:"+"})}},keyMap:iQ,modifier:i0,modifierMap:i1};for(var oe in i9)Object.prototype.hasOwnProperty.call(i9,oe)&&(hotkeys[oe]=i9[oe]);if("undefined"!=typeof window){var ot=window.hotkeys;hotkeys.noConflict=function(e){return e&&window.hotkeys===hotkeys&&(window.hotkeys=ot),hotkeys},window.hotkeys=hotkeys}let on=["copy","cut","paste","asset"];function useKeyboardShortcuts(){let e=(0,I.j)(),t=useReadonly(),n=useActions(),r=useTools(),i=(0,b.Hg)("is focused",()=>e.getInstanceState().isFocused,[e]),{itemsInPanel:o}=useToolbarItems();(0,P.useEffect)(()=>{if(!i)return;let o=e.getContainer();hotkeys.setScope(e.store.id);let hot=(t,n)=>{hotkeys(t,{element:document.body,scope:e.store.id},n)};for(let r of Object.values(n))r.kbd&&(!t||r.readonlyOk)&&(on.includes(r.id)||hot(getHotkeysStringFromKbd(r.kbd),t=>{areShortcutsDisabled(e)||(preventDefault(t),r.onSelect("kbd"))}));for(let t of Object.values(r))t.kbd&&(t.readonlyOk||!e.getInstanceState().isReadonly)&&(on.includes(t.id)||hot(getHotkeysStringFromKbd(t.kbd),n=>{areShortcutsDisabled(e)||(preventDefault(n),t.onSelect("kbd"))}));return hot(",",t=>{if(areShortcutsDisabled(e)||e.inputs.keys.has("Comma"))return;preventDefault(t),o.focus(),e.inputs.keys.add("Comma");let{x:n,y:r,z:i}=e.inputs.currentScreenPoint,a={type:"pointer",name:"pointer_down",point:{x:n,y:r,z:i},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(a)}),hotkeys(",",{element:document.body,keyup:!0,keydown:!1,scope:e.store.id},t=>{if(areShortcutsDisabled(e)||!e.inputs.keys.has("Comma"))return;e.inputs.keys.delete("Comma");let{x:n,y:r,z:i}=e.inputs.currentScreenPoint,o={type:"pointer",name:"pointer_up",point:{x:n,y:r,z:i},shiftKey:t.shiftKey,altKey:t.altKey,ctrlKey:t.metaKey||t.ctrlKey,pointerId:0,button:0,isPen:e.getInstanceState().isPenMode,target:"canvas"};e.dispatch(o)}),()=>{hotkeys.deleteScope(e.store.id)}},[n,r,t,e,i,o])}function getHotkeysStringFromKbd(e){return useKeyboardShortcuts_getKeys(e).map(e=>{let t=e.split("");return 1===t.length?t[0]:"!"===t[0]?`shift+${t[1]}`:"?"===t[0]?3===t.length&&"!"===t[1]?`alt+shift+${t[2]}`:`alt+${t[1]}`:"$"===t[0]?"!"===t[1]?`cmd+shift+${t[2]},ctrl+shift+${t[2]}`:"?"===t[1]?`cmd+\u2325+${t[2]},ctrl+alt+${t[2]}`:`cmd+${t[1]},ctrl+${t[1]}`:e}).join(",")}function useKeyboardShortcuts_getKeys(e){"string"!=typeof e&&(e=""),e=e.replace(/\s/g,"");let t=e.split(","),n=t.lastIndexOf("");for(;n>=0;)t[n-1]+=",",t.splice(n,1),n=t.lastIndexOf("");return t}function areShortcutsDisabled(e){return e.getIsMenuOpen()||null!==e.getEditingShapeId()||e.getCrashingError()}function toolbarItem(e){return{id:e.id,type:"item",readonlyOk:e.readonlyOk,toolItem:e}}let or=P.createContext([]);function ToolbarSchemaProvider({overrides:e,children:t}){let n=(0,I.j)(),r=useTools(),i=P.useMemo(()=>{let t=(0,v.oA)([toolbarItem(r.select),toolbarItem(r.hand),toolbarItem(r.draw),toolbarItem(r.eraser),toolbarItem(r.arrow),toolbarItem(r.text),toolbarItem(r.note),toolbarItem(r.asset),toolbarItem(r.rectangle),toolbarItem(r.ellipse),toolbarItem(r.diamond),toolbarItem(r.triangle),toolbarItem(r.trapezoid),toolbarItem(r.rhombus),toolbarItem(r.hexagon),toolbarItem(r.cloud),toolbarItem(r.star),toolbarItem(r.oval),toolbarItem(r["x-box"]),toolbarItem(r["check-box"]),toolbarItem(r["arrow-left"]),toolbarItem(r["arrow-up"]),toolbarItem(r["arrow-down"]),toolbarItem(r["arrow-right"]),toolbarItem(r.line),toolbarItem(r.highlight),toolbarItem(r.frame),toolbarItem(r.laser)]);return e?e(n,t,{tools:r}):t},[n,e,r]);return(0,T.jsx)(or.Provider,{value:i,children:t})}function useToolbarSchema(){let e=P.useContext(or);if(!e)throw Error("useToolbarSchema must be used within a ToolbarSchemaProvider");return e}function MobileStylePanel(){let e=(0,I.j)(),t=useTranslation(),n=useRelevantStyles(),r=n?.get(S.R_),i=(0,S.y6)({isDarkMode:e.user.getIsDarkMode()}),o=(r?.type==="shared"?i[r.value]:i.black).solid,a=(0,b.Hg)("disable style panel",()=>e.isInAny("hand","zoom","eraser","laser"),[e]),l=(0,P.useCallback)(t=>{t||e.updateInstanceState({isChangingStyle:!1},{ephemeral:!0})},[e]),{StylePanel:c}=useTldrawUiComponents();return c?(0,T.jsxs)(TldrawUiPopover,{id:"mobile style menu",onOpenChange:l,children:[(0,T.jsx)(TldrawUiPopoverTrigger,{children:(0,T.jsx)(nK,{type:"tool","data-testid":"mobile-styles.button",style:{color:a?"var(--color-muted-1)":o},title:t("style-panel.title"),disabled:a,children:(0,T.jsx)(TldrawUiButtonIcon,{icon:a?"blob":r?.type==="mixed"?"mixed":"blob"})})}),(0,T.jsx)(TldrawUiPopoverContent,{side:"top",align:"end",children:c&&(0,T.jsx)(c,{isMobile:!0})})]}):null}let oi=["select","hand","draw","eraser","text","zoom","laser","highlight"];function ToggleToolLockedButton({activeToolId:e}){let t=(0,I.j)(),n=useBreakpoint(),r=useTranslation(),i=(0,b.Hg)("is tool locked",()=>t.getInstanceState().isToolLocked,[t]);return!e||oi.includes(e)?null:(0,T.jsx)(nK,{type:"normal",title:r("action.toggle-tool-lock"),"data-testid":"tool-lock",className:C("tlui-toolbar__lock-button",{"tlui-toolbar__lock-button__mobile":n<nz.TABLET_SM}),onClick:()=>t.updateInstanceState({isToolLocked:!i}),children:(0,T.jsx)(TldrawUiButtonIcon,{icon:i?"lock":"unlock",small:!0})})}let oo=(0,P.memo)(function(){let e=(0,I.j)(),t=useTranslation(),n=useBreakpoint(),r=P.useRef(void 0),i=useReadonly(),o=useToolbarSchema(),a=(0,b.Hg)("current tool id",()=>e.getCurrentToolId(),[e]),l=(0,b.Hg)("geo",()=>e.getSharedStyles().getAsKnownValue(S.Zu),[e]),getTitle=e=>e.label?`${t(e.label)} ${e.kbd?kbdStr(e.kbd):""}`:"",c=o.find(e=>isActiveTLUiToolItem(e.toolItem,a,l)),{itemsInPanel:u,itemsInDropdown:d}=useToolbarItems(),p=(0,P.useMemo)(()=>{let e=d.find(e=>e===c);return e||(r.current||(r.current=d[0]),e=r.current,d.includes(e)||(e=d[0])),r.current=e,e},[c,d]);(0,P.useEffect)(()=>{let t=[...u,p];for(let n=0;n<Math.min(10,t.length);n++){let r=`${n+1}`.slice(-1);hotkeys(r,r=>{areShortcutsDisabled(e)||(preventDefault(r),t[n].toolItem.onSelect("kbd"))})}return()=>{hotkeys.unbind("1,2,3,4,5,6,7,8,9,0")}},[p,e,u]);let{ActionsMenu:h,QuickActions:g}=useTldrawUiComponents();return(0,T.jsx)("div",{className:"tlui-toolbar",children:(0,T.jsxs)("div",{className:"tlui-toolbar__inner",children:[(0,T.jsxs)("div",{className:"tlui-toolbar__left",children:[!i&&(0,T.jsxs)("div",{className:"tlui-toolbar__extras",children:[n<nz.TABLET&&(0,T.jsxs)("div",{className:"tlui-toolbar__extras__controls tlui-buttons__horizontal",children:[g&&(0,T.jsx)(g,{}),h&&(0,T.jsx)(h,{})]}),(0,T.jsx)(ToggleToolLockedButton,{activeToolId:a})]}),(0,T.jsxs)("div",{className:C("tlui-toolbar__tools",{"tlui-toolbar__tools__mobile":n<nz.TABLET_SM}),children:[u.map(({toolItem:e})=>(0,T.jsx)(ToolbarButton,{item:e,title:getTitle(e),isSelected:isActiveTLUiToolItem(e,a,l)},e.id)),d.length?(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(ToolbarButton,{item:p.toolItem,title:getTitle(p.toolItem),isSelected:isActiveTLUiToolItem(p.toolItem,a,l)},p.toolItem.id),(0,T.jsxs)(TldrawUiDropdownMenuRoot,{id:"toolbar overflow",modal:!1,children:[(0,T.jsx)(TldrawUiDropdownMenuTrigger,{children:(0,T.jsx)(nK,{title:t("tool-panel.more"),type:"tool",className:"tlui-toolbar__overflow","data-testid":"tools.more-button",children:(0,T.jsx)(TldrawUiButtonIcon,{icon:"chevron-up"})})}),(0,T.jsx)(TldrawUiDropdownMenuContent,{side:"top",align:"center",children:(0,T.jsx)(oa,{toolbarItems:d})})]})]}):null]})]}),n<nz.TABLET_SM&&!i&&(0,T.jsx)("div",{className:"tlui-toolbar__tools",children:(0,T.jsx)(MobileStylePanel,{})})]})})}),oa=(0,b.j)(function({toolbarItems:e}){let t=useTranslation();return(0,T.jsx)("div",{className:"tlui-buttons__grid","data-testid":"tools.more-content",children:e.map(({toolItem:{id:e,meta:n,kbd:r,label:i,onSelect:o,icon:a}})=>(0,T.jsx)(TldrawUiDropdownMenuItem,{"data-tool":e,"data-geo":n?.geo??"","aria-label":i,children:(0,T.jsx)(nK,{type:"icon",className:"tlui-button-grid__button",onClick:()=>o("toolbar"),"data-testid":`tools.more.${e}`,title:i?`${t(i)} ${r?kbdStr(r):""}`:"",children:(0,T.jsx)(TldrawUiButtonIcon,{icon:a})})},e))})});function ToolbarButton({item:e,title:t,isSelected:n}){return(0,T.jsx)(nK,{type:"tool","data-testid":`tools.${e.id}`,"data-tool":e.id,"data-geo":e.meta?.geo??"","aria-label":e.label,"data-state":n?"selected":void 0,onClick:()=>e.onSelect("toolbar"),title:t,onTouchStart:t=>{preventDefault(t),e.onSelect("toolbar")},children:(0,T.jsx)(TldrawUiButtonIcon,{icon:e.icon})})}let isActiveTLUiToolItem=(e,t,n)=>e.meta?.geo?"geo"===t&&n===e.meta?.geo:t===e.id;function useToolbarItems(){let e=useBreakpoint(),t=useToolbarSchema(),n=useReadonly();return(0,P.useMemo)(()=>{let r=t.filter(e=>!n||e.readonlyOk),i=Math.min(8,5+e),o=r.slice(0,i),a=r.slice(i);return a.length<=2?{itemsInPanel:r,itemsInDropdown:[]}:{itemsInPanel:o,itemsInDropdown:a}},[t,e,n])}function DefaultZoomMenuContent(){let e=useActions();return(0,T.jsxs)(T.Fragment,{children:[(0,T.jsx)(TldrawUiMenuItem,{...e["zoom-in"],noClose:!0}),(0,T.jsx)(TldrawUiMenuItem,{...e["zoom-out"],noClose:!0}),(0,T.jsx)(menu_items_ZoomTo100MenuItem,{}),(0,T.jsx)(ZoomToFitMenuItem,{}),(0,T.jsx)(ZoomToSelectionMenuItem,{})]})}let os=(0,P.memo)(function({children:e}){let t=useContainer(),[n,r]=useMenuIsOpen("zoom menu"),i=e??(0,T.jsx)(DefaultZoomMenuContent,{});return(0,T.jsxs)(ir.fC,{dir:"ltr",open:n,onOpenChange:r,modal:!1,children:[(0,T.jsx)(ir.xz,{asChild:!0,dir:"ltr",children:(0,T.jsx)(ol,{})}),(0,T.jsx)(ir.Uv,{container:t,children:(0,T.jsx)(ir.VY,{className:"tlui-menu",side:"top",align:"start",alignOffset:0,sideOffset:8,collisionPadding:4,children:(0,T.jsx)(TldrawUiMenuContextProvider,{type:"menu",sourceId:"zoom-menu",children:i})})})]})}),ol=(0,P.forwardRef)(function(e,t){let n=(0,I.j)(),r=useBreakpoint(),i=(0,b.Hg)("zoom",()=>n.getZoomLevel(),[n]),o=useTranslation(),a=(0,P.useCallback)(()=>{n.resetZoom(n.getViewportScreenCenter(),{duration:_.KD})},[n]);return(0,T.jsx)(nK,{ref:t,...e,type:"icon",title:`${o("navigation-zone.zoom")}`,"data-testid":"minimap.zoom-menu-button",className:r<nz.TABLET_SM?"tlui-zoom-menu__button":"tlui-zoom-menu__button__pct",onDoubleClick:a,icon:r<nz.MOBILE?"zoom-in":void 0,children:r<nz.MOBILE?null:(0,T.jsxs)("span",{style:{flexGrow:0,textAlign:"center"},children:[Math.floor(100*i),"%"]})})}),oc=(0,P.createContext)({});function TldrawUiComponentsProvider({overrides:e={},children:t}){let n=useShallowObjectIdentity(e);return(0,T.jsx)(oc.Provider,{value:(0,P.useMemo)(()=>({ContextMenu:io,ActionsMenu:ii,HelpMenu:ic,ZoomMenu:os,MainMenu:ip,Minimap:DefaultMinimap,StylePanel:iX,PageMenu:iy,NavigationPanel:ig,Toolbar:oo,KeyboardShortcutsDialog:id,QuickActions:ib,HelperButtons:DefaultHelperButtons,DebugMenu:DefaultDebugMenu,MenuPanel:ih,...n}),[n]),children:t})}function useTldrawUiComponents(){return(0,P.useContext)(oc)}let ou=(0,P.memo)(function(){let{DebugMenu:e}=useTldrawUiComponents();return(0,T.jsxs)("div",{className:"tlui-debug-panel",children:[(0,T.jsx)(od,{}),(0,T.jsx)(FPS,{}),e&&(0,T.jsx)(e,{})]})});function DebugPanel_useTick(e=!0){let[t,n]=(0,P.useState)(0),r=(0,I.j)();(0,P.useEffect)(()=>{if(!e)return;let update=()=>n(e=>e+1);return r.on("tick",update),()=>{r.off("tick",update)}},[r,e])}let od=(0,b.j)(function(){DebugPanel_useTick();let e=(0,I.j)(),t=e.getPath(),n=e.getHoveredShape(),r=e.getOnlySelectedShape(),i="select.idle"!==t&&t.includes("select.")?r:n,o=i&&t.includes("select.")?` / ${i.type||""}${"geo"in i.props?" / "+i.props.geo:""} / [${et.B.ToFixed(e.getPointInShapeSpace(i,e.inputs.currentPagePoint),0)}]`:"",a=t.startsWith("select.")&&!t.includes(".idle")?` / [${et.B.ToFixed(e.inputs.originPagePoint,0)}] \u2192 [${et.B.ToFixed(e.inputs.currentPagePoint,0)}] = ${et.B.Dist(e.inputs.originPagePoint,e.inputs.currentPagePoint).toFixed(0)}`:"";return(0,T.jsx)("div",{className:"tlui-debug-panel__current-state",children:`${t}${o}${a}`})});function FPS(){let e=(0,b.Hg)("show_fps",()=>$.showFps.get(),[$]),t=(0,P.useRef)(null);return((0,P.useEffect)(()=>{if(!e)return;let n=0,r=!1,i=performance.now(),o=0,a=0,l=!1;function loop(){if(!r){if(a++,(o=performance.now()-i)>250){let e=Math.round(a*(250/o)*4);e>n&&(n=e);let r=.75*n;(e<r&&!l||e>=r&&l)&&(l=!l),t.current.innerHTML=`FPS ${e.toString()}`,t.current.className="tlui-debug-panel__fps"+(l?" tlui-debug-panel__fps__slow":""),o-=250,a=0,i=performance.now()}requestAnimationFrame(loop)}}return loop(),()=>{r=!0}},[e]),e)?(0,T.jsx)("div",{ref:t}):null}let Dialog=({id:e,component:t,onClose:n})=>{let{removeDialog:r}=useDialogs(),i=useContainer(),o=(0,P.useCallback)(t=>{if(!t){if(n)try{n()}catch(e){console.warn(e)}r(e)}},[e,n,r]);return(0,T.jsx)($5d3850c4d0b4e6c7$export$be92b6f5f03c0fe9,{onOpenChange:o,defaultOpen:!0,children:(0,T.jsx)($5d3850c4d0b4e6c7$export$602eac185826482c,{container:i,children:(0,T.jsx)(rw,{dir:"ltr",className:"tlui-dialog__overlay",onClick:e=>{e.target===e.currentTarget&&o(!1)},children:(0,T.jsx)(rx,{dir:"ltr",className:"tlui-dialog__content",children:(0,T.jsx)(t,{onClose:()=>o(!1)})})})})})};function _Dialogs(){let{dialogs:e}=useDialogs();return(0,T.jsx)(T.Fragment,{children:e.map(e=>(0,T.jsx)(Dialog,{...e},e.id))})}let op=P.memo(_Dialogs);function FollowingIndicator(){let e=(0,I.j)(),t=(0,b.Hg)("follow",()=>e.getInstanceState().followingUserId,[e]);return t?(0,T.jsx)(FollowingIndicatorInner,{userId:t}):null}function FollowingIndicatorInner({userId:e}){let t=usePresence(e);return t?(0,T.jsx)("div",{className:"tlui-following-indicator",style:{borderColor:t.color}}):null}function Toast({toast:e}){let{removeToast:t}=useToasts(),n=useTranslation(),r=e.actions&&e.actions.length>0;return(0,T.jsxs)(nj,{onOpenChange:n=>{n||t(e.id)},className:"tlui-toast__container",duration:e.keepOpen?1/0:5e3,children:[e.icon&&(0,T.jsx)("div",{className:"tlui-toast__icon",children:(0,T.jsx)(nY,{icon:e.icon})}),(0,T.jsxs)("div",{className:"tlui-toast__main",children:[(0,T.jsxs)("div",{className:"tlui-toast__content",children:[e.title&&(0,T.jsx)(nO,{className:"tlui-toast__title",children:e.title}),e.description&&(0,T.jsx)(nB,{className:"tlui-toast__description",children:e.description})]}),e.actions&&(0,T.jsxs)("div",{className:"tlui-toast__actions",children:[e.actions.map((e,t)=>(0,T.jsx)(nF,{altText:e.label,asChild:!0,onClick:e.onClick,children:(0,T.jsx)(nK,{type:e.type,children:(0,T.jsx)(TldrawUiButtonLabel,{children:e.label})})},t)),(0,T.jsx)(nU,{asChild:!0,children:(0,T.jsx)(nK,{type:"normal",className:"tlui-toast__close",style:{marginLeft:"auto"},children:(0,T.jsx)(TldrawUiButtonLabel,{children:e.closeLabel??n("toast.close")})})})]})]}),!r&&(0,T.jsx)(nU,{asChild:!0,children:(0,T.jsx)(nK,{type:"normal",className:"tlui-toast__close",children:(0,T.jsx)(TldrawUiButtonLabel,{children:e.closeLabel??n("toast.close")})})})]})}function _Toasts(){let{toasts:e}=useToasts();return(0,T.jsx)(T.Fragment,{children:e.map(e=>(0,T.jsx)(Toast,{toast:e},e.id))})}let oh=P.memo(_Toasts);function ToastViewport(){let{toasts:e}=useToasts(),[t,n]=P.useState(!1);return(P.useEffect(()=>{let t=!1;return e.length?n(!0):setTimeout(()=>{t||n(!1)},1e3),()=>{t=!0}},[e.length,n]),t)?(0,T.jsx)(nE,{className:"tlui-toast__viewport"}):null}let og="2.0.2",of={fonts:{draw:`https://unpkg.com/@tldraw/assets@${og}/fonts/Shantell_Sans-Tldrawish.woff2`,serif:`https://unpkg.com/@tldraw/assets@${og}/fonts/IBMPlexSerif-Medium.woff2`,sansSerif:`https://unpkg.com/@tldraw/assets@${og}/fonts/IBMPlexSans-Medium.woff2`,monospace:`https://unpkg.com/@tldraw/assets@${og}/fonts/IBMPlexMono-Medium.woff2`}};function setDefaultEditorAssetUrls(e){of=e}function useDefaultEditorAssetsWithOverrides(e){return(0,P.useMemo)(()=>e?{fonts:{...of.fonts,...e?.fonts}}:of,[e])}let om={...of,icons:Object.fromEntries(["align-bottom-center","align-bottom-left","align-bottom-right","align-bottom","align-center-center","align-center-horizontal","align-center-left","align-center-right","align-center-vertical","align-left","align-right","align-top-center","align-top-left","align-top-right","align-top","arrow-left","arrowhead-arrow","arrowhead-bar","arrowhead-diamond","arrowhead-dot","arrowhead-none","arrowhead-square","arrowhead-triangle-inverted","arrowhead-triangle","aspect-ratio","avatar","blob","bring-forward","bring-to-front","check","checkbox-checked","checkbox-empty","chevron-down","chevron-left","chevron-right","chevron-up","chevrons-ne","chevrons-sw","clipboard-copied","clipboard-copy","code","collab","color","comment","cross-2","cross","dash-dashed","dash-dotted","dash-draw","dash-solid","discord","distribute-horizontal","distribute-vertical","dot","dots-horizontal","dots-vertical","drag-handle-dots","duplicate","edit","external-link","file","fill-none","fill-pattern","fill-semi","fill-solid","follow","following","font-draw","font-mono","font-sans","font-serif","geo-arrow-down","geo-arrow-left","geo-arrow-right","geo-arrow-up","geo-check-box","geo-cloud","geo-diamond","geo-ellipse","geo-hexagon","geo-octagon","geo-oval","geo-pentagon","geo-rectangle","geo-rhombus-2","geo-rhombus","geo-star","geo-trapezoid","geo-triangle","geo-x-box","github","group","hidden","image","info-circle","leading","link","lock-small","lock","menu","minus","mixed","pack","page","plus","question-mark-circle","question-mark","redo","reset-zoom","rotate-ccw","rotate-cw","ruler","search","send-backward","send-to-back","settings-horizontal","settings-vertical-1","settings-vertical","share-1","share-2","size-extra-large","size-large","size-medium","size-small","spline-cubic","spline-line","stack-horizontal","stack-vertical","status-offline","status-online","stretch-horizontal","stretch-vertical","text-align-center","text-align-justify","text-align-left","text-align-right","tool-arrow","tool-embed","tool-eraser","tool-frame","tool-hand","tool-highlight","tool-laser","tool-line","tool-media","tool-note","tool-pencil","tool-pointer","tool-text","trash","triangle-down","triangle-up","twitter","undo","ungroup","unlock-small","unlock","vertical-align-center","vertical-align-end","vertical-align-start","visible","warning-triangle","zoom-in","zoom-out"].map(e=>[e,`https://unpkg.com/@tldraw/assets@${og}/icons/icon/${e}.svg`])),translations:Object.fromEntries(S.a2.map(e=>[e.locale,`https://unpkg.com/@tldraw/assets@${og}/translations/${e.locale}.json`])),embedIcons:Object.fromEntries(S.Lu.map(e=>[e.type,`https://unpkg.com/@tldraw/assets@${og}/embed-icons/${e.type}.png`]))};function setDefaultUiAssetUrls(e){om=e}function useDefaultUiAssetUrlsWithOverrides(e){return e?{fonts:Object.assign({...om.fonts},{...e?.fonts}),icons:Object.assign({...om.icons},{...e?.icons}),embedIcons:Object.assign({...om.embedIcons},{...e?.embedIcons}),translations:Object.assign({...om.translations},{...e?.translations})}:om}function useDefaultHelpers(){let{addToast:e,removeToast:t,clearToasts:n}=useToasts(),{addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:a}=useDialogs(),l=useBreakpoint(),c=l<nz.TABLET_SM,u=useTranslation();return(0,P.useMemo)(()=>({addToast:e,removeToast:t,clearToasts:n,addDialog:r,clearDialogs:i,removeDialog:o,updateDialog:a,msg:u,isMobile:c}),[r,e,i,n,u,o,t,a,c])}function mergeOverrides(e,t){let n={};for(let t of e)if(t.translations)for(let[e,r]of(0,v.EP)(t.translations)){let t=n[e];t||(t=n[e]={}),Object.assign(t,r)}return{actions:(n,r)=>{for(let i of e)i.actions&&(r=i.actions(n,r,t));return r},toolbar:(n,r,i)=>{for(let o of e)o.toolbar&&(r=o.toolbar(n,r,{...t,...i}));return r},tools:(n,r,i)=>{for(let o of e)o.tools&&(r=o.tools(n,r,{...t,...i}));return r},translations:n}}function useShallowArrayEquality(e){return(0,P.useMemo)(()=>e,e)}function useMergedTranslationOverrides(e){let t=useShallowArrayEquality(null==e?[]:Array.isArray(e)?e:[e]);return(0,P.useMemo)(()=>{let e={};for(let n of t)if(n.translations)for(let[t,r]of(0,v.EP)(n.translations)){let n=e[t];n||(n=e[t]={}),Object.assign(n,r)}return e},[t])}function useMergedOverrides(e){let t=useDefaultHelpers(),n=useShallowArrayEquality(null==e?[]:Array.isArray(e)?e:[e]);return(0,P.useMemo)(()=>mergeOverrides(n,t),[n,t])}function TldrawUiContextProvider({overrides:e,components:t,assetUrls:n,onUiEvent:r,forceMobile:i,children:o}){return(0,T.jsx)(AssetUrlsProvider,{assetUrls:useDefaultUiAssetUrlsWithOverrides(n),children:(0,T.jsx)(nZ,{overrides:useMergedTranslationOverrides(e),children:(0,T.jsx)(UiEventsProvider,{onEvent:r,children:(0,T.jsx)(ToastsProvider,{children:(0,T.jsx)(DialogsProvider,{children:(0,T.jsx)(BreakPointProvider,{forceMobile:i,children:(0,T.jsx)(TldrawUiComponentsProvider,{overrides:t,children:(0,T.jsx)(InternalProviders,{overrides:e,children:o})})})})})})})})}function InternalProviders({overrides:e,children:t}){let n=useMergedOverrides(e);return(0,T.jsx)(ActionsProvider,{overrides:n.actions,children:(0,T.jsx)(ToolsProvider,{overrides:n.tools,children:(0,T.jsx)(ToolbarSchemaProvider,{overrides:n.toolbar,children:t})})})}function useEditorEvents(){let e=(0,I.j)(),{addToast:t}=useToasts();(0,P.useEffect)(()=>{function handleMaxShapes({name:e,count:n}){t({title:"Maximum Shapes Reached",description:`You've reached the maximum number of shapes allowed on ${e} (${n}). Please delete some shapes or move to a different page to continue.`})}return e.addListener("max-shapes",handleMaxShapes),()=>{e.removeListener("max-shapes",handleMaxShapes)}},[e,t])}let oy=P.memo(function({renderDebugMenuItems:e,children:t,hideUi:n,components:r,...i}){return(0,T.jsx)(TldrawUiContextProvider,{...i,components:r,children:(0,T.jsx)(ob,{hideUi:n,renderDebugMenuItems:e,children:t})})}),ob=P.memo(function({children:e,hideUi:t,...n}){return(0,T.jsxs)(T.Fragment,{children:[e,t?null:(0,T.jsx)(ow,{...n})]})}),ow=P.memo(function(){let e=(0,I.j)(),t=useTranslation(),n=useBreakpoint(),r=useReadonly(),i=(0,b.Hg)("focus",()=>e.getInstanceState().isFocusMode,[e]),o=(0,b.Hg)("debug",()=>e.getInstanceState().isDebugMode,[e]),{SharePanel:a,TopPanel:l,MenuPanel:c,StylePanel:u,Toolbar:d,HelpMenu:p,NavigationPanel:h,HelperButtons:g}=useTldrawUiComponents();useKeyboardShortcuts(),useNativeClipboardEvents(),useEditorEvents();let{"toggle-focus-mode":f}=useActions();return(0,T.jsx)($054eb8030ebde76e$export$f5d03d415824e0e,{children:(0,T.jsxs)("div",{className:C("tlui-layout",{"tlui-layout__mobile":n<nz.TABLET_SM}),"data-breakpoint":n,children:[i?(0,T.jsx)("div",{className:"tlui-layout__top",children:(0,T.jsx)(nK,{type:"icon",className:"tlui-focus-button",title:t("focus-mode.toggle-focus-mode"),onClick:()=>f.onSelect("menu"),children:(0,T.jsx)(TldrawUiButtonIcon,{icon:"dot"})})}):(0,T.jsxs)(T.Fragment,{children:[(0,T.jsxs)("div",{className:"tlui-layout__top",children:[(0,T.jsxs)("div",{className:"tlui-layout__top__left",children:[c&&(0,T.jsx)(c,{}),g&&(0,T.jsx)(g,{})]}),(0,T.jsx)("div",{className:"tlui-layout__top__center",children:l&&(0,T.jsx)(l,{})}),(0,T.jsxs)("div",{className:"tlui-layout__top__right",children:[a&&(0,T.jsx)(a,{}),u&&n>=nz.TABLET_SM&&!r&&(0,T.jsx)(u,{})]})]}),(0,T.jsxs)("div",{className:"tlui-layout__bottom",children:[(0,T.jsxs)("div",{className:"tlui-layout__bottom__main",children:[h&&(0,T.jsx)(h,{}),d&&(0,T.jsx)(d,{}),p&&(0,T.jsx)(p,{})]}),o&&(0,T.jsx)(ou,{})]})]}),(0,T.jsx)(oh,{}),(0,T.jsx)(op,{}),(0,T.jsx)(ToastViewport,{}),(0,T.jsx)(FollowingIndicator,{})]})})});var oS=((c=oS||{})[c.SUCCESS=0]="SUCCESS",c[c.FAILED=1]="FAILED",c[c.WAITING=2]="WAITING",c);let usePreloadFont=(e,t)=>{let[n,r]=(0,P.useState)(2);return(0,P.useEffect)(()=>{let n=!1;return r(2),preloadFont(e,t).then(()=>{n||r(0)}).catch(e=>{n||(console.error(e),r(1))}),()=>{n=!0}},[e,t]),n};function getTypefaces(e){return{draw:{url:e.fonts.draw,format:e.fonts.draw.split(".").pop()},serif:{url:e.fonts.serif,format:e.fonts.serif.split(".").pop()},sansSerif:{url:e.fonts.sansSerif,format:e.fonts.sansSerif.split(".").pop()},monospace:{url:e.fonts.monospace,format:e.fonts.monospace.split(".").pop()}}}function usePreloadAssets(e){let t=(0,P.useMemo)(()=>getTypefaces(e),[e]),n=[usePreloadFont("tldraw_draw",t.draw),usePreloadFont("tldraw_serif",t.serif),usePreloadFont("tldraw_sans",t.sansSerif),usePreloadFont("tldraw_mono",t.monospace)];return{error:n.some(e=>1===e),done:!n.some(e=>2===e)}}function Tldraw(e){let{children:t,maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:a,components:l={},shapeUtils:c=[],tools:u=[],...d}=e,p=useShallowObjectIdentity(l),h=(0,P.useMemo)(()=>({Scribble:TldrawScribble,CollaboratorScribble:TldrawScribble,SelectionForeground:ty,SelectionBackground:TldrawSelectionBackground,Handles:TldrawHandles,HoveredShapeIndicator:TldrawHoveredShapeIndicator,...p}),[p]),g=useShallowArrayIdentity(c),f=(0,P.useMemo)(()=>[...t6,...g],[g]),m=useShallowArrayIdentity(u),y=(0,P.useMemo)(()=>[...nn,...tD,...m],[m]),b=useDefaultEditorAssetsWithOverrides(d.assetUrls),{done:w,error:S}=usePreloadAssets(b);return S?(0,T.jsx)(ErrorScreen,{children:"Could not load assets. Please refresh the page."}):w?(0,T.jsx)(e1,{initialState:"select",...d,components:h,shapeUtils:f,tools:y,children:(0,T.jsxs)(oy,{...d,components:h,children:[(0,T.jsx)(InsideOfEditorAndUiContext,{maxImageDimension:n,maxAssetSize:r,acceptedImageMimeTypes:i,acceptedVideoMimeTypes:o,onMount:a}),t]})}):(0,T.jsx)(LoadingScreen,{children:"Loading assets..."})}let ov=Object.freeze(["image/jpeg","image/png","image/gif","image/svg+xml"]),ox=Object.freeze(["video/mp4","video/quicktime"]);function InsideOfEditorAndUiContext({maxImageDimension:e=1e3,maxAssetSize:t=10485760,acceptedImageMimeTypes:n=ov,acceptedVideoMimeTypes:r=ox,onMount:i}){let o=(0,I.j)(),a=useToasts(),l=useTranslation(),c=Tldraw_useEvent(o=>{let c=[];return c.push(...registerDefaultSideEffects(o)),registerDefaultExternalContentHandlers(o,{maxImageDimension:e,maxAssetSize:t,acceptedImageMimeTypes:n,acceptedVideoMimeTypes:r},{toasts:a,msg:l}),c.push(i?.(o)),()=>{c.forEach(e=>e?.())}});(0,P.useLayoutEffect)(()=>{if(o)return c?.(o)},[o,c]);let{Canvas:u}=useEditorComponents(),{ContextMenu:d}=useTldrawUiComponents();return d?(0,T.jsx)(d,{}):u?(0,T.jsx)(u,{}):null}function Tldraw_useEvent(e){let t=(0,P.useRef)();return(0,P.useLayoutEffect)(()=>{t.current=e}),(0,P.useDebugValue)(e),(0,P.useCallback)((...e)=>{let n=t.current;return(0,v.hu)(n,"fn does not exist"),n(...e)},[])}let oT=(0,P.memo)(function(e){let[t,n]=(0,P.useState)(null),[r,i]=(0,P.useState)(null),o=useShallowArrayIdentity(e.shapeUtils??[]),a=(0,P.useMemo)(()=>[...t6,...o],[o]),l=useTLStore({snapshot:e.snapshot,shapeUtils:a}),c=useDefaultEditorAssetsWithOverrides(),{done:u,error:d}=usePreloadAssets(c),{pageId:p,bounds:h,scale:g,background:f,padding:m,darkMode:y,preserveAspectRatio:b,format:w="svg"}=e;return((0,P.useLayoutEffect)(()=>{if(!r||!l||!u)return;let e=!1,t=document.createElement("div");r.appendChild(t),r.classList.add("tl-container","tl-theme__light");let i=new eP.M({store:l,shapeUtils:a??[],tools:[],getContainer:()=>t});p&&i.setCurrentPage(p);let o=i.getCurrentPageShapeIds();return async function(){let t=await i.getSvg([...o],{bounds:h,scale:g,background:f,padding:m,darkMode:y,preserveAspectRatio:b});if(t&&!e){if("svg"===w){let r=await getSvgAsString(t);if(!e){let e=new Blob([r],{type:"image/svg+xml"}),t=URL.createObjectURL(e);n(t)}}else if("png"===w){let r=await getSvgAsImage(t,i.environment.isSafari,{type:w,quality:1,scale:2});if(r&&!e){let e=URL.createObjectURL(r);n(e)}}}i.dispose()}(),()=>{e=!0}},[w,r,l,a,p,h,g,f,m,y,b,u,d]),d)?(0,T.jsx)(ErrorScreen,{children:"Could not load assets."}):u?(0,T.jsx)("div",{ref:i,style:{position:"relative",width:"100%",height:"100%"},children:t&&(0,T.jsx)("img",{src:t,style:{width:"100%",height:"100%"}})}):(0,T.jsx)(LoadingScreen,{children:"Loading assets..."})});function OfflineIndicator(){let e=useTranslation(),t=(0,P.useRef)(null);return(0,T.jsxs)("div",{className:C("tlui-offline-indicator"),ref:t,children:[e("status.offline"),(0,T.jsx)(nY,{"aria-label":"offline",icon:"status-offline",small:!0})]})}function buildFromV1Document(e,t){e.batch(()=>{t=migrate(t,15.5),e.cancel().cancel().cancel().cancel();let n=e.getPages()[0].id;for(let t of(e.setCurrentPage(n),e.getPages().slice(1)))e.deletePage(t.id);e.selectAll(),e.deleteShapes(e.getSelectedShapeIds());let r=new Map;Object.values(t.assets??{}).forEach(t=>{switch(t.type){case"image":{let n=S.Yk.createId();r.set(t.id,n);let i={id:n,typeName:"asset",type:"image",props:{w:coerceDimension(t.size[0]),h:coerceDimension(t.size[1]),name:t.fileName??"Untitled",isAnimated:!1,mimeType:null,src:t.src},meta:{}};e.createAssets([i]),tryMigrateAsset(e,i);break}case"video":{let n=S.Yk.createId();r.set(t.id,n),e.createAssets([{id:n,typeName:"asset",type:"video",props:{w:coerceDimension(t.size[0]),h:coerceDimension(t.size[1]),name:t.fileName??"Untitled",isAnimated:!0,mimeType:null,src:t.src},meta:{}}])}}});let i=new Map;Object.values(t.pages??{}).sort((e,t)=>(e.childIndex??1)<(t.childIndex??1)?-1:1).forEach((t,n)=>{if(0===n)i.set(t.id,e.getCurrentPageId());else{let n=S.ez.createId();i.set(t.id,n),e.createPage({name:t.name??"Page",id:n})}}),Object.values(t.pages??{}).sort((e,t)=>(e.childIndex??1)<(t.childIndex??1)?-1:1).forEach(t=>{e.setCurrentPage(i.get(t.id));let n=new Map,o=new Map,a=Object.values(t.shapes??{}).sort((e,t)=>e.childIndex<t.childIndex?-1:1).slice(0,_.kx);function decideNotToCreateShape(e){n.delete(e.id);let t=o.has(e.parentId);if(t){let t=o.get(e.parentId).filter(t=>t!==e.id);o.set(e.parentId,t)}}a.forEach(e=>{if("group"!==e.type)return;let t=(0,S.F1)();n.set(e.id,t),o.set(e.id,[])}),a.forEach(a=>{if("group"===a.type)return;let l=(0,S.F1)();n.set(a.id,l),a.parentId!==t.id&&(o.has(a.parentId)?o.get(a.parentId).push(a.id):console.warn("parent does not exist",a));let c=i.get(t.id),u={id:l,parentId:c,x:coerceNumber(a.point[0]),y:coerceNumber(a.point[1]),rotation:0,isLocked:!!a.isLocked};switch(a.type){case"sticky":e.createShapes([{...u,type:"note",props:{text:a.text??"",color:getV2Color(a.style.color),size:getV2Size(a.style.size),font:getV2Font(a.style.font),align:getV2Align(a.style.textAlign)}}]);break;case"rectangle":{e.createShapes([{...u,type:"geo",props:{geo:"rectangle",w:coerceDimension(a.size[0]),h:coerceDimension(a.size[1]),text:a.label??"",fill:getV2Fill(a.style.isFilled,a.style.color),labelColor:getV2Color(a.style.color),color:getV2Color(a.style.color),size:getV2Size(a.style.size),font:getV2Font(a.style.font),dash:getV2Dash(a.style.dash),align:"middle"}}]);let t=e.getShapePageBounds(u.id);if(e.updateShapes([{id:u.id,type:"geo",props:{text:a.label??""}}]),t.width===t.height){let t=e.getShape(u.id),{growY:n}=t.props,r=coerceDimension(t.props.w),i=coerceDimension(t.props.h),o=r+n/2,a=i+n/2;e.updateShapes([{id:u.id,type:"geo",x:coerceNumber(t.x)-(o-r)/2,y:coerceNumber(t.y)-(a-i)/2,props:{w:o,h:a}}])}break}case"triangle":{e.createShapes([{...u,type:"geo",props:{geo:"triangle",w:coerceDimension(a.size[0]),h:coerceDimension(a.size[1]),fill:getV2Fill(a.style.isFilled,a.style.color),labelColor:getV2Color(a.style.color),color:getV2Color(a.style.color),size:getV2Size(a.style.size),font:getV2Font(a.style.font),dash:getV2Dash(a.style.dash),align:"middle"}}]);let t=e.getShapePageBounds(u.id);if(e.updateShapes([{id:u.id,type:"geo",props:{text:a.label??""}}]),t.width===t.height){let t=e.getShape(u.id),{growY:n}=t.props,r=coerceDimension(t.props.w),i=coerceDimension(t.props.h),o=r+n/2,a=i+n/2;e.updateShapes([{id:u.id,type:"geo",x:coerceNumber(t.x)-(o-r)/2,y:coerceNumber(t.y)-(a-i)/2,props:{w:o,h:a}}])}break}case"ellipse":{e.createShapes([{...u,type:"geo",props:{geo:"ellipse",w:2*coerceDimension(a.radius[0]),h:2*coerceDimension(a.radius[1]),fill:getV2Fill(a.style.isFilled,a.style.color),labelColor:getV2Color(a.style.color),color:getV2Color(a.style.color),size:getV2Size(a.style.size),font:getV2Font(a.style.font),dash:getV2Dash(a.style.dash),align:"middle"}}]);let t=e.getShapePageBounds(u.id);if(e.updateShapes([{id:u.id,type:"geo",props:{text:a.label??""}}]),t.width===t.height){let t=e.getShape(u.id),{growY:n}=t.props,r=coerceDimension(t.props.w),i=coerceDimension(t.props.h),o=r+n/2,a=i+n/2;e.updateShapes([{id:u.id,type:"geo",x:coerceNumber(t.x)-(o-r)/2,y:coerceNumber(t.y)-(a-i)/2,props:{w:o,h:a}}])}break}case"draw":if(0===a.points.length){decideNotToCreateShape(a);break}e.createShapes([{...u,type:"draw",props:{fill:getV2Fill(a.style.isFilled,a.style.color),color:getV2Color(a.style.color),size:getV2Size(a.style.size),dash:getV2Dash(a.style.dash),isPen:!1,isComplete:a.isComplete,segments:[{type:"free",points:a.points.map(getV2Point)}]}}]);break;case"arrow":{let t=coerceNumber(a.bend),n=getV2Point(a.handles.start.point),r=getV2Point(a.handles.end.point),i=et.B.Dist(n,r);e.createShapes([{...u,type:"arrow",props:{text:a.label??"",color:getV2Color(a.style.color),labelColor:getV2Color(a.style.color),size:getV2Size(a.style.size),font:getV2Font(a.style.font),dash:getV2Dash(a.style.dash),arrowheadStart:getV2Arrowhead(a.decorations?.start),arrowheadEnd:getV2Arrowhead(a.decorations?.end),start:{type:"point",x:coerceNumber(a.handles.start.point[0]),y:coerceNumber(a.handles.start.point[1])},end:{type:"point",x:coerceNumber(a.handles.end.point[0]),y:coerceNumber(a.handles.end.point[1])},bend:-(i*t)/2}}]);break}case"text":e.createShapes([{...u,type:"text",props:{text:a.text??" ",color:getV2Color(a.style.color),size:getV2TextSize(a.style.size),font:getV2Font(a.style.font),align:getV2Align(a.style.textAlign),scale:a.style.scale??1}}]);break;case"image":{let t=r.get(a.assetId);if(!t){console.warn("Could not find asset id",a.assetId);return}e.createShapes([{...u,type:"image",props:{w:coerceDimension(a.size[0]),h:coerceDimension(a.size[1]),assetId:t}}]);break}case"video":{let t=r.get(a.assetId);if(!t){console.warn("Could not find asset id",a.assetId);return}e.createShapes([{...u,type:"video",props:{w:coerceDimension(a.size[0]),h:coerceDimension(a.size[1]),assetId:t}}])}}let d=coerceNumber(a.rotation);0!==d&&(e.select(l),e.rotateShapesBy([l],d))}),o.forEach((r,i)=>{let o=r.map(e=>n.get(e)),a=n.get(i);e.groupShapes(o,a);let l=t.shapes[i],c=coerceNumber(l.rotation);0!==c&&(e.select(a),e.rotateShapesBy([a],c))}),a.forEach(r=>{if("arrow"!==r.type)return;let i=n.get(r.id),o=e.getShapeUtil("arrow");for(let a of(e.inputs.ctrlKey=!1,["start","end"])){let l=r.handles[a].bindingId;if(l){let r=t.bindings[l];if(!r)continue;let c=n.get(r.toId),u=e.getShape(c);if(!u)continue;if(c){let t=e.getShapePageBounds(c),n=e.getShape(i),l=(0,E.uZ)((coerceNumber(r.point[0])+.5)/2,.2,.8),u=(0,E.uZ)((coerceNumber(r.point[1])+.5)/2,.2,.8),d=e.getPointInShapeSpace(n,{x:t.minX+t.width*l,y:t.minY+t.height*u}),p=e.getShapeHandles(n),h=o.onHandleDrag(n,{handle:{...p.find(e=>e.id===a),x:d.x,y:d.y},isPrecise:.5!==d.x||.5!==d.y});if(h){if(h.props?.[a]){let e=h.props?.[a];"binding"===e.type&&(e.isExact=0===r.distance,e.boundShapeId!==c&&(console.warn("Hit the wrong shape!"),e.boundShapeId=c,e.normalizedAnchor={x:.5,y:.5}))}e.updateShapes([h])}}}}})}),e.setCurrentPage(n),e.history.clear(),e.selectNone();let o=e.getCurrentPageBounds();o&&e.zoomToBounds(o,{targetZoom:1})})}function coerceNumber(e){return"number"!=typeof e||Number.isNaN(e)||!Number.isFinite(e)?0:e}function coerceDimension(e){let t=coerceNumber(e);return t<=0?1:t}async function tryMigrateAsset(e,t){try{if("bookmark"===t.type||!t.props.src)return;let n=await fetch(t.props.src);if(!n.ok)return;let r=new File([await n.blob()],t.props.name,{type:n.headers.get("content-type")??t.props.mimeType??void 0}),i=await e.getAssetForExternalContent({type:"file",file:r});if(!i)throw Error("Could not get asset for external content");if("bookmark"===i.type)return;e.updateAssets([{id:t.id,type:t.type,props:{...i.props,name:t.props.name}}])}catch(e){}}function migrate(e,t){let{version:n=0}=e;e.assets||(e.assets={});let r=new Set;return Object.values(e.pages).forEach(e=>Object.values(e.shapes).forEach(t=>{let{parentId:n,children:i,assetId:o}=t;o&&r.add(o),n===e.id||e.shapes[n]||(console.warn("Encountered a shape with a missing parent!"),t.parentId=e.id),"group"===t.type&&i&&i.forEach(n=>{e.shapes[n]||(console.warn("Encountered a parent with a missing child!",t.id,n),i?.splice(i.indexOf(n),1))})})),Object.keys(e.assets).forEach(t=>{r.has(t)||delete e.assets[t]}),n!==t&&(n<14&&Object.values(e.pages).forEach(e=>{Object.values(e.shapes).filter(e=>"text"===e.type).forEach(e=>{void 0===e.style.font&&e.style.font})}),n<=13&&Object.values(e.pages).forEach(e=>{Object.values(e.bindings).forEach(e=>{Object.assign(e,e.meta)}),Object.values(e.shapes).forEach(e=>{Object.entries(e.style).forEach(([t,n])=>{"string"==typeof n&&(e.style[t]=n.toLowerCase())}),"arrow"===e.type&&e.decorations&&Object.entries(e.decorations).forEach(([t,n])=>{"Arrow"===n&&(e.decorations={...e.decorations,[t]:"arrow"})})})}),n<=13.1&&null==e.name&&(e.name="New Document"),n<15&&null==e.assets&&(e.assets={}),Object.values(e.pages).forEach(e=>{Object.values(e.shapes).forEach(e=>{n<15.2&&("image"===e.type||"video"===e.type)&&null==e.style.isFilled&&(e.style.isFilled=!0),n<15.3&&("rectangle"===e.type||"triangle"===e.type||"ellipse"===e.type||"arrow"===e.type)&&("text"in e&&"string"==typeof e.text&&(e.label=e.text),e.label||(e.label=""),e.labelPoint||(e.labelPoint=[.5,.5]))})})),Object.values(e.pageStates).forEach(t=>{t.selectedIds=t.selectedIds.filter(n=>void 0!==e.pages[t.id].shapes[n]),t.bindingId=void 0,t.editingId=void 0,t.hoveredId=void 0,t.pointedId=void 0}),e.version=t,e}var oP=((u=oP||{}).Sticky="sticky",u.Ellipse="ellipse",u.Rectangle="rectangle",u.Triangle="triangle",u.Draw="draw",u.Arrow="arrow",u.Text="text",u.Group="group",u.Image="image",u.Video="video",u),oC=((d=oC||{}).White="white",d.LightGray="lightGray",d.Gray="gray",d.Black="black",d.Green="green",d.Cyan="cyan",d.Blue="blue",d.Indigo="indigo",d.Violet="violet",d.Red="red",d.Orange="orange",d.Yellow="yellow",d),ok=((p=ok||{}).Small="small",p.Medium="medium",p.Large="large",p),oI=((h=oI||{}).Draw="draw",h.Solid="solid",h.Dashed="dashed",h.Dotted="dotted",h),oE=((g=oE||{}).Start="start",g.Middle="middle",g.End="end",g.Justify="justify",g),o_=((f=o_||{}).Script="script",f.Sans="sans",f.Serif="serif",f.Mono="mono",f),oM=((m=oM||{}).Arrow="arrow",m),oj=((y=oj||{}).Image="image",y.Video="video",y);let oA={white:"black",black:"black",lightGray:"grey",gray:"grey",green:"light-green",cyan:"green",blue:"light-blue",indigo:"blue",orange:"orange",yellow:"yellow",red:"red",violet:"light-violet"},o$={mono:"mono",sans:"sans",script:"draw",serif:"serif"},oD={start:"start",middle:"middle",end:"end",justify:"start"},oO={small:"s",medium:"l",large:"xl"},oB={small:"m",medium:"l",large:"xl"},oF={solid:"solid",dashed:"dashed",dotted:"dotted",draw:"draw"};function getV2Color(e){return e?oA[e]??"black":"black"}function getV2Font(e){return e?o$[e]??"draw":"draw"}function getV2Align(e){return e?oD[e]??"middle":"middle"}function getV2TextSize(e){return e?oO[e]??"m":"m"}function getV2Size(e){return e?oB[e]??"l":"l"}function getV2Dash(e){return e?oF[e]??"draw":"draw"}function getV2Point(e){return{x:coerceNumber(e[0]),y:coerceNumber(e[1]),z:null==e[2]?.5:coerceNumber(e[2])}}function getV2Arrowhead(e){return"arrow"===e?"arrow":"none"}function getV2Fill(e,t){return e?"black"===t||"white"===t?"semi":"solid":"none"}let oU=".tldr",oL=x.T.object({tldrawFileFormatVersion:x.T.nonZeroInteger,schema:x.T.object({schemaVersion:x.T.positiveInteger,storeVersion:x.T.positiveInteger,recordVersions:x.T.dict(x.T.string,x.T.object({version:x.T.positiveInteger,subTypeVersions:x.T.dict(x.T.string,x.T.positiveInteger).optional(),subTypeKey:x.T.string.optional()}))}),records:x.T.arrayOf(x.T.object({id:x.T.string,typeName:x.T.string}).allowUnknownProperties())});function isV1File(e){try{if(e.document?.version)return!0;return!1}catch(e){return!1}}function parseTldrawJsonFile({json:e,schema:t}){let n,r;try{n=oL.validate(JSON.parse(e))}catch(t){try{if(n=JSON.parse(e),isV1File(n))return v.x4.err({type:"v1File",data:n})}catch(e){}return v.x4.err({type:"notATldrawFile",cause:t})}if(n.tldrawFileFormatVersion>1)return v.x4.err({type:"fileFormatVersionTooNew",version:n.tldrawFileFormatVersion});try{let e=Object.fromEntries(n.records.map(e=>[e.id,e]));r=t.migrateStoreSnapshot({store:e,schema:n.schema})}catch(e){return v.x4.err({type:"invalidRecords",cause:e})}if("error"===r.type)return v.x4.err({type:"migrationFailed",reason:r.reason});try{return v.x4.ok(createTLStore({initialData:r.value,schema:t}))}catch(e){return v.x4.err({type:"invalidRecords",cause:e})}}async function serializeTldrawJson(e){let t=[],n=new Set,r=[];for(let i of e.allRecords())switch(i.typeName){case"asset":if("bookmark"!==i.type&&i.props.src&&!i.props.src.startsWith("data:")){let e;try{e=await v.P6.fileToBase64(await (await fetch(i.props.src)).blob())}catch{e=i.props.src}r.push({...i,props:{...i.props,src:e}})}else r.push(i);break;case"shape":"assetId"in i.props&&n.add(i.props.assetId),t.push(i);break;default:t.push(i)}let i=t.concat(r.filter(e=>n.has(e.id)));return JSON.stringify({tldrawFileFormatVersion:1,schema:e.schema.serialize(),records:i})}async function serializeTldrawJsonBlob(e){return new Blob([await serializeTldrawJson(e)],{type:"application/vnd.tldraw+json"})}async function parseAndLoadDocument(e,t,n,r,i,o){let a=parseTldrawJsonFile({schema:e.store.schema,json:t});if(!a.ok){let t;switch(a.error.type){case"notATldrawFile":e.annotateError(a.error.cause,{origin:"file-system.open.parse",willCrashApp:!1,tags:{parseErrorType:a.error.type}}),reportError(a.error.cause),t=n("file-system.file-open-error.not-a-tldraw-file");break;case"fileFormatVersionTooNew":t=n("file-system.file-open-error.file-format-version-too-new");break;case"migrationFailed":t=n(a.error.reason===w.qx.TargetVersionTooNew?"file-system.file-open-error.file-format-version-too-new":"file-system.file-open-error.generic-corrupted-file");break;case"invalidRecords":e.annotateError(a.error.cause,{origin:"file-system.open.parse",willCrashApp:!1,tags:{parseErrorType:a.error.type}}),reportError(a.error.cause),t=n("file-system.file-open-error.generic-corrupted-file");break;case"v1File":buildFromV1Document(e,a.error.data.document),i?.();return;default:(0,v.iP)(a.error,"type")}r({title:n("file-system.file-open-error.title"),description:t});return}(0,b.ay)(()=>{let t=e.getViewportScreenBounds().clone(),n=e.getInstanceState().isFocused;e.store.clear();let[r,i]=(0,v.uK)(a.value.allRecords(),e=>"shape"===e.typeName);e.store.put(i,"initialize"),e.store.ensureStoreIsUsable(),e.store.put(r,"initialize"),e.history.clear(),e.updateViewportScreenBounds(t),e.updateRenderingBounds();let o=e.getCurrentPageBounds();o&&e.zoomToBounds(o,{targetZoom:1}),e.updateInstanceState({isFocused:n})}),o&&e.user.updateUserPreferences({isDarkMode:!0})}}}]);